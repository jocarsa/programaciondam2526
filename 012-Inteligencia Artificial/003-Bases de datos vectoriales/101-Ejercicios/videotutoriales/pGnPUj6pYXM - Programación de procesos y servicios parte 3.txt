otro uso posible de los workers consiste en crear procesos independientes que en un momento dado nos pueden servir para prácticamente cualquier cosa vamos a crear este tipo de procesos independientes ahora luego veremos hasta qué punto son independientes ahora lo son así que vamos a ver por aquí nos damos a procesos vamos a abrir un editor y vamos allá asiste a continuación voy a crear un nuevo archivo lo voy a guardar como voy a guardar como index 8.7 ml bien y en este caso vamos a ver que está guardando y ahora a continuación también lo abrimos host index 8 punto php procesos index 8 esto por aquí esto está abriéndose no sé por qué se está quedando frito así que vamos a cerrarlo y luego sabréis eventualmente lo abrimos directamente bien y ahora a continuación y ahora a continuación y lo que vamos a hacer es crear un archivo nuevo vale bien en este caso vamos a crear una serie de workers para hacer una serie de cosas voy a crear un script y aquí dentro voy a crear bar trabajadores es igual al igual raid voy a decir por aquí arriba bar número trabajadores es igual a 50 por ejemplo y por tanto ahora vengo por aquí y digo y es igual a 0 y es menor a número trabajadores y más en tal caso lo que quiero decir es que trabajadores y es igual a mí o worker y el archivo que voy a usar es tarea 8 js que no existe pero que ahora en un momento dado crearemos si todo va bien voy a crear ahora el archivo de guardarlo como tarea 8 y procesos tarea 8 js bien y tarea 8 simplemente va a decir con solé punto lo otra vez se ha quedado parece un poco frito no pasa nada entonces tarea 8 lo abrimos con brackets si todo va bien se van a abrir los archivos y si no pues los abrimos manualmente así que invex 8 bien index 8 y tarea 8 voy a poner controles punto log hola así que recargamos vamos a inspeccionar voy a quitar momento esto de momento no nos sirve luego lo volveremos a poner y en este caso nos dice hola es decir vemos como el aumento por lo menos han arrancado cada uno de estos workers entonces voy a poner aquí inicio y aquí voy a poner el código de un archivo worker totalmente libre entonces voy a hacer lo siguiente inicio arrancó el inicio función inicial hace algo y en este caso lo que voy a hacer es decir función bucle y el función bucle va a hacer alguna otra cosa así que bar temporizador esto es algo parecido a las clases y los objetos pero un poco diferente bar temporizador y entonces el inicio voy a decir temporizador es igual hace time out quiero ejecutar bucle dentro de un segundo entonces aquí en bucle función bucle y time out temporizador y temporizadores igual al pse time out y básicamente lo que voy a decir es con solé punto lo estoy en el bucle bien ahora si lanzamos esto lo que va a ocurrir es que inicio y bueno básicamente cada uno de los workers en todo momento va a decidir estoy en el buque no voy a machacar demasiado esto básicamente porque el conxo le punto lo que se va a llenar de cosas en la pantalla pero ahora lo que voy a hacer es pues como una serie de digamos personajillos en la pantalla para mostrar gráficamente cada uno de estos workers que está haciendo y entonces vengo por aquí y ahora a continuación lo que voy a hacer es decir que en index 8 aquí arriba voy a crear un canvas y de lienzo no lo voy a hacer muy grande lo voy a hacer uy se suma la 512 píxeles haters igual a 512 píxeles simplemente este lienzo nos va ayudar a ver visualmente qué es lo que hace cada uno de los 50 trabajadores y entonces ahora aquí lo que voy a hacer es decir que el contexto es igual a un documento punto get elemento by heidi lienzo punto get contexto 2 d entonces de esta forma sabemos ya sabemos que desde un worker no podemos pintar directamente dentro d dentro del campo pero sabemos que podemos pasar información y por tanto aquí puedo hacer un punto y el inicio puedo hacer una función bucle y de hecho incluso me puedo copiar bar temporizador vamos a meterlo aquí me puedo copiar temporizadores igual acepta un núcleo me puedo copiar esto de aquí y aquí voy a poner inicio y en definitiva la idea es que podemos debemos trabajar con un bucle en el principal y luego otros tantos bucles en los elementos digamos del inicio bien ahora una vez que tenemos esto vamos a hacer que digamos esto haga cosas interesantes muy bien vamos a comentar el código anterior así que voy a copiar eso y voy a decir defino el número de trabajadores que tendría simultáneamente el resto grande específico un contexto en el cual dentro voy a dibujar he dejado esta línea los trabajadores son una nueva colección donde en cada uno de ellos pondré un worker un burger me ha cogido bien creó un nuevo vamos a verlo creó un nuevo temporizador vacío para cada uno de los trabajadores dentro de la colección los asignó como un trabajador y ahora aquí digo llamo a la función de inicio delfino la función de inicio conveniencia ahora las cosas dentro de un segundo ejecutamos la función de bucle vengo por aquí y digo defino la función de bucle eliminó el temporizador anterior para refrescarlo y yo aquí creó un nuevo temporizador recursivo que se llama a sí mismo realmente que llama a la misma función llamada la función de bucle bien pues si tenemos esto si hasta ahora tenemos esto a continuación yo vengo por aquí y dentro de el trabajador voy a hacer lo siguiente vamos a ver ahora para cada uno de los workers cuidado aquí para cada uno de los workers lo que quiero es que me digan dónde están y lo que quiero es que me digan pues bueno que digamos que tienen entonces vamos a por ello vamos a ver ar trabajadores bar personajes es igual ánimo array y ahora voy a decir en este caso personajes y vamos a verlo esto es que los creó desde cero es igual a de momento x es el balacera y es igual a cero hasta el momento así que en este caso lo que voy a hacer es y es igual a cero y es menor que número trabajadores y más y lo que voy a hacer de momento es decirle al sistema de la pantalla que contexto punto fil recto y voy a decir que personajes de ti punto x coma personajes de un punto y coma 2,2 y si todo ha ido bien vamos a verlo si todo ha ido bien recargamos tendremos un canvas y tendremos ahí 50 puntitos es decir 50 elementos 50 digamos puntitos iniciales por qué pues porque les he dicho que cuando nacen digamos tienen x igual a cero y es igual a cero ahora bien aquí dentro del worker el worker va a decir algo diferente y va a decir lo siguiente 2x es igual a 0 x es igual a más punto random multiplicado por 512 porque la altura del proyecto es de 512 posición y es lo mismo y de momento aquí en el bucle lo que voy a hacer es decir post message y voy a lanzar una jota son voy a decir que bueno x os x como y esposo y ya está así que vamos a verlo esto de momento no va a hacer nada os lo aseguro pero tampoco de error que es lo bueno pero ahora aquí lo que quiero es lo siguiente que quiero es trabajadores de iu punto un mes age es igual a la función y le digo en este caso que a ver si no me vuelve a fallar como antes igual si metes a ver personajes de iu punto x es igual esto es data de datos es igual a datos data punto x y personajes e ingeniero es igual a data y con lo cual de momento lo que estoy haciendo si no funciona mal que en este caso funcionado mal lo que estoy haciendo es definir las posiciones x y bien no pasa nada voy a pasar las coordenadas entonces voy a vamos a ver trabajadores new work air voy a pasarle el identificador trabajadores de ahí punto post meses y voy a decir que pide es igual a y en este caso por tanto lo que voy a hacer es decirle a cada trabajador cuál es su vida voy a decirle por aquí arriba en meses le voy a decir que esto es igual a function datos aquí arriba digo es igual a nada maribel y aquí le digo y de datos data punto y por tanto ahora aquí digo es igual aire y si todo va bien aquí voy a decir datos punto data punto y datos controla está punto y ver si ahora esto ha ido bien vamos a recargarlo y tenemos ya todas y cada una de las posiciones de los puntitos pero lo interesante en este caso es que lo que se va a encargar de las posiciones va a ser el worker y no el objeto principal el archivo principal únicamente va a recoger xe y todo lo que ocurra realmente al archivo principal le va a darle igual porque va a ocurrir dentro de los workers vamos a verlo por tanto y ahora nos metemos dentro del propio worker y bueno vamos a quitarlos con soles ya que ya están ya está claro que estamos dentro del inicio y dentro del bucle bien y ahora por ejemplo yo voy a crear diferentes cosas voy a crear var dirección es igual aquí debería preservar también vamos a poner la dirección es igual punto random x + punto p x 2 bar velocidad es igual a más punto random y por tres por ejemplo así que ahora vengo por aquí y en cada uno de los elementos del bucle pues digo en dirección más igual a más punto random menos 0.5 y esto lo multiplicó por 0 o lo que sea o no dividido por 4 por ejemplo y ahora digo pues x es igual a es más igual más puntos de la dirección y 2 y es más igual a más puntos in de la dirección entonces si todo esto ha ido bien lo que ocurre en este caso y recargo lo que ocurre en este caso es que los personajillos se están empezando a mover se mueven ellos solos así tendría que borrar el bucle aunque bueno me hace gran un poco de gracia que se queden en la pantalla vale parte como gusanitos que van creciendo pero lo importante de esto lo interesante de esto es que cada bucle va absolutamente a su rollo cada bucle va como quiere voy a darle aquí a que esto ocurra pues cada 30 fotogramas por segundo aquí voy a hacer exactamente lo mismo le voy a recargar y observamos que esto es lo que ocurre en la pantalla ahora sí ya puedo sacar el monitor y bueno de momento no creo que vea mucho ciertamente pero lo interesante de este tema es que yo ahora puedo por ejemplo poner devuelvo al archivo principal y yo puedo poner 250 programitas de estos y le doy aquí a recargar ahora veremos que hay 250 de ellos bueno pero que están ahí de la que te pego están calculando pero fijémonos voy a parar un poco esto porque parece que se ha quedado frito no sé por qué porque tampoco eran tantos pero bueno pero démonos cuenta que el cálculo de cada personaje está dentro de cada uno de los workers voy a ir a procesos de nuevo que parece que nos ha sentado muy bien lo de que le haya puesto 250 pero bueno creo que no eran tantos pero como digo lo interesante es que ahora cada uno de ellos está trabajando está funcionando de forma independiente y cada uno de ellos en un espacio diferente me pare recién venga va a ver si no se me queda como antes vale en principio estos son 100 y lo que quiero ver es que pues insisto cada uno de ellos tiene un comportamiento diferente y cada uno de ellos va a su propio núcleo del procesador bien vamos a seguir metiendo condiciones para seguir viendo que el archivo de inicio prácticamente se va a quedar así pero toda la lógica va a estar aquí dentro de este archivo o aquí dentro de estos archivos así que yo ahora puedo ver por aquí y decir pues varias cosas vamos a ver voy a meter funciones voy a meter función function collection bordes así que vengo por aquí y le digo al sistema que pues bueno quiero que colisionen digamos con los bordes así que pues x es menor que 0 2x es mayor que 512 pons y es menor que cero por seguiría es mayor 512 en ese caso lo que quiero es que dirección más igual a más punto random apégate una vuelta de 180 grados y luego dentro del bucle lo que hago es decir colisión a bordes básicamente llamo a la función también puede poner por aquí function mueve y vamos a ver y ya está entonces i function cambia dirección y así luego pues vemos cómo podemos darle más código a cada uno de ellos esto es la función 9 y ahora esto es cambia dirección y esto es 9 y así de alguna forma es como que estamos trabajando con un objeto con una especie de objeto un objeto que ahora cada vez va a tener más complejidad va a tener más código pero cada uno de estos bloques es lo que va a hacer es moverse dentro digamos bien vamos a ver para cada uno de ellos rebota evidentemente y bueno vamos a continuar dándoles propiedades un poco para ver hasta dónde podemos llevar este ejercicio y para ver hasta dónde podemos llevar el hecho de que podamos trabajar en múltiples hilos en este caso tengo 100 a la vez y démonos cuenta de que si libro no es muy pesado aunque solo tengo cuatro procesadores pero tengo cien tareas y no pasa nada vamos a darle un color vamos a darle una coloración así que posee equipos y pues vamos a ver el color color vamos a r bar color r es igual a más punto round de más punto random x 256 esto es el color rojo verde y azul y por tanto lo que podemos hacer en este caso es decirle al sistema que le pasamos la información cuidado porque estamos llenando esto más de información así que f r es igual a cr cb es igual acb y no perdón es igual a cg y cb es igual acb y por tanto ahora a continuación cuando venimos por aquí pues lo que hacemos es decirle al sistema que contexto fil recto pues le decimos contexto punto field style es igual rgb como coma vamos a poner aquí los las coordenadas correspondientes entonces esto es personajes de iu y punto cr personajes de cuidado me quede dejado la perfect personajes de iu puntos personajes de punto cb y si todo ha ido bien pues vamos a ver como ahora pero fijémonos que ya está casi negro ahora vamos a ver a cada personaje debería tener su propio color pero parece que no lo está teniendo bueno vamos a verlo datos voy a refrescar del todo no sé por qué a verse todo negro y voy a hacer una cosa mi r me ve y aquí digo mi ere ha cuidado mi hijo mire y bueno simplemente he estado aquí está esto es x 0 r es 0 es cero y por tanto ahora r es igual a mier es igual a mi g es igual a mí d y por tanto aquí pongo una r pongo una g y pongo una vez guardo recargo vamos a verlo ahora y ahora sí si todo va bien cada uno cada una de las trenzas digamos cada una de las líneas cada uno de los personajes pues tiene su propio color y en definitiva pues le podemos dar una serie de propiedades diferentes vamos a ver a continuación qué bueno en un momento dado nos podría gustar digamos el hecho de poder introducir diferentes propiedades y que el sistema digamos las pueda ver entre sí e incluso las pueda actualizar en este caso por ejemplo me gustaría que los personajes digamos de alguna forma se vieran entre sí para pues interactuar por ejemplo para intentar evitarse o para cualquier otra cosa en este caso lo que tenemos que hacer con los personajes es que se vean entre sí es decir que el sistema sea capaz de enviarle a cada una de las instancias la información del resto de instancias entonces esto lo vamos a poder conseguir de una forma más o menos sencilla con bueno con la creación de con el pase digamos de información parte a otra vamos a verlo bien para hacer esto vamos a hacer lo siguiente al worker a cada uno de los workers le podemos pasar la información de el resto de workers entonces voy a hacer en este caso una cosa y es que voy a decir a otros es pero otros de momento lo voy a poner a cero pero ahora lo que voy a hacer esto es un mensaje nada vale cuando llamo el post message y cuando de hecho llamó llamo cuando de hecho llamo al post message vale puedo decirle que el identificador es igual a i y puedo decirle también que otros es igual a vamos a verlo a personales de esta forma lo que estoy haciendo es que a cada uno de los personajes le estoy pasando la lista de los otros personajes vamos a verlo me vengo por aquí y le digo bar otros y le digo otros es igual a datos punto data punto otros y al final le puedo decir cuidado otros y al final le puedo decir con solé punto el ojo otros y vamos a ver que nos da vamos a ver que nos da voy a bajar la frecuencia a bajar la frecuencia voy a recargar e inspeccionar y aquí lo tenemos ahí voy a poner menos trabajadores ver - workers me abre riesgo para que el sistema no vaya tan aquí y entonces si nos fijamos vamos a ver espera aquí vale lo que está haciendo es lanzar cada uno de los otros 10 ahora esperar un poco vamos aquí abajo y entonces veremos como el sistema lo que está haciendo es que le está enviando como un dato la posición de cada uno de los otros elementos entonces eso quiere decir que ahora cada worker pues puede conocer información acerca del resto de otros workers y por tanto puede hacer cosas como por ejemplo pues vale intentar evitarse vamos a verlo vengo por aquí me voy a tarea y ahora voy a crear una función llamada evitarse bien vengo por aquí y ahora le digo lo siguiente quiero por y es igual a cero y es menor que y ahora viene la cuestión y es menor que datos data punto otros puntos link creo yo porque esto es directamente vale para cada uno de ellos voy a averiguar cuál es su dirección cuidado hace falta un y más bien voy a poner javascript distance between two points voy a la clásica ecuación que está aquí vale y voy a decir a es igual a 2 x menos datos punto data punto otros de iu punto x porque x pues porque si nos fijamos tengo aquí para cada uno de ellos su x ahora la ve esposa y menos datos punto de ata a punto otros puntos y la fe es la distancia entonces yo a continuación digo si es cierto que la distancia es menor que no sé 20 en ese caso yo lo que quiero es dirección más igual a más puntos y esto quiere decir que cuando me acerco a alguien pues doy la vuelta voy a poner aquí evitarse voy a poner la función activa dentro del bucle así es que si ahora vengo por aquí y recargo voy a bajar un poco la frecuencia ahora que ya hemos visto lo que queremos y no hace falta que pongamos ya el conxo le punto log porque si no se nos van a llenar la consola de matrices recargo bien cuidado datos y snow design al evitarse mal por qué pues porque datos está aquí entonces ok esto es otros vale pues sólo con poner otros en principio debería funcionar porque allí pues lo he puesto en una variable recargamos datos es notifight otra vez a ver que recargue entero al evitarse otros puntos recargamos valer ahí los tenemos no sé si están haciendo algo o qué tendría que haber los time outs 33 y 33 voy a desactivar evitarse a ver si es que evitar se está haciendo que se quede frito pues igual sí hablemos voy a hacer distancias igual a 5 activo evitarse porque parece que se están quedando fritos en el sitio si te parece que voy a hacer una cosa con sole punto nov cambiando a ver si está entrando ahí dentro cambiando efectivamente por lo que sea parece que se están detectando como que están todo el rato unos pegados a otros si distancia es menor que 5 voy a repasar el código otros y voy a hacer una cosa con soles punto el ojo otros de x y otros y quiero ver las x y las y griegas de los personajes quiero ver si están acogiéndose correctamente así que parece que se están cogiendo correctamente así que no parece que esto sea un problema vamos a hacer un con sol y punto de logo de la distancia y este consuelo ya no hace falta tampoco cuidado recargamos vamos a ir como esto ya está usando procesador vale inspeccionar vamos a ver la consola a ver qué nos dice voy a volver a trabajar el tiempo con solo bien y en principio esto que estamos viendo aquí es la distancia vemos que en prácticamente ningún caso es menor si la distancia es menor que 5 en ese caso dirección nacional aquí así que vamos a ver esto y por tanto no acabo d de ver cuál es el sentido de que diga que está cambiando vamos a hacer esto con todavía más tiempo vamos a poner esto con todavía más tiempo y vamos a poner menos jugadores en pantalla voy a poner 2 así que ya sé lo que está pasando ya sé lo que está pasando y lo que está pasando es que se está cogiendo a sí mismo porque sí mismo es un jugador muy bien entonces si distancias igual a cero and distancia no es igual o sea si es menor que 5 y no es igual que 0 bueno cambiando le aparece uno como distancia es interesante y distancias mayor que 1 vamos a ponerlo cambiando de nuevo vamos a poner mayor que 2 parece que se está cogiendo a sí mismo con lo cual no debería vale entonces ahora vamos a volver a bajar vamos a verlo otra cosa es que además estoy cogiendo puedo la id entonces si puedo la idea si puedo la ive es ti así pues puedo decirle al sistema directamente si otros punto y d dónde estás y otros puntos no es igual a mí al aire y en definitiva lo que estoy haciendo con esto es no cogerme el mismo vale sigue por ahí cambiando vale no pasa nada voy a decirle y otros con distancia es mayor que 4 voy a hacerle menor que días vamos a verlo recargamos ahora vale se empiezan a mover creo que se sigue cogiendo a sí mismo pero bueno vamos a poner más para que haya un poquito más de opciones a que colisionen bien fijémonos qué vamos a verlo en cuanto hay 20 bueno aparte de que la consola la voy a liberar evidentemente porque sí no vale pensamos que vamos a empezar a probar poco a poco el procesador al cien por cien puede incluso matar el proceso arrancamos chrome lanzamos de nuevo vamos con 5 llegamos allá bien pues ahora lo que estoy esperando es a ver si se acercan los unos a los otros y yo creo que hay uno que ya ha colisionado pero bueno no se lo puedo saber y ahí van a coleccionar pero parece que no curioso voy a darles un poquito más de es menor que 10 no menor que 50 por lo menos vamos a recargar ay ahí lo han hecho hay dos que se van a acercar demasiado y se han evitado entre sí y hay dos que también se estaban acercando y se han evitado entre sí así que ahí podemos verlo ahora lo que quiero es un poco ir subiendo poco a poco voy a poner 15 para comprobar que el sistema pueda con ello ahí tenemos 15 o hay dos claros se quedan atrapados hay dos que hay varios que se quedan atrapados cuando están demasiado cerca se quedan atrapados entre sí es curioso cuando nacen demasiado cerca es como que no se pueden alejar hay una salida y se vuelve a quedar atrapados y ahora a continuación voy a ir subiendo poco a poco yo creo que la sobrecarga de antes era por tener la consola abierta vamos a poner 25 también lo que voy a hacer aquí en la tarea es ahí vemos como el procesador va subiendo es decirle que bueno no va a ser distancia 50 va a ser distancia 20 una vez más lo bueno lo divertido de esto es que pues vemos como la lógica del comportamiento de cada uno de estos elementos pues va independiente a cada uno de ellos vemos como yo puedo poner lógica y la lógica va a ir totalmente de forma totalmente independiente en cada uno de estos personajes como ya momento en el que dibujamos si no se ve muy bien lo que podemos hacer es volver aquí y ahora pondremos más comentarios y vamos a decir que vamos a decir qué contexto punto feel style es igual a rgb ah 255 25 54 55 0.1 contexto punto fil recto 00 512 coma 512 esto en lugar de borrar la pantalla lo que hace es como una máscara semi transparente que hace que los personajes pues dejen un pequeño rastro así que pues bueno ahí los tenemos y la idea es comprobar cómo van dejando un momento de colisión de hecho hay algunos que se quedan fritos es interesante de ver una cosa que puedo hacer por ejemplo es ponerles tamaño y así si les ponemos tamaño pues igual podemos mejor pues podemos ver mejor como colisionan vamos a por ello voy a ponerle el tamaño por tanto entonces para ponerles tamaño son como un poco como perfecto es una pecera vamos a una res tamaño por aquí así que y desigual allí y tamaño me apartan es igual a cero vamos a ver por aquí tamaño es igual a cero realmente no realmente aquí no lo que sí quiero es retornar lo entonces bar tamaño es igual a 2 por ejemplo y ahora lo que quiero hacer es decirle lo siguiente en el bucle tan es igual a 2 y si la distancia cambia tan es igual a 23 igual a 5 y esto lo que va a hacer y esto lo que va a hacer ahora vengo aquí te digo es igual a tan lo que voy a hacer aquí es que el grosor va a ser este va a ser personajes punto tan el dato tan y por tanto tengo aquí y bigotón y tam y lo que voy a hacer es cambiar el tamaño mediante programación en este caso lo que he hecho simplemente es decirle al sistema que en el momento de colisionar pues se hagan grandes como hay y así notaremos mejor cuando colisionan vemos que en el momento de colisionar en ese momento se hacen grandes y luego ya desbalances pequeños y así podemos yo creo que se ve en la pantalla como lo están haciendo y así también me ayuda a ver cuáles de ellos están atrapados y cuáles de ellos pues no vamos a ir como ustedes atrapan vemos que algunos se quedan atrapados por parejas llega uno de repente los desbloquea bueno y ahora pues una vez más puedo ir metiendo poco a poco nuevos elementos más elementos voy a meter 50 a ver qué pasa y ahí lo tenemos la idea es ir subiendo poco a poco y subiendo en poco a poco bien además voy a intentar que se pegue en un empujón cuando sé cuando se cambia en la dirección voy a hacer esto dirección velocidad creo que al final no he utilizado por velocidad por tres poco como para que se peguen un empujón y por cierto aquí voy a poner también la velocidad que no la estoy teniendo en cuenta en ningún momento recargamos bien cuidado no tanta velocidad vamos a bajar menos velocidad aunque tampoco me disgusta pero partido 2 y bueno la idea es verse así al rebotar pues se atrapan menos pero yo creo que es porque viendo que se tratara igual vamos a intentar buscar más al sistema vamos a decirle que queremos ahora 150 y siempre estamos viendo aquí como va subiendo el procesador conforme vamos subiendo los elementos al en vemos que es el procesador con 150 ya empieza a tener ciertos problemas para gestionar la información sobre todo porque hay un json que está yendo y viniendo en cada momento pero es inevitable porque pues tenemos que decirle al sistema cuántos elementos hay y parece demasiado así que no lo vamos a bajarlo de nuevo a 50 y así un poco estamos comprobando que podemos digamos llevar el sistema a su límite podemos forzar el sistema y podemos en todo momento monitorizar el procesador y comprobar como cada tarea se está ejecutando de forma independiente ahí lo tenemos