bien Vamos por tanto a hacer esta primera aplicación en jsp para comprobar que ya no va a ser solo javascript el que valide ese código sino que también vamos a poder combinarlo con Java en el lado del servidor en este primer ejemplo en esta primera batería de ejemplos usando una tecnología llamada Java server pages o páginas de servidor creadas en Java y que para ello me voy a crear un nuevo proyecto va a ser un proyecto de dynamic web project estoy haciendo lo mismo que he hecho antes Entonces lo voy a llamar Hola mundo jsp y dentro de Hola mundo jsp lo que voy a hacer es simplemente crear un nuevo archivo con la extensión jsp de la misma manera que en un sitio web estático la primera página se tiene que llamar index.html.com si os aparece ese error eso técnicamente no es un error pero bonito tampoco queda por tanto cuando ocurre eso simplemente es que el proyecto no tiene bien enfocado no sabe Ahora mismo Quién es el servidor que lo tiene que ejecutar para arreglar ese pequeño error que no lo es tanto pero supongamos que lo sea tenemos que hacer lo siguiente Solo cuando aparezca pulsamos con botón derecho encima de la carpeta del proyecto que tenemos actualmente en este caso siab con el proyecto holamundo jsp pulso botón derecho justo encima del nombre del proyecto holamundo jsp a continuación me voy a properties me voy a propiedades del proyecto dentro de esta ventana con multitud de propiedades y opciones veréis que hay una sección llamada targeted Run Times es decir los objetivos de servidor donde os aparecerá un número de servidores con toda probabilidad como mínimo os aparecerá tomcat 7 y tal vez os aparezca también Java Enterprise preview Así que marcamos tomcat 7 por tanto le estamos diciendo que vamos a usar tomcat 7 y le estamos diciendo que vamos a usar el jre 1.7 y simplemente pulsamos Ok Esto es algo que esperaríamos que el programa hubiera hecho automáticamente pero no lo hace automáticamente tras unos segundos comprobaremos como el error debería desaparecer en pantalla momento en mi caso no está desapareciendo Porque además debo marcar también Java Enterprise preview Así que ahora sí una vez hagáis eso comprobaré como el mensaje de error ese pequeño mensajito de error desaparece de las líneas una vez que tenemos el proyecto configurado aparte de como ya sabéis siempre me gusta escribir sangrías lo que hacemos es escribir nuestra primera línea de jsp que es la siguiente en primer lugar escribimos como si fuera una etiqueta html menor que porcentaje si todo va bien eclipse la cierra automáticamente con porcentaje mayor que y ahora esto es muy importante porque esto marca un cambio con respecto a cómo hemos estado trabajando hasta ahora esa etiqueta yo ahora mismo la he abierto una vez la he cerrado una vez en un proyecto la podemos abrir y cerrar Tantas veces como queramos no hay ningún problema con eso Pero hay una regla que debéis seguir a raj tabla Y es que todo aquello que esté entre esta etiqueta y esta etiqueta es Java y todo aquello que esté fuera de esta etiqueta o antes de esa etiqueta es html así de sencillo por tanto si yo ahora pongo Hola intento ejecutar Este programa como no hay ningún comando voy a decir Java preview en mi caso como no hay ningún comando en Java de hecho veis que ahí me da un error que sea Hola veréis que Ah un momentín porque yo tengo que parar mi servidor tomcat bien Vamos a ejecutar de nuevo el programa y lo que ocurrirá es que el servidor me va a devolver un error y comprobemos como ahora en una página web por ahí Ahora cuando quiera está conectando y ahora lo que va a ocurrir es que me da un error server error y lo que dice es que no sabe lo que hay en la línea 12 no sabe interpretar lo que hay en la línea 12 en la línea 12 Mira tú por dónde está el Hola técnicamente está en el 11 pero el programa cree que está en el 12 Qué vamos a hacer pues tener cuidado y saber que todo aquello que vamos a escribir tiene que estar bien escrito en lenguaje Java no en el mismo lenguaje con el que programático que es printline así que printline imprime una l este lo vamos a usar muchísimo aunque es básico es muy útil y digo Hola mundo en jsp qué estoy diciendo lo que estoy diciendo es digamos vomita en html Devuélveme en html lo que yo te ponga en Hola mundo en jsp Ya sé que este ejercicio parece que no tenga mucha utilidad ahora mismo cierto que no la tiene pero veréis que es mucho más importante de lo que parece así que paro el servidor vuelvo a ejecutar y ahora comprobaremos que salá la página correcta y me dice hola mundo en jsp es algo muy poco impresionante pero ahora veréis a la vuelta del Descanso que es la llave de entrada para desarrollar cualquier aplicación usando esta tecnología usando jsp azul continuamos con jsp Y en este caso antes de embarcarnos en cosas más complejas Como fundamentalmente abrir conexiones con bases de datos que no es lo único que hace jsp pero desde luego es una de las cosas que pienso que son más interesantes para el desarrollo de aplicaciones empresariales pues vamos a ver un poco qué podemos hacer con Este lenguaje lo primero que hemos visto lo más sencillo consiste en lanzar cosas en html en la pantalla pero teniendo en cuenta que cada vez que abro estas llaves realmente estamos dentro de Java puedo usar no todo aquello que tenemos en Java pero una gran parte Como por ejemplo la declaración de variables Así que voy a declarar una variable de tipo entero llamada edad que es igual a 36 ojo que ya no está japt estamos en Java por tanto las variables ya no se declaran con bar se declaran con el tipo de dato de la variable y a continuación el nombre de la variable Así que ahora puedo hacer algo tan sencillo como out printline vamos a aquí bajar un poco out printline y digo el doble de la edad es espacio más paréntesis por favor edad por dos técnicamente según el orden de precedencia en matemáticas la multiplicación va antes de la suma pero si le ponemos unos paréntesis pues mejor que mejor en este ejemplo los paréntesis no harían realmente nada porque la propia precedencia resuelve antes la multiplicación que la suma o encadenamiento pero si se lo ponemos pues mejor que mejor así que cuidado porque en algún momento deberíamos poner algún br verdad Para que se produzca algún salto de línea así que si ahora ejecuto la aplicación acordaos que para ejecutar la aplicación es posible que tengáis que parar el servidor y vuelvo a recargar comprobaremos como me dice hola mundo en jsp y el doble de la edad es 32 Así que fácilmente hemos ido capaces de declarar una variable Y a partir de ahí empezar a jugar con ella de la misma manera que podemos declarar variables también podemos jugar con estructuras de control Así que en este caso Bueno solo voy a demostrar una porque el resto son iguales voy a por la estructura de control for por tanto voy a decir for bar no int dia es igual a 1 punto y coma día es menor o igual que 31 coma día más y lo que estamos haciendo es crear una estructura de control donde voy a bclear a través de 31 valores y ahora digo out printline Hoy es el día más día siendo día la variable correspondiente al interior del bucle for por tanto si ejecuto de nuevo este pequeño programa bueno Y si le pongo un br después pues mejor que mejor como os podréis imaginar por lo menos para estilizar un poco un momento Ay fijaos daos cuenta como recargo pero al recargar no me hace caso al br por qué porque no basta con recargar al igual que valía en javascript tengo que darle a stop tengo que darle a Play y al darle a Play lo que observo es que ahora sí lo que tengo es hoy es el día 1 hoy es el día 2s hoy es el día así hasta el día 31 es decir tener en cuenta que cada vez que lanzo el servidor lo que hace el servidor internamente Aunque vosotros no lo veáis un momento que así lo que hace internamente el servidor aunque no lo veáis es compilar la aplicación y por tanto una vez que la aplicación está compilada si yo hago modificaciones en el código y le doy a recargar no voy a ver las modificaciones por eso es por lo que esto es lo que diferencia una de las cosas que diferencia a Java Enterprise de php o asp y lo que tengo que hacer por tanto como ya habéis visto es parar el servidor y volver a arrancarlo y solo entonces las modificaciones son tenidas en cuenta al introducir jsp empezamos a introducir el propio concepto de modelo vista y controlador es decir la separación por capas donde la idea de Java Enterprise es precisamente desarrollar aplicaciones que estén separadas en varias capas este es concepto que hoy todavía no voy a machacar demasiado pero os diré que eh jsp es un componente de Java Enterprise sobre todo pensado para hacer vistas sobre todo para pensado para hacer interfaces de usuario otra fórmula de escritura dentro de Java Enterprise y dentro de jsp es la siguiente Mirad si empezamos a diferenciar Y hoy no me voy a obsesionar demasiado con que diferencieis pero quiero iros introduciendo el concepto nos daremos cuenta que esta parte de aquí de int edad esto es realmente programación realmente la edad es programación el for es programación pero técnicamente el printline es interfaz de usuario el printline lo que hace es devolverme algo en la interfaz de usuario Así que para establecer una mejor separación y para que veáis dos maneras de trabajar directam diferentes en jsp voy a hacer lo siguiente Justo a continuación del for si queréis me voy a cargar esto vamos a dejar el ejercicio estrictamente en el for justo al acabar el for Cierro la etiqueta de jsp a continuación abro de nuevo la etiqueta aquí la tenemos para la siguiente parte y fijaos lo que ocurre Hoy es un día bonito es mentira porque es lunes pero pongamos que lo es entonces daos cuenta de una cosa Esto es jsp esto es Java al final Pero esto es html puro y duro ahí no hay un out pun printline sino es html directo Claro si aquí he abierto un for evidentemente Aquí tengo que cerrarlo Y aunque he abierto y he cerrado jsp dos veces no pasa nada porque es perfectamente legal Así que guardo no recargo porque no voy a ver ningún Mira sí que me lo ha calculado ha habido suerte vale Hoy es un día bonito no he tenido que refrescar Y si os fijáis lo que he hecho es separar por una parte lo que es Java puro y duro lo he separado dentro de etiquetas de jsp y lo que es interfaz de usuario lo que no es pensamiento sino que lo que es directamente interfaz lo he extraído como html un poco buscando siempre esa separación entre Dinámico y estático entre Java y html dentro de que se puede poner perfectamente out printline no os estoy diciendo que no lo pongáis ahora claro eso tiene un pequeño problema Y es que yo vengo aquí y digo Hoy es el día no eso ya no vale Porque si yo digo Hoy es el día a día ahora sí que parece que voy a tener que parar y reiniciar vamos a verlo y fijaos como dice Hoy es el día porque este día veis que ya no es una variable de jsp ahora Este es un html puro y duro Qué puedo hacer pues puedo hacer porcentaje menor que porcentaje igual y porcentaje de cierre cuidado esto es Java en su modo de Java en Java server pages eso simplemente aquí dentro voy a escribir código pero menor que porcentaje igual es Dime algo Esto no es Dime algo esto es bueno declara algo declara una variable declara lo que quieras pero esto es entro dentro de jsp y le digo que quiero devolver algo en la pantalla en este caso la variable día por tanto guardo y recargo a ver si tengo que refrescar y me dice Hoy es el Día uno Hoy es el día dos Hoy es el día tres y así hasta el día 31 qué es lo que estoy haciendo pues lo que estoy haciendo es simplemente intentar separar al máximo posible lo que sea interfaz de usuario que se quede en html y lo que sea comportamiento lo que sea programación que realmente se quede en formato Java hay veces que no será tan fácil como en esta ocasión separar pero siempre que podamos para la futura mantenibilidad de la aplicación deberíamos intentar Separar en diferentes capas vamos a hablar ahora mismo de una limitación de jsp Y por supuesto Cómo superar esa limitación para ello voy a crear un nuevo proyecto voy a cerrar este proyecto y voy a crear una vez más un dynamic web project que va a recibir el nombre de jsp sesiones Así que igual que siempre creo un jsp sesiones y dentro de web content lo que voy a hacer es simplemente crear dos archivos jsp un primer archivo llamado index SP y un segundo archivo llamado Pues algo así como destino. jsp Oh vaya me sigue dando el mensajito de error de antes ya sabéis que no es un error muy preocupante y ya sabéis que si alguna vez os sale se arregla pulsando botón derecho al proyecto y dentro de properties dentro de Target r time Pues elegís en vuestro caso tomcat en el mío dado que estoy en Linux tengo que elegir también el Java preview Así que pulso Ok y error arreglado ahora voy a hacer lo siguiente atención voy a abrir jsp y voy a decir int edad es igual a 36 algo que ya hemos hecho antes por tanto y permitidme ahora no Separar en capas voy a decir out printline os vais a cansar de escribir esta instrucción el doble de tu edad es más paréntesis edad por 2 Y por último ahora y fuera de Java Enterprise fuera de jsp hacemos una href que me lleva a destino jsp y digo vamos a la segunda página es decir tengo una página en la cual declaro una variable edad a continuación realizo una sencilla operación con esa variable edad Y por último Digo vamos a la segunda página si todo ha ido correctamente voy a para el servidor del proyecto anterior ejecuto este nuevo proyecto le digo en mi caso Java preview bien en mi caso vamos a ver Parece que tengo por ahí arrancado algún servidor un segundo vale Así que arranco bueno Vale en mi caso voy a tener que cerrar y volver a abrir Así que vuelvo a abrir eclipse ya sabéis que cuando se engancha mucho pues Generalmente reiniciar e clipse se arregla el problema y si aún así no se arregla pues reiniciar el ordenador no suele fallar es lo que tiene la informática Entonces ahora veréis que básicamente yo hago una operación y me voy a otra página y aquí viene el misterio y erróneamente espero que la otra página recuerde Cuál es mi variable y no la va a recordar y vamos a ver por qué Y cómo solucionarlo por tanto lo que hago ahora es refrescar al refrescar ejecuto el proyecto y me dice el doble de tu edad es 72 vamos a la segunda página Así que hago clic y vamos a la segunda página destino. jsp existe pero no tiene nada de código Así que ahora atención voy a hacer algo que os va a parecer muy inocente y digo out printline y digo el doble de tu edad o el triple si quieres de tu edad es más edad por 3 y lo que ocurre y el problema es el siguiente ya para empezar aquí y parece que estoy teniendo un error y me dice edad no se puede resolver como variable yo digo cómo que no si la he definido yo antes vamos a ver qué pasa así que refresco me da un error vamos a volver Mirad eh el doble de tu edad es 72 vamos a la segunda página por tanto hago clic y me da un error vamos a ver qué dice el error esto es lo que os decía anteriormente que ahora que estamos en el lado del servidor el error ya no aparece en la consola sino que el error aparece directamente en el navegador Así que dice mira el error es que no puedo encontrar un símbolo y el símbolo que me está dando el error es la variable edad es decir tenemos lo mismo aquí Tenemos el mismo error aquí que en el navegador Pero cómo es esto posible si yo he declarado una edad aquí y yo estoy usando la edad aquí pues lo que he hecho técnicamente es forzar el cometer un error y este error sirve para demostraros que jsp es un lenguaje sin estado quiere decir y esto es un poco una limitación ahora veréis que tiene sentido Pero es una limitación impuesta por el protocolo http Y es que cada vez que yo cargo una página jsp abro la página cargo un programa cargo recursos y cuando la página se cierra los recursos se cierran todo lo que yo haya creado funciones variables todo se olvida en este caso lo que ha ocurrido es que cuando cargo Index jsp al llegar aquí al final de la página todo lo que yo he creado se olvida y por tanto cuando entro dentro de destino. jsp simplemente destino es otro programa diferente está dentro del mismo proyecto pero es un programa diferente y por tanto no recuerda no tiene en cuenta lo que es la variable edad esto proviene por el propio protocolo http el protocolo con el cual visualizamos páginas web lo que ocurre con este protocolo sencilla y básicamente es que cada página web que cargamos es una página diferente claro nosotros querríamos que recordara variables pero el caso es que no lo está haciendo y lo que estamos haciendo con jsp básicamente es usar Java dentro de una página web Así que no es una limitación de Java técnicamente es una limitación del protocolo web Pero oye es la limitación que hay por tanto visto cuál es el problema Vamos a abordar una de las múltiples posibles soluciones una de las múltiples maneras de salvar este problema es usar un tipo especial de variables que no existen en Java normal que se llaman variables de sesión las variables de sesión son unas variables que sí que son capaces de pervivir de una página a otra así que me voy a index.jsp y digo session punto y aparecen unos métodos no hay muchos Pero hay un método particular hay dos métodos particulares Perdón que son el set y el get ya habréis visto en Java en programación en clases que siempre que encontráis un set y un get el set lo que hace es poner atributos el get lo que hace es recuperar atributos pues set attribute que espera dos argumentos dice edad es igual a 36 y por supuesto un punto y coma al final lo que he hecho por tanto es no usar una variable local sino usar una variable de sesión más que usar Mejor dicho lo que he hecho es definir una variable de sesión la variable local si queréis ya no sirve la voy a comentar por tanto con set attribute lo que he hecho es definir una variable de sesión ahora lo que voy a hacer es usar lo que voy a hacer es leer lo que voy a hacer es recuperar la variable de sesión Así que voy a decir session punto get attribute y el atributo que recupero es edad vamos a verlo session.get attribute edad qué me dices claro Oh tengo un problema y es que me dice a ver que no es capaz de realizar operaciones bueno no pasa nada lo que voy a hacer en este caso es eliminar de momento el signo de multiplicación porque tengo un problema de tipos y es que me dice que no reconoce esa variable como una variable entera tendría que hacer un casting tendría que hacer una conversión pero de momento vamos a dejarlo así porque Únicamente lo que quiero hacer en la página de destino. jsp es lo siguiente tu edad es y digo sesión pun get attribute y el atributo es edad fijaos que en la página de destino. jsp error no me da porque dice Bueno no has definido aquí la variable de sesión pero igual la has definido en otra parte Así que no tiene por qué ser correcto pero tampoco puedo decir que sea incorrecto Y si ahora probamos Este programa veremos que hace lo siguiente yo ahora recargo es decir el servidor y vuelvo a cargar atención me dice el doble de tu edad es 36 no es 36 vale pero me lo he dejado Así vamos a la segunda página si vamos a la segunda página me dice tu edad es 36 Así que como acabáis de ver el uso de variables de sesión es uno de los mecanismos que incorpora Java server pages para ser capaces de saltarnos El la dificultad De que jsp al igual que php y asp que son lenguajes de tipo stateless es decir son lenguajes sin estado que pierden el estado en cada página pues puedan pervivir al menos algunas de las propiedades un pequeño detallito es que en el momento en el que empecéis a usar sesiones vamos a cargar esto con Chrome en el momento en el que empecéis a usar sesiones veréis que si inspeccion elemento y me voy a resources veréis que aunque vosotros no lo habéis pedido se crea una Cookie llamada J session ID la sesión de Java Enterprise vale el ID de la sesión de Java Enterprise esa Cookie no la habéis creado vosotros tiene un valor codificado y sirve precisamente para localizar vuestras variables en el servidor se crea una sesión en el servidor simplemente que sepáis que se crea esa Cookie no la destruy porque necesitáis usarla para trabajar con sesiones otro mecanismo para conseguir pasar información de una página a otra es usar parámetros o bien mediante get o bien mediante post así que me voy a crear un nuevo proyecto sí un nuevo proyecto otra vez de dynamic web project y este proyecto se va a llamar jsp request donde el request es una propiedad que me permite atar parámetros pasados de una página a otra en este caso en la clase de hoy mediante el método get que es el más sencillo Así que Finish voy a crear en jsp request una nueva página jsp por ejemplo la voy a llamar index.jsp y otra vez voy a volver a crear ot página jsp llamada destino. jsp el proyecto es clavado al proyecto anterior con Index jsp y destino. jsp vuelvo a tener el error en la línea número uno pero vuelvo a pulsar botón derecho properties y le digo otra vez que en targeted r Times le activo los dos runtimes que tengo aquí tras lo cual en unos pocos segundos el error debería desaparecer si no refresco y si no probablemente un guardar ahí está A veces cuando un error no se va igual que en Java escribes algo guardas y el programa como que se da cuenta de los cambios y entonces limpia lo que tenga que limpiar eso es algo que siempre me ha dado bastante rabia en eclipse pero es así que se va a hacer ponemos angria ponemos sría y escribimos el siguiente código el código que voy a escribir es int edad es igual a 36 y ahora digo out printline el doble de tu edad es dos puntos más edad por 2 y ahora viene hasta aquí es igual que el ejercicio anterior digamos o el primero pero ahora viene la parte de este ejercicio que es a href destino. jsp vamos a la segunda página y la novedad con respecto a lo que hemos hecho hasta ahora creo que alguno me lo preguntaste en la parte de javascript el tema de pasar parámetros y recogerlos con get aquí Vais a ver que es mucho más fácil aquí es donde realmente se supone que se hace digo interrogante es decir destino. jsp interrogante y digo edad es igual a qué bueno pues ahí lo que tengo que hacer es o pasar un parámetro mediante jsp o pasar un Java server faces caras de Java server pero como todavía no sabemos hacer eso vamos a hacerlo mediante jsp así que igual a edad madre mía lo que hay ahí vamos a verlo aquí me lo da como error vamos a ver no El problema es que no entiende que este igual realmente sí que va ahí déjame un segundin comprobar que no da error le doy a Finish sí es interrogante bien y si todo va bien Vamos a la segunda página por tanto no tenemos problemas Aunque ahí me lo subraye de Rojo No es una incorrección Mirad atención lo que voy a hacer en la pantalla Mirad destino. jsp Esta es la página de destino a continuación pongo un interrogante es todo lo que venga después van a ser parámetros que te voy a pasar y los parámetros tienen que ir separados por nombre del parámetro es igual a valor del parámetro Así que ahora digo lo siguiente Mirad recargo el doble de tu edad vamos a la segunda página y me dice destino. jsp y edad es igual a 36 porque lo que hecho es decirle y edad es igual a Dime lo que vale la variable que vale 36 pero lo divertido es lo que ocurre cuando ahora saltamos a la segunda página en la segunda página yo digo lo siguiente el parámetro que me has pasado es si queréis pongo un br y digo request punto get parameter Espera que lo encuentre get parameter Aquí estás y digo edad vamos a ver cómo funciona esto atención Mirad recargo el doble de tu edad es 72 vamos a la segunda página bien cuidado porque tengo que parar el servidor y volver a arrancarlo cuando veáis que una página no refresca los cambios que estáis haciendo es porque probablemente tenéis que refrescar el servidor Así que vamos a la segunda página bien el parámetro que me has pasado es y no me dice edad con lo cual vamos a ver qué pasa aquí en destino. jsp así por supuesto Qué pasa como has dicho efectivamente out print Line Así que out printline y lo que quiero es devolver ese parámetro Así que ahora sí Mirad refrescamos para refrescar tengo que parar el servidor qué rollo pero es así y Mirad ahora y le digo el doble de tu edad es 72 vamos a la segunda página el parámetro que me has pasado es 36 es decir qué está haciendo ese request lo que está haciendo el request es tomar el parámetro de la URL bajarlo abajo al programa y usarlo dentro del programa para practicar el uso del request voy a hacer una pequeña calculadora que la podríamos hacer prácticamente con lo que ya sabemos usando javascript pero la diferencia hoy es que el cálculo se va a realizar en el servidor no en el cliente por tanto voy a crear un nuevo proyecto un dynamic web project y vamos a crear un proyecto llamado jsp calculadora es el clásico y típico proyecto dentro de web content voy a crear un nuevo archivo jsp llamado index jsp y voy a crear otro archivo jsp que en este caso ya no se va a llamar destino sino que se va a llamar calculadora jsp recordáis que sigo teniendo el problema del errorcito en la primera línea pero vuelvo a pulsar botón derecho properties y Marco los Run Times le doy a OK Y si no desaparecen ahora pues luego desaparecerán dentro de index.jsp voy a hacer una pequeña calculadora de la siguiente manera me hago un for me hago un formulario digo action es igual a calculadora jsp donde anteriormente en el proyecto html os dije crear un formulario ficticio Que de momento Nadie puede procesar pues hoy vamos a empezar aender a procesar el formulario method es igual a get para el ejercicio de hoy necesito que el método enviador de datos sea get ya que trabajando con jsps el método preferido es get aunque también se puede usar post más adelante veremos que con servlets hay específicamente un método llamado duet para los datos que vienen por get y un método llamado do post para los datos que vienen por post pero de momento vamos a hacer get ahora digo lo siguiente digo input type text esto es html puro y duro name es igual a operando un voy a poner un signo más voy a hacer una calculadora Que de momento será una sumadora input type text name operando 2s y ahora voy a poner igual y voy a crear un input type submit value Calcula es decir tenemos un pequeño formulario que tiene un operando uno un operando dos y un botón de pulsa aquí y nos vamos a la otra página para calcularlo vamos con la segunda parte de este ejercicio por tanto voy a asegurarme que el servidor está parado voy a pulsar Play le digo Java preview y Mirad ocurre lo siguiente si el servidor arranca correctamente me dice atención me dice operando 2 más operando Calcula atención todos a la pantalla Calcula y me dice Bueno te vas a calculadora jsp y me pasas en la URL operando un es igual a 2 y operando dos es igual a 3 eso es lo que ocurre en un formulario cuando ponemos el método get lo que hacemos Es tomar los datos del formulario y pasarlos como datos en la URL por tanto ahora en calculadora jsp usando lo que os he enseñado de request vamos a ser capaces de los datos de arriba pasarlos bajo y realizar operaciones con ellos así que para ello voy a hacer lo siguiente probablemente me dé un pequeño error y ahora veréis que lo solucionamos ahora voy ahora revisamos errores y digo atención el resultado de la operación es br y digo request get parameter operando 1 más request punto get parameter operando dos y verdad si todo esto a ver qué nos dice aquí hay un mensaje de advertencia bien cuidado hay un error ahí perfecto out printline dejadme que minimice eso y ahí lo tenemos vamos a ver qué ocurre el error ha desaparecido no sé si se va a comportar bien o no por tanto paro la aplicación reinicio la aplicación y digo 4 + 3 es igual a vaya 43 bien qué es lo que ha pasado tengo un pequeño error de casting tengo un pequeño error de tipificación de datos es el típico error de Java lo que ha pasado es que en lugar de sumar 4 + 3 lo que ha hecho es encadenarme 4 + 3 Por qué Porque ha pensado que 4 no es un número sino que es una cadena y como cadena si engancho 4 con TR no da 7 da 43 pero de momento lo importante y ahora hacemos el casting Lo importante es que ya tenemos los datos cogidos y tratados dentro de la calculadora jsp si sé que el operando un y el operando 2s me los está cogiendo con como String digo teger parse int y meto ahí dentro el String es decir integer parseint en este caso del operando un momento que no le ha hecho demasiada gracia vale porque requiere el get parameter claro muy bien porque me he cargado el request Así que request get parameter y el parámetro es operando un vamos a verlo hay un error el parse int vamos a hacer una cosa Ahora ya lo tenemos bien y ahora en este también lo mismo es una cadena por tanto si queréis lo voy a separar en diferentes líneas para que lo veáis mejor atención int operando 1 es igual a integer parse int esto de aquí int operando 2 es igual a integer parce int operando 2 y ahora por tanto al final digo operando un más operando 2 es decir operando uno es una variable de tipo entero y le digo el request get parameter operando uno me lo conviertes en un parse int me lo conviertes en un entero es un String pero me lo conviertes en un entero o por lo menos lo intentas con operando 2s le digo integer.to parseint request getp operando 2 y si estos dos si estas dos capturas ya se han convertido en enteros ya puedo hacer operando uno más operando dos así que Mirad un momento vuelvo a recargar y digo 4 + 3 Calcula y el resultado de la operación es 7 es decir lo que ocurre simplemente es que lo que estoy haciendo es convertir a entero Y a partir de ahí realizar la operación azul sí lo que vamos a hacer es conectarnos a una base de datos vamos a estar trabajando con mysql que es una base de datos también de Oracle y eh vamos a en primer lugar crear una base de datos a la que nos podamos conectar y a continuación realizaremos una conexión desde Java Enterprise usando Java server pages por tanto en primer lugar lo que quiero hacer es abrir una conexión con la base de datos para a partir de ahí poder crear tanto la base de datos como un usuario con privilegios como una tabla en la base de datos como también meter un par de registros simplemente para probar que tenemos datos que recuperar en primer lugar y si tenéis instalado y ejecutando shamp lo que quiero es arrancar una utilidad que se llama php my admin veréis dentro de el panel izquierdo de la barra izquierda de color naranja de shamp que en la parte de abajo donde pone utilidades veis una utilidad que pone php my admin por tanto quiero que entréis todos y cada uno de vosotros en la utilidad llamada php my admin lo tenéis en la barra izquierda en la parte de abajo tras lo cual en mi caso dado que tengo una instalación manual tengo que acceder con usuario y contraseña veréis que aparece esta interfaz que tenéis en la pantalla es decir la interfaz de administración de php My admin es un gestor de bases de datos visual a través del navegador web que tiene las siguientes partes por una parte por aquí tenemos las bases de datos que tenemos creadas ahora mismo y por otra parte en la parte derecha tenemos las operaciones que podemos aplicar sobre las bases de datos que tenemos creadas por tanto lo primero que quiero hacer es crear una base de datos nueva y vacía Así que para crear una base de datos nueva y vacía en primer lugar voy a pulsar el botón llamado bases de datos al pulsar el botón llamado bases de datos veremos que aparece un formulario que me invita a crear una nueva base de datos Así que vamos a llamar a esta nueva base de datos agenda a continuación si ponemos el nombre de la base de datos debemos especificar Cuál es el cotejamiento siendo el cotejamiento también a veces llamado colación el juego de caracteres con el que voy a introducir contenido dentro de esta base de datos debemos tener en cuenta que elegir cotejamiento no es pero es muy recomendable Qué pasa si no elijo cotejamiento Bueno pues pasa algo muy gracioso Y es que si no eliges cotejamiento el cotejamiento por defecto es sueco esto es un guiño histórico ya que May sql originalmente era una empresa sueca llamada my sqlab que más adelante fue comprada por San que más adelante fue comprada por Oracle vale por tanto lo que voy a hacer es desplegar el panel de cotejamiento me voy a ir hasta del fondo del todo y donde pone utf8 cuidado no utf8 mb4 no vamos a ir a la parte de arriba y donde veo que pone utf8 spanish ahí voy a elegir ese cotejamiento fijaos que pone utf8 spanish y utf8 spanish 2 El spanish es español de España el spanish 2 es español internacional pero básicamente son prácticamente iguales con lo cual a efectos de May sql podéis exactamente el que queráis en mi caso voy a spanish y una vez que he cogido el nombre de la base de datos Y he seleccionado la colación voy a pulsar sobre crear al pulsar sobre crear veréis que de repente a la izquierda aparece una base de datos nueva llamada agenda mucho cuidado una cosa en la que debéis tener mucho cuidado solo por haber creado una nueva base de datos no quiere decir que hayamos entrado dentro de ella por tanto ahora para finalizar esta parte lo que tenemos que hacer es hacer clic dentro de agenda y al hacer clic dentro de agenda ahora sí que habéis entrado en la base de datos de Nueva creación acabamos de crear una base de datos y la base de datos por supuesto está vacía Por tanto al entrar dentro de la base de datos evidentemente vemos que no se han encontrado tablas dentro de la base de datos Así que vamos a crear una tabla en primer lugar se nos pregunta ya que estamos aquí ya que no tengo tablas la posibilidad de crear una tabla por lo que elijo en primer lugar el nombre y a continuación el número de columnas da igual el número de columnas que elijáis porque si os habéis quedado cortos Más adelante se pueden ampliar si os habéis quedado digamos largos Más adelante se pueden recortar Vale entonces en este caso voy a crear una tabla llamada contactos y dentro de contactos de momento voy a respetar los cuatro Campos que vienen por defecto en algunas versiones de Maya sql No aparece el número 4atro por defecto si no aparece ningún número simplemente ponéis manualmente un número cuatro y ya está por tanto una vez que supero esta pantalla voy a pulsar el botón de continuar tras lo cual creo la tabla contactos y paso a definir Cuál es el nombre y el tipo de datos de cada una de estas cuatro columnas que especificado por defecto la primera columna ahora que estamos en una base de datos que ya no es de miniatura es decir una base de datos ya buena os recomiendo que siempre sea un ID que sea numérico primario autoincremental por tanto voy a hacer lo siguiente la primera columna se va a llamar ID el tipo de datos va a ser int va a ser entero a continuación espeo especifico la longitud aquí yo siempre digo que cuando trabajemos con una aplicación real debemos tener cuidado Yo suelo poner por defecto 255 Pero qué quiere decir poner 255 caracteres que podría tener un y 255 ceros detrás es probable que mi aplicación llegue a tener tantos registros no es tan probable es probable que llegue a tener una agenda que tenga un 1 y 25 ceros después de número de contactos pero no existe tanta gente en la tierra vale por tanto de momento voy a poner 255 teniendo Claro que es un límite al cual nunca voy a llegar de hecho nunca llegaría ni a 10 veces menos de ese límite otra cosa que digo Pero insisto que hoy estamos haciendo un ejercicio teórico de práctica es que ahora lo dejo a 255 en una aplicación real nunca pondría 255 Por qué Porque sabría que voy a mal gastar memoria usando ese campo vale pero teniendo claro eso ahora de momento lo voy a dejar a 255 y ahora muy importante y solo para este campo me voy a ir un poco hacia la derecha y voy a hacer que este campo sea un índice primario a mí me sale esta ventana no sé si a vosotros Sí igual no pasa nada porque realmente no voy a modificar nada simplemente le digo continuar y activo la opción de Ai autoincremental por tanto elijo un campo ID elijo 255 primario Y autoincremental a partir de aquí voy a definir otra serie de Campos Como por ejemplo en este caso el nombre el teléfono y el email cuidado porque mientras que el campo ID por supuesto va a ser un número entero el nombre evidentemente no es un número entero Así que despliego y veo que en mysql Tengo cuatro tipos de datos preferentes Y luego tengo un montón de datos más por la parte de abajo así que por una parte veo que tengo entero bar charar para pequeños textos text para grandes textos y date para fechas Así que para un nombre evidentemente voy a elegir marchar una vez más aquí diseñando una base de datos real tendría que pensar en cuál es el número máximo de caracteres que yo pienso que debería tener un nombre insisto una vez más que como estamos haciendo una aplicación de prueba voy a poner 255 simplemente para trabajar es decir voy a hacer una base de datos que es cierto va a malgastar algo de memoria Pero como va a ser una aplicación pequeña en principio ahora mismo para esta prueba no me importa con el teléfono Ocurre algo parecido el teléfono es cierto que mayormente se compone de números pero igual tiene un más delante para el prefijo internacional algunos países tienen paréntesis para definir el número de teléfono por tanto teniendo mayormente eh enteros lo que voy a hacer es ponerlo como barchart y así sé que le puedo poner cualquier sintaxis en cuanto a la definición de del número de teléfono y bueno email evidentemente es un marchar y también le voy a poner 255 caracteres Yo siempre digo lo siguiente no es que sea obligatorio poner un ID en todas y cada una de las tablas que hagáis porque hay tablas como tablas de registro en las que no es obligatorio sin embargo yo siempre digo que un ID primario numérico y autoincremental daño no os va a hacer así que a menos que tengáis una justificación en un caso concreto para no poner un ID mi recomendación es que siempre lo pongáis que luego no lo usáis pues Vale pero no os va a molestar En definitiva una vez que ya he definido la estructura de la tabla porque esto es la estructura de una tabla May sql voy a pulsar sobre guardar igual vosotros no tenéis el previsualizar sql vamos a ver el cotejamiento no hace falta ponerlo Simplemente porque el programa te lo ofrece pero no te obliga si no ponéis ningún tipo de cotejamiento se entiende que heredis el cotejamiento de la base de datos ahora tú Imagínate que eh Por ejemplo Vale tengo una base de datos y por lo que sea porque es una base de datos que opera en español la base de datos Está en español pero luego tengo una tabla que son Árabes y luego teng una tabla que son clientes japoneses y claro yo digo hombre la base de datos Está en español pero para un campo concreto Necesito que este nombre tenga cotejamiento en árabe o en coreano o vete a saber qué y en esta en japonés o en chino o en lo que sea vale por eso te dan la opción pero no la obligación de si te interesa poder cambiar el cotejamiento para un campo concreto en principio de todos los campos que hay a continuación no me interesa tocar ninguno más con lo cual comentarios pero tampoco podría tampoco quiero perder tiempo ahora con eso y ente le damos a guardar si no tenéis previsualizar sql No pasa nada Simplemente tenemos una tabla la tabla sin embargo está vacía Por tanto si me voy a examinar veremos cómo me dice que my sql ha devuelto un conjunto de valores vacíos es decir cero columnas realmente quiere decir cero filas ya que tengo una tabla pero está vacía qué es lo que voy a hacer ahora voy a insertar registros por tanto me voy al botón de insertar que es el quinto botón por la parte de arriba y veo que tengo un formulario para insertar de hecho veis que puedo insertar dos Campos nuevos a la vez atención la tabla de ID no la toquéis la columna de ID quería decir eso que veis ahí en forma de fila no lo toquéis porque para eso le he dicho que quiero un campo ID autoincremental ya lo va a auto incrementar el programa automáticamente Así que nombre Bueno pues aquí invent José Vicente teléfono este de aquí email info @josé comom ya que estamos Tenemos también un campo abajo pues Juan teléfono este de aquí email info ponga donde ponga esté donde esté el botón de continuar le damos a continuar Así que pulso sobre continuar y atención me dice dos filas insertadas Y si voy a examinar comprobaré que he insertado dos filas lo que queremos hacer ahora es simplemente insertar unos cuantos registros más ya sabéis que no toquéis no tenéis que tocar el campo de ID porque lo va a gestionar automáticamente el servidor y voy a poner a Jorge con este teléfono y info @jorge.moneda tengo a Juana tengo ese teléfono tengo a info @j.pro como al examinar si Ahora vuelvo al primer botón de la fila de arriba llamado examinar pues ya tengo una pequeña tabla de contactos rellenada con seis registros con lo cual puedo ya o mejor dicho casi puedo Ya empezar a pedirle algo a la base de datos antes de intentar conectarnos a la base de datos desde un programa creado en jsp debemos tener en cuenta que para conectarnos a una base de datos vamos a necesitar privilegios de acceso vamos a necesitar un usuario y una contraseña para poder conectarnos por tanto antes de hacer nada tenemos que crear este usuario con contraseña para ello voy a hacer lo siguiente en primer lugar voy a asegurarme que ya no estoy trabajando en la tabla sino que estoy trabajando en la base de datos Cómo hago esto pues pulso aquí en la columna de la izquierda sobre agenda y me aseguro que aquí arriba la ruta de acceso sea servidor local Host y base de datos agenda no quiero ni que ponga solo local Host ni que ponga local Host agenda contactos sino debe poner únicamente local Host y luego base de datos agenda si habéis hecho esto probablemente en vuestra pantalla aparecerá por aquí un botón llamado privilegios Yo como tengo la pantalla más pequeña pues tengo que desplegar para ver privilegios Así que si veis privilegios hacemos clic y rellenamos el formulario siguiente esta sección de privilegios me muestra los usuarios que ahora mismo tienen permiso para acceder a esta base de datos que ahora mismo son el usuario de mantenimiento del sistema y el usuario raíz pero la cuestión es que nunca me debería Conectar a una base de datos usando el usuario raíz lo que debo hacer es crear un usuario específico con permisos para esta base de datos y usar ese usuario Así que voy a pulsar sobre el enlace de agregar usuario y voy a rellenar el formulario que aparece en la siguiente pantalla nombre del usuario pues por ejemplo usuario agenda servidor muy importante veis que por defecto pone una almohadilla cualquiera no quiero cualquiera quiero local si elegís ahí en el formulario la palabra local veréis como automáticamente se pone la palabra local Host ahora elegís una contraseña atención acordaos de la contraseña que ponéis porque luego la tenemos que poner en la programación Así que yo voy a poner password agenda y no pulsé nada sobre la fila llamada generar contraseña esto que estoy haciendo una vez más Aunque supongo que ya lo habréis visto en bases de datos se podría considerar un sacrilegio es decir una base de datos agenda con un usuario llamado usuario agenda Es como decir pirateame vale Pero insisto lo estamos haciendo porque estamos haciendo un ejercicio práctico si esto fuera una aplicación real publicada al público general le pondría un usuario y una contraseña más seguros más difíciles de reventar bien si hemos puesto Ya por tanto el usuario el servidor y hemos puesto dos veces la contraseña no ponemos nada sobre generar contraseña no modificamos ningún tipo de permiso al no modificar permiso asumimos que el usuario tiene todos los permisos no ponemos ninguna limitación de recursos por hora al no poner límites o lo que es lo mismo siendo el límite cero que quiere decir que no hay límite Y por último pulsamos continuar si hemos hecho esto ya hemos completado el ciclo de crear una base de datos crear una tabla poner algo de contenido y poner al menos un usuario con privilegios Y eso quiere decir que ya estamos preparados para la parte difícil de este ejercicio que consiste en irnos a jsp y conectarnos con la base de datos para empezar a pedir cosas ahora es momento de volver a eclipse vamos a crear un proyecto nuevo por tanto me voy a file New dynamic web project como siempre y vamos a llamar a este proyecto Para tenerlos todos juntos lo voy a llamar jsp conect deb dynamic web project igual que siempre así que jsp conecta de B más que nada para que luego tengamos claro cada proyecto que hacía por nombre no elegimos nada más simplemente le ponemos nombre pulsamos Finish vamos a hacer una pequeña comprobación bueno para hacer una pequeña comprobación evidentemente tengo que dentro de web content crear vamos aquí un archivo nuevo de tipo jsp llamado index.jsp en mi caso ya estáis viendo que tengo un problema con la x el mismo problema de siempre pero ya sabéis que le doy botón derecho propiedades en Target room Time elijo los r Times que tengo instalados y el error desaparece aparte es muy recomendable antes de empezar a trabajar que ponga si estás viendo esto es que todo va Ok y en mi caso no va a ir Ok porque tengo que parar el servidor que en mi caso lo tengo permanentemente ejecutándose sudo bien con lo cual por último para esta primera prueba y comprobación vamos a pulsar Play elegimos el servidor con el cual vamos a estar trabajando y comprobamos que aparece una pantalla en un navegador que nos dice si estás viendo esto es que todo va Okay un momento que la está arrancando y fijaos dentro de un segundos ya sabéis que la primera ejecución de una página en jsp tarda bastante Aunque luego tarda bastante menos pero debe decir si todo si estás viendo esto es que todo va Ok voy a copiar y pegar un trozo de código en la pantalla que no va a funcionar porque me hace falta instalar el conector de jdbc es decir Java database connector pero de momento vamos a ir copiando y pegando el código A falta de ese conector que ahora veréis que se descarga de una manera muy sencilla desde Maya sql y el código dice lo siguiente vamos a ver me voy a jsp creo que lo tenía por aquí y el código es este de Aquí vamos a ver en primer lugar aquí arriba me voy a copiar un par de importaciones al igual que ocurre en Java puedo realizar importaciones cuando voy a necesitar las librerías correspondientes mucho cuidado que estas etiquetas no se abren Exactamente igual que la las que hemos visto hasta ahora además de poner menor que porcentaje se pone menor que porcentaje ar a continuación se pone page indicando que lo que estáis creando ahí es una directiva no es realmente código jsp es una directiva para especificar Cómo se va a comportar el resto del código jsp Y a partir de ahí ponéis una importación Exactamente igual que la ponéis en Java es decir import aquí ponéis un igual en Java no hace falta y aquello que queréis importar Así que en este caso quiero importar java.sql toodo puntoasterisco y quiero importar también Java in and out asterisco o sea lo quiero importar todo de la librería sql y lo quiero importar todo de la librería io esto que estoy haciendo ahora es seguro pero no es demasiado eficiente es decir aunque solo vaya a hacer una conexión y solo vaya a hacer una petición estoy importando todo lo de la librería sql lo cual conlleva a que voy a malgastar memoria Cuánta no mucha vale por tanto ahora para hacer estas primeras pruebas vamos a importarlo todo y en el momento en el que ya tengamos un nivel avanzado y sepamos perfectamente trabajar con conexiones a bases de datos desde jsp pues ya elegiremos que no lo quiero todo quiero solo aquello que voy a usar pero de momento es más seguro que lo import temos todo lo mismo ocurre con in and out como al final Yo quiero trabajar con una librería para meter contenido y sacar contenido por pantalla necesito también esta librería y a continuación el código que voy a copiar y pegar hace lo siguiente el código es este de aquí así de repente lo voy a pegar dentro del Body lo voy a sangrar para que lo veáis bien y a continuación lo voy a comentar así que ya podéis empezar a copiar dejadme que quite unos cuantos espacios en blanco y vamos a visualizar un poco Qué hace exactamente este código lo primero que podemos ver por supuesto no se os olvide la etiqueta de apertura y la etiqueta de cierre lo primero queos que vamos a ver Es que la petición a la base datos se realiza a través de una estructura try Catch es decir no podemos realizar una petición directamente sino que tenemos que meter la petición dentro de un try y en un momento dado si hace falta capturar una excepción es decir capturar un error lo primero que hacemos Es declarar una variable de tipo String llamada connection URL como se llame es lo de menos y a continuación ponemos la fórmula de conexión la fórmula de conexión tiene las siguientes partes en primer lugar jdbc donde jdbc es Java database connection conexión a la base de datos conexión a la base de datos a qué base de datos Pues nos estamos conectando a May sql no os olvidéis de los dos puntos que hay después de jdbc y después de mysql a continuación barra y ponemos la siguiente Fórmula en primer lugar local Host es el servidor a continuación el puerto no es obligatorio pero es muy recomendable Así que el puerto por defecto para May sql es el 3306 Y por último después de una barra ponemos el nombre de la base de datos en este caso prueba pero evidentemente nosotros estamos trabajando con la base de datos agenda no prueba a continuación especifico una variable llamada conexión del tipo de datos conexión y la inicializo a vacío es decir la creo pero digo de momento no tienes nada aquí tenemos una línea donde nos va a dar un error nos dice de la clase que tiene el nombre com. mysql.js Driver quiero hacer una nueva instancia quiero instanciar esa clase Esta es la línea que va a fallar porque no he importado todavía el conector de My sql para Java pero tranquilos porque ahora luego lo importar Y ahora digo realizo una conexión y digo tomo una conexión con la conexión URL el usuario y la contraseña Así que usuario agenda y password agenda o En definitiva lo que sea que hayáis puesto como usuario y como contraseña de la base de datos creo otra variable llamada connection con es una variable de conexión pongo una variable de statement de tipo statement es decir Le digo algo a la base de datos Primero me conecto a la base de datos luego le digo algo a la base de datos y luego la base de datos me devuelve un resultado estas tres líneas son un poco raras pero es que son así establezco una conexión preparo una petición Y preparo una preparar una devolución quiere decir que si yo le pido algo a la base de datos Espero que me devuelva algo pues lo que le voy a pedir se lo voy a decir en el statement lo que me va a devolver me lo va a devolver en el res result set y todo ello está enmarcado dentro de la conexión dentro del proceso de conexión Así que ahora le digo statement es igual a con y ahora en execute query le digo Select all from una petición muy sencilla Pues si antes tenía la tabla de contactos Pues voy a decir Select all from contactos a continuación si yo le he pedido algo dejadme que ponga esto un poco más arriba si yo le he pedido algo a la base de datos espero que la base de datos me devuelva algo así que digo mientras que result set mientras que la petición a la base de datos me siga devolviendo algo tenga next tenga un siguiente resultado quiero sacar algo por pantalla out printline RS getstring y prueba uno en este caso no nos vale recordad que en la tabla teníamos ID nombre teléfono email así que por ejemplo voy a poner de momento nombre simplemente para comprobar una primera comprobación de que sale algo en la pantalla y bueno ahora ya una pequeña estructura de control y decimos si la conexión no está cerrada digo que no está cerrada porque tenemos un símbolo de admiración ponemos out printline esta sintaxis no me gusta Así que lo voy a poner entre llaves y muy buena costumbre el que os acostumbré a poner un connection punto Close en principio al ser jsp un lenguaje de tipo stateless es decir un lenguaje sin estado se supone la teoría dice que los recursos se cierran automáticamente al acabar la ejecución de la página pero si nos acostumbramos a cerrar nosotros manualmente los recursos mucho mejor por último escribimos un Catch donde el Catch aparece si hay algún error y nosotros vamos a tener un error Así que decimos out printline enable to Connect to database pues no he podido conectar con la base de datos por dos puntos y ex donde ex es el exception ex es decir ahí captura el error y me da algo en la pantalla de esa manera cuando Cometa un error pues por lo menos podré saber de qué va el error Por qué está causado el error porque con la conexión a sql hay múltiples errores que podemos cometer uno que no exista el Driver dos que el usuario o la contraseña no sean correctos tres que no estemos Llamando a la base de datos correspondiente cuatro que este es muy común que la tabla no tenga un campo como el que has pedido cinco que la sentencia sql no sea correcta es decir Hay un montón de errores que podemos cometer si ahora ejecuto Este programa podré comprobar atención todos podré comprobar como no he podido conectar con la base de datos por la siguiente por el siguiente mensaje de excepción y es que Class not Found exception Y es que no tengo el driver de mysql dónde está ese Driver no está en eclipse no está en Java no sé por qué porque lo podrían poner por defecto pero no está lo que tenemos que hacer por tanto es bajarnos descargarlo de la página oficial de mysql Así que abrimos un navegador web y ponemos jdbc mysql connector el conector de mysql para Java cuidado porque hay un conector para c un conector para csharp un conector para python pero yo quiero el de Java por tanto tengo que poner jdbc que es Java database connection my sql connector Si ponéis eso en Google es decir ponéis jdbc mysql connector veréis que el primer resultado es esta página que es mysql.com bar products bar connector y esto nos da un listado como os decía de conectores para ADO Es decir para net para mysql en abierto para Open database connector el que queremos el jdbc para python para c+ má y para c pelado Así que yo cuál quiero yo quiero el tercero llamado jdbc El Driver para Java tanto para Java Enterprise como para Java normal Así que pongo jdbc Driver para mysql pulso Download y dentro de Download voy a hacer lo siguiente selecciono plataforma y me lo descargo a continuación al el platform independent vemos que podemos Descargar el Driver o bien en formato tar o bien en formato zip por tanto si alguno No tenéis internet siempre lo podéis pasar con un pendrive con lo cual no creo que eso arregle nada es el segundo error de la informática entonces dado que estáis en Windows os recomiendo descargaros el archivo zip ya que el archivo zip por defecto se descomprime dentro de Windows y para el archivo tar hay que Descargar software aparte Así que atención pulsamos sobre download veis que aquí te dice mira o login o Sign up pero yo no quiero ni login ni Sign up Así que muy escondido en la parte de abajo aparece un cartel que dice No gracias simplemente quiero arrancar mi descarga Así que le doy a No gracias Me descargo en el escritorio el conector de Java en mi caso ya lo tengo y una vez que esté descargado en el escritorio lo que quiero hacer es simplemente descomprimirlo para que el ZIP se extraiga dentro de una carpeta azul lo que voy a hacer ahora es satisfacer la dependencia incorrecta para este proyecto que es la dependencia de la librería que me he bajado desde la página oficial de mysql para satisfacer esta dependencia vamos a primero copiar la librería en la carpeta correspondiente y luego veremos si es necesario además dar de alta un servidor entonces voy a sacar la lista de proyectos estamos trabajando ahora en el proyecto de jsp conect db dentro de web content he creado una carpeta tengo una carpeta Perdón un archivo llamado index.js SP y sin que yo lo haya creado Hay una carpeta llamada web yf y dentro de web yf hay otra subcarpeta llamada lib de librería no la hemos creado nosotros se crea automáticamente con un proyecto de Java Enterprise entonces me voy a ir a Aquel lugar donde tengáis el conector ya sea el escritorio la carpeta de descargas o donde sea vamos a encontrar que hay un montón de archivos hay un lm hay un cambios documentación el código fuente pero hay un archivo que me interesa especialmente que es el archivo del conector de Java Enterprise Así que ese archivo har lo que voy a hacer va a ser simplemente atención lo voy a pinchar y lo voy a arrastrar hasta la carpeta Live fijémonos en este caso que tengo a la vez mostrada la carpeta de la ventana de eclipse y a la vez mostrado un navegador de archivos por tanto atención lo que hago es pincho y arrastro el archivo har hasta la carpeta Liv y en cuanto suelto el archivo conector a la carpeta Live aparece una ventana flotante que me pregunta qué es lo que quiero hacer quiero copiar archivos o Quiero realizar un vínculo hasta los archivos evidentemente lo que quiero es copiar el archivo quiero que la librería esté en cada una de las carpetas de cada uno de los proyectos que hagamos a partir de ahora que usen conexión con base de datos por tanto pulsamos Ok tras lo cual nuestro conector está correctamente copiado en la carpeta de librería y ahora vamos a probar a ver si se conecta o no se conecta y si no se conecta qué error nos da por eso voy a ejecutar voy a llamar al servidor no sé si tengo el servidor en funcionamiento un momento creo que lo tengo en funcionamiento vamos a ver aquí servidores Aquí está bien entonces voy a parar el servidor voy a asegurarme que vuelvo a ejecutar el servidor y vamos a comprobar ahora cuál es el mensaje que nos da está procesando y nos dice en este caso que José Vicente Juan Jorge Jaime y successfully connected to my sql server es decir devuelve el resultado y me dice que me he conectado correctamente en principio esto que hemos hecho debería haber funcionado Pero hay veces que aún así a eclipse le cuesta un poco reconocer que tiene el driver de conexión por eso lo que vamos a hacer es ayudarle un poco le vamos a hacer le vamos a ayudar un poco de la siguiente manera vamos a ver que en esta ventana que tenemos por aquí abajo la ventana donde arrancamos los servidores debéis tener una pestaña justo al lado que es Data source Explorer en Data source Explorer lo que hacemos Es configurar nuevas conexiones a base de datos voy a eliminar la que tengo yo y si todo va bien Vamos a pinchar en la pestaña Data source Explorer que está al lado de donde está servers si tenéis la pestaña de servers a la derecha tenéis Data source Explorer veis que tenéis una cosa que pone database connections así que vamos a pinchar con botón derecho justo encima de la palabra database connections vamos a pinchar New voy a crear una nueva conexión con base de datos eclipse y Java Enterprise se pueden conectar con todas estas tecnologías de base de datos pero nosotros la que queremos como veis aquí es mysql así que mysql una vez que tenemos Ahí mysql vamos a elegir el botón next para continuar y en este caso lo que vamos a hacer Bueno decidme qué tenéis aquí qué tenéis en esta ventana nada vale perfecto vamos a verlo en mi caso tengo ya ahí mysql jdbc Driver porque ya lo tenía importado de días anteriores si en vuestro caso no tenéis nada tenéis que pchar este botón que me sirve para crear una nueva definición de Driver Así que pinchamos este botón de aquí y al pinchar Ese botón de ahí aparece esta ventana donde aparece el mysql jdbc Driver cogemos 5.1 pero sin embargo me dice que no es capaz de reconocer Dónde está el archivo har aparece un mensaje de error Por eso lo que voy a hacer es pasar a la segunda pestaña donde tengo hard list en mi caso ya aparece el conector en el vuestro no así que lo voy a eliminar para quedarme como vosotros cago en la mar Bueno pues si ya os aparece vale supongamos que no os aparece lo voy a poner yo entonces entraría dentro de la carpeta donde lo hemos descargado y me lo cargaría bien Por tanto una vez que tenemos esto vamos a ver Claro en mi caso no me deja continuar porque me dice que ya tengo un Driver con ese nombre en vuestro caso Supongo que os dejará pinchar Ok qué os dice vamos a verlo una vez que hemos conseguido conectarnos correctamente a la base de datos ahora si queréis voy a quitar el out printline Y en lugar de poner simplemente un get String nombre puedo hacer lo siguiente Mirad al principio antes de meterme dentro del archivo jsp voy a hacer una tabla que tendrá un with del 100% y que tendrá un Border ig a 1 no va a quedar muy estético pero ya sabéis que esto lo hago simplemente para que veamos correctamente el archivo en una tabla hasta que hagamos un ejercicio futuro donde lo mezclemos con css ahora cada vez que haga una out print Line voy a hacer lo siguiente voy a hacer TR TD acordaos que en Java se encadena con el signo más Y digo TD más get String teléfono más TD esto se me empieza a escapar de la pantalla por tanto yo lo que suelo hacer en estos casos no me gusta es una de las cosas que no me gusta nada de Java pero son así yo aquí en Java no Puedo saltar de línea porque en cuanto salto de línea daos cuenta que no me lo reconoce como correcto vale por tanto lo que hago es poner un signo más al igual que en javascript para informarle al programa de que me he bajado a la línea de bajo y creo que en este caso ni aún así me lo va a permitir Bueno pues si no me lo permite un momento a ver si poniéndolo bajo me lo permite no pues nada lo pongo en una sola línea y ya está Dime no da igual que lo ponga con comillas o sin comillas Ah vale Sí muy bien tú me dices esto Entonces le quito esto de aquí bien vale entonces sí perfecto Pues con abriendo comillas cerrando comillas vale Y así sí si queréis ya puestos meto aquí arriba el TR y meto los tds en la parte de abajo entonces bajo esto abajo y así lo veréis mejor para formularlo en diferentes líneas Ahora sí y acordémonos de al final cerrar la fila muy importante Por tanto Incluso si os lo pongo con un poquito de sangría pues lo veréis mejor lo que estoy haciendo es formatear una fila de tabla con sus tds y con sus trs lo que va a hacer esto si ahora pruebo el código va a ser simplemente devolverme la fila en la pantalla pero ya mejor maquet con respecto a antes y Mirad lo que va a ocurrir es esto lo que va a ocurrir es que Ah cuidado porque he copiado dos veces teléfono y por eso teléfono me aparece por duplicado por tanto Ahora vuelvo a arrancar y ahora sí Mirad tengo el nombre el teléfono y el correo electrónico parece que no sé cómo pero se me ha metido ahí una línea suelta con lo cual esto es porque esta la he cerrado incorrectamente Así que guardo y recargo y ahora sí tengo una tabla donde voy a poder ahí listar los elementos atención y ahora Mirad una cosa miradme primero la pantalla Vais a poder copiar sin ningún problema ahora un poco ejercicio para nota aunque esto es lo que haremos próximos días yo ahora me vengo aquí fuera del javascript fuera del jsp me creo un formulario y digo action es igual déjame que lo baje action es igual a Nuevo usuario o nuevo contacto pun jsp method como ya hemos visto en sesiones anteriores es get Así que ahora digo TD input type text name nombre input type text name email input type text name teléfono y input type submit es decir enviar esto lo que hace es que cuando recargo tengo una advertencia porque me dice que no debería meter un form fuera de un TD pero es una advertencia únicamente recargo y lo que tengo es un formulario donde tengo un listado de contactos y puedo introducir un nuevo contacto cuidado cuando envío consulta me dice que el archivo nuevo contacto jsp no existe pero si no existe No pasa nada porque yo lo creo así que dentro de web content me creo un nuevo archivo llamado me acuerdo cómo se llamaba nuevo contacto SP y lo divertido de esto atención lo divertido de esto es que ahora voy a empezar a copiar y pegar código por tanto copio pego y ahora hago lo siguiente este archivo no va a tener una tabla este archivo va a tener únicamente la conexión sql y la conexión sql realmente lo que va a decir no es un Select all from contactos sino que va a decir insert into contactos values los siguientes valores nul para el campo ID para decirle en ID no te pongo nada Tú sabes lo que tienes que poner coma nombre coma teléfono coma email así que dejadme que me escape y request.get parameter quiero el nombre request Mira voy a copiar request.get parameter el teléfono request.get parameter el email y un truquet que me s yo que me s yo Mentira porque lo tengo que buscar en internet es una etiqueta llamada html redirect que creo que en alguna ocasión la hemos utilizado anteriormente que nos sirve para cuando voy a una página automáticamente irme a otra es decir yo lo que quiero con esa página es realizar una inserción y a continuación Volver al listado Así que digo quiero volver a index.jsp y quiero volver en dos segundos así le doy tiempo a la conexión para que se conecte si todo ha ido bien y yo creo que ha ido bien ejecuto de nuevo el proyecto y digo ahora Quiero crear al usuario Julián con el número de teléfono 11 con el correo info @julian comom Y si todo ha ido bien envío consulta no se ha podido conectar vamos a ver Ay qué error me ha dicho vamos a ver el error que me ha dicho mm voy a desactivar un momento la etiqueta meta porque la etiqueta meta no me ha dejado leer el error bien Vamos a verlo a Ah Ah Ah vamos a verlo Ah vale Sí es cierto vale eh bien lo que me dice este error básicamente es que el Aquí está el execute query se usa únicamente para eventos de tipo Select Es decir para eventos de tipo Devuélveme para eventos de tipo insert delete o update se usa otro llamado prepared statement Entonces ahora os preparo el código y os lo paso lo que voy a hacer es utilizar este código un prepared statement stmt y lo voy a sustituir por el vamos a ver aquí está prepared statement stmt el query vale eh Aquí no aquí Voy a hacerme un poco de hueco vale el query es esto de aquí el query hemos dicho que es este query de aquí bien todo esto lo puedo borrar Y por último me hace falta ejecutarlo elimino esto de aquí elimino los errores me da todavía un error producido por doble comilla Ah vamos a ver qué me dices vamos a verlo eh nul No es correcto en principio bien lo que me dice en este caso es que el prepared statement tengo una variable duplicada y no debería tenerla y ahora sí vamos a verlo si funciona por tanto público eh cuidado publico desde el archivo principal No desde el archivo secundario ahora digo a aa Parece que ya funciona bbb iccc envío consulta he desactivado la consulta inicial aa bbb ccc sí por el registro ese que escrito antes así que ya puedo activar el meta redirect y ahora recargo Y si pongo decía yo Julián con el teléfono 111 info @julian comom envío consulta escribe o no vuelve se ha olvidado de volver vale vamos a parar el servidor vamos a parar el servidor refresco creo que tengo a Julián por tanto lo tengo dos veces De hecho voy a poner a Jacobo con info @ creo que tengo el correo al revés jacobo.com el teléfono 2222 envío consulta Oh venga vuelve hombre sí Ah vale igual Es que soy poco paciente cierto De hecho no me he esperado ni 2s segundos a irme del código bien otro nombre con j Javier con 3333 info @javier comom le doy a enviar consulta espero pacientemente dos segundos y entonces vuelvo Vale y vemos como ya tenemos el código en funcionamiento Entonces lo primero que vamos a hacer para crear este proyecto va a ser crear una base de datos ahí va si ya tengo una creada pues me la voy a eliminar vamos a ver quiero ir a bases de datos quiero eliminarme esta base de datos o por lo menos quiero renombrar así que quiero ir a operaciones y quiero renombrar la base de datos a rp2 bien Ahora sí vamos a crear una nueva base de datos por tanto vamos al botón de bases de datos y voy a crear una base de datos que va a ir creciendo poco a lo largo de las sesiones llamada erp Enterprise resource planning o sistema de gestión de los recursos de empresa Así que elijo el nombre erp y a continuación lo que voy a hacer es elegir el cotejamiento dado que preferentemente va a contener datos en castellano es decir datos que van a contener o que pueden llegar a contener acentos eñes quizás alguna cedilla es posible que algún acento abierto Pues elegimos el utf8 en español así que elegimos erp pulsamos sobre crear Y tenemos ya una base de datos erp creada Pero por supuesto dado que acabamos de crear la base de datos está vacía no tiene tablas Así que vamos a crear a continuación dos tablas básicas una para alojar a los clientes otra para alojar a los productos a continuación vamos a hacer una tabla de clientes Así que nos metemos dentro de la base de datos erp y nos vamos aquí a crear tabla aquí donde pone crear nueva tabla y bueno vamos a empezar creando una tabla de la manera más clara posible por tanto si vamos a crear una tabla de clientes pues simplemente pondremos laab palabra clientes tenemos que hacer clic en donde pone erp Y entonces veremos que ahí pone nombre de nueva tabla vale por tanto ponemos clientes y a continuación nos ofrece cuatro columnas de base igual a vosotros no os ofrece ninguna pero En definitiva lo que voy a hacer es poner 10 teniendo en cuenta siempre que lo que voy a hacer ahora es Definir la estructura de una tabla de la base de datos que si luego necesito más Campos puedo poner más de 10 y si luego Me sobran Campos simplemente los dejo vacíos y my sql los va a recortar O sea que realmente el número que pongáis ahí es un poco lo de menos así que pongo continuar voy a pulsar sobre continuar y a continuación definimos atención Mirad los campos que van a conformar la estructura de esta tabla de clientes momento Au ahora el primer campo ya sabéis que yo siempre recomiendo que pase lo que pase se llame ID y además muy importante atención todos a la pantalla solo ese campo va a ser una clave primaria y autoincremental por tanto clave Primaria con la opción de autoincremental solo ese campo a partir de aquí lo que quiero que hagáis es poner una serie de Campos que según vosotros definan a un cliente yo no os puedo decir qué Campos siempre sí o sí definen a un cliente yo voy a poner unos Campos que yo Considero que suelen ser bastante seguros Y a partir de ahí cada uno la gracia es que luego os lo personaliz por ejemplo independientemente del ID que es un identificador para la base de datos cada empresa tiene su propia numeración de clientes por tanto número de cliente Voy a definir primero las columnas y ahora luego tipificando y ponemos la extensión a continuación tenemos la razón social es el nombre de la empresa si tu cliente es un autónomo o una persona física Bueno pues la razón social es el mismo nombre de esa persona pero eh si tienes que estás facturando a una empresa una cosa es la razón social y otra cosa es la persona de contacto entonces voy a poner de momento razón social a continuación dirección a continuación voy a poner código postal y como voy a poner código postal técnicamente no es necesario poner población ya que a partir del código postal sale la población ya lo veremos más adelante tampoco haría falta Bueno voy a poner por si acaso país en definición de bases de datos se suele usar la regla laxa de más vale que sobre que falte es decir si pones un campo que luego no usas pues no lo usas y ya está pero si luego te falta un campo es peor porque hay que modificar la estructura así que dentro de un límite sin pasarnos tampoco pero usaremos la regla de más vale que sobre que falte a partir de ahí cif nif o dni voy a ponerlo como cf Y si luego en lugar de poner un cif ponemos un nif o un dni pues no pasa nada y luego a partir de aquí pondríamos algo así como la persona de contacto la discusión en este caso consistiría en averiguar si la persona de contacto la ponemos dentro de la misma tabla de cliente o la ponemos en una tabla asociada a esta tabla la el razonamiento y atención todos porque este razonamiento os va a servir para siempre es que tenéis que pensar de la siguiente manera si para un cliente para una razón social para una empresa en vuestra aplicación va a haber solo una persona de contacto si la relación entre empresa y persona de contacto es uno a uno en ese caso podéis fusionar perfectamente la persona de contacto dentro de la tabla de cliente porque podéis meterlo en una tabla externa pero no tiene ningún sentido es mal gastar recursos ahora bien si para una empresa pueden haber múltiples personas de contacto es decir en la base de datos tenéis una relación de uno una empresa a n personas de contacto en ese caso ni se os ocurra meter eso dentro de la tabla sino que tendréis que tener una tabla para clientes otra tabla para personas de contacto y ya enlazar con una clave primaria o como queráis o con un número de cliente los contactos a esa segunda tabla en este caso voy a dejarme la aplicación un poco abierta vale Y por tanto no voy a poner persona de contacto aquí sino que lo pondré si lo necesito en una tabla más adelante resulta que de 10 Campos he usado siete Pues bueno no pasa nada Me dejo tres vacíos y ya está a continuación hablamos de la tipificación de los datos el dato de ID siempre va a ser entero es un número entero Así que no tocamos de entero número de cliente No sabría qué deciros Porque hay empresas que tienen solo un número y hay empresas que mezclan letras con números para el número de cliente así que por si acaso lo que vamos a hacer es poner marchar para admitir letras y números la razón social yo creo que está claro que es un marchar Así que marchar dirección es un marchar código postal vamos a asumir que la aplicación trabaja dentro de España vamos a ponerlo como int sin embargo si en un momento dado trabajáramos con diferentes países tendríamos que asegurarnos que no hay ningún país que trabaje con letras en los códigos postales o cosas así Creo que Inglaterra tiene letras en los códigos postales vale por tanto por si acaso vamos a meter marchar en diseño de bases de datos como veréis se juega siempre entre el por si acaso y el no usar más recursos de los que se deban en principio país voy a poner de momento marchar y cif evidentemente será marchar en longitud ahora ya como no estamos haciendo una aplicación de prueba si no estamos haciendo una aplicación que es un poco más real ahora tenemos que pensar un poco qué es lo que vamos a hacer Vamos a ver si yo aquí en ID pongo 255 caracteres quiere decir que yo voy a tener una aplicación en la que un número de clientes equivalente si queréis decirlo como un 1 y 254 cer o 255 nueves que es realmente lo real Es normal que yo en mi aplicación tenga 255 nueves de clientes ojalá cualquier empresario lo quisiera pero no lo creo fijaos que no hace falta poner 255 sino solo componer 10 caracteres quiere decir que tendría acceso a 1000 millones de clientes por tanto verdad con poner 10 ya va de sobra número de cliente 3 cuartos de lo mismo vale De hecho pondría también 10 y Diego 10 Se podría poner ocho y con ocho tendría 10 millones de clientes creo razón social ahora es ahora ya no estamos hablando de números ahora es un bar charar vale por tanto Cuántos caracteres puede tener el nombre del cliente Pues bueno voy a poner 255 un poco para protegerme porque más vale que sobre que falte y en un momento dado más adelante si un día repaso la aplicación y digo Mira es que no tengo ningún cliente que tenga más de 100 caracteres en el nombre pues siempre puedo venir a la estructura alterar la estructura y rebajar el número de campos el número de caracteres para ese campo no es lo más recomendable del mundo alterar la estructura de una base de datos a mitad de funcionamiento pero como poder hac se puede hacer en dirección 3 cuart de lo mismo 255 código postal Claro en España son cinco caracteres pero yo no soy en el resto del mundo por tanto le voy a poner 10 como un poco asumiendo tendría que hacer un proceso de investigación previa evidentemente pero asumiendo que no hay ningún país que tenga un código postal que tenga más de 10 caracteres que igual me equivoco Vete a saber en país voy a poner 20 caracteres y en el cif por si acaso voy a poner 20 caracteres Aunque en principio con siete sería suficiente pero voy a poner 20 caracteres por si acaso tampoco 255 Para no gastar más recursos de la cuenta pero tampoco siete y que luego de repente facture un país que tenga ocho Vale entonces una vez que tengo esto voy a finalizar la creación de esta tabla pulsando sobre guardar y ya tengo la primera tabla necesaria para esta aplicación que es la tabla de clientes crear clientes es importante pero también lo es que los clientes en un momento dado puedan comprar productos porque si no tengo únicamente un sistema de gestión de clientes Por eso voy a crear una nueva tabla pincho en el enlace que pone nueva o bien Voy a la base de datos y voy a crear una nueva tabla como queráis es lo mismo vale o creáis aquí abajo una nueva tabla o pincháis en enlace de nueva tabla es lo mismo Así que si tengo una tabla de clientes y la tengo ya creada vamos ahora a crear una tabla de productos lo mismo evidentemente ponemos 10 Campos Y si luego sobran pues ya habéis visto que no pasa nada que simplemente se dejan vacíos la base de datos los ignora y ya está al seguir funcionando pulso sobre continuar y defino la estructura de esa tabla una vez más recordad que a menos que os diga lo contrario Siempre vamos a hacer lo mismo la primera columna se llamará ID Así que le digo que índice primario autoincremental Y a partir de ahí empezamos a definir Son productos Mira si hace falta que necesito más columnas le digo cuatro columnas y continuar y me añade cuatro columnas bajo podéis Añadir tantas como queráis el primer campo recordad que siempre se llama ID y recordad también que es primario y autoincremental siempre a menos que os diga lo contrario que luego no lo usamos pues no pasa nada no hace daño que esté pero desde luego nos puede convenir en un momento dado bien en producto vamos a poner unos Campos un poco parecidos a los de cliente en primer momento código producto código de producto cada empresa suele tener sobre todo si tiene un número extenso de referencias Pues un código para cada uno de los productos a continuación nombre de producto o nombre claro es que si estoy en productos poner código de producto nombre de producto Bueno pues voy a poner código y ya está código nombre no es que sea obligatorio Pero por qué no podemos poner una descripción si luego no la usamos pues la dejamos vacía y ya está y para un producto Es evidente que hay unos Campos que son obligatorios como mínimo el precio y podemos también poner parámetros extra tales como el peso las dimensiones parámetros como el color Aunque es realmente es un atributo de un producto más que un producto en Sí vale En definitiva lo voy a dejar de momento Aquí y ahora vamos a tipificar Campos el ID es un entero el código puede ser un marchar el nombre evidentemente es un marchar a ver la descripción dudo mucho que haga falta una descripción tan grande para un producto que amos usar un text en lugar de un barchart Así que digo yo que con un barchart podemos ir bien y claro el precio evidentemente un entero no va a ser porque un producto puede tener decimales en el precio eh si yo le digo por aquí decimal tendré que especificar si lo veis ahí no sé si lo veis un número decimal fijo entonces tengo que especificar el número de dígitos y el número posible de decimales Pues bueno vale lo definimos así por tanto decimal y ahora atención mucha atención todos a la pantalla el ID voy a poner 10 el código voy a poner 10 el nombre voy a poner 255 la descripción voy a poner 255 también y ahora con decimal recordad que en la pista me decía que me pide dos parámetros uno el número de dígitos y dos el número de Así que voy a hacer por ejemplo pues seis dígitos seis coma es decir mi producto podría valer como máximo 999,999 vale Y voy a decirle que tenga dos decimales Así que pongo 6,2 ponedlo así porque es que si no la creación de la tabla os dará error Así que si ahora hemos acabado el proceso de crear esta base de datos esta tabla le doy a guardar bien Vamos a ver solo puede haber una columna automática y debe estar definida como una clave no la he definido como clave yo juraría que sí clave primaria autoincremental vale voy a hacer una cosa veis que me ha dado un error de la clave a veces el error realmente tiene que ver con El decimal dejadme que lo ponga en barchart para comprobar si es el error y si hace falta luego le cambio el tipo más adelante le doy a guardar bar pues no incorrect Table definition vale vamos a ver campo ID entero longitud 10 índice primario autoincremental primario voy a quitar la clave se la voy a volver a poner bien y autoincremental vamos a darle y ahora sí Fíjate lo que ha pasado simplemente le he quitado primario le he vuelto a dar primario y ha funcionado en fin la las cosas del directo y tenemos ya por tanto dos tablas que nos permiten empezar a trabajar como mínimo evidentemente más adelante nos harán falta más tablas como pedidos cuando un cliente concreto compre productos hará un pedido a partir del pedido factura a partir del pedido líneas de pedido a partir de la factura líneas factura Pero eso irá más adelante Vale ahora como mínimo con estas dos tablas ya tenemos para emp hacer cositas dado que estamos creando la base de datos antes de crear la propia aplicación vamos a hacer una carga estática de datos con carga estática de datos quiero decir que voy a insertar datos manualmente dentro de la aplicación cómo lo hago me voy a clientes he pinchado sobre la tabla de clientes me voy a insertar Así que voy a insertar un nombre de cliente Así que c 001 razón social nombre del primer cliente dirección del cliente código postal 46014 País España cif Pues un cif y tengo ya un cliente el ID no lo toquéis porque el ID es primario autoincremental ya se modifica el mismo así que continúo y voy a insertar un segundo registro voy a insertar unos pocos Así que segundo cliente calma número de cliente cli 002 segundo cliente y dirección del segundo cliente 46 920 País España cif uno que os inventé y así por tanto quiero que hagáis una carga de más o menos cuatro o cinco clientes por tanto le dais a insertar cada vez cli 003 los números de cliente no tienen por qué ser consecutivos eso ya lo que queráis eh tercer cliente dirección del Tercer cliente 46001 España y un cif y un par de clientes más cli 004 eh cuarto cliente su dirección 46002 España y un cif voy a poner cuatro y ya está una vez que tenemos una carga estática de clientes vamos a hacer lo mismo con los productos por tanto pensad qué es lo que queréis vender en vuestra empresa y por tanto Añadir productos así que insertar voy y en productos voy a poner pues una carga estática inventar el código de producto inventar que Vais a vender en la tienda vale por tanto p001 y no sé qué voy a vender ordenadores ordenador portátil ordenador muy potente con muchas prestaciones cuánto va a valer pues 800 porque es potente claro Así que continúo ya sabéis que el ID no lo tocamos inserto de nuevo código p002 nombre pues ordenador de sobremesa ordenador más potente todavía y precio Pues no sé 1 eur y así vamos haciendo una carga cada uno poned los productos que queráis p003 nombre Pues no sé Tablet y tablet Android con 4.4 o con 5 yo que sé cuánto vale cuenta y por último por ejemplo p004 pues impresora y impresora que siempre se estropea la noche antes de la entrega porque si no es una buena impresora así que pues no sé 80 porque valen baratas ahora y continúo vale lo que he hecho simplemente es crear una pequeña carga de datos para que ahora cuando saltemos a la programación pues tengamos una mínima carga que crear a continuación y una vez que me he bajado la plantilla de la factura lo que voy a querer hacer es crear un nuevo proyecto e importar esta plantilla dentro de ese proyecto Así que este proyecto este archivo lo tengo dentro del escritorio y ahora me voy a crear un file New dynamic web project un proyecto Dinámico que tendrá html css tendrá jsp y tendrá más adelante también seres Por eso voy a crear un dynamic web project Cómo se va a llamar el proyecto se puede llamar como queráis pero vamos a llamarlo rp voy a pulsar sobre Finish y tengo ya un proyecto como veis atención creado con el nombre erp yo ahora lo que quiero dentro de web content realmente no es crear un archivo nuevo jsp con el archivo con el nombre index.jsp sino que lo que quiero hacer es importar este archivo de plantilla factura html que he bajado por eso lo que voy a hacer es simplemente Mirad localizar dónde está el archivo ese llamado factura html en vuestro navegador de archivos y atención muy importante voy a pinchar y lo voy a arrastrar sobre la carpeta web content no quiero que lo arrastré ni en la carpeta rp ni la carpeta Java resources ni en meta ni en web sino en la carpeta web content cuando lo tengáis justo soltado encima soltá y os dirá qué quieres hacer quieres copiar o quieres vincular A menos que os diga lo contrario siempre que se os plantee esta pregunta decir copiar no quiero vincular un archivo externo quiero copiarlo dentro del proyecto Así que pulso sobre copiar y comprobaré que ya tengo el archivo llamado factura html dentro de mi estructura de proyecto tengo un pequeño problema y es que esta factura originalmente estaba pensada para estar hecha completamente con javascript pero nosotros La queremos hacer con jsp Entonces el problema es que yo no puedo hacer código jsp dentro de un archivo que tiene la extensión html ocurre igual que en php por ejemplo para que archivo contenga código php tiene que tener la extensión php Pues en jsp ocurre igual para que un archivo contenga jsp tiene que tener la extensión hsp Por eso voy a pulsar simplemente botón derecho Dentro de este archivo llamado factura html voy a elegir la opción de f2 rename y voy a cambiar simplemente la extensión de html a jsp si queréis bueno podríamos cambiarlo a index.jsp va vamos a dejarlo como factura jsp porque probablemente más adelante habrá un archivo Index previo a este archivo factura jsp y lo que quiero hacer ahora a continuación evidentemente es doble clic para cargar el archivo factura jsp dentro del editor de código bien a continuación vamos a cambiar el título de la factura por tanto en la línea TR vamos a cambiar el título el title D html línea 3 a factura ahí donde veis un título simplemente lo cambiáramos a rellenarlo de momento estáticamente así que me voy a la línea me voy a la línea 62 en la línea 62 os he dejado ya un Select abierto y cerrado pero recordamos que en html hace falta la etiqueta Select y luego hace falta la etiqueta option Así que creo una opción y digo por ejemplo nombre del cliente uno nombre del cliente dos nombre del cliente 3es estoy copiando y pegando he creado una línea y a partir de ahí copio y pego para el resto de líneas de hecho ni siquiera estoy poniendo un value Así que guardo y recargo y vamos a ver qué pasa por tanto si ahora ejecuto de nuevo el proyecto comprobaré Mirad como tengo un desplegable Ah Espera que es content editable ahí aparece el nombre del cliente pero no me deja desplegar muy bien Vamos a tocarlo dejadme que compruebe y esto os lo puede arreglar momento déjame que vuelva a recargar Y ahora os lo digo bien atención de la línea 59 en la línea 59 donde pone content editable es igual a true quiero que lo quitéis solo lo que estoy marcando en la pantalla solo content igual a true no el nombre de cliente ni el placeholder cliente Así que quitamos content editable es igual a true por tanto le damos otra vez a Play y ahora veremos cómo salen cuatro nombres de cliente pero estáticos que me los acabo de inventar ahora como os podéis imaginar lo que quiero atención todos a la pantalla lo que quiero es que ahí donde pone las opciones del Select ahí donde pone las cuatro opciones del Select las opciones no sean estticas es decir que no las haya puesto yo a mano sino que las opciones vengan de la base de datos Así que vengan de la base de datos quiere decir copiar el código que hemos desarrollado previamente para conectarnos a la base de datos Y aplicarlo aquí cómo lo vamos a hacer atención todos lo voy a hacer primero yo en primer lugar voy a sacar ese código lo teníamos en no me acuerdo en jsp conect deb voy a el archivo index.jsp Así que tengo index.jsp que tiene el código para la base de datos y tengo factura jsp que tiene el código donde quiero volcarlo atención todo el mundo que recordamos que antes de ponernos a hacer la petición a la base de datos había que hacer esto había que cargar primero la cabecera y luego las importaciones de Java sql y Java in and out Así que antes de copiar la petición a la base de datos copio eso y lo pego aquí arriba y guardo para ver si el proyecto me da algún error que en principio no debería copio las tres líneas de arriba a ver claro es que técnicamente esta es parte de esta Por eso digo tres líneas pero sí está dividido en dos líneas y ahora atención copio esto miradme todos copio esto copio toda la petición el try Catch y mientras lo voy copiando mi mente me va diciendo No has creado un usuario con privilegios para la base de datos vas a tener problemas ahora lo creamos Así que aquí donde pone el option lo que voy a hacer es pegarlo sangrar correctamente y modifico los datos de acceso y yo digo mi base de datos se llama agenda no mi base de datos se llama rp mi usuario se llama usuario agenda y su password se llama password agenda ese es el problema que no lo hemos creado por tanto vamos a volver un momento a la base de datos y vamos a poner un usuario bueno efectivamente ahora Hay que crear un usuario y para ello lo que voy a hacer es lo siguiente muy importante atención todos de vuelta a la base de datos de vuelta a php my admin voy a ir a local Host base de datos rp no quiero estar dentro de una tabla quiero estar dentro de la base de datos rp Así que pincho ahí arriba hasta asegurarme que lo último que estoy viendo en esa fila es base de datos erp a continuación vosotros tendréis en este menú superior una parte un botón que pone privilegios Yo no lo tengo porque lo tengo aquí metido dentro del menú Así que pinchamos en privilegios y dentro de privilegios lo que vamos a hacer es crear un usuario bueno en mi caso ya tengo creado Uno Vale Así que simplemente agregá un usuario y ponéis lo siguiente ponéis nombre de usuario erp servidor local contraseña erp debe volver a escribir erp a mí me dice que ya existe una misma cuenta porque yo ya la había creado pero a vosotros no os aparecerá este mensaje así que local Host erp y ya está y no tocamos nada más y simplemente le damos al botón de continuar simplemente allí arriba rp local Host rp ponemos rp tanto en el nombre de usuario como en la contraseña Insisto que a mí me dice que ya existe una cuenta porque en mi caso es verdad en el vuestro no os lo dirá así que simplemente el proces de creción y pis portimo el botón de continuar para final creción de ese usuario continuamos con el rp Y si ya hemos creado un usuario erp con contraseñ erp Vamos a continuar modificando los datos de conexión así que dentro de la conexión modifico tant el usuario como la contraseña y ahora evidentemente lo que necesito es modificar también la petición a la base de datos la petición a la base de datos tal cual la he copiado y pegado era Select all from contactos pero hoy no tengo contactos hoy tengo clientes Así que Select all from clientes Y por último antes de tratar el problema concreto de no haber importado la librería lo que vamos a hacer es maquetar el out print Line Así que Mirad me voy a cargar este out print Line voy a poner una de estas opciones voy a cargarme las otras opciones y la opción se va a quedar de la siguiente manera digo RS punto get parameter bueno get parameter get String claro RS get String y el String va a ser el nombre a ver corchetes comillas vale el String va a ser el nombre va a ser el nombre No lo sé no me acuerdo porque tengo mala memoria Así que voy a clientes y digo razón social eso era el nombre del cliente así que social además quiero que cada opción tenga un ID de cliente por tanto value es igual a get String realmente no es un get String es un get int Pero bueno vale con número de cliente iba a el ID pero cogemos el número de cliente y casi mejor pone número de cliente es número de cliente ahí lo tenemos por tanto el String se queda así out pun printline option value es igual a esto y RS get String es igual a eso seguro que entre las comillas el signo más y el signo de cerrar alguno Se os olvida y os sale mal pero bueno para eso está la práctica si ahora intento probar un momentín si ahora intento probar Este programa lo ejecuto contra el servidor y vamos a desplegar aquí y veo que de momento no tengo ninguna conexión correcta es decir de momento no me está conectando a la base de datos de hecho ya me extraña que no me haya salido el mensaje de advertencia con el error pero lo que voy a hacer evidentemente Mirad atención es voy a copiar de jsp conect db de la librería el mysql connector atención todos lo copio y dentro de erp web inf lo pego y lo que voy a hacer Mirad es copiar la librería de may sql sin necesidad de moverla de un sitio a otro no quiero que deje de estar en el archivo anterior Bueno voy a parar el servidor vamos a ver outline no servidor me lo bajo me lo paro y vuelvo a arrancar para asegurarme que lo estoy ejecutando todo desde cero desde nuevo y si todo va bien un momento y si todo va bien nombre del primer cliente segundo cliente tercer cliente cuarto cliente es decir ya estoy atrapando realmente datos desde la base de datos Ahora sí lo que voy a hacer ahora va a ser bajar hasta la línea donde encuentro aquí tengo una línea en mi caso es 113 como he hecho unos cuantos espacios de más en vuestro caso igual no es exactamente 113 pero será una línea parecida pero En definitiva Mira es una línea donde claramente tenéis un TR y un TR de cierre y es un grupo de líneas en las que veis que pone cantidad uno un Select con horas o unidades ahora lo cambiamos producto un precio un y total un lo habéis encontrado bien lo que quiero ahora es lo siguiente aquí dentro me hecho un poco de espacio aquí dentro Quiero hacer otra petición a la base de datos cómo voy a hacer otra petición a la base de datos pues Mirad todos a la pantalla atención todos a la pantalla me voy a No perdon aquí Aquí no vale no Ahí pero casi Mirad donde pone producto uno veis que pone producto uno ahí en medio de esas filas me hago un hueco para producto un porque es producto donde quiero trabajar es decir tengo cantidad un horas producto un precio uno y total uno pues me hago un poco de espacio entre el Select y producto uno y me he hecho espacio simplemente para ahora volver a copiar y pegar ese código Ya sé que cuando copiamos y pegamos código Hay algo en nuestro interior que nos dice mm no está bien pero por lo menos lo que quiero es que funcione y ya veremos Cómo optimizarlo pero primero recordad siempre la moraleja primero que funcione y ahora digo atención todos y ahora Digo vamos a ver producto un ahora atención todos miradme quiero Me conecto a rp con usuario rp y contraseña rp bien Select all from productos y option por una option porque es una lista desplegable y que Cómo se llama el número de producto No lo sé código y luego el nombre de producto y por tanto ahora me lo formateo atención todos me lo formateo y digo el TD producto 1 va arriba el cierre de TD producto un va abajo fijaos que y voy a minimizar esto t de producto un se queda arriba el content editable lo voy a quitar porque eso lo tengo así en mi software por una razón concreta pero que no se cumple en este caso t de producto uno se queda arriba TD de cierre se queda abajo ahora y a ver si me cabe si no me cabe Pues voy a quitar algunas barras de estas que no me sirven de momento Ah muy bien fantástico déjame quitarlas Sí lo que pasa es que arriba tampoco te creas que tengo s Sí por eso Claro pero estoy bueno va ahí venga y el quick Access ahora no me dejarás quitar da igual estoy igual Bien mira y ahora digoel producto el Select abajo y por tanto esto se me queda de la siguiente manera TD producto arriba Select name producto arriba Select abajo y cierre TD abajo cierre de Select abajo y cierre de TD abajo el Select no lo he copiado ni lo he pegado sino que lo he escrito y el producto un lo he cortado si el producto uno lo he cortado para dividirlo en dos para separarlo en dos Mitades la primera mitad arriba la segunda mitad abajo y si todo ha ido bien Ahora guardo y recargo y en la factura veremos que bueno vamos a ver tengo aquí los cuatro productos algo no he hecho correctamente pero ya estoy cerca fijaos que me aparecen los cuatro productos a la vez lo cual ya es un avance bien debe ser porque algo no he hecho correctamente porque en principio si cierro el TD porque en principio he creado una opción Select name es igual a producto con sus estos un momentín vale estoy pensando que puede ser debido a que no he parado el servidor y lo he vuelto a arrancar por tanto igual no estoy viendo los últimos cambios igual estoy viendo una versión anterior de cuando no había creado el Select Así que guardo y recargo Y ahora yo creo que sí veremos como tengo por una parte un Select para el cliente y por otra parte un Select para el producto yo ahora no quiero tener una línea de pedido o de factura quiero tener múltiples líneas por eso lo que voy a hacer es lo siguiente efectivamente muy bien voy a usar un bucle una estructura de control de tipo bule y yo creo que más que usar un While en este caso es mucho más fácil usar un for Así que digo for pongo las condiciones para el for y encapsulo el While dentro del foro y ahora digo for int línea es igual a 1 línea es menor que el número máximo de líneas que queráis tener digamos 30 Luego si queréis lo cambiamos y digo línea más es decir la clásica estructura del bucle for para repetir algo 30 veces pero claro ahora lo que me va a repetir 30 veces no es exactamente lo que yo quiero sino que me va a repetir 30 veces el out print Line esto Qué resultado va a tener pues Mirad va a hacer lo siguiente si yo ahora guardo y recargo comprobaré que ya tengo algo parecido a lo que quiero pero no exactamente lo que quiero comprobaré que aquí básicamente tendría Espera que creo que no ha refrescado aquí tendría 30 veces estos cuatro elementos un momento porque no ha refrescado déjame que lo Pare bien déjame que ejecute cierro aquí instancias me voy a la última instancia si hace falta la refresco bueno momento que refresco vale Pero bueno Ahí en principio no sé por qué no me están saliendo más será que a ver qué inspección elemento será que están por ahí ocultas Bueno me debería aparecer ahora sí no ordenador portátil me debería aparecer pues 4 por 30 instancias de eso lo que voy a hacer en su lugar es lo siguiente Mirad dentro del for simplemente lo que voy a hacer es capturar todo esto desde el TR hasta el TD y digo atención out si sé que la doble comilla va a ser un problema pues le pongo comilla sencilla y luego ya sabéis que en Java cuento con la problemática de la múltiple línea así que pongo comilla sencilla más esto hay otros lenguajes como php donde no es necesario pero dentro de Java sí a su vez php tiene otros problemas evidentemente y aquí lo tenemos y después lo que hago es lo siguiente después lo que hago es outto printline Ah sí vo tener ahí un problema muy bien vale no va a funcionar Exactamente y ahora averiguamos por qué simplemente aquí le cargo el Select el TD y el TR y ahora ya sabéis jugamos con las comillas para poner comillas al principio y comillas con encadenamiento al final Esto va a casi funcionar pero no va a funcionar del todo paro recargo veis que teóricamente tengo ahí el TR que se abre tengo la petición y tengo el TR que se cierra y ahora ejecuto ahora os envío el código y ocurre Esto bueno bien ocurre un error en la línea 16 116 Perdón Ah muy bien muchas gracias por la ayuda 116 es todo ese bloque así que bueno parece Claro que tengo un error en alguna parte de los encadenamientos sin ir más lejos ahí bien paro recargo vamos a verlo ahora bueno otro error Vale dice unclose caráter literal si me dice unclosed es algo que no he cerrado bien Así que TD Ahí está cerrado hay algo que no he cerrado correctamente y ahora tengo que buscarlo una buena manera de saber si el error está en un sitio o en otro Mirad es comentar Así que yo comento esa línea independientemente de que ahora la maquetación funcionará mal por supuesto tengo que parar y volver a arrancar y voy a ver si el error está arriba o está abajo vale l 116 Así que el error no está abajo parece que está arriba Ah sí creo que ya sé cuál es el error os lo voy a confirmar es que en Java y en jsp no se pueden poner no se pueden cambiar comillas dobles por sencillas en todas partes vamos a verlo vale cuidado paro está parado creo ejecuto y efectivamente Vale pues un segundo porque el error va a consistir en cambiar las comillas sencillas por dobles y las dobles por sencillas un momento lo hago yo compruebo confirmo y ahora lo hacéis bien voy cambiando las comillas voy cambiando las comillas compruebo paro recargo y efectivamente Ese es el error vale por tanto el error simplemente consiste en que cambiéis Para dejarle las comillas dobles a Java y poner comillas sencillas en html por tanto ponemos comillas dobles en Java sencillas en html y por tanto si ahora va bien paro el servidor recargo las líneas se repiten pero solo en la primera funciona en las demás parece que quiere funcionar pero no funciona lo que voy a hacer por tanto como habéis dicho no es pedir esto cada vez sino pedirlo una vez y meterlo dentro de un String Mirad yo suelo hacer lo siguiente perm de crear una variable de tipo String llamada churrete Ahora que estamos en fallas String churrete es igual a nada digo churrete porque es una base digo es una String al cual yo le voy a ir encadenando como churretes como longanizas como embutido nuevos elementos Así que yo ahora digo lo siguiente de datos tenga resultados en lugar de hacer un out print Line voy a hacer un churrete más igual Qué quiere decir en Java más igual es lo que valía más esto que te voy a decir o sea encadena lo que te voy a decir o súmale lo que pasa es que en este caso como es un String es encadena ojo si he quitado el paréntesis del principio quito el paréntesis del final Así que ahora yo me he formateado una variable que se llama churrete y a churrete le he ido metiendo cada uno de los options Así que ahora al final aquí simplemente tengo que decir out print Line churrete y si todo ha ido bien le doy aquí a guardar y recargar y veis como ahora sí en cada una de las líneas de producto tenéis cada una cada uno de los productos disponibles bien entonces a partir de aquí a partir de aquí voy a hacer lo siguiente dentro del proyecto recordad que estamos dentro del proyecto erp estoy trabajando dentro de la carpeta web content y dentro de la carpeta web content lo que voy a hacer es crear un nuevo archivo llamado dime dirección por tanto creo un nuevo archivo jsp y este nuevo archivo se va a llamar dimed direccion. jsp dentro de dime dirección parece que en rp vuelvo a tener el problema del Target un momento le doy a propiedades le digo Target r Times y elijo Java preview y apach tomcat para que desaparezca el problema bueno bien ahora desaparecerá por tanto ahora lo que voy a hacer va a ser atención en dime dirección voy a eliminar todo el código y voy a poner Hola soy una página jsp ahora luego pondremos algo de código más complejo entonces en la página principal voy a hacer lo siguiente en factura jsp voy a ir alrededor de la línea Aquí está de la línea 103 104 es decir d se acaba el Select y donde se cierra el div Mirad estoy en una línea estoy en una línea en la que ya he acabado la petición a la base de datos en la que he cerrado el Select y en la que he cerrado el div vale por tanto quiero estar antes de empezar la tabla y aquí bajo del Select alrededor de la línea 99 100 101 tienes que buscar donde acabe el Select y donde acaba el dip cuando acaba el Select y cuando acaba el div vamos a poner el código que pondremos a continuación a partir de aquí me voy a hacer un elemento nuevo llamado div con ID dirección cliente vacío de momento ahora lo vamos a llenar pero no lo vamos a llenar directamente aquí en html lo vamos a llenar asincrónicamente a partir de otro archivo Por eso ahora que he creado este div lo dejo Ahí quieto me voy arriba y arriba lo que voy a hacer es simplemente Por una parte me voy a traer jquery y por otra parte voy a hacer la estructura clásica y característica para arrancar jquery esto que quiere decir pues que reutilizo vamos a verlo por ejemplo del crm reutilizo el archivo de jquery Ah no tengo por aquí bien pues por ejemplo crud javascript seguro que aquí sí de la carpeta me copio la carpeta me la paso de un proyecto a otro y la pego aquí dentro de web content por tanto le doy a paste Y fijaos que ahora dentro de web content tengo una carpeta lid contiene el archivo jquery Es decir me he copiado y me he pegado la carpeta de jquery desde un proyecto Hasta el otro y ahora lo que hago es poner la etiqueta como siempre de que quiero importar un Script que está situado en Li bar min.js y una vez que tenemos esta etiqueta este Script recordáis que siempre hacemos la misma estructura de control para arrancar jquery tras lo cual pongo alert si estás viendo esto es que funciona así que si ahora guardo y recargo paro el servidor y vuelvo a arrancar comprobaremos como sin ningún problema aparece un mensaje en la pantalla donde dice si estás viendo esto es que funciona y ahora lo que voy a hacer es algo realmente sencillo donde a continuación del alert si queréis para no Eliminar esa línea voy a hacer lo siguiente dólar almohadilla dir cliente porque recordamos que he creado un ID que se llama dirección cliente Así que almohadilla dirección cliente punto load y voy a cargar el archivo dimed direción jsp qué le estoy diciendo lo que le estoy diciendo es dentro de aquel elemento que tiene el ID dirección cliente lo que quiero es cargar el contenido del archivo llamado dimed dirección jsp por supuesto el contenido de aquí debe coincidir perfectamente con el ID del div y el contenido de aquí debe coincidir perfectamente con el nombre del archivo jsp que habéis creado Y si todo va bien y ahora guardo y recargo dejadme que desac esta línea ahora paro el servidor recargo la pantalla y lo que tengo si todo ha ido bien Mirad es que me dice hola soy una página jsp es decir yo tengo aquí una página jsp de inicio llamada factura alvarán lo que sea pero el contenido de esta línea proviene viene de otra página jsp Y aunque en este momento no lo parezca se está cargando de manera asincrónica Claro que ahora no quiero que este mensaje aparezca porque sí al principio de la pantalla sino que quiero que ese mensaje aparezca Solo cuando yo seleccione algo del Select entonces voy a hacer lo siguiente voy a decirle que cuando sobre cómo se llama ese Select se llama ID selecciona Cliente por tanto voy a decir cuando sobre selecciona cliente haga punto change cuando selecciona cliente cambie en ese caso introduzco aquí una función y esa función es la que va a contener a la línea de código que había escrito previamente por tanto básicamente lo que estoy haciendo es englobar la línea de código que había escrito previamente dentro de selecciona cliente punto change que básicamente esto se lee en castellano que cuando selecciona cliente cambie En ese momento y solo en ese momento y respondiendo a ese evento es cuando quiero cargar dimed direción jsp si todo ha ido correctamente nos encontraremos con que ahora paramos el servidor arrancamos de nuevo atención Mirad y encuentro que ahora no me dice aquí abajo Hola soy una página jsp pero en el momento en el que yo seleccione un cliente me dice hola soy una página jsp es decir he supeditado la ejecución de ese código al cumplimiento de un evento que es cambiar el combobox lo que hago ahora es complicar un poco más el código de dime dirección por tanto en dime dirección yo voy a hacer lo siguiente selecciono la primera parte de las etiquetas jsp es decir de codificación las etiquetas de sql y las etiquetas de import ahora copio una petición a la base de datos ya os dije que este código lo vamos a copiar y pegar permanentemente simplemente lo que he hecho mira aquí mira la pantalla lo que he hecho es copiar las etiquetas del principio al principio de dime dirección y un bloque de petición a la base de datos un trycatch justo bajo a dime dirección entonces ahora dime dirección tiene las tres etiquetas de importación y a partir de ahí tiene una petición a la base de datos luego lo que voy a hacer es lo siguiente Mirad voy a decir Select all from clientes limit 1 y ahora simplemente voy a hacer algo así vamos a ver atención Mirad voy a decir rs.get String dirección vamos a verlo voy a ir un momento a local Host voy a ir un momento a php my admin y voy a comprobar que dentro de la base de datos erp en clientes tengo un cliente con una dirección Así que Mirad lo que ocurre ahora Select clientes limit 1 solo quiero el primer registro selecto from clientes limit 1 si ahora ejecuto Este programa veis que ocurre lo siguiente nombre del primer cliente atención cojo el segundo cliente y me dice dirección del cliente qué me dice dirección del cliente me dice dirección del cliente porque efectivamente aquí pone dirección del cliente una buena noticia y una mala noticia la buena noticia es que cuando he cambiado el Select he sido capaz de ir a la base de datos tomar un dato y devolverlo en pantalla la no tan buena noticia Es que yo he cogido el segundo cliente pero me ha devuelto la dirección del primer cliente y esto por qué ha sido esto ha sido por dos razones la primera razón es porque le he dicho convenientemente Select all from clientes limit 1 o sea no te digo cual quiero te digo dámelos todos Quédate con el primero ahora lo que tengo que hacer por último y ahora podéis copiar código es decirle que quiero la dirección del cliente pero no de cualquier cliente sino del cliente que haya seleccionado en el combobox Así que esto lo voy a hacer de la siguiente manera le digo que cargo dime dirección jsp y le paso un parámetro que dice ID cliente es igual a más dis punto Val es decir le paso un ID de cliente y el ID de cliente es aquel ID que haya capturado en el Select ahora podréis copiar por lo que ahora digo Select all from clientes ID es igual a má request get parameter y de cliente vamos a ver si funciona antes de copiar Así que recargo y ahora digo segundo cliente bueno no se ha podido conectar con la base de datos Porque hay una excepción no se encuentra la columna cli 002 vale vamos a ello bien ha fallado porque estoy pasando cli 001 pero cli 001 no es un ID sino corresponde a la columna número de cliente por tanto voy a número de cliente y Ahora sí recargo y atención porque si todo ha ido bien le digo a segundo cliente bueno Vale y me dice que no encuentra la columna cli 002 vale lo está intentando atrapar como una columna cuando realmente no es una columna sino que es una fila vamos a verlo Select all from clientes Where número de cliente es igual a request parameter voy a hacer una cosa voy a hacer una cosa Ah claro muy bien Creo que el problema es que me faltan unas comillas sencillas siempre que tengáis un problema con toda probabilidad son unas comillas un paréntesis así que y coma entonces guardo recargo probamos de nuevo y vamos a verlo vamos a ver si ahora nombre del primer cliente segundo cliente y me dice dirección del segundo cliente Si cojo tercer cliente me dice dirección del Tercer cliente Si cojo cuarto cliente me dice su dirección porque en cuarto cliente efectivamente tenía su dirección es decir qué estoy haciendo pues lo que estoy haciendo como comentaba al principio de la clase es crear una petición asincrónica para que en el momento en el que yo selecciono aquí en ese momento se me va a la base de datos me selecciona ese cliente y me pide un campo concreto como en este caso es la dirección a partir de aquí lo que voy a hacer es lo siguiente lo que voy a hacer es Select clientes número de cliente Pues aquí voy a hacer out printline Quiero obtener también el código postal de paso también quiero obtener la población y también quiero obtener el cif probablemente me haga falta encadenar con algún br os lo aviso por tanto voy a probarlo y ocurrirá lo siguiente vamos a factura y dentro de factura atención Mirad nombre del segundo cliente eh dirección del segundo cliente y luego no he podido conectar con la base de datos Porque población no se ha encontrado vale vamos a población vamos a comprobar si bien no pusimos campo pues ponemos código postal y ya lo tenemos Así que vamos a verlo Ah código postal y no pusimos directamente población pues no pasa nada y voy a decir país Y cif en lugar de población por tanto aprovecho Mirad en lugar de población pongo país y aprovecho también para si queréis voy a hacerlo muy extendido para que lo veáis muy claro out printline y voy a poner br para forzar un salto de línea así que pongo br y así me aseguro que entre cada uno de los registros hay un pequeño salto de línea Por eso ahora guardo recargo y comamos atención como ahora sí si no hay errores de sincronización con columnas comprobamos como cojo el segundo cliente y aparece dirección del segundo cliente código postal España y su cif tercer cliente dirección del Tercer cliente y así vale Y como podéis comprobar pues simplemente seleccionando un cliente automáticamente obtengo todos sus datos el problema está en que claro Solo cuando cambias es cuando realmente recarga por tanto yo lo que haría es que dentro de factura trucar manualmente en ID selecciona cliente y voy a poner un campo manual option en el que voy a poner selecciona un cliente y así no me aparece ya el primer campo por defecto V es igual a nada vale entonces selecciona a un cliente ahora recargo y veréis como ya no aparece ese primer cliente con el que te aparece el primer cliente pero no te aparecen sus datos Porque no has hecho change ahora dice selecciona un cliente y aquí ya puedes el nombre del primer cliente y tenerlo correctamente y ningún problema lo que necesito ahora es realizar la siguiente acción para este Select voy a decirle que vamos a ver Select valor Aquí está vamos a ver no horas dónde está Select aquí en el churrete bien Ahora mismo en el churrete que hicimos ayer atención yo ya tengo lo siguiente yo ya tengo el que cada producto tiene su propio ID su propio código de producto Qué quiere decir esto Pues que por ejemplo ordenador portátil tiene el valor p001 por qué Pues porque en productos a ordenador portátil le puse el código p001 de la misma manera ordenador de sobremesa tiene el p002 Así que si os fijáis tengo que hacer algo parecido Vale tengo que hacer algo parecido a lo que había hecho pero en este caso con cuidado vamos a verlo vamos a ver y ahora hago lo siguiente este Select name si os fijáis es indistinguible dónde estás aquí de este Select name producto Mirad los dos tienen name producto por tanto yo ahora voy a hacer lo siguiente aquí donde pone Select voy a decir número de línea es igual a más línea porque línea recordamos que es una variable que viene aquí del bucle for esto qué va a hacer Bueno pues esto lo que va a hacer es que si yo ahora guardo y recargo veréis que cuando recargo si queréis miro un momento el código ver código fuente de la página y veréis que Ah lo pone por aquí Bueno vamos a ver ahí no se puede ver bien Vamos a verlo inspeccionando código y Mirad y digo Select número de línea es igual a 1 Vamos a verlo Select número de línea es igual a do esto qué quiere decir pues que ya estoy siendo capaz de asignarle un atributo específico para cada una de las líneas ahora voy a hacer lo siguiente vamos a ver ahora en el precio voy a decirle ID va a ser precio línea yid precio línea va a hacer lo siguiente Mirad yid precio línea va a hacer que cuando yo guarde y recargue y ahora Aquí empieza a aparecer un poco el kit de la cuestión si yo inspeccion este elemento veréis que es número de línea porque en precio aparece ID precio 1 número de línea es igual a un creo que está más o menos Claro que irá enlazado a precio un si me voy a la siguiente fila veréis que tengo número de líneas igual a 2 y de precio uno no puede ser porque me dices precio uno me deberías decir precio dos vamos a ver por qué vamos a verlo número de línea es igual a tres y me debería decir precio uno vamos a ver qué puede que le haya puesto para que no me diga no me incremente ese elemento vamos a ver precio línea Es que tienes un ID dos ID Ah Uh vale No pues entonces no dejadme entonces Claro que quite el primer ID porque entonces el primer ID está machacando al segundo efectivamente muy bien visto Así que ahora paro el servidor arranco el servidor Y comprobamos de nuevo si es cierto que número de líneas igual a 1 porque ahí tengo precio uno bien hasta aquí sí pero ahora me voy a la siguiente línea y digo número de líneas igual a 2 porque precio 2s y por supuesto Ahora si me voy por ejemplo a esta línea digo número de líneas igual a 5 precio 5 lo que he hecho por tanto es línea a línea en primer lugar enlazar Por una parte el Select y por otra parte el precio para qué pues para al enlazar esos parámetros poder decir cuando línea 3 cambie Pon el resultado en precio 3 ni en precio dos ni en precio 4 sino en precio tres cuando línea 5 cambie pone el resultado en precio 5 y así de esa manera engancho un parámetro con otro ahora de la misma era que antes he creado un archivo llamado dime dirección ya habéis visto para qué Para que tú dime el cliente y yo te digo la dirección ahora vamos a crear un archivo nuevo dentro de web content un archivo jsp llamado dime precio fijaos va a hacer algo muy parecido a lo que hace Dime dirección de hecho es que me estoy copiando todo el código de dime y Lo estoy pegando en dime precio y ahora digo de momento aquí Select all from clientes qu no me acuerdo Select all from productos we código esto es de lo que me acordaba vale código y Select all from productos we código es igual a ID producto simplemente lo modifico Y en lugar de clientes pongo productos Y en lugar de número de cliente pongo código Y en lugar de ID de cliente pongo I de producto es decir lo adapto para que me sirva para la otra tabla ahora claro Mirad este out printline se simplifica muchísimo porque no quiero que me digas todos los datos de un cliente Quiero que me digas únicamente el precio Así que modificar Este dime precio es más o menos sencillo simplemente lo adapto para la tabla de producto pero Mirad y sobre todo Ahora quiero que miréis y luego tranquilos que tenéis tiempo para copiar pero lo que quiero es que aunque no pillé exactamente qué hace cada línea pero pilláis el mecanismo lo más difícil por tanto ahora de este bloque es lo siguiente me voy a crear vamos a ver aquí el Select Dónde está Select no estás aquí Select name producto y digo Class producto o Class sí producto necesito ponerle una clase a cada uno de los selects atención todos la pantalla para ahora decir cuando sobre producto punto change en este caso voy a ejecutar una función que si queréis dirá de momento vamos a por el precio vamos a verlo si funciona así que paro el servidor recargo de nuevo y de momento atención muy primitivamente de momento cada vez que cambie un producto me dirá vamos a por el precio Es decir es capaz de en un primer momento reconocer cuá estoy cambiando un Select de los productos por tanto ahora hago lo siguiente ahora digo vamos a ver dentro de precio Pero qué precio No lo sé dentro de precio uno si queréis digo load dime precio ID producto y de producto No lo sé y de producto sí y de producto es igual a dis Val creo que es Val creo que sí vamos a verlo esto casi funcionará no del todo pero funcionará Así que recargo y vamos a ver si funciona cojo ordenador de sobremesa y me dice ordenador de sobremesa 1000 parece que ha funcionado pero no ha sido así es decir casi ha funcionado Por qué Pues porque ahora cojo ordenador de sobremesa aunque no lo parezca ahí me sigue poniendo 1000 para que lo veáis digo Tablet y me dice 150 bueno casi funciona fijaos que cojo ahí impresora y me dice 80 Por una parte funciona Porque es capaz de reconocer cada una de estas líneas tomarme el producto ir a la base de datos y recuperar su valor pero únicamente no funciona porque me lo está poniendo todo en la línea número uno por qué es esto es natural porque yo le he dicho Ahora quito eso yo le he dicho precio uno por tanto es normal que ocurra eso ahora tengo que decirle que ese precio no tiene por qué ser precio uno será precio de lo que sea entonces si todo va bien yo digo atención con ahora lo que hago es bar y de línea es igual a dis Es decir de este en el que he pulsado su atributo qué pues su atributo número línea efectivamente no me acordaba de memoria entonces su atributo númer línea Entonces yo le digo precio uno no precio más I de línea sea cual sea la línea que has cogido dime vamos a verlo creo que no es precio y el número efectivamente con lo cual si y de línea se va a convertir en un número va a ser precio y el número porque con el signo más lo que estoy haciendo es encadenar me refiero que elrio nú l creo que guardas no guardas creo que no pero vamos a verlo creo que no te lo digo en número línea Select Class producto número de líneas igual a dos claro es porque si no tendría que la cadena trocearla quedarme con el número sería un rollo vale por eso lo he hecho así entonces Si ahora todo va bien guardo o sea paro recargo Y si ahora le digo ordenador portátil pues momento que tengo que cambiar y número de línea muy bien Vamos a verlo es número de línea fíjate tú muy bien así que ordenador de sobremesa me dice 1000 pero ahora aquí digo Tablet y me dice 150 Ahora aquí digo ves A mí también me sale de vez en cuando ese icono No pasa nada y digo tablet también 150 y aquí claro lo único que no puedo es portátil Pero no te preocupes porque simplemente a ahora introducir una opción manual de hecho voy a hacerlo ya porque molesta bastante que tenga una factura que ya de entrada me ponga un concepto en cada línea entonces simplemente esto lo puedo arreglar muy fácilmente atención diciendo aquí que en el churrete vamos a ver el churrete en el churrete simplemente voy a poner un option vacío simplemente para obligar a que la primera línea de cada opción aparezca en blanco y por tanto Mirad y por tanto Bueno a mí en este caso en firefox me aparecen los desplegables en otros navegadores ni siquiera aparecerían y solo cuando Cojo un producto es cuando realmente aparece el precio dentro de la parte izquierda vale con lo cual en el siguiente bloque lo que tenemos que conseguir y eso ya es bastante fácil ya lo veréis es que cada vez que yo ponga aquí cantidad pues diga sí pues 1 * 800 es igual a 800 y que al final del todo sume y calcule impuestos eso ya veréis que es javascript pro y duro Hola azul sí venga entonces bueno en este caso os diría que voy a cerrar dime precio voy a cerrar dime dirección Voy a trabajar amente con factura jsp Y ya sabéis que estamos hablando de javascript por tanto me voy a ir a javascript y voy a decir lo siguiente cuando sobre el documento cuando sobre cualquier parte del documento haga Ke app en ese caso voy a ejecutar una función que de momento ya sabéis siempre empiezo por poquito diga has pulsado una tecla has pulsado una tecla lo que va a hacer es que cuando sobre déjame quear el servidor vamos a sacar servidores por aquí cuando atención estoy ejecutando cuando sobre cualquier parte del documento haga clic en una tecla meis atención que dice Has pulsado una tecla has pulsado tecla será el disparador para ejecutar el cálculo Mirad tengo un pequeño problema vamos a verlo Mirad precio tiene el ID precio un Eso está muy bien pero cantidad tiene el ID cantidad 1 cantidad un está puesto a mano no lo hemos puesto Dinámico vale por tanto lo que voy a hacer es esto Mirad de la misma manera que antes he hecho cantidad Dinámico o precio Dinámico Pues voy a hacer ahora lo siguiente aquí cantidad más línea por lo que ahora Mirad paro y ejecuto y comprobaremos vamos a recargar y comprobaremos Mirad como vamos a verlo bien como os decía comprobaremos como esto es cantidad uno y esto es precio uno pero en la siguiente línea esto es cantidad dos y esto es precio dos así que como os podéis imaginar e cuidado y total no puede ser total uno otra vez en total tengo que poner total más línea para que sea precio 1 cantidad 1 total 1 precio 2 cantidad 2s total dos bueno hecho esto ahora manualmente atención lo voy a hacer para una línea para que lo veáis claro voy a decir esto lo her mudez y digo sobre total un Ponme el código html correspondiente a sumar cantidad 1 punto text por precio uno cantidad uno es un ID precio 1 punto text vamos a ver si da un error que debe dar un error Por qué dará un error por una razón muy sencilla porque estoy multiplicando dos cosas que básicamente son texto no son número pero ahora hacemos un pequeño cast lo ponemos como entero y ya está bien un momento que parae el servidor vamos a verlo ahora bien Se me ha enganchado el servidor Así que voy a parar un momento eclipse vuelvo a arrancar vamos a verlo Sí si no he puesto una almohadilla efectivamente en total uno como es un ID tenía que haber una almohadilla así que de la misma manera que se me ha olvidado la almohadilla en cantidad creo que ha sido pues tendré que poner también en total vamos a arrancar y al arrancar veremos que este código va a funcionar sobre la línea uno funcionará sobre la línea un por tanto a partir de ahí tenemos dos opciones o bien calcularlo manualmente línea a línea en las 15 líneas o bien buscar alguna manera automatizada de decirle hayan 10 o hayan 500 calcúlame las que haya es decir ves línea a línea y calcúlame las que haya bien como os decía bueno total uno efectivamente debe llevar un ID Así que ahora ejecuto la aplicación vamos a ver qué nos da y Mirad digo producto es ordenador portátil 800 cantidad es dos Mira ha funcionado de casualidad se ve que ha cogido directamente los textos como si fueran números si no hubiéramos hecho un entero y ya está Pero cuidado si ahora digo 3 por ordenador de sobremesa y daos cuenta como no me Calcula ese total por qué no me Calcula ese total pues simple porque aquí me he referido a total 1 cantidad 1 precio 1 lo que tendría que hacer que de hecho vamos a hacerlo ahora para el principio es calcular unas cuantas líneas de código ya que me diréis Oh madre mía repetir eso tiene mala pinta lo sé pero de momento lo que quiero es que os funcione y una vez que os funcione nos preocupamos de reutilizar Así que he activado el cálculo para las cuatro primer las líneas de la factura Así que ahora recargo y ejecuto y Mirad atención Cómo digo lo siguiente como digo ordenador portátil 800 por 3 2400 ordenador de sobremesa por 4 4000 tablet por 5 750 y impresora por 1 es igual a 80 claro si intento hacer la quinta línea pues no funciona porque solo he programado hasta la cuarta vale Así que tengo esto por aquí lo que tengo es e qué os diría yo activado el código para las cuatro primeras filas ahora además quiero hacer lo siguiente Mirad cálculo para las líneas de factura Y ahora atención cálculo de los totales creo que la base imponible creo que tiene ya un ID vamos a verlo un segundo que os lo digo bien total base el campo correspondiente a la base imponible se llama total base Así que digo aquí arriba total base punto html y quiero que sea igual a total 1 punto text más total 2 punto text más total 3 pun text más total 4 pun text y así Ya lo sé que diréis una manera un poco manual de hacerlo Sí lo sé pero de momento que funcione Así que paro el servidor y vuelvo a recargar y comprobamos vamos a ver si funciona Cómo Quiero un portátil que son 800 quiero Dos ordenadores de sobremesa Quiero tres tablets y quiero impresoras Y si todo ha ido bien me vengo aquí abajo bien hay algún problema ahí porque fijaos que en lugar de estar sumando lo que está haciendo es encadenando si está encadenando ahí sí tengo que irme al método parse in en javascript que lo que hace es convertir intentar convertir al menos una cadena en un número dejadme que tengo un bacalao entre Java y javascript parseint que ya no me acuerdo si es con puntito o con paréntesis vale bien ya está pues entonces hago lo siguiente Mirad le digo parse int ojo que la i es mayúscula de el total un parse int del total dos parseint del total 3 parseint de total cuatro y no olvidemos que si he abierto paréntesis los tengo que cerrar por eso ahora guardo recargo ejecuto bien Ah muy bien Se me ha quedado ahí vale ordenador portátil Espera que no ha cambiado Wow debo tener vamos a ver tablet 2 ahora impresora 3 ordenador portátil 4 si todo ha ido bien Ahora veréis que 3200 + 240 + 300 + 800 deberían sumar 4540 con lo cual lo único que me queda es calcular el IVA calcular el irpf y calcular el total si queréis para hacerlo fácil al principio asumir un IVA yo lo tengo aquí como desplegable hacerlo sencillo calcular un iba fijo el que queráis calcular un irpf fijo el que queráis y adelante tenemos un problema y es que la función se ejecuta Solo cuando hago clic eso A qué me obliga Pues a que si cojo el producto Y entonces pulso una tecla se calcula pero si pulso una tecla Y entonces cojo el producto no se calcula el total Así que en este caso lo que quiero es atención esto es conceptualmente muy importante lo que quiero es ejecutar una función desde dos eventos diferentes eso tiene toda la pinta de que voy a externalizar la función a una función externa por tanto Mirad hago esto ccul totales me llevo todo el código a calcul totales y por tanto ahora digo cuando document keap Calcula totales y cuando claro cuando qué pues cuando no lo sé momentín que lo mire a ver si esto tiene alguna clase creo que sí creo que cada uno de los desplegables le hemos puesto la clase producto Pues cuando producto pun change entonces también Calcula totales lo que hemos hecho por tanto es permitir que dos eventos diferentes lancen la misma función para que por tanto os funcione de cualquiera de las dos maneras es decir Mirad demostración si ahora paro y recargo creo que me vuelve a pasar lo de tengo que volver a recargar saving workspace le digo que quiero ejecutar de nuevo eclipse voy a ver si ha habido suerte que creo que va a ser que no y me dice que no se puede conectar bien hasta que no refresque el servidor no me dejará conectar pero el caso es que si ahora probáis comprobaré un momento comprobaré como eh Por una parte funciona cuando pulso un botón cuando pulso una tecla y cambio un Select se me pondrá el precio y cuando cambie el Select y pulse un botón también se me pondrá el precio y de esa manera digamos no es técnicamente un fallo de programación pero sí que en cuanto a usabilidad Pues el cliente espera poder usar esta plantilla de cualquiera de las maneras posibles quiero decir que no es muy viable decirle a un cliente no para usar esta plantilla tienes que hacerlo así y no al revés vale porque te puedo decir bueno Pero lo normal es que lo haga como yo quiera Bueno le doy a Root y ahora simplemente lo que quiero arrancar es volver a ejecutar y comprobar el funcionamiento del código que acabo de escribir un momento y lo probamos y ahora arranco eclipse arranco el servidor y como podréis comprobar si yo digo dos de qué no lo sé todavía de ordenador portátil en ese caso 800 cambia no estás cambiando a ver ahora le pongo dos o me lo cambia vale vamos a ver qué ha pasado cuando sobre producto punto change Calcula totales porque vamos a comprobar que esto de aquí tiene la cl ese producto Select Class producto Está bien escrito cuando sobre producto punto change claro cuidado bien Es que producto punto change ya lo estoy atrapando aquí arriba con lo cual no lo debo atrapar aquí abajo pues no pasa nada Ya que ya lo atrapo allí arriba pues digo Calcula totales aquí dentro de esta función y ya está así que guardo recargo bien fantástico error interno Vamos a darle a recargar y digo uno por tablet bien Oh creo que tengo un problema ahí y es que 2 por aparte de que no sé si realmente he llegado a parar el servidor un momento pero bueno tengo un pequeño problema y El pequeño problema Mirad El pequeño problema es que bueno es que si os fijáis Ajax tarda un segundito en darme la información Eso que quiere decir que le digo calcula el precio no está luego no me calcular nada y cuando aparece no tengo ninguna manera de decirle que calcúlalo ahora Así que para empezar vuelvo a tener el problema este a ver si cerrando tomcat vale ejecuto bueno y no creo que sea esto no Bueno pues voy a reiniciar vamos a trabajar y Vamos a abordar la problemática de los decimales entonces me voy a la base de datos voy a poner precios con decimales Así que punto 1000.05 150.40 y 80.45 con lo cual ahora como he cambiado la base de datos no tengo por qué reiniciar el servidor y digo uno por ordenador portátil y es igual a Espera que no he cambiado nada y es igual a 1000.05 Vale hasta ahí bien eh si cojo dos o uno por ordenador portátil no Ah sí mira aquí vale Ahí tengo empezo a tener un problema y es el problema de los ceros pero ahora veréis que se tiene fácil solución lo que quiero ver lo que quiero ver es vale 1800 Vale y efectivamente ahí se me ha comido la coma Por qué por una razón realmente sencilla y es que yo al texto le he dicho parse int y como le he dicho parse int es parse entero y como es un tero no tiene decimales con lo cual ahí tendríamos que buscar algún método alternativo eh javascript parce doble o parse float mismamente parse float vale Y con un número de precisión flotante de coma flotante Mirad le cambio int por float in por float ahora sí que tengo que parar y refrescar y Dale y al parar y refrescar vamos a ver como cojo a ver que refresque del todo y si no Mira me lo llevo aquí a javascript a Chrome digo un ordenador portátil son 802 Mira otro ordenador portátil ya está y ahora por tanto me aparece 1600 con4 por tanto al usar parse float Ya lo tenemos en marcha tenemos ahora un pequeño problema no es un problema desde el punto de vista matemático pero es un problema si quieres más estético que otra cosa pero es un problema vale Y es el rellenado de ceros por tanto ahí lo que vamos a hacer es buscar alguna de las funciones javascript number of decimals ya hay funciones hace esto Mirad t fixed a dos decimales y lo que hago es pun html madre mía Mira sabes qué bar total es igual a todo eso de ahí porque es que si no ahí aplicarle el to fix me puedo morir Así que le digo eso y ahora digo total punto to fixed con dos decimales por tanto ahora Mirad lo que voy a hacer va a ser Sencillamente vamos a ver aquí está Sencillamente paro el servidor y vuelvo a recargar errores aparte Oh bien dejadme que para el servidor porque no creo que lo recargue directamente uno ordenador de sobremesa o portátil 80 con2 ahí no pero Mirad uno de ordenador portátil ahí mismo bueno no no espera 80 con2 pero fíjate que aquí al final me dice 1600 con 40 si queréis ahí queda bonito ahí no queda nada bonito pero lo que puedo hacer es mira lo que voy a hacer eh A ver dejadme que ponga esto con tu fixed de dos pero Mirad y con esto acaba la sesión de hoy a nivel teórico claro es que yo me tengo ahora que poner a hacer todo eso en todas las líneas del pedido y yo digo no eso no me gusta vale Ahí hay algo que no acaba de funcionar mentalmente por tanto voy a hacer lo siguiente atención Mirad y voy a poneros este código con el cual lo que voy a hacer es repasar la tabla línea a línea automáticamente para atrapar las operaciones Así que Mirad primero Esa línea cómo se llama No lo sé tiene nombre de hecho str Ahí TR y veo que no tiene nombre de hecho fijaos que el TR no tiene ni ID ni clase Así que ahora me voy a Java y aquí donde creo el TR Déjame ver dónde creo el TR aquí le digo Class y la clase es línea factura por tanto ahora digo Mirad ahora digo línea factura punto atención punto each que en inglés quiere decir cada uno de ellos o sea por cada línea de factura que te encuentres ejecuta una función que va hacer lo siguiente Mirad vamos a ver bien un momentín que estoy con esto y ahora voy a hacer lo siguiente bar contador es igual a 1 así que yo digo atención en total más contador le digo cantidad más contador precio más contador cuánto vale contador al principio vale uno luego va a ser total 1 cantidad 1 precio un Y así vamos a probarlo Y por supuesto al finalizar cada uno de estos voy a decir contador más si todo ha ido bien y no sé si irá bien le doy a Play creo que me dice el problema este lo cual en principio me debería dar igual porque no he modificado nada de Java Enterprise y ahora digo uno por ordenador de sobremesa fijaos que ya aparecen todas las líneas y digo es igual a 1000 2 por ordenador tres por impresora cu por ordenador pero 5 por ordenador seis por tal no tengo por qué ponerlo en orden verdad Y a partir de ahí lo que quiero que veáis es como Únicamente lo único que he tenido que hacer Y fíjate Como cada uno de ellos va con tu fixed a dos Es simplemente en lugar de tener que escribir 15 veces toda esa información lo que hago simplemente os he dejado el anterior enmudecido para que lo tengáis lo que hago simplemente es Poner este código y es código de manera automática le da igual que tengas 5 que 15 que 500,000 líneas lo que va a hacer es buscarte línea a línea y ponerte la información en la sesión de hoy vamos a empezar hablando de una tecnología parecida a la que hemos visto hasta ahora pero con una diferencia bastante grande que es trabajar más bien en el lado del servidor lo que vamos a ver hoy se llama serlet y los herbs como ahora veréis son parecidos a los jsps pero una pero con una gran diferencia mientras que hasta ahora los jsps eran mayormente html y Tenían un trozo de Java los her son al contrario son Java que de vez en cuando puede tener un trozo de html es como lo mismo pero al revés vamos a hacer un par de ejemplos Y ahora os cuento Por qué funciona así y qué sentido tiene y cuandoo usar un SP y cuando usar un serlet por tanto vamos a crear un nuevo proyecto vamos a crear un New dynamic web project y en project name vamos a poner servlets son como ser de server y lets no sé cómo traducirlo al Castellano pero un serbet es como un servidor cillo es como un cachito de servidor ahora una cosa muy importante el dynamic web module version en qué lo tenéis bien si lo tenéis en tres por seguridad por una cosa que ahora luego os contaré pasarlo a una versión anterior pasarlo a 2.5 por tanto ahí donde pone dynamic web module version pasadlo a la versión anterior al 3 que es 2.5 y esto os va a ahorrar una gran cantidad de problemas una vez que hemos cambiado a 2.5 Vamos a darle a next Vamos a darle al botón que pone next en esta siguiente pantalla nada que cambiar simplemente tengamos en cuenta que para este proyecto vamos a empezar a hacer clases Java hasta ahora no pulsamos next porque me da igual donde estuvieran los archivos Java porque no íbamos a tener archivos Java pero en este caso sí que los vamos a tener Vale entonces simplemente en este caso me dice Bueno dónde se meterán tus archivos Java se van a meter en la carpeta src aquí nada que cambiar simplemente pulsamos next y ya está pero lo importante ocurre en la siguiente pantalla en la siguiente pantalla vamos a confirmar que tenemos todos context root en serbs vamos a confirmar que tenemos el content directory en web content y vamos a confirmar que esto que tenemos aquí abajo que es lo importante que es generate web.xml está activado porque en algunas versiones de eclipse está desactivado porque se supone que ya te responsabilizas tú de gestionar tu propio we web xml la cuestión es que ahora que estáis aprendiendo es de demasiada responsabilidad que os lo gestionis vosotros prefiero que os lo gestione el eclipse y que más adelante cuando sepáis exactamente Qué hace ese archivo ya lo podéis toquetear y configurar oslo vosotros por tanto Ahora sí y más que nada porque ya no hay un next otra vez activado ahora le ocurre Ahora cuando y atención esto es muy importante en lugar de pinchar en la carpeta web content como he pinchado hasta ahora en lugar de esa carpeta lo que voy a hacer ahora es pinchar en la propia carpeta de proyecto si estoy trabajando en el proyecto serlet pincho justo encima de la palabra del proyecto serlet y le voy a decir que quiero crear un New algo podría crear un F un folder podría crear un archivo html podría crear un archivo jsp pero lo que voy a hacer es crear un archivo serlet Así que creamos un archivo serlet Y empezamos su proceso de configuración en cuanto al Java package eso ahora mismo no tiene demasiada importancia pero vamos a poner el paquete en el formato de estructura inversa es decir com punto vuestro nombre y apellidos en mi caso vamos a ver estoy poniendo com punto porque tengo José Vicente carratala comom com. josev viicente carratala por eso es El dominio inverso porque pones primero la extensión y luego El dominio claro vosotros diréis yo no tengo ningún dominio da igual inventarlo porque en este caso el ser no va a ir a comprobar si realmente tenéis El dominio o no y a continuación el nombre del paquete servlets el nombre de la clase no puede estar vacío Así que no puede estar vacío y además tiene que empezar con minúscula por tanto Hola mundo en formato camel case convención Perdón al revés minúscula no mayúscula por convención el nombre de la clase debe empezar por mayúscula por tanto Hola mundo si lo ponéis en minúscula funciona vale Pero si respetamos la convención pues mejor que mejor bien en lugar de darle a Finish le damos al botón de next nos aseguramos de que en el name ponga Hola mundo y atención no lo cambiéis pero aseguraros que en el mapping en el URL mapping pone barra Hola mundo es cierto que lo pone pues vamos allá por último pulsamos next y Dentro de este pequeño formulario siempre que hagamos un serlet vamos a comprobar que automáticamente viene con los métodos do get para capturar lo que venga por el modo get por la URL y el do post para capturar lo que venga en formularios traídos por post vamos a dejarlo así además quiero que sepáis que sin que vosotros tuvierais que escribir código vienen plantillas para do putut do delete do Head u otras opciones vale pero las dos más comunes son do get y do post yo os diría incluso que cuando creas un serlet elijas o do get o do post porque la información suele venir por un lado o por otro pero no por los dos hay excepciones vale Pero no es lo común pero ahora para un primer ejemplo vamos a mantener las dos por tanto ahora pulso Finish porque ya no hay un botón next tras lo cual como veis el programa os crea vuestra primera plantilla de serbet en este caso fíjate tú así como siempre que creamos un jsp yo digo no me gusta no está bien sangrado cuando crea el programa un seret lo crea bastante bien fijaos que todo está bastante clarito bastante comentado bastante sangrado Así que lo dejamos como está únicamente en mi caso tengo una serie de errores pero que ya sabéis que son debidos si os salen a no haber indicado el target proyecto a proyecto por tanto le doy a properties me voy a runtime le cojo por ejemplo en mi caso tomcat 7 y me aseguro que al tomcat 7 los errores se interpretan correctamente y ya no aparecen como errores una vez que tenemos esto vamos a ver qué pasa vamos a ver qué ocurre y para ver qué ocurre simplemente vamos a pulsar a Play Y si todo va bien choose an existing server elegir un servidor actual un servidor existente veréis que dentro de unos pocos segundos simplemente le dais a Play comprobéis como aparece en la pantalla un segundo aparece en la pantalla esto que tenéis aquí qué tenéis ahí nada pero el hecho de que la pantalla se vea en blanco ya está bastante bien siempre que no os de ningún error siempre que veáis ahí arriba que pone local Host 8080 el nombre del proyecto y el nombre del serlet Aunque la pantalla aparezca en blanco no hay ningún problema el hecho de que un serbet no nos diga nada por pantalla no solo es normal sino que es bueno porque el serbet como ahora os comentaré a continuación Ahora cuando os explique el modelo de tres capas el serbet no tiene por qué lanzar nada en pantalla porque para eso ya está el jsp lo que queremos del serlet es que haga cosas pero no necesariamente nos las convierta en una vista ahora si queréis para ver cositas pues es bueno que podamos lanzar algo en pantalla Así que para lanzar algo en pantalla vamos a volver a nuestro serlet vamos a venir aquí a la zona superior de importaciones he pinchado para desplegar simplemente para ver todas las que hay y simplemente la librería de in and out la librería que nos permite tomar datos y lanzar datos por pantalla no está importada por defecto en un seret porque en principio no hace falta porque el actúa de controlador no de vista Pero ocurre que en este caso quiero lanzar algo por pantalla Así que voy a poner import java.io asterisco para importarlo todo de la librería io veo que tengo una pequeña advertencia en la parte izquierda la advertencia dice que esta librería todavía no ha sido usada vale No pasa nada Ahora lo voy a usar y ahora además voy a decir lo siguiente y es que le digo asterisco con lo que ya sabéis que estoy malgastando bastante memoria porque lo importo todo de la librería io pero lo quiero así para saber que tengo todos los métodos disponibles vale es mal gastar memoria pero también así evitamos errores bien ahora tenemos que elegir si usamos el método do get o usamos el método do post en este caso Este es un serbet aislado que no tiene un jsp de apoyo por tanto vamos a usar el método duet que es el que usamos Cuando tenemos un serbet el solito y ahora voy a decir lo siguiente voy a pegar el siguiente código lo tengo por aquí en otro proyecto Java momentín que os lo voy a copiar Aquí bien voy a poner esto simplemente voy a poner vamos a ver primero ponemos esto primero poned hola simplemente y con ya tenemos para empezar poned estas dos líneas la 31 y la 32 que os acabo de poner en pantalla y os cuento Qué hacen en primer lugar creo un objeto o creo un una variable de la clase printwriter para crear algo en la clase printwriter antes Tengo que haber importado Java io es lo que hemos hecho antes writer mensajes Ya sabéis que si algo está en inglés es porque no podéis elegir el nombre pero si algo está en castellano es porque sí que podéis elegirlo printwriter mensajes es igual a response.get writer y acordaos de respetar las mayúsculas y las minúsculas Y si ahora ya tengo instanciado mensajes Ya puedo usar todos aquellos métodos de mensajes como por ejemplo printline hay otro Método en mensajes hay muchos mensajes punto que es el set content type vamos a ver está por aquí está también el format Bueno vamos a tirar de momento con el printline bien Así que simplemente escribimos mensajes printline Hola si queréis incluso ese Hola voy a ponerlo en h1 Así que guardo recargo paro el servidor lo rearranque y va a salir algo tan espectacular como lo que Vais a ver en pantalla va a salir algo tan espectacular como Hola brutal y este es el ejercicio en el cual de manera teórica hemos puesto a funcionar un serlet en la pantalla y por último para finalizar este ejercicio simplemente vamos a hacer los siguiente dentro del Hola Voy a encadenar una pequeña cadena y voy a poner lo siguiente request nuestro amigo request que ya lo conocemos request.get parameter y dentro del parámetro vamos a poner nombre así que ponemos Hola atención a los encadenamientos Hola espacio comillas get parameter y nombre y simplemente lo que voy a hacer ahora atención todos a la pantalla es parar vamos a parar el servidor vamos a arrancar atención todos la pantalla y veréis que ahora cuando me aparezca aparecerá Hola nul porque no le estoy pasando ningún nombre pero si ahora pongo Hola mundo interrogante nombre es igual a Jose me dirá Hola Jose si digo Hola Juan me dirá Hola Juan si pongo Jaime me dirá Hola Jaime es decir lo que estamos haciendo es pasarle un parámetro por get estamos pasando un parámetro por la URL lo estamos atrapando y lo estamos lanzando dentro del navegador y lo que vamos a hacer ahora es crear un ejercicio para poner en funcionamiento nuestros serbs y nuestros jsps voy a crear un proyecto Dinámico voy a crear un dynamic web project recordad que al crear un proyecto lo voy a poner con el la versión de módulo 2.5 no la 3 versión 2.5 y lo voy a llamar grabar db vale grabar algo en la base de datos usando serbs ya no jsps y ahora voy a hacer lo siguiente bueno simplemente me aseguro de que ahí pone 2.5 pulso next me aseguro de que la carpeta es src un segundo pulso next me aseguro de que aparece el web xml deployment descriptor pulso Finish y aparece un proyecto nuevo vacío llamado grabar db voy a crear por tanto una parte vista y una parte de servidor Y es más para hacerlo lo más separado posible en lugar de crear un archivo jsp voy a crear un archivo html para que el archivo html sepa que no va a contener nada de Java ni siquiera en formato jsp más adelante durante la semana lo que haremos es mezclar ejemplos de jsp con serbs pero hoy para ilustrar esta separación entre diferentes capas en primer lugar dentro de web content voy a crear un new html file nuevo archivo html y voy a hacer un archivo html muy sencillo Mirad lo voy a llamar Index html bien el código un segundo se me ha quedado un poco pequeño Así que dejadme que me vaya preferencias en general en este editor y lo voy a poner a 11 creo que ahí lo volveréis a leer bien dentro de Body voy a crear un form no voy a crear un input type text y de nombre cliente y si queréis placeholder nombre cliente un input type text y de teléfono cliente placeholder teléfono y un input para acabar type text y de email cliente placeholder email cliente y por supuesto un buton enviar con el ID botón enviar Y qué tengo Pues tengo cuatro campos de un formulario creando una interfaz de usuario Cuando digo creando interfaz de usuario quiero decir que no tengo nada de Java ahí dentro está todo en el cliente lo que sí que voy a necesitar es un poquito de javascript concretamente Necesito la librería jquery por eso vamos a sacar la librería jquery de cualquier otro proyecto donde la tengáis Ya sabéis que en web content me voy a hacer como siempre una carpeta llada y dentro de web content voy a pu vamos a verlo dentro de web content l voy a buscar un proyecto que tenga jquery por ejemplo la calculadora pues no vamos a verlo crud javascript vale Este sí que lo tiene Así que lo voy a copiar y lo voy a pegar lo voy a copiar y lo voy a pegar de un proyecto a otro para asegurarme atención Mirad que ahora dentro de grabar deb dentro de web content dentro de Live tengo un archivo llamado jquery 2.1 pun lo que sea min.js de tal forma que ahora antes de cerrar el Head pues puedo llamar a ese archivo Así que Script src me meto en la carpeta Live y cojo jquery-2.1.4.min.js y ahora empiezo como siempre con e mi propio código donde siempre veis que escribo document ready function llaves y antes de hacer nada más pongo un alert Ok para asegurar que el proyecto hasta aquí funciona Aunque de momento es un archivo html pero necesito lanzarlo contra el servidor para probar que lo está viendo el servidor Porque este archivo lo podríamos lanzar directamente contra un navegador pero el siguiente que vamos a hacer no vale Por eso tengo que pulsar la tecla Play para asegurarme que el servidor lo ve correctamente Y si todo va bien veréis que a continuación aparecerá un pequeño formulario con tres Campos y un alert que nos dice ok diciéndonos que todo funciona correctamente ahora que ya tenemos el alert funcionando vamos a hacer que el programa responda al clic del botón por tanto voy a hacer lo siguiente voy a hacer cuando sobre botón enviar haga click en ese caso ejecuto una función que va a hacer lo siguiente esta función si queréis aquí dentro de Voy a hacerme un div Ajax div y Ajax aquí abajo del todo y voy a decir sobre el div llamado Ajax quiero cargar un load y ese load todavía no sabemos Qué es Entonces ese load lo que va a hacer es llamar al servidor en el cual va a ejecutar un serbet pero claro es que todavía no sabemos quién es serlet por tanto este archivo lo paramos aquí y vamos a crear ahora un serlet para que procese esa información cómo va a procesar esa información pues bueno atención dentro del proyecto grabar db voy a pulsar con botón derecho voy a crear un New serlet atención porque he pulsado botón derecho dentro del proyecto no dentro de web content dentro de la carpeta de proyecto new serlet y cómo se va a llamar Bueno pues com. josev viicente carratala pues cre db el Class name va a ser grabar deb me voy a next Sí el nombre es un poco lo de menos crea db y en Class name he puesto grabar db pulso next el Ur mapping es grabar deb acordémonos de esto pulso next Bueno si queréis en este caso Mirad le voy a quitar el do post ya que para este primer ejemplo no voy a usar post voy a usar únicamente get tampoco pasa nada porque esté porque molestar no molesta pero bueno lo quitamos ya que estamos y le doy a Finish con lo cual me aparece un serlet parece que tiene errores pero ya sabéis que en mi caso no son tales errores sino que es simplemente que para cada proyecto al menos en mi caso pues tengo que especificar sobre qué targets lo quiero validar Así que lo valido contra tomcat y ya está se quitan los errores y ya está bien Tenemos un método public Y tenemos un protected void doget Así que en el duet es donde vamos a estar trabajando Mirad atención voy a hacer simplemente un hola voy a hacer un hola mundo Así que import java.io too puntoasterisco y lo que voy a hacer ahora vamos a verlo esto lo puedo plegar lo que voy a hacer ahora es recuperar el código del proyecto anterior el código del proyecto anterior recordamos que hacía lo siguiente recordamos que hacía esto vamos a verlo printwriter mensajes y mensajes printline y voy a poner si estás viendo esto es que tu serbet funciona veis que es un archivo que tiene todo Java que me está diciendo un mensaje en pantalla que ni siquiera debería decir pero lo estoy poniendo para que veáis algo en pantalla para que sepáis que se está ejecutando lo que he hecho básicamente es copiar el código del ejercicio anterior simplemente cambiado el mensaje lo digo porque igual acabáis antes copiando y pegando el código del ejercicio anterior y ahora lo que voy a hacer simplemente es ejecutar quiero decir que voy a pulsar Play le doy a Finish bien me dice not Found pero not Found simple Au sí Simplemente porque tengo que parar el servidor volver a arrancarlo para comprobar bien que si estás viendo esto es que tu serlet Funciona muy importante ahora es que si veis que el serbet funciona quedaros con la URL porque la URL es lo que necesitamos como ahora Vais a ver a continuación para desde la parte de vista Llamar al controlador voy a hacer una primera conexión de la siguiente manera atención todos a la pantalla lo que voy a hacer es en primer lugar voy a ejecutar el serlet no ya para verlo en funcionamiento y que me anime y que me diga tu seret está funcionando que también sino que lo voy a hacer para copiarme la URL porque en esa URL está funcionando el serlet Así que copio la URL y dentro de Index html dentro del load pego la URL del serlet la pego dentro del método load por tanto yo qué es lo que quiero pues lo que quiero es que cuando de momento cuando el botón de get el botón del formulario quiero que me ejecute el serbet mediante Ajax y me dé el resultado en el div Ajax vamos a comprobar si funciona le doy a parar le doy a ejecutar y Mirad ocurre lo siguiente de momento vamos paso a paso Vamos poco a poco atención a la pantalla cuando le doy a enviar si todo ha ido bien imaginaos que no va bien le doy a enviar y dice si estás viendo esto es que tu serbet funciona por tanto yo tengo una vista Pero al pulsar el botón enviar lo que estoy haciendo es llamar al controlador mediante Ajax Y sí Pon si estás viendo esto es que tu ser funciona simplemente lo he puesto para comprobar que algo sale en la pantalla yo ahora estoy llamando a un serbet mediante su URL pero no solo esto sino que además lo que quiero es pasarle parámetros Así que al pasarle parámetros dado que estoy trabajando con el método get voy a hacer lo siguiente aquí a continuación del serlet simplemente atención pongo en primer lugar un interrogante para decirle te voy a pasar parámetros Y ahora te voy a pasar tres parámetros nombre cliente es igual a algo es igual a Jose and teléfono cliente es igual a 111 and email cliente es igual a info lo que he hecho es formular una URL con parámetros donde recordad que siempre que formulamos una URL con parámetros Hoy que estamos trabajando con el método get mañana que trabajaremos con post será otra cosa pero arrancamos con un signo de interrogación ponemos propiedad valor o parámetro valor separándolos con igual nombre cliente es igual a Jose y encadenamos con el ampers igual que siempre que se formula una URL con esto lo que estoy haciendo es llamar al serlet de grabar deb Pero además le estoy pasando unos parámetros de momento estáticos ahora los convertiremos en dinámicos entonces guardo me voy a grabar db y digo lo siguiente mensajes printline br y ahora digo mensajes pun printline el nombre que me has pasado es más response punto get get nada no request punto get parameter nombre cliente copio el br y digo el teléfono que me has pasado es teléfono cliente y el email que me has pasado es email cliente básicamente lo que estoy haciendo es que si en una parte la vista estoy enviando parámetros en la otra parte el controlador estoy recibiendo parámetros y simplemente Insisto que ahora estoy haciendo un controlador vista lo que estoy haciendo de momento es lanzar por pantalla técnicamente luego al final lo que quiero es que el controlador no me diga los datos por pantalla los guarde en la base de datos pero ahora lo estamos haciendo didácticamente para que veáis un poco Cómo pasan los parámetros y cómo se reciben y cómo se devuelven por tanto si esto funcionado correctamente ahora os pongo el código si esto ha funcionado correctamente yo ahora recargo atención todos recargo y ahora mismo es estático ahora mismo ponga lo que yo ponga le doy a enviar y dice si estás viendo esto es que tu ser funciona el nombre que me has pasado es Jose el teléfono que me has pasado es 111 y el email que me has pasado es info en la URL y de recoger estos datos aquí dentro del serlet ahora por último para esta parte del ejercicio no quiero que los parámetros sean estáticos sino quiero que sean dinámicos Por eso voy a hacer lo siguiente en cadeno con de nombre cliente punto bal y os recomiendo que todo aquello que vayáis a pasar por una URL tenga el método en code uri lo que hace es quitar problemas con espacios copio y pego teléfono cliente es igual a teléfono cliente y email cliente es igual a email cliente veis que tengo un pequeño problema con las comillas por tanto voy a usar comillas sencillas dentro de los campos para que no se me confunda el programa Así que guardo recargo paro el servidor y Mirad ahora le doy a Play ejecuto el programa y digo Juan una dirección un teléfono y un correo info pasado es este teléfono de aquí el email que me has enviado tengo algún problema con el email vamos a verlo es undefined así que vuelvo al código y digo es cierto que se llama email cliente un error de tipo por tanto email cliente vamos a comprobar si incluso igual no hace falta ni recargar Pues sí que hace falta recargar vale paro recargo final bien Tengo un problema con eclipse por tanto voy a pararlo y lo vuelvo a arrancar para comprobar el correcto funcionamiento del programa voy a hacer un ejercicio en el cual vamos a estar practicando varias cosas eh Y con ello vamos a utilizar este ejercicio como excusa para trabajar con código desde provincia vale para hacer un Buscador de códigos de provincia Así que lo primero que voy a hacer es seleccionar este archivo txt que he descargado llamado formato txt que tiene una un archivo txt donde voy a obtener tanto el código de la provincia como el nombre del municipio true ahora mismo no sé qué es el código postal y la población a la que perdón a la calle de esta población a la que pertenece lo primero que quiero hacer por tanto es importar estos registros dentro de una tabla de mysql para poder empezar a procesarlos y trabajar con ellos lo que tengo que hacer ahora es importar esta tabla a la base de datos por eso voy a entrar en local Host php my admin Wow Valentín entro en local Host dentro de local Host entro en php My admin bien inicio sesión y voy a crear una tabla nueva voy a crear una base de datos nueva llamada provincias va a tener un cotejamiento de utf8 en español y que no se nos olvide asignarle privilegios es decir crear un usuario para esta tabla voy a crear un usuario llamado provincias con el servidor local Host contraseña provincias confirmar contraseña provincias vale No es una práctica ya sabéis muy segura pero para hacer una prueba en clase pues es suficiente como para poder acceder a continuación una vez que tengo la base de datos provincias voy a crear una tabla llamada provincias y ahora viene la parte donde ya no puedo elegir Cuántos Campos va a tener esta tabla Bueno pues va a tener vamos a ver que lo vea va a tener claro técnicamente esto es un punto y coma aquí está bien va a tener un campo que es el código de provincia dos Campos población tres Campos un true o false que ahora mismo no sé qué función cumple Campos el código postal y cinco Campos el nombre de la calle por tanto vamos a hacer que esa tabla tenga cinco Campos para que la importación Ahora más adelante sea exitosa y ahora voy a hacer lo siguiente código provincia población desconocido código postal y calle código provincia es un entero población es un marchar desconocido es un buleo pero lo voy a poner como marchar código postal es un entero y calle es un marchar Y aunque evidentemente por ejemplo código provincia sabemos que va a tener un máximo de dos caracteres pero para este ejercicio Le voy a poner 255 caracteres a todos los campos y con eso empezamos a funcionar por tanto insisto Y esto es muy importante si me estoy encontrando un campo txt un archivo txt que tiene cinco columnas y yo quiero que la importación se realice exitosamente tengo que crear una tabla que tenga ese mismo número de columnas Así que simplemente ahora guardo Y por último una vez que he creado la tabla de provincias Pues voy a realizar una importación para introducir ese archivo csv para eso nos fijamos que tengo un botón llamado importar Y dentro del botón importar atención Mirad voy a poder seleccionar un archivo selecciono formato txt municipios calles y le digo Mirad como no lo ha reconocido correctamente porque tiene el formato txt yo le digo manualmente que ese archivo es un archivo realmente csv y que el separador de columnas no es que lo diga yo es que lo podéis ver ahí el separador de columnas es el punto y coma por tanto en opciones del csv donde pone columnas separadas por coma lo voy a cambiar por un punto y coma por tanto si todo ha ido bien le doy a continuar tened paciencia ahora porque bien no Se recibieron para importar o se excedió el máximo permitido en su configuración de php vamos a verlo bueno efectivamente en mi configuración de php dice que el tamaño máximo de importación de archivos es de 2000k y el problema que tengo yo ahora mismo es que este archivo ocupa 6 meg por tanto lo que voy a hacer es tener que intervenir el archivo php.ini para subir el nivel para Elevar el nivel de subida lo que tenemos que hacer ahora es editar nuestro archivo php.ini para aumentar la capacidad de carga de archivos en el sistema en este caso para realizar una importación de una tabla para una base de datos Así que vamos a editar el archivo php.ini en mi caso lo voy a editar directamente en la línea de comando con un comando de Linux llamado Nano parce broma Pero no es así entonces lo ejecuto Y ahora yo creo que más o menos todos en la pantalla tendremos más o menos lo mismo que es un archivo que tiene configuración cuidado que este archivo tiene muchas líneas y cuidado no toquemos ninguna que no debemos tocar podemos fastidiar a Apache a una mala nos volvemos a bajar un archivo de configuración y ya está tampoco es muy grande el problema bueno pues voy a ir bajando por las líneas hay muchas líneas insisto sobre las que bajar y voy a encontrar que hay una línea llamada Max upload size Así que vamos a bajar ya os digo que hay muchas líneas que revisar pero vamos a bajar y buscar una que se llama Max upload sites mira tengo una parecida pero no es esta que es Max execution Time que es el tiempo máximo tenéis Buscar en el notepad vamos a verlo Bueno pues voy a buscar en este caso y voy a poner en mi caso control V los que estéis con notepad ponéis control b y voy a buscar upload y veo que hay una cosa aquí Mirad que pone upload Max file size Entonces al Buscar upload Max file size veo que efectivamente tengo un límite de 2m de 2 megas así que voy a hacer lo siguiente simplemente lo voy a editar le voy a poner dos ceritos más como estamos en un equipo local de desarrollo pues le podemos poner lo que queramos técnicamente y voy a hacer que podamos subir un máximo de 200 megas antes de salir una cosa más vamos a cambiar también el Max post size por tanto vuelvo a buscar y sí y voy a poner post vamos a ver si os encuentro la línea un momento un segundo y os digo cómo se llama la línea aquí mira tenéis que buscar una línea llamada post gu Max gu size y encontraréis que esa línea que también interviene dentro de la búsqueda está a ocho pues una vez que encontréis el post gu B Max gu B size y veáis que está a 8 lo que quiero es que lo cambiéis a 800 ya os digo de sobra para la importación que vamos a hacer en la sesión de hoy pero así también lo tenéis urado para si mañana pasado la semana que viene queréis hacer una importación mayor pues ya está preparado Así que es el post gu B Max gu B size os estoy diciendo Vale pues si no Buscad post gu baj Max y así hasta que lo encontréis y lo a salir vamos a ver y vamos a salir para a continuación reiniciar el servidor Bueno pues ahora lo único que tenemos que hacer es simplemente reiniciar el servidor en mi caso voy a hacer un sud service apach 2 restart mismamente Así que reiniciamos Apache simplemente para que se cuenta de los cambios que acabo de realizar si ahora me voy a php my admin atención y le doy a importar deberíais comprobar como ahora ya no pone que el máximo son 2 megas sino que pone que el máximo son 200 megas y por tanto Mirad Ahora puedo hacer lo siguiente selecciono archivo me voy a municipios calles atención le digo que es un archivo csv ya que como no lo ha reconocido manualmente se lo tengo que decir yo Y por último digo que las columnas no están separadas por una coma sino que están separadas por un punto y coma tras lo cual si todo ha ido bien cruzamos los dedos redoble de tambor pulso continuar sea paciente el archivo está siendo cargado Así que sed pacientes y a continuación lo que va a ocurrir es que primero lo va a cargar y segundo lo va a importar estamos hablando de un archivo de 16,000 y pico líneas Así que efectivamente tenemos ser pacientes no solo para importar sino también para convertir lo que tenemos ahora mismo en este proyecto es un pedazo Brown es un pedazo marrón que es muy común al importar bases de datos Y es que de un montón de registros Pues hay algunas líneas que nos da error y tengamos que ir limpiando línea a línea no lo voy a hacer vale por tanto Cuando esto me pasa lo que intento Buscar son soluciones más sencillas Como por ejemplo la que os voy a decir ahora Mirad en primer lugar me este archivo en un archivo csv municipios calles archivo csv A continuación voy a buscar un programa que me permite tratar de manera más automatizada los archivos csv Como por ejemplo el programa libreoffice calc o Excel si queréis Vale entonces Mirad voy a abrir este archivo con libre Office calc para que me lo reconozca correctamente antes lo he nombrado a csv y ahora hago lo siguiente atención digo el separador de columnas no es coma sino lo que en inglés se llama el semicolon o punto y coma Así que pulso OK Vamos a verlo pulso OK ahora dentro de un momento veréis como aparece el archivo dentro de libre Office calc Mientras tanto aquí lo tenemos ya Mientras tanto voy a ir Vaciando la tabla de provincias vaciar y lo que voy a hacer básicamente va a ser limpiar este archivo voy a fijarme si es que tiene vamos a ver Ah bueno los datos no pueden ser cargados completamente porque el máximo número de caracteres por Zelda ha sido excedido Vale y yo diría vamos a ver Mirad aquí yo diría que tengo un problema con la quinta columna Oh tengo también un problema con los acentos Así que cuando tengo un problema con los acentos hago lo siguiente atención voy a volverlo a abrir con libre Office cal pero en este caso al importar voy a decir semicolon me voy a buscar un elemento que tenga acentos o eñes o lo que sea y voy a probar diferentes codificaciones Si utf8 que es la que tocaría no ha funcionado correctamente pues intento con CP 1252 suele funcionar bastante bien entonces me busco CP 1252 un momentín que lo encuentre Bueno voy a 1 250 is a ver el ISO de Europa occidental lo tengo yo por aquí Western europe en ISO el 88591 por ejemplo y veo que bueno ese me ha cogido bastante bien La ñe vale por tanto ese serviría Pues voy a el Western europe en ISO 88591 le doy a Ok a ver qué pasa ahora al importar si me vuelve a dar problemas de codificación un momento que está importando creo que antes me había dicho que había perdido la columna de la población cosa que me da igual para este ejercicio esperamos a que acabe de importar cómo vamos bien los datos no han podido cargados No pasa nada vale Y Mirad vamos a verlo Victoria gasteiz vale lo único que habr podido pasar es que algunos datos pueden no haber sido cargados correctamente Aunque veo que tengo hasta la z Vale pues a partir de aquí Claro ya veo cuál puede ser el problema es que hay uno de estos Campos veis que si esa columna es tan larga es porque hay un campo que realmente está usando esa Lito de columna buscarlo puede ser un poco no os preocupéis voy a hacer lo siguiente voy a hacer lo siguiente como realmente no quiero no me interesan los nombres de población para este ejercicio lo que voy a hacer simplemente va a ser vaciarlo Así que ahí donde ponen los númeres de población Mirad simplemente voy a rellenar todo con una c vamos a ver vale bien otra cosa que voy a hacer es lo siguiente calle copio calle lo pego hasta el final momento lo pego espero unos segundos a que lo pegue y a partir de aquí lo importo es decir lo guardo lo importo y os lo envío csv atención Mirad me voy a importar me voy a municipios calles que ha quedado en 4 con3 megas las comas separadas por punto y coma continúo y si todo va bien en unos segundos largos segundos no os digo que no porque va a tardar importarlo pero si todo va bien en unos segundos quedará correctamente importado ahí sí que hay que decir que cuando phpm admin dice sea pacientes que realmente Hay que ser paciente es decir se lleva sus segundos largos Bueno pues en mi caso lo que ha hecho es crearme una tabla nueva Por eso bueno acabo antes modificando esa tabla que volviéndolo a importar Así que lo que voy a hacer es eliminar la tabla anterior que había creado de provincias y dentro de esta Table 2 voy a para que haga lo que yo quiero por tanto me voy a operaciones y voy a decir que no se va a llamar Table 2 sino que se va a llamar veng municipios entonces pulso continuar ahora ya se llama municipios y ahora lo que quiero hacer es cambiar los nombres de las columnas No es que me disgusten los nombres de las columnas Pero eso de que tenga espacio es malo para hacer peticiones a una base de datos así que me voy a estructura y voy cambiando pues col 1 era provincia realmente es código provincia guardar un momento bien call2 ya no me acuerdo porque tengo muy mala memoria call 2 es población marchar de 36 máximo la columna 3 es desconocido por tanto voy a cambiarlo por buano por ejemplo lo llamo buleo no lo voy a usar por tanto realmente me da igual eh la columna 4 es código postal y la columna 5 es calle columna 6 simplemente le voy a quitar el espacio y con esto lo que voy a hacer ahora va a ser simplemente exportar esta esa tabla a formato sql la guardo como municipios sql y la envío por correo a partir de aquí por tanto una vez que ya tenemos la tabla cargada pues ya podemos crear un nuevo proyecto dentro de eclipse vamos a crear como siempre un dynamic web project y atención porque hoy vamos a seguir trabajando con serbs por tanto recordad que es muy importante que para trabajar con serbs el en la versión del módulo Dinámico la bajis a 2.5 entonces Bueno vamos a Llamar a este proyecto eh deb provincias con 2.5 Y si queréis le damos a Finish Sabiendo lo que había en las siguientes pantallas y que no cambiábamos nada y que queremos el método do get y do post por tanto db provincias 2.5 y pulsamos Finish para empezar a trabajar Dentro de este archivo de B provincias Mirad voy a dentro de web content voy a crear botón derecho New jsp file y es un archivo que bueno como es el primer archivo del proyecto pues se puede llamar Index jsp en mi caso recordad que tengo Aparentemente un error pero es un error por haber indicado haber incluido mal el target Entonces le pongo por ejemplo tomcat y el error desaparece y ahora quiero hacer lo siguiente momento igual en cuanto guarde ahí restaura el error bien aquí lo que voy a hacer es lo siguiente aparte de sangrías ya sabéis que eso no me gusta nada que vienen bastante mal puestas dentro de El jsp voy a poner input type text ID código postal placeholder CP vale código postal pongo un br y ahora voy a poner un div ID población sin acento donde aquí no pongo nada porque ese es el dip que va a recibir la información y este ejercicio en cuanto a la parte html es así de sencillo lo voy a aislar también os digo Simplemente yo pongo un código postal y en cuanto salga del campo código postal lo que quiero es que aparezca algo dentro de la población el html sencillo Porque ahora a continuación lo vamos a complicar un poco más en el Script Así que en el Script ya sabéis que cargo jquery lo que quiere decir que lo tengo que sacar de otro proyecto por tanto voy a crm por ejemplo o a cualquier proyecto donde tenga el jquery crud javascript me copio la librería Live me copio la carpeta Live la pego dentro de web content y Mirad ahora dentro de web content tengo la carpeta Live con lo cual digo entro en Li y cargo jquery 1.3 min.js Script y ahora digo document ready function y creo una función ya sabéis que siempre me gusta hacer alert Hola simplemente para comprobar que hemos la librería jquery y está en correcto funcionamiento voy a parar en mi caso sudo service tomcat 7 stop para parar mi servidor y simplemente ahora lo que hago es ejecutar el proyecto en el servidor para asegurarme que por lo menos veo Hola un segundo arranco firefox Ahora cuando arranque Ahí está y si nos fijamos pues tendré un campo de input y me dice hola y si me dice hola es que está cargando correctamente en la pantalla en html5 placeholder se diferencia de value en una cosa muy sencilla que es la siguiente si yo pongo un placeholder por ejemplo en este caso pone CP yo pincho sigue poniendo CP pero en el momento en el que yo empiezo a escribir se quita automáticamente CP y se pone solo lo que yo ponga si yo pongo valiu que es lo que se ponía antes en html porque Place holder es de html5 ocurre lo siguiente paro el servidor recargo aparte de que me diga hola pero fíjate que pone CP Y si yo empiezo a escribir el CP es parte del campo lo que yo esperaría es que cualquier persona que entrara aquí borrara el contenido y empezara a escribir no te puedes imaginar a lo largo de los años la de aplicaciones en las que he puesto nombre en el campo y he recibido nombre Juan nombre Jaime nombre Javier que dices vamos a ver yo borrar lo que pone nombre pues la gente no lo borra vale con lo cual me tocaba hacer javascript para decir cuando alguien en el campo Borra el contenido y tal Por tanto ahora Lo bueno que tiene placeholder es que te ahorra hacer ese javascript y automáticamente vacía el campo cuando detecta que alguien ha empezado a escribir ahora lo que quiero es detectar cuándo realmente salgo del campo Mirad y ahora digo cuando código postal blur Qué es blur es cuando salgo de un campo de momento lo voy a falsear ahora luego a la vuelta lo que vamos a hacer es hacerlo real y voy a decir dentro de población pun html buscando población de momento es falso pero vamos a ponerlo de momento así que básicamente le digo cuando desenfoque cuando salga de código postal quiero que dentro de población ponga el siguiente texto de momento falseado pero para que veáis cómo funcionaría por tanto ahora paro el servidor y refresco segundo que a veces le cuesta y Mirad lo que va a ocurrir Es que yo pongo un código postal y cuando hago blur dice buscando población de momento insisto es falso es estático Pero simplemente para que comprobéis que somos capaces de detectar el evento blur y por tanto hacer algo dentro de ese campo y ahora lo que haremos a la vuelta será usar el método ja completo y complejo para ver qué cosas nos da con respecto al simplificado que ya conocemos por tanto ahora lo que vamos a hacer Es especificar que quiero usar el método Ajax completo y dentro del método Ajax completo vamos a encontrar que tenemos más parámetros con los que lidiar pero también tenemos más ventajas el método ya completo de hecho me lo voy a sacar de este lugar jquery ya que es una página muy buena Argentina donde tienen un ejemplo de este método completo muy bueno y Mirad me voy a este ejemplo Ajax lo voy a copiar y pegar y aquí está lo que voy a hacer por tanto es que en lugar de poner buscando población voy a poner todo esto de aquí como veis es un método Que Tiene bastantes más propiedades y que ahora voy a poco desgranar es un método bastante vertical como veréis y que requiere un momento y que requiere de tres funciones más ahora os los pongo en línea Wow cuidado vamos a verlo dejadme que lo formatee y ahora lo podréis copiar Bien y ahí lo tenemos luego por tanto tenemos esta función Ajax es una función un poco particular porque se carga en el documento y esto es decir que no hace falta seleccionar un cierto elemento sino que simplemente pongo dólar Ajax Y a partir de ahí empezamos a trabajar bien en primer lugar vemos que este método tiene una serie de parámetros bastante interesantes como en primer lugar nos permite especificar si la conexión es sincrónica o asincrónica en este caso lo dejamos como asíncronos es igual a true los parámetros se separan con comas y ahora digo el type puede ser post o get esto es muy importante desde el punto de vista en el que hasta ahora con el método load estábamos obligados a usar el método get pero gracias al método completo también podemos usar el método post que además constituye un método más seguro de pasar la información el Data type lo vamos a dejar como está que es lo que te voy a pasar es html el content type voy a hacer como si te pasara un formulario vamos a dejarlo así y ahora aquí viene la cuestión la URL es la url del serlet de momento voy a poner URL del serlet porque como todavía no hemos creado ninguno pues no sabemos Cuál es la url así que dejadme de momento que ponga eso y ahora pondremos una URL los datos que voy a enviar Ah son los siguientes voy a decir código postal es igual a aquel elemento que tiene el ID código postal punto B esa línea la 18 El Data sí que la tenéis que cambiar y ahora a mí la parte que más interesante me parece de este método es que Llama a tres métodos un método llamado before Send sabéis que si pone inicio envío si está en castellano es que se puede cambiar pero si está en inglés before Send es que no se puede cambiar Este es un método que va a ejecutar una función que va a ejecutar antes de hacer la llamada Ajax la típica de cargando mientras te pido algo ya hasta que lo reciba por lo menos te muestro un cargando y lo que vamos a hacer aquí es lo siguiente dentro de población voy a cambiar este contenido dentro de población html cargando aquí voy a hacer lo siguiente dentro de población voy a cargar los datos qué datos los datos que recibo no os olvidéis de ese parámetro de la función datos es muy importante y por último en población voy a poner ha habido algún problema lo que hace es lo siguiente mientras realiza la petición Ajax y hasta que reciba resultados ejecuta la función de inicio a partir de ahí si la función Ajax es correcta es decir devuelve resultados correctos se ejecuta la función llegada datos on Access si ha habido éxito ejecutamos la función llegada a datos Y ahora si hay algún problema si Ajax no devuelve nada o si tarda más de 4 segundos en devolver la información tarda más de 4000 milisegundos en ese caso ejecuto la función problemas y la función problemas más dice ha habido algún problema como veis por tanto tiene muchos más parámetros que la función load por tanto es más complejo de utilizar es probable que os equivoqué al poner alguna coma al separar parámetros o al poner algún bloque de dos puntos ya veréis Cómo os equivocáis pero una vez que lo tengáis una vez que le hayáis pillado el rollo Pues veréis que es un método más completo que os permite hacer más cosas que os da más control que el simple método load una vez que ya tengo el jsp a Luego si queréis os lo pongo de nuevo para copiar el código vamos a trabajar ahora con el serlet es esa parte que sobre todo procesa y que devuelve un pequeño html ya sabéis que si estoy pensando en un archivo que tiene que tener mucho html y poco Java estoy pensando en un jsp pero si estoy pensando en un archivo que tiene que pensar mucho y solo devolver un poquito de html eso es un serlet incluso a veces ni devolver nada de html por tanto lo que voy a hacer ahora es irme al proyecto acordaos a la carpeta del proyecto me voy a ir a New me voy a ir a crear un serlet y voy a hacer lo siguiente el package es com. josev viicente carratala provincias el Class name es eh dime provincia voy a darle a next todo correcto voy a darle a next todo correcto le digo el duket y el doost pulso Finish y tengo atención por aquí un serlet llamado dime provincia Class name dime provincia este la primera segunda inicial eh Sí incluso la primera también mayúscula porque Java te recomienda no te obliga pero te recomienda que lo hagamos atención Dime el Java packet es com punto lo que queráis punto provincias comto vuestro nombre provincias por ejemplo tengamos en cuenta que en este ejemplo estoy pasando la información por post por tanto no me voy a ir al método duet sino que me voy a ir al Método doost en el método doost voy a establecer una pequeña conexión con la base de datos aparte de importar el Java io printwriter es decir import java.io todo lo que voy a hacer es lo siguiente voy a recuperar algo de código de ayer vamos a ir a atención Mirad recupero algo de código de ayer y eh vamos a ver si era grabar deb lo tengo aquí como printwriter mensajes y digo response printwriter y ahora digo mensajes punto eh printline vamos a verlo atención Mirad y ahora el serlet te va a dar la información vamos a verlo Mirad Simplemente digo printwriter mensajes lo mismo que ayer response.get writer y digo mensajes printline el server te va a dar la información dejadme un momento que dejadme un momento que refresque y voy a hacer lo siguiente atención todos en la pantalla voy a hacer lo siguiente ejecuto el serlet Por qué ejecuto el serlet Porque quiero saber su URL como se me ha colgado eclipse se me ha colgado el servidor voy a volverlo a ejecutar voy y por qué voy a ejecutar el serlet porque quiero averiguar su ruta porque en el Ajax Estaba poniendo una ruta al serlet pero de momento me la estaba inventando Por qué Porque no la conozco Así que lo que voy a hacer es simplemente realizar una primera ejecución del serlet Aunque no me saque nada en pantalla pero para fijarme en la URL copiar la URL y pegarla dentro de la URL de Ajax Así que vamos a abrir abro eclipse Mirad ejecuto este serlet ya sé que ese serlet así por defecto el solito no tiene ningún sentido Pero es que no lo quiero realmente lo que quiero es la url no el seret en sí estoy ejecutando está arrancando el servidor y Mirad la URL es esa de ahí es local Host 8080 dime provincia así que me la copio Ahora me voy a el método Ajax y en el método Ajax donde he puesto URL del serlet pues pongo la URL Real del serlet con lo cual ahora voy a hacer la siguiente prueba que va a consistir en ejecutar y a ver si funciona bien entonces pongo un código postal y si todo ha ido bien cuando salgo digo ahora el serlet te da la información no sé si habéis visto atención todos a la pantalla que cuando salgo del campo atención todos a la pantalla aparece un mensaje y luego cambia a otro Qué mensaje aparece pues el primer mensaje que aparece es el mensaje de cargando lo que pasa es que es muy rápido y prácticamente no se ve vale pero es el mensaje de cargando y cuando recibe datos a partir de ahí me da el mensaje real Qué pasaría si llamara a dime provincia 2 no existe evidentemente pues lo que pasaría es que como estaría realizando una petición Ajax incorrecta estaría realizando una petición Ajax a una a un destino no existe pues lo que estaría pasando un momentín que voy a recargar lo que estaría pasando Mirad es que pongo un código postal salgo y digo ha habido algún problema has hecho una petición Ajax pero no te ha devuelto nada por tanto veréis que el método Ajax es más complejo Pero también es más completo y es más interactivo que el método abreviado y por tanto ahora lo último que me queda por hacer Mirad es una pequeña petición a la base de datos la petición atención todos no me estáis mirando a mí no a la pantalla eh lo que vamos a hacer con la petición es copiar y pegar el código try Catch que teníamos de ejercicios anteriores me voy a dime provincia y voy a hacer lo siguiente lo que voy a hacer es crear una provincia cuidado en este caso me falla la conexión y si me falla la conexión es porque me hacen falta realizar atención miradme la importación de Java sql todo Así que si tengo aquí errores me voy arriba a la importación y digo import java.sql todo y con eso si todo va bien comprobaremos cómo los errores han desaparecido bien Mirad Me conecto a local Host Me conecto a provincias recordamos que había creado el usuario provincias y había creado la contraseña provincias la petición a la base de datos en principio es Select all from municipios y ahora viene el bacalao digo dónde no me acuerdo es que siempre olvido las columnas de mis bases de datos donde código postal es igual a más esto con comillas no hace falta porque es un entero + request punto get parameter y el parámetro qué parámetro es pues el parámetro es código postal cuidado tengo que decirle limit 1 porque sabemos que van a haber un montón de duplicados y solo quiero el primer resultado que me salga por tanto al final Esto va a ser tan sencillo como decir lo siguiente RS y quiero devolver la población vamos a ver si ha funcionado correctamente ya sería raro que funcionara bien la primera pero vamos a probarlo voy a quitarle este mensaje Sprint Line cuidado porque ya no es out printline es cuando trabajamos con jsp un es mensajes punto printline vamos a probarlo me dice que tengo un error vamos a ver dónde está el error lo mismo mensajes punto printline y si ya no tengo ningún error paro el servidor ejecuto el jsp cruzo los dedos redoble de tambor en la mesa venga y he parado Ya decía yo vale no ha salido de nada pero no pasa nada porque este es el clásico error de que el se me ha quedado un poco enganchado Ojalá ya firmaría yo para que todos los errores fueran ese y bueno vamos a conectarnos con la base de datos Y a ver si nos devuelve algo en este caso tengo una base de datos que creáis que no va ir rápida porque está en local Pero tenía ciento y pico mil registros Así que quizás en este momento nos dé un poquito más de tiempo a ver el resultado del cargando bien como os decía voy a ejecutar Estoy publicando entonces pongo un código postal 46001 salgo ha habido algún problema bien ha habido algún problema quiere decir que dime provincia no lo está cargando correctamente lo cual es raro pero Ay sí Por supuesto que sí en la prueba que he hecho antes me había dejado dime Providencia 2 bien pues paro el servidor Qué cabeza la mía paro el servidor vuelvo a arrancar la aplicación pongo un código de provincia 46001 y cuando salgo bueno no he podido conectar con la base de datos por qué Por el conector de mysql porque recordamos que para conectarnos a my sql necesitamos que Java necesitamos que el proyecto tenga el conector de Java en la carpeta correcta recordamos que este conector de Java se ponía dentro de web content dentro de web inf dentro de Live así que me lo voy a sacar de cualquier otro proyecto jsp conect db web content web inf Live me lo copio me lo pego y volvemos a probar Esto sí que son los errores típicos normales y comunes del desarrollo de aplicaciones en Java Enterprise por tanto ahora pulso Play si queréis voy a refrescar aquí y una vez más voy a decir 46001 y si todo va bien cargando Valencia habéis visto lo que ha pasado en la pantalla decidme un código postal que os sepáis que no sea de valencia 190 Pero bueno por población y lo que voy a hacer ahora Mirad todos en la pantalla atención fijaos que le cuesta un par de segunditos buscar en la base de datos por tanto veis que pone cargando y después de poner cargando pone Valencia alguien que se sepa algún código postal que no sea de valencia 03 qué 150 y yo te pregunto es correcto que es de alicante no pero yo digo el código no tu novia bien vale pues ahí tenemos vale el buscador de códigos postales en funcionamiento luego ya permitidme que haga un detallito y os envío el código por correo y el detallito consiste en que simplemente me voy a internet y Busco así a pelo loading gif Y si buscáis loading gif aparece ya un montón de gifs ya hechos con el típico gif que da la vuelta entonces pues voy a eh tamaño icono pues por ejemplo uno como ese compruebo que sea un gif animado voy a ver imagen a ver si se ve si está animado si carga si no pues voy a abrir dos o tres No ese sí un poco grande verdad Pero servirá y ese tarda en cargar Sí pero no carga por tanto Bueno ya te digo voy a buscar otro ese es el típico loading así que me lo guardo me voy a sistema de archivos me voy a bar me voy al Live me voy en mi caso a tomcat 7 me voy a web Apps me voy a rot me voy a db provincias y en web content para ser un poco ordenados me creo una carpeta img me guardo ese archivo como loading.gif Y eso quiere decir que ahora me puedo ir a eclipse y en la función le digo que en lugar de cargando atención todos a la pantalla creo una etiqueta img src que entra dentro de la carpeta img y carga el archivo loading.gif por tanto esto lo que va a hacer eh lo he puesto lo que pasa es que no he refrescado por tanto me vendrá muy bien el pulsar botón derecho refresh no lo veo aquí para comprobar que se me ha creado una carpeta img y que contiene el archivo loading.gif porque ya sabéis que si lo pongo Pero no refresco Java Enterprise no lo tiene en cuenta y aunque esté puede pensar que no está bueno vuelvo a tener otra vez el problema del servidor colgado por tanto pues vuelvo a parar y vuelvo a recargar eclipse pero ahora veréis que bueno eso que habéis estado tantas veces por internet de que pedís algo y aparece el iconito y luego carga pues es Ajax vale Y es algo que es relativamente fácil de hacer y sé que diréis bueno este ejercicio no ha sido tan fácil pero básicamente tenéis ya la estructura para copiar y pegar en cualquier otro proyecto que necesitéis hacer un momentín comprobamos que carga correctamente momento Vale y Mirad cargo el proyecto publico en el servidor y veréis por tanto que pongo un código postal atención todos a la pantalla bueno pongo 46002 atención y aparece primero el simbolito y luego Valencia vale 36003 pues primero el simbolito y luego Valencia y es básicamente eso esto no lo podíamos hacer hasta ahora con la función resumida pero sí que lo podemos hacer con la función extendida el objetivo de este ejercicio es materializar un modelo de datos como en este caso tenemos el modelo de datos para una pequeña gestión de clientes donde vamos a tener que trabajar con varias tablas en primer lugar una tabla principal clientes de la cual van a colgar tres tablas más que va a ser categorías que va a ser formas de pago y que va a ser iae así que lo primero que voy a hacer es entrar dentro del de la base de datos y voy a realizar una implementación de este modelo dentro de la propia base de datos vamos a realizar de hecho una implementación Y una pequeña simulación es decir una pequeña carga estática de datos para comprobar que todo funciona correctamente entonces para ello estoy abriendo un navegador voy a entrar dentro del gestor de bases de datos voy a entrar con mi usuario y mi contraseña y lo que voy a hacer es lo siguiente lo que voy a hacer es crear una nueva base de datos si queréis voy a llamarla a Clientes no tienes que mirar ahí voy a llamarle a clientes vale Y lo que voy hacer ahora es especificar en qué idioma está esa tabla esa base de datos de clientes por tanto pulsamos sobre crear y dentro de clientes pues simplemente voy a crear en primer lugar privilegios voy a crear un usuario llamado clientes con local Host clientes es decir lo que estoy haciendo es crear simplemente una base de datos clientes con un usuario clientes y una contraseña clientes Bueno una vez que tenemos la tabla creada lo que tenemos que hacer a continuación Es simplemente crear tantas tablas como hemos dicho en el modelo de datos Entonces yo aquí he dicho en el modelo de datos que tengo que crear voy a empezar por la primera vamos poco a poco hacia abajo clientes Podría empezar desde abajo hacia arriba ya que Gracias ya que todavía no las he vinculado pero vamos a empezar de arriba a abajo entonces a ver si lo puedo ver toda la vez que creo que va a ser que no me lo dejo esto aquí porque como tengo memoria de pez tendré que ir saltando todo el rato de tabla a tabla aquí creo una tabla llamada clientes u madre mía clientes y hemos dicho que vamos a tener uno 2 3 4 5 6 7 y 8 Campos los campos que tengamos ahí no son inamovibles es decir más adelante podemos darnos cuenta de que nuestro modelo de datos necesita ser ampliado pero Cuanto más definamos al principio mejor así que pongo ocho columnas pulso continuar y atención lo que voy a hacer a continuación es definir las columnas Entonces nos vamos a ID nos vamos a nombre nos vamos a razón nos vamos a ID bueno y de categoría va Vamos a ponerlo tal cual yid categoría y de proveedores y de formas de pago y de descuento yid iae y yo voy a hacer una cosa Mirad atención Como cada uno de vosotros cuando desarrolle un módulo al final va a necesitar desarrollar una serie de tablas como estáis viendo si empezamos luego a mezclar todas las tablas porque luego necesitaremos mezclar todas las tablas por orden alfabético Se os van a confundir entre ellas Así que si por ejemplo tú trabajas con clientes Yo diría que esta tabla se va a llamar clientes es decir te quedas clientes como prefijo porque tú trabajas con clientes es guion bajo y a continuación dices con lo que vas a trabajar dentro de tu grupo de tablas de clientes y así luego se os agruparán alfabéticamente todas entre sí vale por tanto Esta es clientes Bueno ya sabéis que luego le tengo que decir que el ID es índice primario autoincremental y le decimos que eh 255 voy a darle 255 a todo para tampoco perder ahora tiempo pensando cuál sería el número máximo de caracteres por cada campo eh vamos a ver todos aquellos Campos que no sean ids los voy a poner como bar charar pero todos aquellos Campos que sean un ID externo a otra tabla los voy a poner como entero porque realmente los campos hacen referencia a otra tabla distinta y diferente descuento sí habíamos dicho que era marchar y de iae entero tras lo cual tenemos ya nuestra primera tabla creada una vez que la tengáis creada pulsaremos sobre el botón guardar y continuamos por tanto guardando esa tabla y vamos a crear el resto de tablas de la base de datos a continuación y un momento porque ahora si queréis os envío este documento por correo electrónico y así tenéis el módelo de datos para implementar entonces ahora Quiero crear una nueva tabla que en este caso se va a llamar direcciones por tanto direcciones y hemos dicho dejadme que me lo vuelva a poner así hemos dicho que direcciones tiene 1 2s 3 4 5 6 7 8 y 9 Campos sí efectivamente muy bien Le ponemos clientes gu baj direcciones para que así luego cuando las juntemos todas en una base de datos aparezcan agrupadas por usuario digamos más que por usuario por desarrollador así que pulsamos continuar y vamos a volver a establecer Los criterios de la tabla por tanto ID y decimos ID cliente Esta es una clave foránea ID tipo dirección calle código postal país email tel y persona de contacto ya sabéis que todo aquello que sea ID tiene que ser entero y todo aquello que no sea ID Pues bueno os voy a recomendar a aún Incluso el código postal ponerlo como bar charar y ya sabéis que no me complico y de momento le voy a poner 255 caracteres Sí o sí a cada columna sabiendo que voy a malgastar memoria pero para este ejercicio sencillo me da igual recordad que esto muchas veces se olvida el poner el índice primario autoincremental ahora lo que necesitamos es crear el resto de tablas que hay dentro del modelo de datos por tanto ya tenemos Así que ahora nos vamos a tipo dirección Esta es muy sencilla por tanto nos vamos a clientes gu bajo tipo dirección y recordad que esta tenía dos Campos el campo ID y el campo tipo si es domicilio si es facturación si es entrega Así que pulsamos continuar recordad que es clientes gu baj tipo dirección y le decimos ID y tipo donde ya sabéis que ID es un entero y tipo es un marchar 255 cada uno de ellos y el índice será primario y autoincremental y por tanto al final creamos y guardamos esa tabla realizamos la misma operación fijaos comoo ya va cogiendo forma verdad ya vas viendo Mira clientes direcciones tipo dirección esto ya va cogiendo forma correcta vamos ahora a categorías por tanto creo una nueva tabla base de datos clientes creo clientes gu bajo categorías ya sabemos que tiene dos Campos le doy a continuar y tengo ID y nombre ID es un entero nombre es un marchar los dos con 255 y también sabéis que ID es un campo primario y autoincremental así que guardo formas de pago lo mismo vamos creando el resto de tablas dentro de la base de datos con la estructura que tenéis en el documento que os he proporcionado y por tanto clientes gu bajo formas de pago con tres columnas y las columnas van a ser ID A menos que os diga lo contrario siempre un ID y forma de pago y días está claro que sería un entero Pero insisto todo lo que no sean ids ponerlo como barchat tampoco pasa nada Por hacerlo así como mucho si hiciéramos operaciones Matemáticas en la base de datos importaría si un campo es entero o es cadena pero en principio poned todo lo que no sea ID ponedlo como marchar y trabajamos así y acabamos por tanto con la tabla llamada m iae Así que clientes gu baj iae y digo ID y epígrafe ya sabéis que todo lo que sea ID es entero todo lo que sea no ID es marchar y cada uno de los ids tendrá un campo primario y autoincremental tras lo cual finalizamos la creación de la estructura de estas tablas dentro de la base de datos pero claro ahora a continuación lo que tendremos que hacer es realizar una simulación cómo pues realizando una carga estática de unos pocos datos dentro de la tabla Bueno pues antes de empezar a programar nada vamos a realizar una pequeña carga de datos a partir de ahí hacemos una petición Cruzada entre tablas y lo convertimos en un pequeño programita Vale entonces Mirad en primer lugar vamos a ahora atención voy a ir de atrás a delante en lugar de empezar por la tabla principal de la cual desconocemos las tablas asociadas vamos a las tablas asociadas entonces en clientes tipo dirección Voy a insertar un nuevo elemento no toco el ID y digo facturación hemos ido a insertar hemos entrado en tipo dirección y luego hemos pulsado el botón insertar Así que un tipo de dirección sería facturación vamos a ver queé tenemos uno facturación vuelvo a insertar Y le doy ahora a almacén y continuar sí Pero mira tú mira aquí a la pantalla tienes que entrar en tipo dirección Tú sigue mi ratón vale tipo dirección y entonces ahí insertar uno nuevo bien Entonces teníamos almacén teníamos facturación envío por ejemplo dirección de envío y ahora fijaos que tenemos ahí facturación almacén y envío como tres ejemplos de tipo dirección una vez que tenemos tres ejemplos de tipo dirección nos vamos a por ejemplo iae Así que entro en la tabla clientes iae facturación es facturación almacén dirección y envío Perdón en iae vuelvo a insertar datos qué inserto en iae ya bueno por ejemplo estándar 21 por vale Y voy a poner reducido 10% y ya está es que a partir del iae pasa nada da igual iae como el impuesto que le vamos a aplicar luego y ya está No pasa nada en formas de pago inserto formas de pago y voy a decir no sé pagaré a 30 60 90 y voy a poner ahí días 90 en insertar pongo forma de pago transferencia bancaria días 15 he puesto dos formas de pago que es pagar 30 6 90 que es 90 días y transferencia bancaria 15 días estoy inventando los datos La idea es que cada uno pongáis lo que queráis ahora cuidado que vamos con la tabla intermedia no voy a rellenar esta todavía direcciones todavía no categorías sí categorías voy a insertar dos clientes mayoristas y minoristas en la tabla de categorías acertado mayoristas y minoristas Pero para esto está precisamente el crear la implementación y empezar a hacer una simulación con datos ficticios Porque en cuanto empiezas a hacer una simulación Ahí es donde te empiezas a dar cuenta si realmente ese dato lo necesitabas No necesitabas si iba en la tabla lo extraemos o estaba fuera para qué lo queremos fuera lo metemos precisamente por eso hacemos esto y ahora sí ya creamos un cliente Mirad dónde digo lo siguiente atención dónde digo creo un nuevo cliente nombre Juan López razón Juan López sl y de categoría aquí está la cuestión recordamos que por ejemplo en mi caso mayoristas es el número uno minoristas es el número dos por tanto yo pongo el ID de la categoría ahí no pongo mayoristas o minoristas pongo el ID por tanto pongo o uno o dos y de proveedores no tengo ID proveedor todavía vale por tanto esto lo voy a dejar en blanco y de formas de pago recordamos que en mi caso eh pagaré 3690 era el id1 transferencia bancaria era el id2 vale por tanto ahí por ejemplo pongo un dos pongo el ID no pongo el texto para eso está en descuento ahora habíamos dicho que este era un campo manual por tanto Qué le pongo de descuento pues por ejemplo un 10% de descuento lo que queráis si es que le pongo Y luego el ID iae pues había puesto en el número uno estándar 21 por y que es el impuesto que se aplica derivado de tal lo que sea y luego el número dos el reducido 10% Pues yo que sé número uno por esto veis que necesitamos ir de atrás adelante primero definir lo que hay en las tablas secundarias para que luego cuando vamos a la tabla primaria pues veamos lo que ponemos Y por último le damos a continuar tras lo cual e Bueno aparte de que me dice ID proveedores incorrect integer value vamos a verlo aunque me ha dicho error me dice una fila insertada O sea que al final me lo ha insertado Igual me ha puesto un cero porque requería un valor al Haber puesto entero pero sobre todo a hay otra cosa atención Ah y de categoría En qué categoría había puesto yo a este cliente vale en mayoristas ahora es cuando tengo un cliente definido atención todos a la pantalla atención todos a la pantalla este cliente automáticamente tiene el ID número un se lo ha asignado automáticamente el sistema Por tanto ahora por último me voy a direcciones inserto un nuevo elemento y digo ID no lo toco ID cliente ese es el que toco me refiero al cliente con ID número uno ID de tipo dirección pues por ejemplo facturación número uno calle del cliente código postal 469 yo que sé me lo invento País España email info @juan comom teléfono este de aquí persona de contacto preguntar por la Juani y finalizar como veis por tanto en la simulación estamos viendo cómo se comportan las tablas entre sí Yo siempre digo lo siguiente en cuanto al diseño de bases de datos que calculo que es lo mismo que os habrán dicho he llegado el momento Y es que si un cliente tiene una dirección eso es una relación de uno a uno y por tanto no hay por qué ponerlo en dos tablas se junta en una pero si un cliente puede tener varias direcciones eso es una relación de un a n Y eso se monta en dos tablas diferentes una cliente y otra direcciones por último como os digo le damos a continuar y tenemos ya la simulación correctamente puesta en la tabla antes de ir a ninguna parte antes de ir a la programación a Java lo que voy a hacer Es que voy entrar dentro de sql y voy a hacer lo siguiente vamos a ver atención todos Select all from clientes y Au y ya está Mirad Select all from clientes si yo ejecuto esta petición aquí tienes que mirar esta petición déjame que lo haga más grande ahí si yo ejecuto esta petición lo que sale es esto lo que sale es Juan López vale es Select all from clientes y lo que hace simplemente es devolverme la tabla de clientes no tiene más pero ahora atención a ver quién me lo resuelve yo digo y de categoría uno eso a mí no me dice nada yo con ese número uno yo no sé a qué categoría pertenece ese cliente decidme qué hago sí Yo veo aquí esta este list yo he hecho un Select all from clientes y el programa me dice Pues toma all from clientes yo como administrador de base de datos sé más o menos que estoy viendo ahí pero yo como al cliente le diga categoría uno el cliente dirá esa categoría Cuál es esto es mayoristas minoristas esto es que se me va al cañón qué es esto exactamente Vale pues no lo sabe un momentín vale Qué hago yo ahí Qué hago yo para transformarle a un cliente ese número uno en una categoría bien un join Yo no haría un Inner join para ese caso yo para este caso haría un left join con lo cual simplemente tener en cuenta que tenéis aquí el enlace que pasa muy desapercibido de mostrar ventana de consultas y ahora digo atención Select all from clientes atención left join clientes gu bajo categorías y ahora qué Yo te recomiendo que los comandos de sql los pongáis en mayúsculas aunque se pueden poner en minúsculas y los nombres de las tablas o los campos en minúsculas y así diferenciamos bien lo que es sql de lo que es la estructura de la base de datos aparte de que al igual que muchos editores de código pues como veis el sql de phm admin os colorea un poco el código pero aún así lo suelo poner en mayúsculas Y ahora qué digo elé el qué Pero has dicho we y no es we es on el we es otra cosa que ahora veremos a continuación vale calma ahora iremos Ahora no Pero más adelante sí que es necesario ahora no porque yo puedo usar la sintaxis de llamar nombre de tabla punto nombre de columna Si no tuviera esa herramienta Pues evidentemente sí entonces tengo que decir dónde está la correspondencia por tanto lo que voy a hacer es on clientes gu B clientes Oh mira qué bien no sé a vosotros pero a mí las últimas versiones de phmm admin me sacan la lista en línea no pues es que yo soy gu entonces clientes ID categoría es igual a clientes categorías punto ID de esta manera lo que estoy haciendo Es especificar que quiero juntar una tabla con otra pero el rasgo de coincidencia es que en clientes el ID categoría se corresponde con categorías el ID y por tanto si ahora ejecuto atención todos a la pantalla comprobaré que me dirá atención Mirad e Mirad me dice nombre ahora pongo el código nombre Juan López razón Juan López atención ID categoría 1 me lo sigue poniendo ID proveedores cero ID formas de pago pero aquí me dice ID y nombre mayoristas es decir me ha colocado las dos tablas en un join donde la que manda es la de la izquierda vale por tanto ya tengo por aquí voy a mostrar otra vez la ventana de consultas ya tengo por aquí una primera petición Cruzada lo que quiero hacer ahora es nuevos left joints quiero juntar con más tablas y no tengo que hacer nada más simplemente tengo que volver a escribir left join no hace falta en este caso el and entonces left join clientes gu bajo formas de pago on clientes ID forma de pago es igual a clientes formas de pago pun ID simplemente lo que hago es otro left join lo que hago es no juntar una sola tabla sino juntar tres tablas en sí como veis la sintaxis sql de mysql prác de Oracle hecho técnicamente los left joints son iguales en cualquier lenguaje sql momentín ejecuto y dejarme visualizar un segund ahora pongo el código qué más tenía aquí a el y ae ya está y finalizamos esta super petición a la base de datos con left join clientes punto ID iae no ID clientes gu B iae Claro que sí on clientes ID iae es igual a clientes gu iae punto ID y con esto por el momento acaba nuestra petición sql lo que tenemos por tanto es una super petición pero que en aplicaciones empresariales es lo más común del mundo que nos ha permitido unir pues Cuatro Tablas y fijaos lo que tengo ahí como resultado ahora vamos a tener que limpiar claro el problema de esto Mirad Es que le doy aquí a continuar atención y si os fijáis me ha devuelto una tabla por aquí otra tabla por aquí y otra tabla por aquí es decir lo que ha hecho es Ah Perdona y otra tabla por aquí lo que hecho es meterme Las Cuatro Tablas ahí juntas Entonces qué pasa que de Cara a presentarle esta información a un cliente me sobran datos atención miradme yo he dicho y de categoría y nombre mayoristas pero para qué me sirve a mí darle al cliente el ID y el nombre Yo solo quiero darle el nombre por tanto lo que voy a hacer miradme es decir que en lugar de Select all en lugar de decir dármelo todo ahora que ya he hecho la petición Cruzada Ahora quiero seleccionar qué es lo que quiero obtener de hecho la regla general es a un cliente normal no enseñarle ningún ID porque el cliente general no tiene porque saber que es un ID de una ha de una base de datos por tanto digo clientes gu baj clientes punto nombre coma clientes gu B clientes razón y ahora digo Mirad lo separamos con comas eh clientes gu bajo clientes no cuidado clientes gu B categorías nombre coma clientes gu bajo No sé lo he mezclado con direcciones creo que no creo que al final no formas de pago me faltará esa ahora hago otra petición Cruzada clientes formas de pago punto forma de pago coma clientes biae epígrafe si queréis lo separo un poquito para que veáis que es cada bloque fijaos que los nombres de columna se separan con comas menos el último no se separa con una coma porque ya entra dentro de los left joints Y si ahora os devuelvo el código y si ahora le doy a continuar si os fijáis atención Mirad qué información más resumida porque me dice directamente Juan López sl mayoristas transferencia bancaria estándar 21 por es decir elimino toda esa información que me sobra y me quedo solo con lo que me interesa ahora voy a hacer otro left join si queréis dejadme separar esto y ahora voy a hacer lo siguiente left join vamos a ver centes realmente clientes direcciones on y esto a ver si me deja porque realmente ahí estoy haciendo un Inner join Pero en fin entonces on clientes gu bajo direcciones punto y cliente es igual a clientes. ID madre mía qué habrá pasado No lo sé voy a decir también que quiero seleccionar clientes punto clientes gu B direcciones punto dónde estás calle voy a calle para verlo un mín momentín porque no está claro que esto haya estado correctamente escrito no bien Vamos a ver clientes direcciones calles no punto y coma a parte de punto y coma no te digo yo que no pero el punto y coma no es la causa del error la causa del error probablemente bien la causa del error es que le he dicho left join voy a probar Inner join Bueno un segundo déjame primero lo pruebe yo y o bien voy a hacer otra cosa un segundin continúo nada dejadme que des haaga voy a invertir las columnas no copiáis nada todavía no copiáis nada todavía y dejadme invertir las columnas donde clientes ID es igual a clientes gu B direcciones punto ID cliente probamos Ah venga clientes direcciones calle Dónde está ah bien clientes direcciones calle dice que no conoce esa columna vale déjame que lo coja todo y a ver qué sale bien no me admite todo Dime No si le digo asterisco es de todo lo que pille un segundo bien vale el error no está ahí Ah bien vale muy bien ya lo veo clientes direcciones clientes ID es igual a clientes direcciones yid cliente me dice I igual es porque me lo ha recortado left join clientes direcciones on clientes ID Ah vale Perdón no creía que te referías a este punto y coma efectivamente pero es que ha dicho intermedio cuidado venga vale Y ahora un momentín que no la ha acabado y ahora digo coma clientes direcciones calle por ejemplo para comprobar que sacamos datos y continuar y tenemos aquí calle del cliente y ya por último por si esto no era ya suficientemente complejo pues left join y clientes gu bajo tipo dirección on Esto sí que es difícil on clientes direcciones punto ID tipo dirección es igual a clientes tipod dirección ID ya es que ni me cabe en la línea bien Vamos a probarlo que haya suerte y si todo ha ido bien vale bien pero no he pedido nada así que coma clientes gu B tipo dirección punto tipo Ahora sí Yo creo que con esto la consulta ya está finalizada y me dice Juan López con esta razón social es mayorista su forma de pago es transferencia bancaria su epígrafe digamos su IVA es el 21 por calle de cliente y tipo facturación Así que como veis teniendo la información segregada en varias tablas la podde unic con una sentencia sencillita como esta que tenemos en la pantalla