bueno pues vamos a hacer un proyecto un poco especial para esta segunda parte del curso entonces vamos a crear un proyecto que va a empezar con un canvas 2d luego se va a convertir en un free js y luego lo exportaremos en formato de jota entonces va a ser un proyecto bastante curioso para demostrar que el fin js no es una tecnología que trabaja que funciona ella sola sino que se puede combinar con otras tecnologías entonces voy a venir por aquí el ht docs en frío y js voy a crear una carpeta llamada constructor escenarios y dentro de constructores escenarios voy a crear un archivo nuevo vamos a ver y creó un archivo nuevo por aquí lo guardo dentro de hp docs dentro de constructor escenarios como index 1 html y vamos a abrirlo vamos a abrir un entorno del servidor local y vamos allá lo primero que quiero es crear un creador de plantas vamos a ver constructores escenarios y no es aquí sí no en el index 1.7 ml con lo cual ahora si empezamos a escribir creamos un head creamos un boli viene a continuación voy a crear un canvas que no va a ser muy grande curiosamente de momento va a ser un canvas de 512 por 512 sí creo es igual a 512 píxeles con el ibex es igual a lienzo y ahora e insisto que empezó con un canvas 2d que luego se convertirá en un canvas 3d dar contexto es igual a documento get element by hay del lienzo y punto get contexto 2 d y ahora vamos recargando aunque de momento no hay ninguna novedad si acaso quizás en el head voy a poner un estilo donde voy a decir que el canvas va a tener un borde de un píxel sólido negro así que recargamos más que nada para ver bien el canvas para ver exactamente qué es lo que va a salir y para ponerlo pues por ejemplo por ahí repartir la pantalla entonces ahora a continuación digamos que si este es el plan de planta vale digamos qué voy a hacer un edificio cuadrado luego ya veremos cómo hacer otros tipos de formas pero de momento empezamos por un edificio cuadrado voy a decir lo siguiente bar número casas es igual a por ejemplo 10 no lo sé se me acaba de ocurrir y ahora digo varón pues bar que pues no lo sé es decir bar y es igual a 0 y es menor que número casas y más ya lo que quiero es pues contexto punto fil recto y quiero pues más punto round por más punto random por 512 esto es la equis ahora la vamos a tirarlo hacia abajo ballet esto es la x esto es la y ahora voy a poner 10 y 10 no sé vamos a probar y por supuesto también contexto punto field style es igual a rgb coma más punto round por más punto random x 256 entonces ahora hacemos así esto es el color rgb y si todo va bien hacemos así y vamos a ver que no vamos a ver si hay algún error vamos abajo la consola más es más aquí y más aquí recargamos y tenemos allí una serie de puntos lo que me extrañó es que aparecen todos negros no deberían aparecer todos negros feel style es igual a rgb más punto round más enterrando todos debería estar correcto y rgb en principio es correcto aquí falta una coma así que recargamos y ahora sí por fin tenemos pues una serie de colores así que lo que quiero a continuación es que el sistema empiece a dibujar empiece a tirar como una especie de espirales vale vamos a ver a continuación que por tanto digamos puedo crear una serie de bloques y por tanto ahora vamos a verlo para ello voy a hacer lo siguiente class bloque klaus bloque va a tener un constructor y va a tener lo siguiente de x es igual a esto de aquí es this punto y es igual a esto de aquí ahora ves punto ere es igual a esto de aquí this punto g realmente es igual a esto de aquí this punto be blood es igual a lo mismo y yo creo que ya entonces ahora vamos a ver por una parte creo en los objetos entonces digo bar bloques es igual ánimo array y entonces digo formar número casas bloques es igual a mí un bloque y ahora por tanto una vez que tengo esto pues ahora sí creo en los objetos ahora pinto según los objetos copio y pego mal y entonces vengo por aquí y digo contexto punto file style es igual a rgb como coma y entonces digo bloques punto r y entonces digo bloques de ge bloques de y parece que es lo mismo que lo que tenía pero no lo es y entonces digo contexto punto field recta y entonces bloques de x bloques de punto y 11 vamos a empezar por ahí así que vengo por aquí no se ve pero tengo estoy creando hay unos puntos insisto que no se ven pero están ahí más grande vale ya a continuación lo que quiero es lo siguiente a ver dibujando espirales a lo largo de estos bloques y para dibujar espirales lo que voy a hacer es crear un pequeño algoritmo de caracol vamos a ver y vamos a ver por aquí voy a hacer 128 x 128 porque igual 512 es demasiado grande esto es 128 por 128 vamos a verlo ahora hacemos más grande yo creo que hay mejor vamos a verlo bien y ahora para cada uno de los elementos vamos a ir pues creando un algoritmo que nos permita ir circulando digamos cada elemento con lo que le corresponde estoy viendo sí estoy viendo si los colores son los correctos que diría que no vamos a hacer 5 y 5 igual es que no lo estoy viendo bien sé incorrecto no son correctos rgb bloques de r bloques de g y bloques de b vale en principio es correcto rgb phil style rg n estoy viendo sea alguna algún fallo sintáctico en principio parece que no fil está el sí que hay un fallo sintáctico y es que la s tiene que ir en mayúsculas ahora sí que se está viendo bien vale muy bien entonces a continuación vamos a establecer digamos una dirección de caracol digamos que todos los objetos de todo estos elementos van a ir creciendo digamos haciendo un pequeño caracol y para hacer un caracol vamos a empezar pues digamos haciendo una espiral vamos a ver vengo por aquí y digo four no bar temporizador es igual a séptima bucle que min función bucle función un bucle vamos a decir que clear time out temporizador y entonces vuelvo a lanzar el temporizador esto va a hacer una instrucción recursiva esto va a ser una ejecución recursiva vamos a ir dando vueltas y por ejemplo lo que voy a hacer es que para cada uno de los bloques voy a decir que vamos a poner esto allí vale voy a decir que bloques de punto y más por ejemplo valen a una demostración sencilla así que ahora vamos a ir viendo como por los bloques van creciendo en pues hacia abajo digamos va a ir creciendo hacia abajo salvo que uno se encuentre que digamos que dónde quiere dibujar no puede vale pues en este caso lo que haremos es indicar otra cosa indicar digamos que el programa se comporte de otra forma vamos a ver cómo vamos a ver cómo lo podemos hacer vamos a ver para ello a continuación vamos una forma de hacerlo es que podemos ir contando en el sentido de que dibujar vamos a verle un momentín un segundo que abra el gimp voy a hacer una espiral casi que lo puedo hacer directamente aquí y voy a decir this punto dirección es igual a cero y this punto contador es igual a cero vamos a ver vale vamos allá 1 vamos a ver y de paso es igual a cero vamos allá entonces para cada bucle voy a decir lo siguiente if this punto dirección es igual a cero en ese caso en este caso vamos a verlo this punto y más dirección es igual a 1 x menos si dirección es igual a 2 cuidado si dirección es igual a 2 y más sí dirección es igual a 3 bis x + + muy bien a continuación lo que voy a hacer es lo siguiente ahora tengo que decirle al sistema cuál es el límite entonces punto paso es menor que dice en ese caso nada ahora bien en caso contrario dish punto c + + p es igual a cero y dish punto dirección + + por último sí this punto dirección es igual a 5 no existe 5 perdón no existe 4 en este caso distinto dirección es igual pero si esto ha ido bien no lo sé pero si esto ha ido bien el algoritmo lo que debería hacer es empezar a dibujar el círculo vamos a verlo this punto p así perdón punto p más vamos a ver lo de ps valera no está haciendo nada tres puntos de es igual a 1 voy a poner con sole punto lo sigo con sole punto 1 giro vamos a verlo giro 15 616 giro sí pero no d debería continuar el plan de meditación debería ser continuar voy a decirle 2 es que no es digno es días no estés es bloques de iu creo que es bloques el dices dentro del objeto pero esto hace referencia vamos a verlo bueno vale ok a esa dirección no debería hacerla vale teóricamente no debería ocurrir eso está ocurriendo algo gracioso pero no debería ocurrir eso claro ok perfecto es que esto es y menos venga digamos vamos allá vale súper vale eso es un poco la idea es lo que quiero que hagan como caracolillos bien los caracolillos deberían estar pegados está haciendo los caracolillos un poco interesantes no era lo que yo quería pero era un me valen como demostración por lo menos como demostración conceptual de lo que estaba persiguiendo ahora el time lo voy a pasar a 10 y así esto va a ir más rápido esto vamos a ver un poquito más algo parecido a lo que voy buscando como digo esto no es exactamente lo que voy buscando porque ahora mismo pues podrás pensar que esto es un poco lío pero por lo menos se empieza ya a aparecer ahora lo que quiero es que esto sea menor o igual recargo vale es interesante pero sigue sin ser lo que quiero porque quiero que la espiral pues vaya pegada voy a poner menor o igual que bloque es menos 1 vamos a verlo a ver si así no todavía no quiero que deje un espacio no quiero que deje un píxel de espacio lo que quiero es que haga un sólido bueno a ver puedo hacer trampa no es lo que quiero no es limpio pero puede ser trampa haciendo que el cuadrado sea de 2 y 2 bueno pues vale pues me puede valer no era lo que quería pero me puede valer bien con esto como estamos viendo lo que estamos haciendo es que el sistema dibuje unas áreas y ahora lo que voy a hacer es que el sistema pare cuando se encuentre digamos un obstáculo vamos a ver alegramos a ver qué es lo que ocurre voy a hacer esto un poquito más lento ahora vamos a ver cómo se debe comportar el sistema cuando se encuentra con una colisión es decir cuando hacer una cosa despuntó cb para el acero dejando un huequito pero vale era principio lo que quiero hacer es indicar qué es lo que ocurre cuando encuentra una colisión así que a continuación voy a hacer lo siguiente voy a detectar cuál es el pixel la transparencia en ese punto y entonces digo llegado a este punto bar datos es igual contexto punto de image data desde 0,0 hasta 128 y entonces digo no esto no es cierto esto no es lo que quiero bloques del punto x como bloques de y punto y coma 11 quiero solo un píxel y no les digo si datos punto data de 3 no es igual a cero en ese caso dibuja es decir si el pixel está libre dibuja vamos a verlo parece que nos está dibujando pero sí que debería así que deberían a no al revés no si es igual a cero entonces dibuja claro ahora sí vamos a verlo vale muy bien y ahí muy bien lo estamos viendo cómo empieza a colisionar pero no sobre escribirla pues todo de momento no es perfecto pero se empieza a parecer bastante lo que voy buscando puede parecer bastante calidades blancos bien sólo me preocupa entonces ahí empezamos a ver cómo crecen una serie de islas digamos cómo crecen una serie de departamentos hay algunos que vemos qué hay errores que corregir como por ejemplo esta tira de pixar lines que haría un efecto bastante raro pero si que empezamos a ver cómo se dividen los compartimentos voy ahora sí a bajar el temporizador para que esto ocurra lo más rápido posible y ahora sí y ahí podemos ver ya como el sistema pues delimita unas zonas ahora lo que quiero hacer es un jugar un poquito quiero jugar quiero ver qué pasa si en lugar de poner 10 pongo 20 lo pongo 30 pongo 50 o pongo 3 no se quiere ver qué es lo que ocurre y luego también pues ya que estamos voy a arreglar digamos esta chapucilla que he hecho antes de poner aquí uno y uno por dos y dos ahora se va a destrozar otra vez he hecho pasar un efecto curioso pero graves porque me hace un espacio de 1 efe - 2 ella hacemos es igual a cero dirección más y poner aquí p - 1 esto debería estar cambiando la dirección pero me sigue poniendo ese píxel de espacio cada vez que cambia la dirección el fe vamos a poner más igual 0.5 curioso ahora sí pero eso es lo que quiero ahora sí que funciona razonablemente bien pero no es lo que en principio quería bueno ahora lo tenemos con una especie de departamentos como digo y ahora pues tal y como decía a su momento podemos decir que casas os quiero poner los 30 a ver qué pasa me alejaré esto tiende a diagonales por lo que estoy viendo lo cual es bueno es curioso no era lo que esperaba pero es curioso voy a hacer una cosa voy a pintar al principio voy a pintar al principio un bloque es que de hecho se supone que está pintando un bloque vale pues 4 y 4 he pasado ayer nostros vale pues menos 4 y menos 4 es lo que dónde sale 5 y 5 a lo menos 5 y luego quiero otro que sea de 2 y 5 ahora sí pues sabemos como una especie de departamentos son como casas muy pequeñas en este caso voy a poner por ejemplo como digo estoy jugando pero me parece bien insisto jugando una vez más bien a ver qué sale con cada cosa y no señora puede poner por ejemplo 5 y la idea está en que esto van a ser las casas que va a haber dentro de un edificio a partir de aquí nos vamos a poner vamos a redistribuir a ver una cosa que puede hacer es marcar algunas zonas comunes marcar algunas zonas digamos donde el sistema no pueda tocar nada como por ejemplo pues un pasillo o un corredor o algo así el momento del programa clave que tengo curiosidad a ver qué va a hacer y otra cosa que puedo hacer y otra cosa que puedo hacer es indicar cuando hayamos finalizado entonces datos es igual a esto de aquí datos es igual ahora sí desde 0,0 hasta 128 y ahora voy a decir bar refresca es igual a true y digo por bar y es igual a 0 y es menor que datos punto data link y + + ahora vengo por aquí y digo sí datos punto data de i + 3 es igual a cero en ese caso refresca es igual a falls y entonces aquí digo sí si refresca s 4 en ese caso refresca y en caso contrario saca un molesto alert y vi finalizado para que el programa reconozca cuando ha finalizado vamos a comprobar si funciona y ahora cuando esto esté lleno digamos que cada uno de los objetos es una casa cuando esté lleno debería aparecer una alerta esto de aquí son las casas ahora parte de lo que queremos ahora también es que dentro de cada casa podemos dibujar habitaciones vamos a verlo la ligera cuando llegue al final quería para hacer una alerta sería personal alerta vamos a ver diciendo que ya no quedan más píxeles pero no aparece la ley no pasa nada ahora veremos en un momento por qué vale entonces bueno estoy con la detección vamos a ver de si queda algún píxel refresca es igualdad falls esto la doble comparación es la que ha fallado finalizado no creo que vamos a ver no refresca es igual a folk no al contrario vale refresca es igual a folk si esto es igual si esto es igual a 0 refresca es igual a true ahora sí vale recargamos la lógica era la contraria que muchas veces me pasa con lógica booleana así que ahora la idea es que una vez que esto se complete y una vez que esto se rellene es cuando en principio el programa debería decir vale esto ya está y si el programa dice esto ya está es cuando a continuación lo que quiero hacer es dibujar una serie de compartimentos digamos dentro de cada uno de estos pisos es como la segunda fase de este pequeño proyecto la primera parte es dibujar espacios diáfanos es la primera parte de la segunda parte es dibujar habitaciones dentro otra cosa que podemos hacer para ver un poco cuál es el sentido de todo esto es también una vez que tenga esto meterlo dentro de alguna parte meterlo dentro de un entorno con frío js para ver qué aspecto tiene para ver qué es lo que vamos a hacer con ello lo que tengo que ver ahora digamos es pues cuál es el perímetro de cada uno de estos elementos para dibujar el perímetro estoy pensando para dibujar el perímetro lo puedo hacer directamente con cajas lo puedo hacer con una hallar bordes hay muchas formas de hacerlo vamos a ver si acaba y si al acabar podemos pasar la fase 2 y si todo va bien ahora en cuanto cubra ese hueco en el final me dirá finalizado y si me dice finalizado es cuando ya puedo pasar a la siguiente parte y la siguiente parte como digo podría ser perfectamente puedes dibujar con una hallar bordes dibujar paredes vamos a por ello vengo por aquí y ahora digo que voy a crear un segundo canvas qué es al dibujar un segundo canvas que es lienzo 2 es cuando a continuación voy a decirle al sistema que contexto 2 es igual a lienzo 2 recargamos para comprobar que ahora ha aparecido un segundo canvas aquí abajo y ahora es cuando pues lo que voy a hacer es lo siguiente vamos a ver esto es haber finalizado esto ya no quiero que ocurra y ahora voy a ir a la función segunda parte y aquí voy a ejecutar la función segunda parte la función segunda parte va a hacer lo siguiente vamos a ver más datos vamos a verlo bar datos es igual a contexto punto get element no con texto de emails data desde 0,0 hasta 128 y ahora por tanto hago un foro bar y es igual a 0 y es menor qué contexto punto no datos punto data punto links y más igual a 4 porque quiero ir de 4 en 4 píxeles no pero de cuatro en cuatro piezas de información y vamos a recargar bien y ahora a continuación voy a decir lo siguiente voy a decir qué bar x es igual a menos 2 x es menor 2 x + + lo mismo con la y es igual a menos 2 y es menor que 2 y más eso de viajar y menor o igual y lo que voy a hacer es mirar los píxeles vecinos para ver si hay un límite o no y si lo hay entonces pintaré algo y si lo hay entonces lo que voy a hacer es pintar vamos a hablar vamos allá a continuación voy a hacer lo siguiente voy a decirlo bar rojo es igual a datos punto data de pie + 1 + 2 siendo de vigo bar igual es igual a otro y digo sí sin más punto a bs de rojo menos y ahora vamos a verlo datos punto data + x 4 + y x 4 x 128 si esto es menor que 5 en ese caso no personal si esto es cierto el verde es cierto y el azul es cierto esto es el verde esto es más esto es el azul esto es más dos en ese caso igual es y foros con lo cual al final del todo vengo por aquí y digo sí igual por falls en este caso contexto dos puntos fil recto y ahora qué y ahora cuál es likes l datos 2 contexto 2 al contexto 2 datos 2 dato es igual a cero y más uno es igual a cero y más dos es el balah cero es igual a 255 en caso contrario estos 255 a los 55 bien si esto ha ido bien ahora lo veremos porque tenemos que esperar a que la primera parte acabe lo que va a hacer es detectar los muros de la primera parte es decir en el segundo lo que hace es detectar los muros que habrían en la primera parte vamos a ver si todo ha ido bien porque lo he programado un poco de oído el programa de un poco con un algoritmo en la mente pero sin ir probando paso a paso con los riesgos que eso tiene evidentemente así que suerte si no ahora a continuación forzaré alguna prueba más rápida ahora veremos poniendo más departamentos digamos vamos a verlo ya queda poco venga y de momento no hace nada no sé si de hecho incluso habrá fallado quizás no sé nada vale así vaya al final del todo contexto 2 punto image data datos 2,00 me ha olvidado ese paso vamos a poner más casas vamos a poner 50 aunque el resultado será un poco aberrante pero por lo menos podemos ver si lo que sale es correcto o no vamos a verlo vale si todo va bien vamos a verlo al pse suerte no sale nada pues ya en la segunda parte voy a poner consuele punto el ojo segunda parte y a ver un poco que puede estar pasando estoy repasando mientras se ejecuta el algoritmo estoy repasando visualmente el código principio príncipe todo parece estar bien segunda parte pero segunda parte no está pintando vamos a consola es igual o no es igual vamos a poner con soles y así sí la lógica está fallando podemos averiguar por qué por aquí forzadamente más casas así el algoritmo acabará antes lo que vale al final que nos dice no está entrando en principio en la segunda parte lo cual es raro vamos a hablar estamos acabando la esquina de arriba segunda parte y en principio no está diciendo ni una cosa ni la otra es decir no está parece que no está ejecutando esta parte de aquí a abajo lento y me falta una se podría hacer eso pues podría ser perfectamente vale todos dice que no es igual muy bien si igual es ivana trump vamos a hacerlo al revés igual es igual a falls mayor que 5 esto realmente es menor que 5 vamos a ver si finaliza no sé que le queda es como que se queda enganchado con algún pixel es igual vale vamos a ver r de otros hasta de ello si esto es cierto vale 16.000 píxeles somos por ello en 38 % 28 smith igual es igual y si es igual a otro vale ahora r - datos es menor que 5 es mayor que 5 es mayor que 5 es igual a folk recargamos y lo que quiero es que el programa reconozca que hay zonas ahora si ven esto ya es otra cosa ahora estamos allí marcando los muros de pues de esta casa estamos consiguiendo que el sistema reconozca estos muros y a partir de aquí puedo empezar a pintar de hecho pues bueno ahora puedo hacer lo siguiente puedo hacer x y 1 los cónsules ya no hace falta porque ya estamos viendo que funcionan saldrán muros más ligados ahí por ejemplo vale en algunos casos no reconocen muros lo cual es raro pero bueno igual pasa nada y ahora le digo menor o igual voy a decirle x 0 porque entonces no lo ejecutará bueno si te puedo decir se lo creo vale ahí como vemos está empezando ya a reconocer muros y ahora pues una forma de trabajar no digo que sea la mejor no digo que sea la única pero una forma de trabajar podría ser por ejemplo pues dibujar digamos cajas a partir de esos objetos es decir por acoger estas líneas estos píxeles en definitiva puedo meterlos dentro d meterlos dentro de js por ejemplo y a partir de ahí empezará a excluir muros voy a hacer una cosa contexto dos puntos fil recto desde cero pero voy a dibujar un muro de unos 128 pues dibujar llegamos un muro alrededor es más dos píxeles en 128 0 un muro de menos 2 píxeles en 00 voy a dibujar un muro de 128 con 2 100 0 120 8 voy a dibujar un muro de -2 no dejar un muro de 128 menos 2 vamos a verlo y si esto ha funcionado correctamente debería crear un pequeño muro alrededor vamos allá ahí lo tenemos pues el muro que tenemos de normal los muros que tenemos de normal luego tenemos un mural de alrededor que es lo que sería el muro del edificio vale con lo cual ya estamos preparados para una segunda parte tenemos todavía que dibujar habitaciones dentro de cada casa pero una segunda parte donde podemos ya llevarnos esto ya partir de esto pues empezar a dibujar pero pues una vez que tenemos esto a continuación vamos a guardar esta imagen en el disco duro para guardar esta imagen en el disco duro una vez que tenemos esto de aquí vamos a hacer lo siguiente vamos a ver ambas safe m tu local feil vale entonces bueno nos tendríamos que enviar a php con un total de rl vamos a uno de estos y vamos a ver así bueno copiar esto y bueno pues envió es igual contexto dos realmente contexto dos no es canvas para ambas 2 es igual a lienzos vale entonces ahora es igual a canvas 2 punto tu data url y ahora lo que voy a hacer es enviar esto mediante javascript vamos porno porque no quiero realmente y hacerlo mediante cualquier otra cualquier otro método manual sino que quiero hacerlo automático así que me voy a ir a jquery cbn más que nada para contar con un método fácil para ajax así que vengo por aquí al cargo jquery y al llegar a esta parte voy a decir que hopper y ajax toda esta url qué es vamos a esto dice voy a esto voy a pegarlo aquí y voy a decir lo siguiente la url a la que lo voy a enviar guarda php los datos es envío lo enviamos por post y yo creo que ya sachs es igual a console lo he enviado y error con sol error dicho esto ahora a continuación vamos a guardar un archivo llamado guarda punto php y aquí lo que voy a hacer es recargar vamos a recoger perdón los datos es igual a post noto vamos a confirmarse es cierto qué data envíos y correcto vamos a ver jquery bhp safe y merche vamos allá vale pues vamos a esto realmente esto me convence más esta solución me convence más que la anterior aquí así que voy a utilizar esto canvas data es igual a camas 2 ajax open post guarda php muy bien ing data vale y entonces aquí a ver esto es canvas 2 esto es guardar punto php esto no haría falta pero vale vamos a mandarlo por si acaso y ahora copio y pego lo guardo es imagen png vamos a ver si funciona vamos a ver si funciona vamos allá si acaso bueno realmente da igual vamos a inspeccionar vamos a la consola vamos a esperar que no dé ningún error no debería para la segunda parte 128 ajax response text vale no pasa nada no ha dicho nada tampoco tiene por qué decir nada me vengo aquí constructores escenarios php no ha dicho nada vamos a escribir por aquí el co ok y vamos a volver a ejecutar vamos a ver esta es una de las veces en las que nos salta por algún motivo debe tener algún pixel que entiende que es transparente no sé cómo pero debe tenerlo así que repetimos el proceso lo que ha vuelto a pasar creo que ha vuelto a pasar así que pero bueno para saberlo aquí guarda php vale aunque php dice ok pero el caso es que imagen png no está apareciendo aquí voy a hacer voy a meter este lo que hay aquí dentro estoy viendo se podía averiguar algo un poco más desde aquí pero en principio parece que no también a mirar es quizás tal vez pueda ser un problema de permisos de carpeta que también podría ser de hecho voy a ir mirando los llama vamos a tener información vamos a desbloquear esto y vamos a poner lectura y escritura para todos cerramos recargamos porque parece que ha sido una de esas veces en las que se ha quedado frito vale no dice ok ese es el problema es que no está enviando esto guarda php se deje ver content type y me trata pues vamos a ver esto fuera esto es post esto es mi estado y vamos allá tierra piedad que de vez en cuando no encuentra o encuentra algún píxel vacío al revés y nos dice ok de hecho ha dicho ok vale vamos a ir a la imagen al cerrar esto voy a ir h deluxe voy a ir a constructor escenarios veo que hay una imagen no sé si tendrá la información que quiero vamos a verlo vale no la tiene como parece que no la tiene vamos a verlo me voy a ir a ver qué es lo que hay exactamente en esa imagen bueno es una imagen de 128 x 128 curiosamente pero la imagen es correcta esa es la cuestión el tamaño de la imagen es el correcto pero no parece tener la información que necesito vamos a ver por qué imagen png elenco de datos vale pues vamos a buscar algún otro script pero de aquí vamos a buscar este ustedes no sé cómo he llamado esta imagen png imagen pelaje vale vamos allá recargamos y si todo va bien imagen png y si todo va bien imagen png ahora son tres casas aparte de que la tengo abierta aquí igual eso impide que la pueda abrir vale menos 3 21 14 así que en principio ha sido esta imagen vamos a recargar acabo de borrar para asegurarme que la escribe de nuevo y vamos a por ello estamos así vale aparece la imagen son tres casas vista previa algo falla curiosamente la imagen sí que parece que de alguna forma se están enviando en el sentido de que aparece una imagen de 128 x 128 pero luego los píxeles son transparentes vamos a probar con esto es ing data comprobamos que si emerge data sí foto png vale lo que sea probamos ok nos devuelve nada vale correcto me voy a foto png y veo que esto ya es otra cosa porque ya tengo ahí mi foto correctamente guardada ya tengo ahí mi plano de planta correctamente guardado y ahora es cuando ya puedo ir a la siguiente parte que es la parte en la que abro felix js y la parte en la que voy a dibujar los muros a partir de lo que aparece en este plano vamos a por ello vamos a hacerlo a continuación así que ahora me voy a ir a index.html voy a ir a este index de la parte anterior de esquí js me la voy a guardar en constructores escenarios como index 2 html precisamente y voy a hacer lo siguiente vamos a ver voy a quitar todo esto voy a quitar en los controles todo esto lo voy a quitar vale a continuación esto lo voy a quitar número personajes lo voy a quitar personajes fuera pero escena me la quedo representado el me lo quedo sao no quiero nada creo que me cargado los controles los orbes contra los que los quiero estos no los quiero vale cubo ahora vamos a hablar de esto primero este es un cubo escena textura ok vale carregador esto fuera no quiero cargador no quiero animaciones quiero un poco quiere luz ambiental no quiero personajes bueno ese cubo sin ángulo sol no lo quiero ángulo soy no lo quiero no quiero el compost ser a ver cuidado quiero el render en el campo ser no quiere las direcciones con lo cual se ahora aquí me voy a index 2 bien vamos a ver qué te falta así claro por supuesto lo que le falta lo que le falta es que débil le falta la librería vale y ahora de aquí le falta de los controles vamos a verlo muy bien y el checker sé que también le falta lo copiamos y ahí lo tenemos ahora voy a hacer esto muy bien ya tengo está en la pantalla bueno pues ahora lo que quiero es leer el archivo que acabo de guardar y al leer el archivo que acabo de guardar quiero que el programa cree cajitas quiero que el programa construya cajitas vale cómo puedo hacer que el programa construya cajitas bueno pues entonces voy a hacer lo siguiente vamos a ver todo esto lo voy a colocar en una función llamada dibuja dibujado 3d o lo que sea ok no ocurre nada y entonces ahora aquí arriba voy a poner dibujo así que a continuación recargo animated nos defina si cuidado aquí ok funcionan email y sed funcionamiento vamos a verlo alguna variable correcta una variable fallarán vamos a ver entonces mi ser todas estas variables aquí la escena aquí la cámara aquí el renderizado aquí la geometría realmente todo esto aquí la textura aquí el suelo aquí el foco allí y yo creo que si bien tenemos bien entonces ahora y entonces ahora lo que voy a hacer es que voy a cargar una imagen es decir bar el fondo es igual a new image el fondo srf es igual a la foto punto png creo que es si la foto punto png el oro bueno puedo editar poder la imagen píxel a píxel y a partir de esa imagen puedo ser un poco lo que quiera ser lo que quiera puede tener múltiples formas vamos a ver cómo lo podemos hacer por ejemplo aquí en el body por no tener un canvas llamado y de fondo donde le voy a decir que wish es igual a 128 píxeles height es igual a 128 píxeles y por lo tanto y por lo tanto voy a decir lo siguiente bar contexto es igual a documento punto get element bayle albín a ver qué pasa aquí lienzo punto get contexto vale y ahora puedo decirle javascript emails olot cuando la imagen cargue vale entonces aquí voy a decirle el fondo punto un loud aquí mismo llegó a la función y entonces en él canvas contexto punto draw image y quiero dibujar el fondo en 00 vamos a ver de momento vamos a ver de momento y key ok de connecticut contexto el viento lienzo no es le respondo vale en este contexto a 30 de fondo el contexto 2 d bien veo esto no sé por qué tengo una luz morada lo cierto es que lo desconozco ahora mismo es curioso no me lo esperaba vale voy a hacer el resto un momentín porque desconozco porque la luz es morada a ver hacer una cosa voy a multar esto ahora mismo estoy muy extrañado de que sea morada algo sigue siendo morada a ver en qué momento también está lo del foco pues no lo sé ahora averiguaré a ver por qué el foco es morado porque que yo sepa no tiene ningún motivo para ser morado pero morado sean magenta no lo sé bien el tema del caso guarde valen dibujo la imagen estábamos diciendo y por tanto para a continuación una vez que tengo el contexto dibujado es cuando a continuación puedo hacer una serie de cosas vamos a ver vamos a poner aquí para datos es igual a contexto punto de emails data desde 0,0 hasta 128 y por lo tanto ahora voy a decir que formar y es igual a 0 y es menor a datos punto data link y más igual a 4 así que vengo por aquí y ahora digo lo siguiente sí datos punto data del es igual a 0 en ese caso sólo en ese caso lo que quiero hacer es dibujar un cuadrado un cubo como voy a dibujar un cubo bueno pues vamos a verlo bueno aquí indirectamente así geometría voy a decir dar porque esto varía bar mi geometría mi material miku esto es mi geometría mi material vale ahora la posición vale esta es la posición esta es la cuestión mi cubo o sitio eran marcela y tengo que sacar la equis y la z que sería la i griega pero que es la c no voy a ver si esto causa error de momento antes de hacer nada más vale esto no causa error tampoco está creando ningún cubo cervecero no está creando el cubo vamos a ver que tiene mi escena y mi escena tiene 4 children's así si tiene un cubo aquí no sé cómo uno cuenta así por supuesto porque mi escena puntual disculpa así que recargamos perfecto y ahora sí llamó a mi escena veremos que mi escena en children tiene dos mil y pico children's que son demasiados pero si puede ser que sean correctos vale entonces si todo va bien ahora a continuación partiendo de la y tengo que sacar a verlo vale tengo que sacar la distancia esto por cierto va a ser 5 que es la altura vamos a recargarlo para ver cómo sale una cajita alta ahí está bien a continuación yo digo a partir de ahí la z es más punto no d y partido 4 % 28 y ahora la equis es más punto flor y esto voy a poner un paréntesis para que se entienda bien y resto entero de la división partido 4% 28 vamos a verlo no sé si habrá ido bien recargamos vale bueno apuesto por aquí una serie de cosas bueno creo que quiere empezar a ser correcto pero todavía no lo ves pero bueno aún pero pero tiene forma yo creo que esto es partido 4 esto ya es otra cosa esto es otra cosa muy diferente nos dejamos ahí veremos como tenemos ya esto vamos a hacer esto - 64 para que los centres en la pantalla estos menos 64 y entonces veremos que el programa ha creado una geometría vamos a perder una geometría a partir de la imagen que hemos generado al creado pues un laberinto ha creado una estructura 3d ha creado una serie de paredes en este caso además lo que quiero hacer es lo siguiente en el index 1 constructor escenarios vale menos mal creía que había modificado el otro por un momento casi me muero bien vamos a asegurar que el otro esté intacto ser y js index 2 de hoy a la una vale y este es de hoy el año y media menos mal así mira un pasmo pues ahora lo que quiero en el index dos de constructores escenarios que así que voy a cerrar todo y voy a asegurarme que abro lo correcto de constructor escenarios quiero el index 1 y el index 2 valley en el index cuando llego aquí le voy a decir en este caso windows punto location mira mejor se time out sintieron milk y voy a decir window punto location es igual a index 2.7 ml con esto que es lo que quiero pues con esto lo que quiero es decirle al programa y 1 html lo que quiero decirle es que primero genera el escenario y una vez que ha generado el escenario automáticamente se vaya al otro archivo y me lo construya en 3d vamos a verlo ya sabemos que a veces se engancha ya que la poco si todo va bien cierra correctamente vale entonces ahora nos vamos la segunda parte y vemos como me ha generado ese espacio me ha generado ese entorno no sé si me ha generado el correcto 134 así es correcto muy bien perfecto con lo cual tenemos un generador de escenarios ahora tenemos que las paredes podemos refinar el algoritmo para que me la saga pues todas seguidas en lugar de con estos escalones esos ya un poco evidentemente de trabajar sobre la algoritmo pero el concepto digamos es el que está encima de la mesa y luego hay otra cosa que quiero hacer que es que me quiero guardar esto como un archivo o bj que es lo más curioso que quiero que en este caso free js e incluso me sirva para generar modelos y guardarme los en el disco así que para eso voy a ir por aquí se lee js o bj export y vamos allá transporte vale parece demasiado sencillo bueno evidentemente yo creo que está claro que en un momento dado en un momento dado tendré que ir a exporters vj exporter tendré que ponerlo aquí tendré que llamarlo en textos porter vale vamos a por ello y ahora si todo va bien como digo ejecuto esto aquí tendré que decir free punto o bj exporter y vamos allá voy a ejecutar en textos bien asimismo de find es mi estreno download files naudi find eso ya es otra cosa vale no es esto voy a ver el código aquí vamos a probar esto es un free punto bj exporter mi escena save string resulta vamos a verlo de nuevo recargo exportar ya ha sido declarado curioso así perdón aquí silver spring design of the fine safe string silvestre mismo dif aim es porque será una función qué puedo poner aquí por lo recargó 6 bis notifight es porque será otra función que estaba por aquí recargo de nuevo link is not it find o no me convence esto vamos a ver si encuentro alguna forma más sencilla de descargar los datos y poder meterlos en vender y poder comprobar que podemos tener en la mano digamos tantos como queramos bueno pues al final lo he solucionado de esta forma he creado estos 3 expiados estos tres elementos para crear un link click able auto clic hable en la pantalla y a partir de aquí tenemos el exportador y aquí tenemos una serie de funciones que me han hecho falta para poder poner esto en funcionamiento esta es una función de safe y estas dos funciones son las que he acabado utilizando así que una vez que tengo esto voy a recargar vemos como guardo un objeto y ahora la prueba de fuego digamos consiste en abrir bloomberg abrimos blender y una vez que abra blender lo que voy a hacer es probar a importar a ver qué pasa simplemente para comprobar si es un 9 jota válido para comprobar si es correcto novia j fry js constructor escenarios o bj tres casas pesa poco pero vamos a verlo vale en principio no pero sí es decir démonos cuenta como hay un objeto y esto quizás tal vez quiere decir a esto que es por cierto esto es un objeto una caja es una caja esto quiere decir que me ha guardado la escena cuándo antes de crear los cubos no pasa nada pues entonces lo que voy a hacer es decirle al sistema esto dónde está esto estaba aquí esto lo voy a mover justo en el punto ostras madre mía claro vale vamos a ver entonces ok y sólo entonces esto lo dejo aquí y dibuja no debería estar allí dibuja debería estar aquí para que solo se ejecute cuando todo esto haya sido introducido vale venga vamos a hacer otra vez recargo me descargo el objeto si reemplazo cuánto peso ahora esto fuera cuánto pesa ahora pesa 3 con 8 mb esto ya es otra cosa así que eliminó importó vj objeto y con tres con ocho megas ocupa tres con ocho megas porque no está todavía nada optimizado vale bueno tengo por ahí un cubo vale interesante pero seguro cuánto con lo lento que va esto cuánto tiene en polígonos pues tampoco tiene mucho el talento aún así es un solo objeto que tiene sesenta y pico mil entonces cogemos este objeto entramos en el modo de edición y el problema va a ser este el problema es que cojo una cara la estilo y ahí habrán 60.000 caras más ok muy bien ese es el problema no pasa nada estamos en el yo así que ahora vamos a ver porque no ha respetado la posición o colocado todos los cubos en el mismo sitio ok entonces para cubos es igual mi horror va a dar cuenta cubos es igual a cero y entonces ahora vengo y mi geometría desigual animó a rai bar mi material es igual a navarra el barniz cubos igualan y barral no va con variables ya esto es cuenta cubos en tacubos y esto es mi cubo y me cubo bien ahora aquí al final cuenta cubos más y si todo va bien no tendré errores por eso está seguirá ocupando 3 megas probablemente 3 con 8 megas juraría que ahora ocupa un poquito más lo cual puede ser perfectamente posible por las posiciones si todo va bien ahora me voy a importar me voy a bj me voy a con objeto de j y si todo va bien todavía no bueno pero irá bien ahora me vería debería exportar me todo esto correctamente estoy a un paso voy a hacer una pausa voy a ir a retocar el algoritmo y todo esto pero básicamente lo que nos falta eso es lo que nos falta es que reconozca los objetos que hay vamos a ver valentín mi escena voy a asegurar que lo reconoce aquí vale children dos mil y pico ok y posición vamos a hacer esto grande aquí 63 17 posición 63 - 16 vale 1 - 35 menos 16 es correcto en el sentido de que debería estar aplicando los pero de alguna forma todavía no se está aplicando vale ok no hay problema vamos a retocar como digo el algoritmo de generación de celdas y más adelante pues acabaremos de venir aquí para ver qué es lo que falta para conseguir exportar este modelo y ya puedes tenerlo en blender 9-j no ya emprender vender me da igual pero tenerlo en obejo está para importarlo dentro de un juego y tener escenarios generados automáticamente que es un poco el objetivo del ejercicio dicho esto por tanto me voy a ir a index 1 voy a apagar un momento este window location porque no quiero que redirija haya visto que redirige lo que quiero es jugar un poco con este algoritmo para generar un poco como estos edificios estos no quiero 50 quiero 10 pisos y quiero ver qué es lo que sale quiero ver es un poco qué es lo que genera y eventualmente igual también lo que quiero es generar como una especie de pasillos vamos a verlo especie de pasillos para que digamos el sistema tenga como una forma de crear pasillos interiores también quiero ver como esos pasillos afectan un poco a esta forma final cómo afectan a la corte de los pisos entonces ahora a continuación vamos a ver yo podría por ejemplo en la segunda parte decirle al sistema contexto punto clear recta va a ir de éste vamos a ver son 128 son 64 de 4 - 20 44 hasta 104 creo que me he pasado pero vamos a verlo y ahora cortar un trozo ahora contexto punto beijing pas ahora contexto punto stroke recto desde no esto es la mitad 24 hasta 104 cuál es bueno contexto punto y contexto punto close para quiero también el grosor de grosor html5 canvas stroke wef y sly knowles vale pues con texto wef es igual efe y vamos a ver qué pasó vamos a ver qué ocurre vale no estamos acabando y ahora pues lo que va a hacer es vaciar digamos una parte interior como de su lado espérate claro no acabará bueno vale ok vale no he hecho exactamente lo que esperaba pero casi pero bueno por lo menos me vale vamos a ver hay mucho y quiero que llegue hasta 104 muchas veces 4 y luego aquí pasa lo mismo son 80 y 80 vamos a verlo ahora cuando recargo como vemos estoy intentando hacer como una especie de pasillo interior y un deslunado con lo cual habrán como digamos parcelas que darán hacia el exterior y parcelas que verán hacia el interior vamos a verlo ahora igual pongo más parcelas para que esto vaya más rápido aunque el resultado no sea bueno pero voy a poner más parcelas para que la espera sea menor vale y vale parece que tiene algún pixel transparente todavía vamos allá a ver si ya vale poco a poco no es lo que esperaba pero queda poco el caso es que si los presos o así igual sí que tiene sentido esto que estoy haciendo vale entonces este rectángulo no tendrá 80 sino que tendrá 60 a 40 este line guys yo creo que igual con 6 nos basta vamos a verlo en este caso soy un edificio grande router y no era esto estaba bien creo que era ochenta y esto era vamos a ver primero el sexo de arriba está bien esa parte está bien me está aquí mezclando unas cuantas cosas lo cual es interesante también pero eso de momento está bien y ahora el clear recto si aquí está al debe llegar hasta 128 menos 44 debe llegar hasta 84 a los 44 vamos a verlo ahora no ha soltado a veces no salta debe haber algún píxel escondido por ahí en alguna parte que es el que se queda transparente vale yo creo que casi lo veo un poco descentrado pero creo que nos empieza a valer creo que nos empieza a valera es muy interesante de hecho en algunas ocasiones no está sacando los límites esto es porque en los límites he puesto mayor o igual que 5 voy a poner mayor o igual que 1 y así probablemente sacará todos los límites vamos a verlo finalizamos allá arriba vale bien ahora saca más límites ahí no es curioso pero bueno tendrá alguna explicación por lo demás que lo está sacando e incluso con 50 las parcelas que se nos quedan son bastante interesante es bastante interesante si alguna que se queda fuera de la cobertura del pasillo pero bueno vale estas cosas pueden suceder pero por lo demás el tamaño curiosamente se queda bastante interesante así que ahora lo que voy a hacer es todo esto y digamos como hacer un edificio en 3-d aquí dentro de javascript así que para esto vamos a hacer lo siguiente vamos a ver vamos a jugar un poquito con css3 de no va a ser realmente en difíciles de va a ser sólo una forma de visualizarlo css3 de acostar para saberlo como ver su loro muy claro vamos a ver la idea es lo siguiente la idea es la siguiente el edificio y entonces de clase planta y planta 1 y voy copiando planta 2 3 4 5 6 7 bien dicho esto es eso 3d dios as cards vamos a ver esto bueno no es esto exactamente es bonito pero no es esto lo que te lea a ver los papers esto sí y vamos allá entonces vengo por aquí y digo edificio esto por cierto voy a decir que planta esos 400 píxeles de 400 píxeles background red yo creo que hay que buscar porque el local él detrás mujer y edificio también es un wish de 400 píxeles qinghai de 400 píxeles a cada una de las plantas cada una de las plantas es posición absoluta pero píxeles left 0 píxeles porque esto es posición relativa vale ahí lo tenemos y entonces ahora en la perspectiva lo que quiero es transformar los elementos para el momento pero translate zeta vale ahora planta 1 translate zeta pues píxeles no sé a ver qué pasa no lo estoy viendo transforma no sé dónde ha ido pero no ha ido eso se ve 25 5,000 puntos 2 para que sean transparentes menos 100 píxeles para que fuera bien vale y ser muy bien fantástico x a los ok y ahora con esto ya debería empezar a ver los objetos pero sin embargo hay alguno que no se está moviendo así es que planta 1 estoy no se está moviendo vamos a ver por qué tras la zeta ps3 de atrás la dieta alguna demostración pero cayeron primera falta aquí pues no esto ya es otra cosa parece que se ha movido a alguna parte la idea evidentemente es colocar estos bloques de edificios digamos que suban hacia arriba que veamos como suben voy a ver si encuentra alguna demostración vale ya estamos por aquí claro estoy machacando una transformación con otra asuste vamos con esto planta 4 5 6 7 y 8 plantas planta 8 y entonces ahora vamos a poner 100 píxeles 200 300 400 500 600 píxeles de 200 píxeles 800 píxeles vamos a verlo bueno pues allá arriba para quitar 10 de cama para comprobar ahí están que se apilan correctamente y si se apilan correctamente ahora a continuación haremos un poco esto pero si se apilan correctamente lo que vamos a hacer es que en el momento en el que esté generado el documento lo que quiero hacer es pegarlo allí vamos a ver para ello quiero pegar el canvas jquery copi cuanto elemento to be there a ver persiste bueno vamos a ver una vez que tengo esto vuelo en filtro dibujo es igual tan vastos cómo se llama esto se llama y en fotos y en todos así que planta punto html dibujo vamos a ver si ha funcionado esto es probable que no si no haremos una copia pero vamos a verlo estamos llegando a esa esquina de arriba a la izquierda del dibujo y si todo va bien ahora en cuanto acabe lo multiplicará ahí está pues parece que sí qué o lo ha hecho correctamente o no ha querido hacer correctamente solo me ha pegado el último yo creo hay además la muy entonces no lo he hecho correctamente vale no pasa esto por cierto y le voy a decir qué planta canvas es un wish del 100% y un hack del 100% y entonces una vez que tengo esto clown vale esto es lo que el problema entero punto clown planta 1 lienzos yo creo que probablemente lo que quiero es esto 7 y 8 vamos a por ello las cámaras que si es como que visualizamos un edificio parece que no ha saltado vamos a recargarlo y ahora es una cuestión de ir ajustando un poquito ahora en cuanto salga parece que falla una segunda vez recargamos bueno hay una tercera vez vamos a seguir recargando hasta que correctamente hasta que detecte pixel transparente vale vamos a ver no sé lo que está yendo a ver hyde al 100% vale me ha copiado el lienzo me lo ha copiado vacío vamos a poner 200 x 200 píxeles y si me la cope de vacío esto quiere decir que no me estaba duplicando el objeto original bueno vale no hay mucho problema no duplicar ello a mano a ver si llega al final vale y como digo vamos a verlo está duplicando el lienzo 2 pero lo está duplicando vacío y yo no quiero duplicar con contenido evidentemente así que bueno ahora en cuanto tengamos duplicado pues tenemos como aparecerán pues eso como unos orificios digamos en los cuales pues aparecerá todo el contenido que queremos emplazar como las plantas hacer esto una altura de 800 0 aquí voy a poner 0 60 80 100 120 140 más que nada vamos a hacer incluso 0 - 20 40 menos 60 para ver qué pasa ahí cualquier o en definitiva el edificio dónde está aún la perspectiva pues igual 60 grados algo que en un momento dado me permita ver correctamente los edificios y sobre todo quiero clonar sobre todo lo más importante es que quiero clonar pero claro vale crear nuevos canvas es la solución bien podría ser con getty made data pues bueno pues puedo todos los canvas que haga falta y pegarlos ahí y al final pues tendría un edificio vale podría ser correcto podría ser una forma de resolver