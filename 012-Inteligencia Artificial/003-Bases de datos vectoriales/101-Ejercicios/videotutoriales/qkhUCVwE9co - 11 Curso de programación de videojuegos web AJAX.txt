anteriormente durante la sencilla realización del ejercicio de buscaminas vamos a surgir de una pregunta que es la típica y clásica pregunta que os va a surgir y que tenéis que resolver cuando desarrolláis juegos que tienen una parte de cliente y una parte del servidor y la pregunta básicamente es cómo hacemos para comunicarnos entre php y javascript cómo hacemos para poder compartir información entre php y javascript como hacemos más concretamente para pasar por ejemplo variables o datos entre el lado del cliente y el lado del servidor anteriormente hemos visto un método válido que es usar html como lenguaje intermediario la idea de usar html como lenguaje intermediario más adelante pero siendo así cuando sea así más adelante se implementó en lugar de usar html usando xml y entonces nació un concepto llamado ajax donde ajax es javascript asíncrono ahora veremos qué quiere decir asíncrono y xml entonces la idea por tanto es hacer algo parecido a lo que hemos estado haciendo pero usando el lenguaje xml en lugar de html también os tengo que decir que esta variante está casi muerta y sobre todo trabajando con la palabra asíncrono y ahora a continuación vamos a ver qué quiere decir el sintrom para ello arrancamos el samp hoy vamos a trabajar en localhost de momento no hace falta ni que abramos mysql igual más adelante en la clase de hoy si entonces dentro del local host me voy a crear en champ en este de docs una carpeta llamada ajax y dentro de esta carpeta llamada ajax voy a crear un archivo llamado php perdón un archivo llamado html y un archivo llamado como queráis lo voy a llamar ajax php es importante que tenga la extensión php el nombre tampoco igual así que tengo un archivo index html digamos que este es el que se ejecuta en el cliente y tengo un archivo ajax php que digamos que este es el gel que se ejecuta en el servidor voy a cargar los dos dentro del editor y también verdad ayudará a que use jquery vamos a ver en descargas me ayudará el que use jquery para simplificar enormemente la conexión a través de ajax tengo por tanto en esta carpeta estos tres archivos index.hr ml para el cliente ajax punto php para el servidor y jquery punto js como librería de apoyo aj confundo js no hace falta que lo abráis dentro del editor así que me voy a localhost y ajax sin decir nada se me está cargando el archivo index.html otra cosa que puedo hacer es cargarlo a mano dentro del archivo index html voy a escribir lo siguiente la típica de estructura html con un gel con un body dentro del head en la etiqueta de script cargo jquery js y en la siguiente etiqueta script lo que hago es poner ya sabéis documento punto 9 y function simplemente un alert hola por tanto guardo recargo dice hola eso quiere decir que se ha cargado correctamente como veis el elemento o el elemento alert o la vale ahora la gracia mira es que va a ocurrir lo siguiente dentro del body voy a poner dip y d receptor y button y ve botón púlsar la idea por tanto es que voy a tener un receptor y un botón de pulsar ya sé que el receptor no se ve con lo cual si queréis le ponemos un poquito de estilo y digo el receptor quiero que tenga una anchura de 300 píxeles y quiero que tenga un borde de un píxel dust porque me gusta mucho el efecto dust black además le voy a decir que tenga una altura a 30 píxeles por tanto la anchura de 300 altura de 30 y borde de un píxel alineado de color negro hasta ahora cuando hemos creado un archivo que de hecho era php por ejemplo el tablero del bus caminas que si os fijáis os acordáis se hacía php eso no era asincrónico pero eso era sincrónico cuando cargaba es la página en el momento de cargar la página se ejecutaba un script pero sin embargo ahora voy a hacer lo siguiente atención me voy a ir al archivo ajax y diréis droide estoy copiando no pasa nada me lo llevo a la otra pantalla y en el archivo ajax voy a crear este documento php que digo echo hola estás viendo esto desde el servidor mensaje sencillito para empezar así que le decimos por tanto hola estás viendo esto desde el servidor y por tanto suscribiéndose está la calefacción así que fijaron bueno preocupéis entonces le digo hola estás viendo esto desde el servidor pero es muy importante que veáis que hola estás viendo esto desde el servidor lo está diciendo php y por tanto se está ejecutando en el servidor bien tenemos los dos archivos pues lo único que hace falta ahora es un pequeño script que diga cuando pulses el botón vete a php recupera la información y colócala adentro del receptor esto se hace con una sencilla botón de con una sencilla función que dirá lo siguiente cuando sobre el botón hagas clic ejecuta una función en la que dentro del receptor vas a cargar el archivo ajax punto php por tanto si ahora cuando me recargo vamos a ver que tenemos en la pantalla vuelvo a entrar los archivos porque el archivo ya que es muy sencillo así que recargo y lo que ocurre mirad en la pantalla lo que ocurre es que de entrada en la escena no tengo nada dentro del receptor pero cuando pulsó el botón pulsa me lo que ocurre es que se me devuelve estás viendo esto desde el servidor esto que acabamos de hacer por tanto es la síntesis de cómo funciona a ajax y la síntesis de cómo funciona a ajax básicamente lo que se basa en la palabra asíncrono quiere decir que no está sincronizado con que no está sincronizado con la carga de la página por tanto no se cargue la página de cargar el texto no el texto va a cargar cuando tú digas que cargue la carga del texto no tiene nada que ver con la carga de la página se puede hacer en cualquier momento y por ello se dice que es asíncrono en este caso por tanto lo que estamos haciendo es ser capaces de pasar datos desde el cliente perdón desde el servidor hasta el cliente el servidor dice algo muy sencillo a día de hoy claro bien para empezar el servidor dice hola estás viendo esto desde el servidor y el cliente está recibiendo esa información a continuación vamos a explorar el caso contrario el caso en el que desde el cliente le queramos decir algo al servidor para decirle algo al servidor podemos hacerlo de manera tan sencilla como hacer lo siguiente voy a crear un input de tipo texto con él y de dime así que aparece aquí como veis un input de tipo texto en el que puedo escribir lo que voy a hacer es que de paso que llamo a ajax le quiero pasar una palabra le quiero pasar una frase por tanto digo ajax php interrogante os acordáis que esto significa te voy a empezar a pasar parámetros y digo dime es igual a más la siguiente fórmula y la siguiente fórmula es nunca me acuerdo si es en color y hoy en core hoy hungría en code en esta regla más en code uri dime punto vale cuidado con los paréntesis cuidado con los paréntesis porque al final hay tres el primero del load el segundo de encoder y el tercero del val lo que estamos haciendo por tanto es pasarle datos desde el cliente desde el servidor pero claro el servidor tiene que estar preparado para aceptar estos datos para recibir estos datos así que voy a cambiar a jacques php para decir has dicho dos puntos recordad que en gps en cadena con el punto y digo get dime qué es la variable que viene por url que te escoge eso que te están enviando lo crucial que tenéis que entender en este ejercicio lo más importante para el futuro es que aquí estoy enviando una cosa que pone dime y aquí estoy recibiendo una cosa que pone dime eso es lo más importante del ejercicio de hoy tenéis que entender que si ahí pongo longaniza aquí pongo longaniza podéis poner lo que queráis pero tiene que coincidir es decir tú aquí estás enviando un mensaje pero solo porque lo envíes php no sabe qué mensaje le estás enviando le tienes que decir a php una javascript le dices envíame lo por el canal dime y ajax le dices recoge lo por el canal dime por qué esto es así pues esto es así porque tú al final cuando hagas un juego no vas a enviar un único mensaje vas a enviar múltiples mensajes y el sistema tiene que saber cada uno por dónde le viene bien por tanto si guardamos y ejecutamos este código yo escribo aquí hola le doy a pulsa me y me dice has dicho hola si digo esto es una prueba le pulso y pone has dicho esto es una prueba este ejercicio tan chorra y tan sencillo es un ejercicio que ya nos sirve para saber para poder comprobar que desde javascript le envió datos a php y php me los devuelve escritos en pantalla un ejercicio un poco chorro a que sí pues vamos a ver una utilidad práctica vamos a ver en un sencillo ejercicio para que nos puede servir esta comunicación ajax voy a crear un archivo smash y voy a crear una carpeta llamada multijugador en esta archi en esta carpeta llamada multijugador ya los imagináis que voy a crear un archivo index.html voy a crear un archivo llamado servidor php e incluso voy a crear dentro de ese cool y te voy a copiar el archivo admin er php recordáis que me sirve para crear bases de datos en ese culito y voy a crear también voy a copiar también el archivo jquery punto j s el archivo jquery para la librería y el archivo admin air para crear una base de datos por tanto voy a ir ahora a multijugador y voy a entrar en el main air punto php por tanto voy a hacer lo siguiente ese culito tres bases de datos y voy a crear una nueva base de datos llamada multijugador punto bebé ahora creo una tabla llamada posiciones y en esta tabla voy a tener un jugador 2 un jugador 3 y el que es así esto es pose x y esto es pose y claro que si bien esto es un texto esto es un entero esto es un entero voy a poner 2 55 25 52 55 para no preocuparme y ahora si de momento voy a ir a registros y voy a insertar un nuevo registro que va a ser josé vicente en la posición x 50 en la posición y 50 bien hasta aquí vale le doy a guardar y tengo un primer jugador ahora luego tendremos más jugadores por tanto yo me voy aquí y digo lo siguiente vamos a ver me voy a cargar los archivos index html servidor php ya sabéis que copiaron de la voy a copiar de ajax realmente que la estructura la tengo ya qué y digo lo siguiente dentro de body voy a hacer un dip y de tablero y digo receptor pues no tablero wifi del 100% al 100% borde de un píxel solid black más que nada para que veamos bien el escenario ahí lo tenemos el escenario ahora lo que voy a hacer va a ser lo siguiente quiero poblar la posición del jugador pero la posición del jugador está en la base de datos así que lo que tengo que hacer es devolver posiciones desde la base de datos así que digo lo siguiente dentro del tablero le digo a jacques cloud servidor punto php con lo cual el servidor php lo que voy a hacer es conectar al servidor y devolver cuál es la idea de ese servidor vamos a verlo esto lo teníamos por aquí esto lo tenían los acordes otro día en ese culito le digo listado me copió de este código y lo pego aquí y digo la base de datos que voy a usar recordáis que se llama multijugador y digo select all from que fueron posiciones quiero seleccionar todo de posiciones resulta sql y digo eco vivo class el jugador y ve es igual arroz el jugador y voy a decir fácilmente style es bueno un sitio en relativa top es igual a algo es igual a algo va a ser row 2x perdona pos y eso es el top y el left va a ser rey 2x un poco difícil de leer entonces lo que voy a hacer bueno es que voy a bajar el estilo y ya está si no tenemos en dos líneas vale con lo cual lo que ocurre cuando cargo multijugador es que parece que no pero recargo bien cuidado me dice que falta un punto y coma vamos a verlo falta útil con más efectivamente con lo cual recargo y aunque no lo creáis ahí dentro está el jugador de hecho si me voy a inspeccionar veréis que en el tablero está el jugador jose vicente en la posición 50 en los 50 pero claro como no he dicho cómo se representa ese jugador pues realmente no aparece de ninguna manera así que voy a decirle que todo aquel que sea de clase jugador va a tener pues un background un border de un píxel solid rey y un borde radios de 100 esto que hace pues esto hace vamos a verlo porque aparece es así de raro vamos a ver lo aclaro muy bien porque no le he dicho el wifi el height onces guys 30 píxeles height 30 píxeles vale con lo cual yo soy una ficha yo soy una ficha circular es más como dice la canción jose vicente yo soy la ficha roja así que recargo y yo efectivamente soy la flecha roja lo primero que quiero que veáis lo primero que quiero que veáis es que si este elemento tiene el iv de jose vicente y tiene está en top 50 y el 50 no es porque yo se lo haya dicho en el lado del cliente es porque se lo he dicho en el lado del servidor y de hecho no es que sólo haya dicho en el lado del servidor sino es que se lo he dicho en la base de datos por tanto la idea es que la información está subiendo de la base de datos a php y php a javascript y diréis y qué y en qué mejorar esto mi vida pues ahora veréis en que la mejora entonces una vez que tengo esto una vez que tengo esto lo que voy a hacer es decir lo siguiente una vez que he cargado esto esa carga inicial lo que hago ahora es prepararme para capturar el evento así que prepararme para capturar el evento como ya recordáis es un ciprés o cosas parecidas por tanto voy a sacar el código en amp nt docs en isométrico tengo que ir aún mismamente así que si no os preocupéis un segundo no os preocupéis al entonces lo que voy a hacer es que esto es los cursores esto es las flechas de dirección con lo cual voy a hacer lo siguiente seleccionó este elemento vamos a verlo jugador realmente no existe vale y vigo por ejemplo dejadme hacer un poco de trampa bar post x es igual a 50 barcos y es igual a 50 con lo cual le digo 2x más igual 5 por ejemplo y digo ah jose vicente punto css left como dos equis más píxeles de la misma manera si todo va bien vengo por aquí y digo menos igual a 5 y vengo por aquí y digo pos y trump y digo ss se posee y digo como si griega pons y menos igual a 5 y a ver qué pasa y me van a poner top en el último así que recargo por aquí vamos a ver qué pasa si pulso bueno tengo al revés de hecho lo tengo justo al revés entonces lo que hago aquí - - y aquí más guardo recargo y yo empiezo a mover pero la cuestión es que también vosotros podéis empezar a mover y veréis que esto como ya os digo de momento realmente no es muy multijugador porque sí es cierto que al principio la posición inicial ha venido de la base de datos pero finalmente cada uno estamos haciendo lo que queremos en el lado del cliente pero es un comienzo lo que quiero en este caso es simplemente tener en cuenta que esto lo estamos moviendo en el lado del cliente veis estoy cambiando la variable en el lado del cliente y estoy mostrando la nueva posición el lado del cliente yo digo esto no debe ser así esto no debe ser así porque la posición si quiero que esté sincronizada con vosotros tiene que estar en el lado del servidor así que voy a hacer la siguiente operación digo div enviado y creo un día es un dip vacío está por allá abajo estaba oculto se llama enviado así que yo hago esto y digo esto fuera más pues es más un segundo y vivo en el enviado me llamas a un archivo llamado guardador php no existe ahora lo voy a crear y guardador php lo que va a hacer es decirle pos x es igual a algo y pos y es igual a algo pos x es igual a post x y post y es post y bien lo que estoy haciendo por tanto es que cada vez que ejecutó una acción quiero conectarme al servidor y decirle servidor te voy a mandar la información de dónde está ahora esta ficha que hará el servidor bueno pues en el servidor lo que va a hacer es que en un archivo llamado guardador php se va a conectar a la base de datos multijugador y va a hacer lo siguiente update posiciones set pues x es igual a algo vale como posse y es igual a algo web jugador es igual a jose vicente posee x es igual agett 2 x 2 y es igual zagreb pons y diréis y qué hace todo esto vale pues un segundo que baje esto da varias líneas para que lo veáis más fácil vamos a ver si esto hace algo vamos a ver si funciona mira posiciones con suficiente ahora mismo está en 50 650 50 y ahora pulso atención no me pool 66 pulsando algo vale y ahora pulso dos veces la flecha me da igual que no se mueva en la pantalla porque si todo ha ido bien no lo sé vamos a ver se ha ido bien recargo por aquí la pantalla y ahora pone 60 69 visto bien pues pulso dos veces la flecha debajo recargo a la pantalla y ahí donde pone pues x 50 ahora ponen 60 eso qué quiere decir vamos a recapitular porque ponéis cara de nuestro de lo que está pasando lo que está pasando lo que está pasando es que cada vez que yo aquí toco una tecla si revisamos el código comprobaremos cómo si tú tocas esta tecla en javascript yo te actualizo la posición pero luego lo que hago es que me voy al servidor me voy al guardado php y le envío las posiciones x y del jugador con lo cual el guardador php dice que la posición es muy bien yo te recojo las posiciones y las posiciones las meto en la base de datos así que estamos haciendo todo el camino de ira desde el cliente hasta el servidor para guardar las posiciones en la base de datos y ya sé que vosotros diréis muy bonito pero sigo sin ver esto para que me va a servir bueno pues si a continuación os digo lo siguiente y con esto acaba la parte teórica dura del ejercicio de hoy os digo lo siguiente y es que como esto quieras que no al final es un juego pues entro en la función loop ya sabéis que digo bar temporizadores igual algo ya sabéis para qué y digo clear time out temporizador aquí arriba digo time out temporizador como a mí por ejemplo y aquí digo no claro que sí y es más dijo temporizador que mezclar conceptos entonces ahora de hecho digo esto otra vez digamos que en con lo cual tengo una función que lo que hace es lanzarme en la pantalla lo que hace es lanzarme el loop y empezar a lupe haría lo que hará bien pues ahora en el tablero lo voy a cargar aquí dentro y si todo va bien o si todo va bien si ahora recargo hay un momento canales vosotros tengo ahí el dip no sé si veréis cómo está parpadeando está vibrando veis que está librando los eventos y que se ve entre sí llevará algo así no sé si veréis se recarga es en nuestra pantalla vale nada un error no pasa nada no sé si veréis que muestra pantalla sí no y si queréis saber el mensaje subliminal yo os cuento que dice un mensaje subliminal vamos a ver yo lo que estoy haciendo no me moveré es la pelota porque lo que pasa de momento es que todos peleamos por la misma pelota no pasa nada porque ahora vemos que cada uno tenga su propio jugador claro a ser un juego te digo que no entonces mira lo que estaba ocurriendo de hecho si hago así cada equis me dará un pequeñito error si congeló el error si luego veis el vídeo y congela es justo en ese fotograma veréis que es un error de escritura en la base de datos entonces vamos a analizar un poco lo que tenemos yo lo que estoy haciendo es que cien veces perdón diez veces por segundo en este viaje que todo servidor php y cada vez que pulsó el botón estoy ejecutando guardado php esto quiere decir que yo pueda hacer nada e insisto más adelante haremos un sistema de ms ching para decir cuándo se debe refrescar porque ahora mismo podríamos decir para que te refresca sirve por segundo cuando no tienes nada que refrescar si la posición es la misma ya no se oye de momento es una introducción pero la idea por tanto aquí es que yo estoy haciendo diez peticiones por segundo a la base de datos 10 peticiones por segundo sí o sí más las que haga cuando pulsó el botón claro tienes que tener en cuenta que la base de datos de vez en cuando me envía un poco escapar porque me dice oye es que soy ese kulite él soy ese culito y estoy pensado para proyectos pequeños y me estás usando 10 veces por segundo más las escrituras a 10 veces para leer 10 veces porque si más lo que escribas vale por tanto ese mensajito es porque ese culito a 10 veces por segundo pues hay veces que dice mira no pero si pones 500 pues allí verás como la interactividad es mucho menor es cada medio segundo pero también las probabilidades no sé si veis pulsar esto cada medio segundo pero las probabilidades de que salga un error de base de datos son mucho menores por tanto lo que tenemos en pantalla en definitiva ya es un germen de juego multijugador en términos de que cada uno estamos peleando por el mismo jugador pero en algún momento veréis cómo nos va a ser relativamente sencillo conseguir a ser un juego multijugador donde cada uno juegue con su propia ficha ahora mismo tenemos una cosa en el lado del cliente y otra cosa en el lado del servidor es decir la posición x se está leyendo del cliente la posición y hasta elegido del cliente con lo cual si peleamos por la ficha cada uno pelea con su nueva posición vale pues lo que voy a hacer es lo siguiente voy a decirle qué pues x no le digo y movimiento es igual a izquierda así que vengo aquí y digo y movimiento es igual a arriba y movimiento es igual a derecha no cuidado esto es doble comilla y movimiento es igual a abajo lo que voy a hacer además es que por aquí en el tablero tenga un día y de jugador esto es muy importante para que podamos jugar todos porque en el dip y de jugador no voy a hacer un día voy a hacer un input type text y de jugador entonces en el estilo voy a decir posición absoluta top 10 píxeles el f10 píxeles eso es lo que va a hacer es que tengo aquí un jugador como para decir dime a qué jugador vamos a controlar vale así que guardado es igual a eso y jugador es igual a más jugador punto vale atención todos la pantalla si vale algo pasa a esa comunidad parece que sobraba y vamos allá y ahora en guardador digo en guardador vamos a verlo y digo lo siguiente en primer lugar sql es select el from posiciones web jugador es igual get jugador es decir devuélveme la posición x y del jugador que te estoy enviando en este caso yo pondría de jose vicente entonces ahora lo que hago es devolver las posiciones y vivo pues x es igual arroz 2x y pos y es igual a row pons y ahora digo cuál es la operación que me estás enviando la operación que me estás enviando es movimiento así que digo si operación es igual a derecha en ese caso dos equis más igual 10 lo mismo que hacía antes en javascript pero lo estoy haciendo en php lo mismo que antes hacían el cliente ahora luego en el servidor ahora comento todo el código vale porque estamos cerca ya de acabar no lo sé era movimiento pues movimiento más igual a 5 o lo que sea si no vamos a saldrá si no pasa nada al pasado y ahora digo arriba es post y menos igual 5 abajo es post y más igual 5 la izquierda sports x menos igual 5 ya casi estamos acabando ya casi hemos acabado simplemente llegó aquí y diego actualizar la posición del jugador con lo cual si esto es correcto y ahora lo comento dime muy bien muy bien fantástico pues efectivamente le digo 2x y le digo pos y muy bien así que guardo y recargo bien me aparece ahí yo no escribo nada aquí e intentó mover veis que enviado hace algo cada vez que yo toco el botón noto que es enviado hace algo pero no tocó a nadie pero yo pongo aquí jose vicente y algo así y mueva jose vicente yo pongo juan toco y no muy buena bien and i find variable x no pasa nada no os preocupéis pero yo pongo jose vicente y toco y muy bajos o vicente eso qué quiere decir bueno pues eso quiere decir como os podéis imaginar y con esto acabamos la parte teórica de la clase de hoy y paso a comentar eso quiere decir que ahora me voy a la base de datos mainer un tope hp me voy a ese culito es un multijugador punto debe me voy a posiciones y voy a crear el jugador álex composición 100 el jugador frank composición 200 por momentos y el jugador josé luís con posición 300 bien efectivamente como decís aparecerán ya por ahí vamos a verlo alguien aburrido y al sol que parece vale atención mira no tuviese más de momento lo que quiero que veáis y ahora os pongo colores es más voy poner colores ya vamos a ver así que álex color frank color josé luís color si ahora guardé recargo no toquéis a más de momento será guarda y recargo veo que cada uno tiene un color yo de momento no controla nadie pero sí pongo jose vicente todo es para allá vale a ver qué pasa este es el guardador a ver en el guardador es extraño jose vicente vale vamos a ver todos uno más para allá quiero ver las posiciones 120 aclaro claro sí se mueve sola no os preocupéis nuestro país claro esto es por qué esto es porque en el servidor eso siempre uno le pone jugador vale vamos a verlo tiene pinta de eso para empezar esto fuera para empezar esto fuera vamos a verlo para un segundo os mováis morí tablero jugador que pasa que os he metido dentro ese metido dentro parece que aparentemente he abierto aquí un dip pero en el cerrado el de lo cual estaba dentro de mí entonces ahora sí fijaos cómo controla jose vicente ay y empiezo a controlar solo a jose vicente con job a álex y control solo a álex cojo a josé luís y controla josé luís ahora le pongo con mayor refresco y cojo a frank y control a frank por último dentro de este ejercicio voy a poner por aquí 50 y así veréis que el refresco es mayor con lo cual errores aparte ya podéis empezar a mover os en pantalla y por tanto insisto errores de base de datos aparte pero veréis que ya tenemos en la pantalla un juego multijugador quién es el verde por qué no te mueves recarga la pantalla veis que aparece error de base de datos porque le estamos pidiendo muchas cosas la base de datos si parece que sí hemos visto moverse si no pasa nada yo lo que diría es conectar y desconectar muévete con las flechas ya ver si tenemos moverte y aquí tenemos ya por tanto un juego multijugador en pantalla esto que hemos hecho hoy esto nos da un salto cualitativo muy grande hacia adelante hoy es un juego chorrada porque es un juego de cuatro bolitas de colores en la pantalla pero es un juego que nos abre las puertas a una nueva dimensión de desarrollo de juegos vale lo que voy a hacer ahora como el ejercicio ha sido bastante de éxito es a continuación lo voy a volver a repasar no voy a añadir ni una línea más de código y os voy a comentar para que hemos hecho cada una de las líneas a continuación vamos a hacer un repaso pero antes de hacer un repaso lo que quiero es dibujar un poco en la pantalla un esquema explicativo de que he hecho y por qué lo he hecho me voy a abrir el programita este no el scanner no el fomit y atención y os digo lo siguiente mira este soy yo y este soy yo y este es alex y este es frank y este es josé luís en el apartado no vamos a ver en una línea recta y simétrica este soy yo este es alex este es josé luís a la derecha del padre y este es frank creo que está asimétrico para que nadie se sienta desplazado en la mesa redonda la cuestión está en que debemos jugar en un juego multijugador de manera que todo el mundo vea lo que hace todo el mundo qué es lo que nos hace falta lo que nos hace falta es un servidor por tanto hay un ordenador central que en este caso está siendo el mío pero que podría ser de hecho suele ser un ordenador externo que hace de concentrador que hace del servidor entonces ese ordenador es el servidor que tiene básicamente php el lenguaje es php tiene por la parte de atrás una base de datos entonces esta base de datos es la que al final guarda todas nuestras posiciones voy a hacer que por ejemplo azul es escribir y verde es leer por tanto cada vez que yo soy este de aquí cada vez que yo toco una tecla lo que estoy haciendo es escribir en el servidor la información que a su vez el servidor lo está metiendo en la base de datos pero ahora de color verde lo que ocurre es que x veces cada segundo es el servidor perdón ese servidor devuelve la información a php y te la enseñar a ti me la devuelve a mí también te la devuelve a ti y te devuelve a ti este es el esquema de multijugador que estamos siguiendo en pantalla el esquema de multijugador por tanto nos permite que cada vez porque eso se repite para cada uno de vosotros cada vez que alguien hace una acción azul escribir verde leer cada vez que alguien hace una acción esa acción se envía al servidor el servidor lo guarda en la base de datos y a continuación lo lee de la base de datos y lo devuelve a cada uno de los jugadores la pregunta aquí podría ser porque lo tiene que guardar en la base de datos porque no lo puede trabajar directamente en el servidor sin tener que machacar base de datos bueno las respuestas que podría hacerse pero también os digo que si yo lo guardo en base de datos yo sé que cierro el navegador yo sé que vuelva a abrir una ventana del navegador que recargo el multijugador y me encuentro el juego exactamente en la posición en la que me lo encontré o en lo que lo dejé es decir podemos abandonar el juego volver a conectarnos mañana o dentro de un mes y las fichas están en la misma posición en la que nos las dejamos por lo tanto podría hacer el juego sin base de datos lo único es que tenemos que saber que en el momento en el que quiera abandonar el juego la memoria se perdería si yo en cambio uso una base de datos es más pesado como estáis viendo porque tiene que haber operaciones indiscutida de lectura pero lo que hago es que el juego tenga memoria y para un juego multijugador en línea que tenga memoria que recuerde la posición de cada usuario pues tiene su importancia no digo que sea imprescindible pero digo que es muy importante el esquema tal cual lo he dibujado con colorines lo habéis comprendido pues ahora vamos a ver cómo he implementado ese esquema pero en el código han habido un archivo index.php donde en este archivo os acordáis del esquema que he dibujado un momentín espera que vamos a utilizar es que si yo os voy a decir que no entonces como no os acordáis del explosión me acuerdo por sitio no te acuerdas os lo pongo en pantalla así que yo digo esto este archivo representa un cuadrado rojo que es cada uno de los clientes cada uno de los ordenadores ahora tengo un archivo azul que escribe y un archivo verde que lee por tanto esto fuera entonces servidor es yo soy la flecha verde qué es la flecha verde es el archivo php que se encarga de recoger los archivos de la base de datos y devolvernos los a cada uno de los clientes veis lo que quiero decir con yo soy la flecha verde que hace la flecha verde pues la flecha verde como veis aquí abajo lo que hace es me conecto al servidor le pido las posiciones de todos los jugadores como que sólo parte sí claro momento esto no es solapando t exacto sí no quien solapa no es este eco quien solapa es punto lo 1 punto básicamente es descarga lo que había y carga esto nuevo es como el html digamos como html lo que hace es que no te añade nuevas posiciones sino que borra lo que tenías y te pongo nuevas entonces aquí lo que hago es que devuelvo las posiciones de los jugadores como vimos en el escenario fijaos que es un while por tanto while quiere decir para cada uno de los jugadores que haya en pantalla bien sigamos insisto este archivo es la flecha verde porque este archivo de aquí es la flecha azul guardador php es un archivo que se encarga únicamente de especificar qué es lo que pasa cuando quieres guardar algo en pantalla así que yo soy la flecha azul el color es lo de menos qué es lo que hago en primer lugar quiero saber la posición que tiene ese jugador inicialmente ese jugador es que el jugador no es cualquier jugador es el jugador con el que estás jugando recuperó su posición anterior y la meto en variables ya se podría hacer un ir cuando lo que esperas es un resultado necesito ser un while realmente lo que necesito hacer esto es decir oye lo que te dé la base de datos mete melo en la matriz row entonces el wild necesito es para decirle mientras que haya resultados aquí ejecuta me este bucle pero generalmente en programación cuando sabes que de la base de datos que van a venir varios resultados metes un 'wild cuando sabes que te va a abrir un resultado metes un ife pero siempre tienes que meter alguna estructura de control entonces aquí lo que hago es recuperar la posición inicial y digo detecto cuál es el movimiento enviado y alteró las variables en consonancia y por último actualizo la nueva no la anterior sino la nueva posición del jugador en la base de datos es decir oye cuánto valía esto sí pues ahora vales esto vuelve a meter en la base de datos decidirá actualiza tu valor esto es lo que hacen por tanto la flecha azul el jugador y la flecha verde el servidor el guardador quería decir como flecha azul y el servidor como flecha verde por último nos queda un poco comentar qué es lo que está pasando en el código javascript en el código javascript yo digo cada vez que pulse una tecla de flecha invocó al guarda dor sólo cuando toque un botón de flecha en poco el guardador ahora x veces por segundo invoco al servidor flecha verde por qué porque necesitáis ejecutar esto x veces por segundo para ir si yo lo suelto las ramas del teclado no hay ningún evento pero aunque yo soy de las manos del teclado hacéis lo ver como os recomiendo por pantalla vale por tanto este look se ejecuta en principio sí o sí siempre hasta el día en el que implementamos un sistema de message in pro de momento no un momento a saco y este guardador se invoca sólo cuando pulso los botones de la flecha con lo cual al final como veis con esta infraestructura tenemos la manera más sencilla desde de un juego multijugador implementado en pantalla vamos a continuar trabajando extendiendo el ejercicio de ayer y como sois malos e intentar engañar poniendo un usuario que no es el vuestro tenemos que buscar un mecanismo con lo cual no digo que sea imposible porque nunca es imposible pero por lo menos dificultar el hecho de que cualquier persona pueda vuestra identidad bien por tanto voy a hacer lo siguiente atención lo que voy a hacer vamos a ver lo donde estás aquí bueno primero voy a arrancar el sham contra el panel así que arranco apache segundo me voy a ir al local host barra multijugador voy a arrancar heavy y lo que voy a hacer es buscar un identificador teóricamente único de cada uno de vosotros en este caso por tanto lo que voy a hacer es que este identificador único sea vuestra ip por tanto voy a abrir los archivos que tenían ayer local sanz no no hoy seguir mirando porque todo el código que ahora os voy a pasar prefiero que entendáis más qué más que empecéis a aplicar porque luego os lo voy a pasar entonces multijugador me voy a index.html y lo que voy a hacer en este caso lo que voy a hacer en este caso es que en lugar de decir el jugador puntual que es jugador punto vale es el valor del input que tengo aquí que se haga jugador vale pues lo que voy a hacer en este caso va a ser algo tan sencillo como intentar capturar la ip para intentar capturar la ip voy a hacer lo siguiente mira me voy a ir me voy a ir me voy a ir a aquí y voy a cambiar este archivo index.html por index.php porque pues porque en el momento solo en el momento en el que un archivo tiene la extensión php es el momento en el que yo puedo empezar a usar php tener en cuenta que el código php solo se puede insertar en un archivo que tenga la extensión php si el archivo tiene la extensión html no puedo insertar php bien por tanto voy a hacer lo siguiente mira voy a hacer una super trampa el jugador punto alba afuera y aquí donde pone el jugador lo que voy a hacer es que abro php así en medio de javascript abro php y digo echo server y no me acuerdo quiero decir que me voy aquí y digo php server ip entonces estoy buscando una variable la tengo por ahí en mi servidor pero vamos a ver servera dres pero casi primo nota 3 entonces cojo server remote address y ahora si todo va bien recargo aquí miro el código fuente de la pantalla y dice en este caso 2 puntos 1 es porque estoy en localhost si queréis si yo digo 19 21 681 26 me dirá 19 21 681 26 pero es que lo bueno es que cada uno de vosotros sociedad una ip diferente a cada uno le va a dar su ip bien por tanto ahora voy a hacer esto y con esto por tanto lo que estoy haciendo es proteger el juego para que sea más difícil que nadie no digo imposible repito pero más difícil que nadie pueda ya tomar la identidad de otra persona porque cada uno va a tener una identidad única basada en su ip insisto no es un sistema infalible pero desde luego ya aumentará un poquito más la seguridad a partir de aquí por tanto la idea también de usar un remote address de usar un servicio mediante ip es el hecho de como diría yo no poder no estar limitados a cuatro usuarios sino que se pueda conectar cualquier persona en cualquier momento y pueda jugar por tanto voy a hacer lo siguiente ahora lo que estoy haciendo es decirle al jugador que debes recuperar la posición de esta ip pero además en servidor le voy a decir en este caso vamos a ver tablero load servidor php y le voy a decir a quien me estoy refiriendo concretamente por cierto a una persona esto es para escribir ya decía yo y esto es para leer vale con lo cual me voy a guardado php y le digo tienes que seleccionar posiciones donde el jugador sea igual a 10 jugador eso igual vamos a verlo bien bien vale así que voy a hacer lo siguiente hoy sé que necesito una estructura de control ahora veréis por qué porque voy a decir si hay resultados en la base de datos en ese caso devuélveme los resultados si no hay resultados en la base de datos els en ese caso quiero ejecutar una consulta dónde voy a decidir insert en tus posiciones values y los valores y en qué orden estaba puesto esto creo que era jugador pose y no vamos a verlo vamos a ver tengo unas dobles comillas que no empiezan pues ya empieza correctamente de hecho debería tener que empiezan y que acaban porque es un string entonces sqlite multijugador y posiciones exjugador posición x posición y así que como 50-50 esto que está haciendo pues esto está haciendo que yo diga existe previamente el jugador pues recuperó su posición no existe o no existía previamente el jugador pues le creo una nueva entrada en la base de datos entonces de hecho aquí también voy a decir ya me pasó por equipos y vamos a ver esto es igual a 50 y esto es igual a 50 eso quiere decir que cuando se crea un nuevo usuario por defecto está en 50-50 y esto quiere decir por tanto que sí ya podría si lo que podría hacer es por nada particular lo que podría hacer es esto y así aquí le pongo 2x aquí así le pongo post y me ahorro todos los estáticos mismamente entonces recargo por aquí eliminó sí la base de datos está bloqueada fantástico muy bien entonces si no pasa nada entonces lo que voy a hacer a una mala la vuelvo a crear vamos a ver elimino bien entonces era porque la tenía abierta entonces lo que hago es que recargo y vamos a ver si solo por recargar pregunto solo por recargar aparece esto de aquí vale vamos a ver y solo por recargar no está ejecutándose esto vale pues vamos a ver lo vamos a lanzarlo en pantalla si esto es correcto digo que co existe y si esto no es correcto digo eco no existe si ahora guarda en pantalla en la pantalla en principio no aparece nada el qué el guardador sí pero la avale no perdona personas que ha guardado claro sólo aparece cuando yo pulso una tecla porque guardador sólo se ejecuta cuando yo pulsó la tecla bien puedes pulsar la tecla ahora si ha funcionado de hecho ahí pondrá no existe pero ahora cuando vuelva a pulsar tira existe entonces porque voy a repetirlo mirad aquí recargo ya existe voy a eliminar entonces yo digo cuando recargo por defecto no existo con lo cual la primera vez que le doy a una tecla lo que hace es decir oye tienes a alguien en tu base de datos que tenga esta ip y el programa así lo tiene mira existe si no lo tiene no existe ese jugador con el 6 p en la base de datos no lo acabo de vaciar vale por tanto la primera vez lo que hace es crear el usuario en la base de datos y decirme no existe no existía hasta ahora pero lo acabo de crear por tanto recargo en la base de datos y os fijáis como tengo por ahí este elemento claro la siguiente vez que toco ahora ya existe porque está actualizando una posición que previamente no existía y ahora de hecho entráis en el juego y al entrar en el juego pulsáis una tecla recordad que es esta dirección comprobaréis que vais apareciendo a medida que os metéis eso quiere decir por tanto que este juego ya no está limitado a esta casilla sino que ahora cualquier persona se puede meter en el juego simplemente pulsando la tecla bien él lo que voy a hacer ahora también lo que voy a hacer ahora también vamos a verlo es que el color sea aleatorio otra cosa que puedo hacer por lo menos para diagnosticar es decir lo siguiente en cargador en servidor realmente en el servidor lo que voy a hacer es poner un poquito de la ip entonces algo tan sencillo como simplemente pues poner el jugador ya estaba así de sencillo y ahí tenemos la ip entonces sí bueno si nos molesta pues le podemos decir que si es muy grande quiero decir le podemos decir que esto me lo puedo cargar ya porque esto ya no existe entonces jugador pues bueno volví font-family sans-serif sin remates sin decoraciones y font-size 10pt les permito una fuente pequeñita para qué veamos la ip a alguien no le aparece la ip es curioso porque vamos a verlo porque no tienes ip si es un hacker efectivamente y aún así lo puedes mover ahora si puedes mover tu personaje si es interesante si el 23 3 1 y 3 a regresar 23 alex y el resto qué interesante algún fallo de la red bueno así no os preocupéis pues tenemos esto por aquí por tanto voy a mitigar esto con una roca y esto con una ropa para que no dé error bien y ahora lo que quiero a iván claro 26 ha aparecido dos veces que interesante y se recargó otra vez bien no debería hacerlo dejadme ver la base de datos y es que 26 aparece en mi caso 2 veces con lo cual en este caso esto ha fallado voy a cargarme uno de los 26 pero bueno es que esto es un único es decir select from posiciones donde jugador es igual a esto pero bueno para luego meter alguna otra estructura de control para asegurarme que no hayan duplicados bien de momento tenemos el usuario cada uno de los usuarios identificados pero sabéis que estoy cansado de trabajar con bolitas de color gris quiero trabajar con algo más interesante quiero trabajar con un spray de un personajillo que vaya a correr para ir corriendo por la pantalla por tanto lo que voy a hacer mira es que me voy a open game art open game arts punto hereje voy a buscar pues no se estudia art voy a poner el tropo con vino ya sí no lo sé pero creo que va a ser eso voy a estos pequeños character fillos que para la clase de hoy me sirven así que caracteres punto de svg ahí va un svg con que se abre un svg ah menos mal que hemos perdido en que skype porque si no este es un archivo vectorial y solo con gimp pues no podría abrirlo al final lo tengo que convertir a píxeles pero el hecho de que venga con svg y que hayamos aprendido el link que es que va a venir bastante bien entonces abro este archivo y digo bueno no sé me quedo con uno de estos va a quedar con este así que cojo este lo voy a exportar le digo exportar imagen png de la selección 257 por 203 vale me lo exportó como me lo exportó en el disco duro fe en camps en box multi jugador ahí va pues me creó una carpeta nueva llamada img y lo voy a llamar de momento jugador vamos a jugar todos con este jugador por tanto bueno tampoco vendría mal por cierto que esto qué es por cierto que viniera aquí hay va y exportar tampoco vendría mal que abriera esto con el gimp porque ahora mismo esta imagen no es cuadrada y a mí me gustaría que fuera cuadrada así que mira me cojo esta imagen tamaño del lienzo pues le digo 25 no imagen escalar la imagen 256 y ahora imagen tamaño del lienzo 256 por 256 centramos redimensionamos tengo ya un sprays cuadrado así que lo exportó sobreescribir en y ahora lo que voy a hacer va a ser tan sencillo como simplemente entrar en el código y en servidor pues el lugar además de decir que quiero el ron jugador pues digo quiero img src entrar en la carpeta img y jugador punto qué es lo que hace esto creo que es lo que hace esto es lo que hace esto es meter como cuatro jugadores a las bolas claro bien además atención al momento y número que no me dejáis entonces digo jugador img es decir la imagen que está contenida dentro del jugador quiero que tenga un wifi del 100% ahora sí tenemos que recargar porque esta es la parte de cliente con lo cual hay fijaos que aparecen personajillos dejadme que además haga lo siguiente en body voy a decir para bing 0 píxeles martín 0 píxeles y overflow giren si ahora recargas la pantalla no tendréis ya el problema que teníamos antes quito la bolita background none y border 0 píxeles para quitar la bolita de color gris quedarnos sólo con el personaje y ahora lo que necesito y aquí es cuando la cosa se va a complicar un poquito ahora lo que necesito es que el personaje vaya girando sé según la dirección que tenga es decir el personaje siempre está mirando hacia abajo con lo cual si yo estoy caminando hacia la derecha pues creo que el personaje mira hacia la derecha y claro ahora mismo y esto es un clásico lo que estoy haciendo con los ejercicios enseñaros lo que os va a pasar en el desarrollo de un juego es un clásico de que diseñas la base de datos y por mucho que planifique es al principio siempre luego salen necesidades que no había través al principio en este caso yo había planificado la base de datos con la premisa de que quería jugador posición y 15% y digo ostras además querría tener otro parámetro más que fuera el ángulo que fuera digamos hacia dónde está mirando el personaje así que bueno en este caso lo que tengo que hacer es modificar la tabla y al modificar la tabla voy a pinchar este signo más que me sirve para añadir una nueva columna así que pulso el signo más digo dirección es un entero vale no es un entero es un texto entonces 255 esto no debería hacer falta pero bueno de hecho igual me da un problema de null si no entonces no guardo y ya está bien por tanto ahora tengo direcciones en los personajes y lo que quiero por tanto ojo cuidado ahora tengo que actualizar tanto el servidor como el guardador realmente el guardador porque no puedo insertar fijaos que estoy insertando una dos y tres elementos en una tabla que tiene cuatro celdas que creéis que va a pasar supongo que sí que pasaba deja de verlo porque por mucho que le haya dicho no fíjate que recargo pulso así y no está pasando nada porque aunque le digan un sí yo le estoy diciendo que le voy a meter tres valores y estoy cerrando el paréntesis el programa de espera que van a ver tres columnas y hay cuatro es decir hay cuatro columnas me de tres no funciona 95 no funciona si no metes 4 en sectas no funciona la inserción pero no pasa nada porque yo ahora vengo aquí y digo que digo aquí y digo coma jett movimiento por tanto si todo va bien vamos a verlo no lo sé sin movimiento parece que es movimiento por ahí entonces hago así fíjate que hago así y la base de datos me dice abajo de hecho vale tengo dos porque ya son dos pero ahora algo así pero ahora hago así vale abajo vamos a ver qué pasa interesante ahora voy hacia arriba recargo y no está cargando claro muy bien porque esto es cuando se inserta por primera vez claro pero después lo que tengo que hacer es saber efectivamente se os x es igual a eso pos y es igual a eso y digo dirección es igual no rompas el ordenador a jet movimiento actualizó el movimiento una cosa es insertar el movimiento otra cosa es actualizar el movimiento por tanto algo así y ahora me dice derecha algo así y ahora me dice izquierda y algo así y ahora me dice arriba es decir estoy actualizando también la dirección del personaje lo cual quiere decir como os podéis imaginar que ahora cuando cargo del servidor lo que voy a hacer es girar el dip en base a la dirección entonces voy a hacer lo siguiente vamos a verlo grado en segundo jugador vale esto lo voy a bajar porque ya tengo aquí unos cuantos propiedades y voy a decir background sí transformar y cines con recordaba vale transform origin 50% 50% entonces con esto lo que voy a hacer es lo siguiente para probar esto de vista todos en chrome por cierto para esta siguiente prueba que voy a hacer entonces cuando saco el jugador voy a decirle cierro el eco abro un eco para aquí en medio decirle row dirección es igual abajo en ese caso digo echo importante poner dos espacios adentro y digo style webkit transform tape 0 grados si la dirección es izquierda en este caso 90 grados entonces estoy haciendo al revés ahora lo veremos si la dirección es derecha en ese caso menos 90 grados y la dirección es arriba lo que hago es que lo giró 180 grados si todo va bien no lo sé punto y coma empiezo aquí a caballo si no hay problema lo que me falta es esto dos veces la etiqueta style sí porque esto es un estilo en línea el otro es un estilo interno no es que sea muy limpio te lo voy a reconocer pero se puede algo así vale ahora déjame ver una cosita vamos a ver inspeccionó vale vale lo que tenía aquí en posición vaya si no quería que decía es el estilo arriba y el estilo abajo pero no lo hice ese estilo aquí y eso no se debe porque sólo cuenta el primero así que no pasa nada no pasó nada porque hago lo siguiente espera que no voy a decir realmente por tanto pero para ello se está pero éxito y quito este estilo vamos a ver las comidas dobles interesante muy interesante cuando se debe encerrar aquí y aquí veámoslo ahora parece que sí fijaos por tanto como ahora el personaje de hecho había acertado con el ángulo de casualidad fijaos ahora como el personaje va girando en cada posición es porque lo vais me muera tu rollo no pasa nada mirad un momento en la pantalla hay que dejar de jugar para poder jugar nos vale si vamos a hacer eso me ha gustado más entonces lo que voy a hacer es voy a devolver aquí está el es igual a comillas entonces con esas comillas lo que voy a hacer es devolver por aquí el posición relativa a esto que tenemos aquí con un punto y coma para no tener que repetir cuatro veces lo mismo la idea de no repetir cuatro veces lo mismo siempre es buena entonces hago así quito estas comillas y dejo las comillas para lo último vamos a verlo no es correcto este si este punto es de css y este punto de php vamos a ver lo vamos a ver lo estilo yo creo que sí vamos a verlo vale no está girando tengo que ayudar por su puesto la etiqueta está entonces quito esto de aquí quito esto de aquí quito esto de aquí quito esto de aquí guardamos recargamos y ahora sí muy bien tenemos por ahí que nuestros personajes van dejando los goya en la pantalla sí a veces pasa tenemos que evitar eso y tienes el doble de bueno es que ahora vamos hablar de familiar yo en este caso quiero simular como una sombra que hay por debajo de estos personajes así que lo que voy a hacer va a ser lo siguiente mira quiero duplicar este personaje quiero darle la vuelta a este personaje hay un pequeño problema ahora veréis y es que digo img src class jugador y mejor jugador y dibujo class sombra lo que estoy haciendo es duplicar no perdona al revés la sombra debería ser el de arriba un momentito por favor qué prisas entonces lo que voy a hacer lo que voy a hacer es que todo aquello que sea la sombra vamos a ver si perfecto mirad todo aquello que sea el jugador sombra va a tener posición absoluta recargo y ahora salvo un duplicado que por allí todos están juntos pero voy a decirle top 5 píxeles y ahora hay 2 lo divertido debería estar por bajo así que lo divertido es que voy a webkit filters aquí está y digo pues mira quiero que sea grace que él y quiero que sea a blur y un poquito para terminar ya que estás no cuesta nada una cosa así que me cargo esto y digo la sombra tiene que tener ese parámetro y esto que es lo que va a hacer pues que automáticamente hemos generado una sombra por debajo del personaje pero lo que quiero que veáis me prendo un blues de 2 lo que quiero que veáis es que la sombra se calcula dinámicamente en base al sprite no es una sombra arrojada súper realista pero da bastante el pego solo mover personajes en la pantalla pues quieras que no es un poquillo como aburrido y tal con lo cual yo lo que quiero es que estos personajes sean capaces de interactuar con el entorno y cuando digo interactuar con el entorno quiero decir que por ejemplo contribuyan a construir algo es decir que yo me estoy moviendo con las teclas de dirección pero yo diga así pulsó la tecla por ejemplo espaciadora no sé si teníamos problemas con las pasadoras creo que si yo cojo la tecla espaciadora que yo crea algo que yo suelte un bloque en la pantalla lo que sea algo para que no sea solo caminar sino que los personajes hagan algo construyan a crear yo quiero hacer un juego constructivo es que sois destructivos soy destructores vaya es casi larga no están pensando que me están rodeando en plan barrio el chongo sabes bien en fin esto lo que tiene el ser humano entonces lo que voy a hacer ahora mirad es que voy a preparar este juego y voy a prepararlo diciendo que creo una tabla que no es de posiciones porque posiciones es para posiciones de jugadores voy a quitar unos duplicados voy a tener que hacer de administrador de videojuego y eliminó por aquí y ahora atención tengo que crear una nueva tabla crear tabla donde la voy a llamar por ejemplo bloques entonces en el bloque vamos a anticipar la necesidad de que quizás podamos necesitar meter varios bloques así que tipo voy a poner 2 x 2 y sabes que voy a poner también rotación por si acaso así que tipo es un texto posición y es un entero rotación pues también es un entero por ejemplo así que es 25 525 52 55 más que de sobra pero en fin y ya así que guardo y tengo una tabla llamada bloques así que lo que tengo que hacer ahora atención todos a la pantalla como os podéis imaginar es que me voy a index.php y digo si la tecla que tocas es la barra espaciadora vaya pues vamos a verlo digo alert tocado entonces recargo el juego explota con el error con su el error será por esto y el consell errores por esto es el ese es él error recargo bien ahí está y lo que hago ahora es que pulsó la barra espaciadora vaya es verdad qué raro vale pues bueno no pasa nada si recargamos recargando pero aún así no sé por qué tocado así que recargo de la consola tocado en esa tecla correctamente así que por tanto voy a decir que en enviado por punto load y atención en enviado por punto loud y digo dijo no mentiré y digo crea bloque php dónde 2x no realmente donde el jugador es igual a esto de allí donde el jugador es aquí donde el jugador es igual a estos de aquí por tanto ahora fijaos que yo por ejemplo game art brick block voy a un bloque de ladrillos y yo digo me lo guardo en fe en champ en tesoros el mundo el jugador enrique la brillos y ahora aquí manualmente pongo bloques nuevo registro tipo ladrillos en 50 y 0 con esto por tanto lo que quiero he metido un ladrillo manualmente ahora en la base de datos lo que quiere es que el servidor no solo me devuelva los tips del jugador devuelvo las posiciones de los jugadores sino que también devuelvo las posiciones de los bloques creados así que pero quito esto no va aquí select from que from bloques resultó query igual es decir esta estructura de aquí este conjunto de líneas está devolver los bloques y esta de aquí abajo para devolver los jugadores así que ahora digo para cada uno de ellos me copió esto div class bloque y de es igual a nada posición es igual a pose y posee x con lo cual y ahora digo img src img ladrillos y punto png vamos a verlo claro cuidado no te raro tablero bloque hay un bloque de hecho que lo está creando en esa posición pero que interesante el src es curioso no pone la barra lo cual es muy curioso bueno sí cuidado aquí falta unas comillas dobles y voy a decirle por tanto que todo aquello que sea bloque empecé s todo aquello que sea bloque que tenga una wii de 31 hi de 30 me falta un punto y todo aquello que sea lo que img que tenga wifi de 100% y que tenga height de 100% para qué pues que para el bloque tenga esa dimensión bien pues ahora lo que quiero por tanto es permitir la posibilidad de que cada vez que el jugador haga un toque pues cree un bloque para ello lo que voy a hacer el siguiente ejercicio como os podéis imaginar es crear el archivo crea bloque php y ahora por último comillas por último voy a poner crea bloque php entonces para ello lo que hago es que crea bloque php y crea bloque php lo que hace es realmente algo parecido a guardador madre mía ha guardado copio el código de guardador lo pego él crea bloque y lo que hago por tanto ahora es decir bueno vamos a ver select el from posiciones vale donde jugador es igual a esto de aquí bien lo primero que quiero hacer es averiguar dónde está el jugador que está creando el bloque y para ello era la pantalla para ello jugador vale esto de aquí el jugador tiene que existir por tanto esto lo puedo eliminar no puede ser que no exista un jugador tiene que existir entonces le digo existe esto bueno podría ahorrar vale detecto cuál es el movimiento enviado esto me sobra ahora mismo y lo que hago con crea bloque no es una app de si no es un insert así que insert into bloques values y digo y vigo ladrillos hoy de momento vais a ser todos ladrillos 2x coma 2 y 0 porque de momento no quiero rotación claro realmente justo debajo si todo va bien justo debajo entonces para ello recargo no sé vamos a probarlo a ver encima esperas pero esperas ese momento entonces lo que hago ahora es que el servidor claro ese es el problema posición relativa no es en absoluto claro que por ahí hacer maldades ahora sí que lo crea abajo vale e también en esto quedando frito novella que buscáis hacer el mal jajaja muy bien pero el tema está sin control al reset vale porque si os pongo un reset y claro nos empecemos a eliminar nosotros bien yo soy el rey ser no no 80 ciento exacto entonces vamos a ver me voy a multijugador y lo que hago es que a ver si tengo aquí vale si tengo en bloques tengo vaciar vale por tanto ahora fijaos cómo desaparecen los bloques pues vamos a ver tú qué usuario eres menos situación de los días estás arriba así que tienes que bajar ya estás bajando ya te veo bajando ya tenemos bajando y ahí estás pues muy bien ya tenemos un juego multijugador en el cual podemos jugar a crear cosas ya partir de aquí una vez que empiezo a trabajar si quiere colisión con los elementos yo simplemente lo que tengo que hacer es evaluar cuántos elementos hay en la base de datos o cuántos elementos hay en el tablero lo podéis mirar donde sea pero en uno de los dos sitios hay que mirar lo que quiero decir con esto bueno pues que por ejemplo a ti te enseñado en el cliente y en el cliente sería algo así en el cliente yo vengo por aquí y digo voy a ejecutar cuenta bloques dentro de dos segundos y atención todos a la pantalla porque la función cuenta bloques va a usar un elemento mágico que se llama y entonces lo que hago es que digo dime de todos los bloques que hay fíjate que digo contador es igual a cero digo de todos los bloques que hay es decir para cada uno de los bloques ejecutó una función que dice contador más y por tanto al final del todo console log ay contador bloques si ahora guardo y recargo y me voy a la consola dentro de dos segundos la consola me dirá vamos a ver cuenta bloques vamos a ver lo recargo otra vez vale con sólo el punto no hay contador bloques tampoco me devuelve un error function cuenta bloques aclaró temporizador eso con que esté duplicado el temporizador por supuesto que sí entonces espero dos segundos y me dice hay 277 bloques yo que es lo que he hecho pues lo que he hecho es simplemente para cada uno de estos elementos especificar yo ahora podría hacer lo siguiente era function contador + + y digo de este bloque que estoy cogiendo ahora mismo quiero que me digas el top con soul esto coma y eso que hace pues lo que hace es que en dos segundos no solo me dice que hay 237 sino que me devuelve las coordenadas de cada uno de los bloques y si tengo las coordenadas de cada uno de los bloques ya podéis calcular la colisión como queráis por tanto en el lado del cliente esta sería la solución que es que tú ya tienes unos elementos en pantalla y en el lado del cliente lo que vas a hacer es saber qué posición tiene cada uno para cuando muevas el personaje poder detectar la posición del personaje contra la colisión del bloque esta es una manera de hacerlo otra manera de hacerlo y vosotros elegiréis la que más os guste es a cerrar el servidor y decir cuando yo aquí cuando yo ejecuto guardador yo le pregunto es cierto en primer lugar quiero saber la posición de este jugador que tiene inicial existe previamente cuando se crea un nuevo usuario vale entonces digo realmente bueno ahí tendría que hacer pedir todas las posiciones de los bloques y esto se haría con sql select all from bloques y nada y todo lo quiero todo ejecutó el resultado y digo para cada elemento del resultado while road lo que hago es para el bloque actual el jugador está coleccionando pues digo metin row x y digo si es cierto un segundo esto que voy a poner aquí en ese caso todo esto de aquí es decir las actualizaciones de la posición ahora dependen de que exista una colisión les digo sí 2x claro cuidado a ver pero electro font bloques vale ay posee x muy bien pues x bloque y porsche y bloque es el tema pues x del personaje digo sí post x es mayor que posee x bloque y también es cierto que posee x es menor que posee x bloque más 30 y también es cierto es lo mismo de siempre que posee y es menor es mayor que posible llegar lo que y post y es menor que consigue llegar lo que más 30 en ese caso está coleccionando así que sólo ejecutó esto si no está condicionando por tanto guardo recargo ahora me habéis atrapado por ahí en el medio ahora dónde estoy dejadme que borre la base de datos vamos a verlo así que recargo qué pasa aquí claro sí vale a ver número es igual a cero número más y digo sí número es igual a cero en ese caso esto de aquí locklear y pegar o algo así al saber los bloques vale esto es guardador pero qué pasa con crear lo que pues que me he dejado esto a mitad por lo que le estaba explicando vale si yo hago así teóricamente debería empezar a colisionar debería estar pensando con todo es el guardador bueno si no estará por ahí cerca vamos a verlo y coexiste con existe por ahí por alguna parte si posee x es pues x bloque no no claro que sí 2x row es lo que vuelve de la base de datos lo último que he leído esa tabla de bloques el tamaño del tamaño de lo que efectivamente entonces vale algo así pero no lo que es si en principio son correctos vale ahora déjame ejecutar esto bueno pues tengo que ver qué pasa ahí pero vamos a ver si posee x es mayor y os digo tengo que ver qué pasa porque no está condicionando pero básicamente la fórmula es esta si queréis os lo envía al correo electrónico para que la desarrolle pero corrigiendo el error que esté dando este error de que no hay colisión con eso tenéis la colisión en el lado del servidor así que elegir el eje donde la creación del servidor o en el cliente en primer lugar vamos a hablar de un concepto lo voy a explicar la teoría con la base de datos abierta pero vais a ver que precisamente puede estar trabajando con videojuegos pues está explicar que son relaciones en la base de datos va a ser bastante fácil de comprender entonces voy a ir al local host multijugador voy a abrir la base de datos voy a ir a ese kulite 3 me voy a multijugador punto de ve y digamos que en este caso recordamos que tengo hasta ahora dos tablas donde una exposición es que guarda el jugador y otra es el bloques que guarda la posición de los bloques así que la pregunta en definitiva era si yo tengo que poner vida al personaje donde la pongo en la misma tabla o hago otra tabla si yo tengo que darle más propiedades y durante el desarrollo del juego vais a tener que darle multitud de propiedades a un personaje donde guardo las propiedades en una tabla en la misma tabla o en otra tabla diferente entonces esas son relaciones que se pueden dar de 11 se pueden dar de 1 n o se pueden dar de nm en la base de datos entonces lo que voy a explicar es una regla básica para saber y decidir cuándo tengo que hacer otra tabla o cuando puedo operar en la misma tabla son reglas de consejo más que de obligación pero yo os recomiendo que las sigáis entonces la primera regla es una regla de relación que se llama de 1 a 1 vamos a poner ejemplos de esta regla de relación de uno a uno y veréis que es muy fácil de comprender yo te pregunto un personaje cuántas vidas tiene es decir el parámetro de vidas es una columna que se llama vida un personaje tiene una vida no es tan normal que se dé la situación de un personaje tiene la vida y la vida por eso que es un personaje tiene una vive no es otra cosa porque claro es no es vida es energía y de la misma variedad tendría un maná un marcador de maná y un marcador de estamina con lo cual son dos relaciones pero son dos relaciones de uno a uno por tanto siempre que hablemos de que el personaje por ejemplo imagínate lo que se configura es un personaje que es lo que os ha tocado hacer esta semana pues un personaje al que le puedas poner una peluca pues o no peluca o no pelo como los de la xbox tanto cuando otros con figuras tal entonces ahí la idea es ese personaje cuántas pelucas puede tener por solo una porque se le pones otra es que le quitas la anterior con lo cual si estamos hablando de que un personaje una identidad de la base de datos sólo puede tener un elemento del otro lado que nunca mira esta mina humana lo que sea hablamos de una relación de uno a uno y cuando hablamos de una relación de uno a uno estamos hablando de que la información al poner la misma tabla es decir si yo por ejemplo aquí al jugador le quiero poner una que sea vida yo digo para que crear otra tabla diferente que luego las tendría que enlazar cuando simplemente puedo aquí poner una columna llamada vida y va a ser mucho más sencillo que crear otra tabla diferente ahora está prohibido creo todo lo diferente no prohibido no está podéis hacerlo cuando queráis simplemente es que no se recomienda ahora la siguiente relación es la relación de uno and1 n quiere decir que un objeto puede contener múltiples de algo entonces por ejemplo en el caso de los personajes en el caso de los personajes de videojuegos yo digo supongamos que tengo una serie de recolecta bless y hay una serie de recolecta bless que tengo que ir cogiendo a lo largo del juego entonces la pregunta es cuánto recolecta blesa hay pues la respuesta puede ser que desconocidos igual hay mil recolecta bless y digamos congojas 200 ya pasas de nivel claro si puede haber aquí me recomendó mil recolecta bless yo podría la tabla y decir pues nada método otra columna recolecta bleu 1 y otras recolecta bledos y otra recolecta bleu 3 y otros recolecta bleu 4 pero en cuanto empezamos a pensar esto decimos no parece una buena solución porque lo que ocurrirá en este caso es que la tabla crecerá desmesuradamente en horizontal y eso es algo que tampoco queremos así que cuando un personaje tiene una relación con un elemento de 1 a n para recoger recolecta bless para tener diferentes armas para tener imaginamos por ejemplo el minecraft o tienes un montón de objetos que puedes escoger y si tienes un límite pero un límite numérico pero en cuanto tipos de objetos que puedes escoger no te digo que es infinito pero son un montón entonces cuando hablamos de una relación de 1 a n lo que se recomienda es crear otra tabla y aparece el concepto de enlace es decir voy a crear otra tabla crear tabla que va a ser por ejemplo coleccionables en este caso no le pongo idea porque estamos trabajando en ese culito 3 y hablaremos de él y de auto incremental pero lo primero que nos hace falta es saber quién es el jugador quien es el enlace como el lazo yo un registro de esa tabla a la tabla anterior así que digamos que evidentemente en este caso el enlace fácilmente sería el jugador dime de qué jugadores estamos hablando vale por tanto en este caso digo jugador recolectado dime qué es lo que ese jugador ha recolectado y de esta manera por tanto se habrá guardo y tengo un jugador llamado 192 168 126 pues en coleccionables que podría añadir un nuevo registro diciendo que este jugador ha cogido una manzana y este jugador ha cogido una pera y este jugador ha cogido un plátano y de esta manera por tanto damos cuenta como esta tabla va a ir creciendo en vertical por supuesto teniendo un valor en principio único e irrepetible de a qué jugador se está refiriendo esta que en este caso está mostrando la ip como valor temporal ahora veremos que no es un valor muy seguro para trabajar pero es un valor vale para empezar el ejercicio y por tanto se hago el esquema déjame que saque el zoom it si hago el esquema veremos como huevo veremos como lo que acabo de hacer es que básicamente tengo un jugador tengo una tabla de jugadores que contiene varios registros no voy a hacer muchos diagramas de flujo vale pero éste sí que es uno pues que hay que hacer porque es prácticamente obligatorio que es el pequeño diagrama que nos muestra dos tablas dónde en este caso aquí tengo jugadores y aquí tengo coleccionables entonces yo digo el jugador 1 puede tener ese coleccionable y puede tener ese coleccionable y puede tener ese coleccionable el jugador 2 puede tener este coleccionable y puede tener ese coleccionable el jugador 3 puede tener ese coleccionable de aquí por tanto cuando estamos hablando de esto cuando estamos hablando de que un jugador puede tener múltiples elementos hablamos de que los agregamos en dos tablas pero te vuelvo a repetir una vez más esto es obligatorio no es obligatorio lo que os estoy haciendo realmente es contaros veladamente escondida mente y para niños las reglas de la normalización en bases de datos el programa que nos entró así me diréis un qué rollo persona muy rollo y bueno ciertamente lo es vale por tanto lo que voy a hacer a lo largo de las semanas es iros contando las reglas de la organización pero cuando aparezca un problema porque primero quiero que os aparezca el problema para poder entonces dar la resolución no quiero empezar a contaros soluciones antes de que una persona problemas porque tenemos sabréis que os estoy contando bien como te digo por tanto una solución la mejor se suele usar cuando digo yo digo la mejor siempre quiero decir la mejor a menos que esté justificado no usarla porque igual en un caso concreto en un juego concreto me decís no es que prefiero meterlo todo en la misma tabla de la base de datos si lo justificas si todo está justificado todo es perfecto vale entonces mirad cómo sería por ejemplo en posiciones meter aquí los coleccionables es otra solución sería modificar la tabla me creó una casilla más y le digo coleccionables es un texto es null guardo con lo cual ahora en posiciones fijaos que cada uno de los personajes tiene una casilla de coleccionables pero una casilla coleccionables entonces yo podría venir a este personaje número 26 y en coleccionables le podría decir pues tiene la pera coma la manzana coma el plátano como te digo puede ser punto y coma puede ser dos puntos puede ser barra vertical el separador que tú quieras para separar registros puede ser melón puede ser la fruta que tú quieras puede ser fresa así que guardo y fíjate que lo que he hecho realmente con respecto al esquema que os estaba contando antes es que tengo una tabla por aquí esta tabla tiene registros y realmente lo que estoy haciendo es que en un cachito del registro estoy metiendo como otra pequeña tabla estoy metiendo en una casilla que en principio está pensada para poner un pedazo de información pues lo que estoy haciendo es meter un montón de pedazos de información recomendable en líneas generales no posible desde luego que sí esto creo que va a ser lo que hay que sopesar en cada caso es qué es lo que quieres hacer hay que tener en cuenta que si yo hago esto con los coleccionables lo que va a ocurrir es que cuando yo recuperen los coleccionables yo lo que tendré que hacer es recuperar esta fila y entonces ese valor y entonces empezará a partir por lo que tiene coma y entonces meterlo en una matriz y entonces empezará a recogerlo con lo cual me gastaré más esfuerzo sacando la información de esa tabla y recopilando la pero a cambio me ahorraré una tabla en la base de datos por eso yo os digo en líneas generales recomendable pero como todo en la vida cualquier cosa tiene ventajas y desventajas mediante cada caso concreto hay veces que lo recomendable se puede saltar pero insisto si tienes una justificación para ello en la clase de hoy vengo a hablaros de algo un poquito más urgente que es la eficiencia entonces en este caso tenemos ya un juego funcionando mirad los trabajos multijugador pero este juego a ver para re porque no va muy bien a ver si es que lo que sea este juego no es nada eficiente y recordad lo que yo siempre digo y os voy a insistir siempre y es que lo importante es primero que funcione y solo cuando funciona entonces nos preocupamos de que sea eficiente así que me voy a ir a esta ventanita llamada network y veo que la ventanita networks nunca deja de funcionar porque la ventanita network nunca deja de funcionar pues porque evidentemente estamos haciendo un juego que 50 veces por segundo le está pidiendo al servidor dime cuál es la nueva posición de los jugadores cada dos cada tres cada cuatro milisegundos se establece una nueva petición al servidor a partir de ahora por tanto va a ser frecuente que saquemos esta ventanita llamada network que nos dice cuál es el uso de la red que estamos haciendo así que cada vez que se realiza una petición como cuanto escaso ocupa 12 casas lo veis lo tenéis ahí pero claro 12 casas con respecto a tu tarifa plana de móvil cuánto es nada pero es que es 12 casas cada 3 milisegundos eso quiere decir que yo saco la calculadora y digo parto mil entre tres mensaje de 333 así que por 1.2 cash y eso quiere decir que en este juego que hemos desarrollado cada segundo el juego está gastando 400 casas de hecho si saco el administrador de tareas y me voy a red vamos a verlo a rendimiento de la red en el host tendría que meter meno en localhost porque en este caso como soy el mismo no me consumo datos pero claro este juego lleva ahora mismo dos minutos ejecutándose así que dos minutos si son 400 casos por segundo por 120 segundos quiere decir que este juego en dos minutos ha gastado 48.000 cash o si lo divido entre 1024 este juego en dos minutos hasta 46 megas eso quiere decir que el usuario que esté jugando una hora se queda sin tarifa planear el móvil si vamos a ver eso son dos minutos bueno no sé cada uno con respecto al ala de 2 gb es un poco la más común hoy en día pero existe son dos minutos pues lo multiplicó por diez y que son 20 minutos que son 4 mil 68 megas lo multiplicó por 3 que es una hora y es 1 con 5 gigas así que vale esto es un poco pues lo que hay con el juego que hemos desarrollado a continuación vamos a ver cómo optimizarlo este juego ahora mismo tal y como lo tenemos programado voy a hacer esta ventanita para no reírme entonces este juego tal y como te lo tenemos planteado dejadme sacar al heavy y dejadme refrescar el código del juego recordamos que tenemos un archivo index bien no está si html y efectivamente ya no era html sino que era php así que hp docs así que multijugador así que index.php y recordamos que este juego tiene un escenario vacío tiene un tablero y está cargando dentro del loop cada 50 milisegundos el archivo llamado servidor php por su parte el archivo servidor php lo que hace es que cada vez me devuelve esto de aquí cada vez me devuelve todo este bloque de información perdón al bloque no aparte del bloque que también me devuelve el deeb con el jugador me devuelve las dos imágenes la de la imagen original y la sombra y cierra el dip en lo que me estoy gastando realmente la información en lo que me estoy gastando realmente los datos es que primero primera cosa ineficiente 25 veces por segundo se me están volviendo a traer los personajes en pantalla cuando yo digo pero para que me dibujas el personaje del personaje es el mismo sólo quiero que me traigas la posición del personaje no el personaje entero y lo segundo es que fijaos que ahora mismo por ejemplo ahora mismo los personajes vamos a ver dejar de quemar hacia la base de datos es el colista y multijugador y déjame que en posiciones en vaciar si así y en bloques vaciar así que algo así no sabe ningún personaje hablemos por qué no existen registros ahora vemos bien la cuestión está en que si por ejemplo yo tengo un set de personajes que no se mueven yo lo que estoy haciendo es que recuperó las posiciones de los personajes aunque no se muevan igual todo el mundo está parado la gente no se mueve 25 veces por segundo sino que se mueve una vez cada segundo una vez cada dos yo le estoy pidiendo información x veces por segundo la base de datos y no es solo que me está devolviendo este cacharro de aquí es que además me lo está devolviendo incluso cuando no hay variaciones en la posición de la gente lo que necesito por tanto es gestionar dos cosas una que no realice tantas peticiones por segundo y los que sólo realice peticiones cuando más que no refieran a paciente por segundo que las realice sólo cuando sea necesario pero claro cómo saber cuándo es necesario y dos que no me devuelva todo sino que sólo me devuelva la posición porque yo ya tenga los personajes cargados al menos una vez en la base de datos voy a desactivar un momento la colisión bien así que aguardo del momento recargo vamos a ver la posición con jugador 1 y vamos a verlo al principio he desactivado la colisión vale pues desactivo esto por aquí pues x bloque de entrada de momento ya funciona y ahora me preocuparé por la colisión entonces fijaos que yo tengo un personaje que se estaba moviendo por pantalla se os queréis conectar efe mb ipconfig es el 26 681 26 y mirada 302 a la pantalla fijaos cómo podemos ser varios personajes moviéndonos pero fijaos atención ahora estamos todos quietos somos cuatro de repente parece cinco no pasa nada no soy yo también creo porque está local host entonces inspeccionó y veo que aunque estemos todos quietos en la pantalla seguimos enviando información seguimos recibiendo información así que lo primero que vamos a hacer hoy es implementar un sistema de mensajería no mensajería entendida como un correo electrónico sino como un sistema de comunicarme con la base de datos para preguntarle a la base de datos si realmente es necesario que me devuelva la información así que voy a hacer lo siguiente mira lo que voy a hacer es que ahora sí voy a modificar la tabla de posiciones déjame que elimine coleccionables que de momento no lo voy a usar aquí está me voy a posiciones voy a modificar la tabla y lo que quiero saber creando un campo más es cuál es la fecha cuál es el momento cuál es el segundo en el que se produce esa ese movimiento por tanto esto es un interés le voy a poner 255 aunque eso da igual le doy a guardar y ahora por supuesto lo que tendría que hacer para que esto funcione mínimamente así la tabla bien de momento aquí funciona lo que voy a hacer es simplemente trabajar con el guardador así que en el guardador voy a decirle que update posiciones posición lo que sea y voy a decir fecha es igual no es con comillas simple adif y hace lo siguiente y hace lo siguiente yo era me muevo y ahora me muevo y si me voy a bloques comprobaremos como este jugador tiene esa fecha y bueno nosotros también voy a eliminar el local host como verás nosotros y si os movéis me voy ahora a la tabla y comprobamos como ahora cada uno de nosotros tiene una fecha la fecha diréis está en un formato un poco raro la fecha está en el formato utc y esa fecha básicamente mirad cómo si os lo digo lo vais a creer me voy a la documentación de php de ahí me voy a la primera de todas de arriba que es nate php que es el manejo de fechas en php está muy bien y tengo aquí una tablita fantástica que me dice a nominada a nuestra primera vale que me dice cada una de las letritas que puedo poner a que corresponde entonces me voy a buscar la u hay hubiera el amposta al final y la uv son los segundos que ha pasado desde la época y unix y la época iunics empieza el jueves 1 de enero de 1970 a las 12 de la noche así que en definitiva lo que estamos haciendo es una fecha un poco friki de hecho en cierta manera es una religión entonces la idea aquí es que es una manera muy friki pero muy limpia de introducir una fecha en la base de datos es decir no tengo que empezar a crear tablas para poner año mes vía hora minuto segundo no tengo que poner una un campo donde ponga año que yo un mes y un día y luego empieza a separar por los guiones empieza a contar día por sesenta meses por sesenta hora por sesenta para averiguar algo sino que es simplemente un número que te dice los segundos que han pasado desde el 1 de enero de 1970 entonces esto como vais a ver fijaos me permite saber quién es la última persona que hizo un movimiento en pantalla por tanto este contador lo que me va a hacer es lo siguiente yo voy a mover fichas en pantalla y lo que voy a hacer es quedarme con la con el último movimiento que hubo en la pantalla la idea es después de ese movimiento se ha hecho alguno más si la respuesta es que sí yo vuelvo a la base de datos y digo mira la última que comprobé el último movimiento se había hecho en este segundo alguien ha hecho un nuevo movimiento si a pues entonces traémelo no pues no me traigáis la información porque para que me va a esperar la información si hemos comprobado que lo que yo tengo el tablero es lo mismo que teníamos en la base de datos si es lo mismo para eso no me entregas novedades porque no hay novedades ahora que tú me dices no es que alguien ha movido ficha pues entonces dame las fichas entonces lo que quiero vale vamos allá vamos a ver efectivamente en php por defecto el php trabaja en segundos no en milisegundos pero claro qué pasaría entonces en la base de datos porque tengo dos usuarios que teóricamente se han movido en el mismo segundo con lo cual diríamos que el margen de precisión que tengo es de un segundo eso en la práctica quiere decir que si un usuario se mueve y otro usuario se mueve 50 milisegundos después técnicamente se han movido pero la base de datos mediría no hay cambios no hay novedades cuando yo diría sí que hay novedades entonces yo probablemente lo que quiero no es sólo trabajar con segundos sino que quiero trabajar también con milisegundos así que me voy a ir aquí y voy a haber php eid mil seconds así que encuentro micro time vamos a verlo está bien hay micro time entonces esto es la fecha y unix actual con microsegundos así que me vengo por aquí me vengo por aquí me vengo por aquí vamos a ver time start micro time out espero que no pero va a ser que sí ahí está te lo digo porque es que micro time flow es un micro time con de coma flotante por tanto tendrá más procesión todavía brutal sí igual con php quiero saber el millonésimo del segundo con el cual un átomo de hidrógeno colisiona con otro de oxígeno pero no es el caso vale así que lo que voy a hacer es usar micro time por tanto aquí donde pone de it y voy a poner micro time refrescamos un poco el juego mover un poco el juego no se mueve si no se mueve si no se mueve probablemente es porque esto está dando error vamos a verlo voy a poner micro time cloud pero también es posible si no aparte es otra pero aparte de esto es que no está refrescando nada en pantalla esto qué compatibilidad tiene bueno php 4 php 5 y 36 vale micro time por esto también es igual time voy a poner a micro time y ahí pongo time a ver si no quiere que se le introduzcan como es una función sabes lo de enganchar una función ahí en el medio igual no le ha gustado mucho vamos a verlo lo que es vamos a ir a igual sigue igual y si yo ahora lo que hago es ejecutar directamente guardador php eso es lo que ocurre bueno pues sí pero esto sin terror en 57 el día 57 y un error y el error es está bien pero el caso es que si quito esto fecha es igual a nada guardo recargo dice que funcionara pero si pongo fecha es igual a time en ese caso me dice que no es posible preparar este statement de hecho cerca de 14 interesante así que voy a hacer lo siguiente pero tan recargo bien y el times estoy aquí por tanto yo lo había puesto como un íntegro ahí lo tenemos esto es la fecha esto es el entero con lo cual yo lo que quiero es que madre mía que esto quede mal formateado viene vamos a verlo pues hago creo la función micro time cloud time es igual a micro time float voy a devolverlo ahora en pantalla ahora sí pero cuidado porque esto es un número con decimales por eso yo lo que voy a hacer en este caso es multiplicarlo por 10 así que también multiplicarlo por 1000 por mil y así me quito los decimales bien realmente no por mil no será por 10.000 vale con lo cual no si me da igual porque ese es el eco time es aquí abajo donde lo estoy multiplicando por 10.000 es directamente en la base de datos así que le doy a guardado ahora sigo guardando pero atención todos a la base de datos como ahora la precisión de la base de datos es cuatro dígitos mayor ahora y por tanto eso quiere decir que ahora las posibilidades de colisión son mil veces menores y aparte de que son mil veces menores pues bueno el tiempo en el que podrían coincidir es un milisegundo con lo cual de goiás y si mi margen de error a horas de un milisegundo pues ciertamente me da igual muy bien el hecho de que hayas encontrado la minúscula vamos a verla estaba aquí microsegundos porque entonces igual lo que puedo hacer es que le digo day en mayúsculas encadenado con beit o minúsculas si son milisegundos está añadido en php 522 mientras que el micro time es compatible incluso con php 4 pero bueno teóricamente suponemos que ya no vais a encontrar ningún servidor que tenga php 522 php 5 2 es de principio de 2011 con lo cual ya no deberíais encontrarlo entonces recargamos y fijaos que tenemos lo mismo en la pantalla con microsegundos vale así es vale pues mover nuestros personajes al barça de actos incorrectos posiciones muchos ceros pues nada esto debe ser que en el local hostel sean no tengo activados los milisegundos los microsegundos con lo cual lo dejó como estaba y trabajamos así que recargar moveros y comprobamos cómo tenemos milisegundos y por tanto así trabajaremos más cómodos este personaje que no se mueve es el de álex que se va a hacer los demás y que se mueve bien por tanto ahora ya tenemos una columna para mensajería dentro de la tabla con lo cual nos hace falta esa estructura de control con la cual podemos comparar si la última posición conocida en la base de datos es igual a la que ya teníamos o es nueva o ha cambiado ahora mismo vemos por aquí que lo de micro time pone que tiene compatibilidad con php 5 con php 7 con lo que sea pero como un saber la versión de php que nosotros tenemos ahora mismo y que estamos ejecutando bueno pues hay una función entonces la vimos el primer día pero bueno hay una función que se escribe de la siguiente manera voy a hacer un nuevo archivo este archivo se puede llamar como queráis y lo ve de mar php y lo que voy a hacer simplemente vais a alucinar con lo que voy a hacer voy a decir php info paréntesis porque es una función punto en coma y qué diríais que hace esa función pues esa función ahí donde la veis es chiquita pero matona porque hace php y hace eso saca eso entonces el php info lo que hace es sacarme cuál es el estado de mi servidor php en este momento y gracias al php info yo puedo saber por ejemplo que ahora mismo en este campo estamos usando la versión php 5 614 el bild fue el 30 de septiembre que el compilador fue visual de 2012 puedo saber una imagen los módulos que tengo instalados quitan puedo saber todo lo que tengo instalado las librerías de compresión la librería de calendario lo que tengo en el núcleo de php en la librería de codificación la librería de fechas la librería dom la librería exit para fotografías la librería ftp para conectarme la librería gv que ya veremos para generar gráficos en el servidor librería la librería jason la librería xml es decir la librería mysql que es lo que lleva por supuesto está la de sécurité por aquí hay ese kulite que es lo que lleva concretamente este servidor php insisto una vez más que nosotros ahora mismo lo que hemos hecho es instalar el samp y olvidarnos y esto es lo que quiero haber hecho hasta ahora pero al final del sunp es como un servidor a la carta y se le pueden quitar y se le pueden poner un montón de componentes evidentemente no quiero liarnos con esto ahora porque esto es irrelevante de qué sirve saber configurar un servidor en php si no sabes programar en php pues primero preocuparemos preocupémonos de programar en php y luego nos preocuparemos de saber que le puedo poner y que le puedo quitar a un servidor php pero que sepáis en definitiva que esta función php info si en el momento de decir ostras yo estoy trabajando con php 5 con php 4 con php 7 pues ponéis php info y te vomita como podéis ver toda la información del servidor bien ahora lo que voy a hacer por tanto va a ser lo siguiente mira en primer lugar me voy a crear un archivo por aquí me voy a crear un bip por aquí en el php llamado div tiempo este dip tiempo tendrá el siguiente estilo tiempo tendrá un sitio en absoluto wef 200 píxeles height 20 píxeles 10 píxeles top así que siempre y top 10 píxeles y border de un píxel entonces guarde recargo y el tiempo estará por ahí un píxel solid black y ahí está el tiempo de momento el tiempo no tiene nada no tiene mucho pero yo ahora voy a decir lo siguiente vengo a multijugador creo un documento llamado dime tiempo php así que lo abro con un php y digo dime tiempo punto php hace una cosa muy sencilla que es la siguiente me conecto a la base de datos le pido select all from posiciones order by fecha ordena melo por fecha descendiente de mayor a menor límite 1 qué quiere decir esto sácame todo lo que tengo en posiciones ordena melo por fecha sobre tiempo quitando al vale ordenó por fecha de mayor a menor y limite 1 me quedo con esto de aquí si queréis mirar lo pruebo a ejecutar lo que hace es que comandó sql ejecutó y lo que hace es que me devuelve un único registro límite uno es de lo que te dé quiero que me muestre el primero entonces lo que hago con esto es averiguar cuál es la última fecha así que atención lo que hago ahora es que en la pantalla digo lo siguiente vamos a verlo aquí así que un segundo pongo el wild realmente en este caso como es un solo elemento no hace falta al igual como comentamos otro día y digo roe cuidado porque me diréis que tengo allí una llave y digo row fecha quiero que me digas la fecha así que vamos a verlo eco road fecha punto y coma y si todo va bien está bien recargo así espera claro pero yo no he dicho esto quien lo ejecuta cuando lo ejecuta esto se ejecuta en el loop entonces le digo vamos a ver en el grupo fiesta y digo en cómo se llama este elemento en tiempo punto loud dime tiempo punto php así que guardo y recargo y ahora bien cuidado línea 5 ahí me sobra un paréntesis vale vamos a verlo no me da tiempo el corro fecha con fecha me debería estar dando tiempo no pasa realmente en wilde y así me aseguró no me devuelves nada voy a quitar los resultados and i find variable resulta entonces resulta es vale me falta el este le falta la ejecución en la base de datos mientras hacer eso por tanto podemos comprobar que si ahora os movéis veis cómo va cambiando el último tiempo cierto bueno pues yo lo que voy a hacer ahora mira es qué voy a usar ese marcador de tiempo para que hp diga lo siguiente atención me voy al loop y digo lo siguiente primero atención mirad me deja tocar allí primero lee el último tiempo entonces digo bar tiempo inicial es igual a tiempo punto texto lm lo que pone antes de tocar nada y ahora digo lo siguiente ahora carga me el tiempo y ahora digo para tiempo final es igual a tiempo punto texto voy a bajar un poquito el loop voy a ponerlo a 200 así que yo ahora digo lo siguiente tiempo inicial es igual a tiempo final en ese caso digo console punto log nadie se ha movido en caso contrario en caso de que haya alguna variación con soul punto love alguien se ha movido por tanto guardo recargo y digo nadie se ha movido nadie se ha movido nadie se ha movido pero si yo ahora toco vamos a verlo eso va variando vale nadie se ha movido vale vamos a ver qué pasa si tiempo inicial es igual a tiempo final eso parece me estaban todo el rato el mismo tiempo nadie se ha movido nadie se ha movido vale tengo que usar una cosa que se llama el callback entonces jquery load callback el callback es que esto no se ejecute hasta que esto no ha recibido los datos dejadme un segundo se trata completa function lenguage perforando eso es lo que quiero así que digo loud coma function y digo tiempo final es eso de ahí cuidado esto quiere decir que tiempo inicial y tiempo final veis que está encapsulado dentro de una función pues tengo bar tiempo inicial es igual a cero bar tiempo final es igual a 0 tengo que sacar para que no haya problemas porque este esté englobado dentro de una función así que si hay suerte ahora nadie se ha movido nadie se ha movido lo cual me extraña mucho vale voy a decir lo siguiente con soul punto no tiempo inicial más tiempo inicial vuelve voy coma tiempo final vamos a ver sí claro voy a poner cada dos segundos bien vamos a verlo está cogiendo el mismo momento con lo cual sí que se producen cambios pero no estoy siendo capaz de leerlos voy a darle un pequeño delay como diciéndole tómate tu tiempo sep time out como 200 recargado vale me está leyendo el mismo tiempo lo cual evidentemente no debe ser para mostrarle al contrario acepta y mount este es el que se va a ejecutar más adelante esto se ejecutan 200 milisegundos vamos a ver aquí evidentemente hay un error bien ahora soy bien luego esto por aquí bien al ahora si hay uno que no vale pues tenemos que buscar algún otro método de leer el tiempo voy a quitar esto porque de alguna manera sí entonces la idea si quieres pongo aquí es que en tiempo inicial leo lo que había recargo con el nuevo tiempo y tiempo final es igual a tiempo punto texto es decir léeme el nuevo tiempo sin embargo el problema es que siempre dice que nadie se ha movido está cogiendo la misma hora ahí tenemos que ver porque si yo le digo coge la antigua renueva la y coge la nueva pues las dos son iguales cuando no debería ser cuando hay movimiento lo que voy a hacer es que esta carga no se ejecute 25 veces por segundo sino que se ejecute cuando yo hago clic en una tecla entonces cuando yo hago clic en una tecla dejadme primero que compruebe que funciona donde estoy a ver bien entonces me vengo aquí y digo tiempo inicial es igual lo corto a esto tiempo tiene un tiempo final es más esto aquí y esto aquí bueno primero dame el tiempo luego guarda el movimiento y dime el último tiempo así que ahora tiempo inicial tiempo final vale vamos a ver la consola vale la consolidación alguien se ha movido alguien se ha movido soy pero cuidado porque ahora se queda interesante vamos a verlo nadie se ha movido pero en cuanto algo así dice alguien se ha movido y sin embargo tiempo inicial es igual a esto tiempo final es igual a esto otro bien bien en este caso lo que voy a hacer es decirle al final fíjate lo que voy a hacer que super trampa voy a hacer tiempo inicial así que guardo y recargo y ahora dice alguien se ha movido pero vuelve otra vez a tiempo inicial y peta muy bien vale muy bien ese tiempo inicial lo tengo que poner claro aquí un segundo alguien se ha movido ahora cuando muevo pone alguien se ha movido y luego nadie se ha movido ahora moveremos otros modelos uno de vosotros hacia arriba menos hacia arriba si se dice ser claro no no recarga bueno claro ahora si es que hay un problema y es que el problema es que yo estoy ejecutando esta comprobación pero estoy ejecutando esta comparación sólo cuando yo puso una tecla no cuando nosotros cada uno sí no pero cada uno comprueba la suya quiero decir que si vosotros sacáis la consola exacto con lo cual bueno estamos ahí cerca de la solución pero lo que tenemos que hacer es meterlo en el loop para que se ejecute aunque yo no pulse ninguna tecla la idea aquí es que yo lo que acabo de hacer es una estructura de control ahí está vale con la cual lo que hago es comprobar cuál es el tiempo inicial y cuál es el tiempo final cuando yo pulso una tecla pero cuando yo pues una tecla eso quiere decir que si vosotros pulsáis teclas como yo he pulsado una tecla no me entero con lo cual este sistema únicamente le está haciendo preguntas a la base de datos cuando yo pulso una tecla pero debe hacer preguntas cuando alguien pulsa una tecla vale por tanto bueno el sistema más o menos empieza a estar pero todavía no vale por tanto lo que tengo que hacer es finalmente bajarlo sea como sea el control de cambios tiene que estar aquí para comprobar los cambios de todos entonces lo que ocurre en este caso es que tiempo inicial lo meto aquí esto lo dejo igual esto es lo que cargo por aquí madre mía creo que lo cortado correcto y todo dame tiempo finales igual el tiempo textos es como tenemos un momento con lo cual evidentemente va a fallar pero sí lo sé bien hay un error ahí hablé pero vamos a seguirle dando vueltas a este código hasta que lo consigamos ahora entraremos en el descanso pero tranquilos porque mañana por la mañana esto quedará solucionado vive otra manera de trabajar podría ser déjame que quite esto el documento podría ser hacer esa comparación en el servidor y por qué no mira si yo me voy al network y compruebo que estoy gastando me x kilobytes cada segundo pues yo puedo ir al servidor moment in 90 yo puedo ir al servidor y este eco no puedo quitar cuanto se transfiere ahora al haber quitado eso se transfieren 200 y pico bytes de hecho bloques tampoco tendrían por qué haber vale digamos que es transfieren bytes si yo activo esto entonces es cuando se pasa a transferir uno como un cast lo veis transfiere cuatro veces más cuando es que dice que irá mi tiempo es dame tiempo lo voy a quitar un segundo atención todos dame tiempo dónde estás dame tiempo dime tiempo hay un log por aquí tiene tiempo para la he comentado así que recargo el servidor ya había recargado entonces me voy a servidor y ahora insisto vuelvo a matear esto recargo y fijaos cómo pasa de darme nada prácticamente 253 bytes a darme no sé cuántos kilobytes el problema está en que no esto no se debe hacer en el servidor estoy pensando sino que se debe hacer en el cliente porque pues porque si tú al final supongamos que le dices al servidor el servidor hay algo nuevo el servidor que te diría que diga lo que te diga te va a devolver información es decir yo lo que quiero del servidor es que me ve simplemente un sí o un no por qué supongamos que era una estructura de control en el cual digo servidor hay algo nuevo si el servidor me dice que no que voy a hacer no dibujar sino dibujo no dibujo nada en la pantalla entonces eso tampoco me ayudaría así que la idea es buena la de preguntar en el servidor pero no otra cosa que puedo hacer otra cosa es la siguiente vamos a ver mira le digo lo siguiente estoy en index me creo una etiqueta viviré renueva entonces vale dime tiempo está funcionando no tiempo lado esto fuera recargo y me da el tiempo así que lo que voy a hacer ahora es que le digo lo siguiente en renueva punto loud y le digo renueva php donde tiempo es igual a más tiempo punto texto es decir me voy a renueva php le pido el tiempo en la pantalla y compruebo si el tiempo es igual al que tengo así que por tanto me voy a multijugador me voy a renueva php y en renueva php voy a hacer esto selecciona todo de posiciones menos ordenadas por fecha y le digo huguet get que diet tiempo qué tiempo es igual arroz fecha en ese caso eco no en caso contrario eco sí comprobamos el funcionamiento claro yo dije no vale fijaos y voy tocando esto y cuando muevo me dice sí o me dice no pero lo más importante es que yo no voy a hacer nada y vosotros tenéis que moverlo pues fíjate que vosotros lo movéis y dices sí pero lo dejáis de mover y dije no bien pero si estáis pensando bien funciona pero no sabemos cómo lo has hecho más o menos lo seguís bien lo que es hacer una banderita marcar un marcador digamos y lo que estoy haciendo es simplemente preguntarle al programa por una vía he perdido la fecha y por otra vía me voy a este marcador y te pregunto si tengo que mover o no tengo que mover ahora dejadme estilizar un poquitín entonces voy a hacer lo siguiente el renueva una tontería pero para que no se quede ahí en la pantalla muerto le digo raid 210 píxeles bordes 3 pixel solid black esto es de 20 píxeles simplemente para ahí que pongan lo he puesto ahí formateado en la pantalla muy bien pues ahora viene la cuestión venga a ver si me da tiempo antes de que se centre en el descanso la idea lo que quiero es que vamos a ver voy a desactivar esto voy a desactivar el load atención mira recargo fijaos que no se devuelven personajes nos duelen personajes en pantalla porque ahora lo que voy a hacer es solo en el caso de qué renueva punto text sea igual así porque fijaos que ahora veis no aparecen los personajes pero tocar un botón tocar flechas y detecta cuando habéis tocado una flecha es decir la misión de dime tiempo y de renueva es comprobar cuando hacéis un cambio en la base de datos simplemente esa entonces ahora digo si renueva punto texto es igual así en este caso entonces es cuando vas y me carga servidor es decir solo pide la nueva posición de los personajes cuando realmente detecte es que hay nuevas posiciones de los personajes así que recargo vale va un poco lento pero fijaos mirad que están peleando dime tiempo y renueva pero no servidor solo cuando muevo el personaje es cuando aparece el servidor por ahí lo veis quito la pantalla y damos cuenta como no hay servidor tocad vuestro servidor tocamos una flecha entonces veréis que es cuando aparece servidor pero cuando soltáis las teclas veréis que todo el rato es el mensaje de renueva y de dime tiempo qué es lo que estaba ocurriendo por tanto pues lo que estaba ocurriendo es que estamos cargando esta mañana lo optimizaremos más todavía porque todavía estamos gastando unos cuantos bytes pero lo que estamos haciendo es optimizar el que nos transfiera siempre la información sino sólo pregúntame cuántos personajes hay cuando detecte es un cambio no hay nuevos personajes no hay nuevos movimientos pues no preguntes nada no vuelvas a pedirlos digamos vamos a empezar hoy ilustrando un problema y la solución evidentemente y es un problema que os encontraréis cuando trabajéis con ajax es un problema que al principio os puede resultar bastante chocante porque no encontraréis el porqué pero sin embargo veréis que tiene un porqué muy curioso voy a crear una carpeta llamada en vivo en el servidor entonces dentro de la carpeta en vivo voy a copiar el archivo jquery punto js voy a crear atención un archivo llamado index php y otro index punto realmente no index.hr ml index.html ya que este en principio hoy para este primer ejercicio no va a contener nada de php y luego otro que se va a llamar dame botón punto php por tanto ahora lo que hago es cargar los dos dentro de edit así que arrancó heavy abro index.html abro dan el botón php y escribo para empezar el código de arranque de cualquier archivo html conteniendo un gel conteniendo un body dentro del head voy a crear una llamada al archivo jquery punto j s y cerramos la llamada creo un archivo script y digo document punto rebbie es función de momento pues al leer funcionó veis que siempre empiezo los proyectos igual siempre empiezo los proyectos con una llamada de alerta no para que lo primero que hagamos es comprobar que hemos cargado correctamente la librería jquery entonces digo div y de contenedor cierro el día y simplemente ahora lo que hago es ejecutar un navegador web donde voy a poner localhost barra en vivo y si todo bien me dirá funcionó me dará un alert llamado funcionó bueno en el caso de también botón php lo que voy a hacer es simplemente algo como por ejemplo php y voy a decir un botón así que digo button y de mi botón button y voy a poner pulsar y verás lo que pasa así que este dame botón php sólo tiene un php que lanza un botón html que dice pulsa me y verás lo que pasa evidentemente de momento no pasa nada porque pues no tiene ninguna acción no he definido todavía ninguna acción para ese botón así que ahora fácilmente voy a decir que el lugar del alert en el contenedor quiero loud quiero cargar el archivo dame botón php y lo que ocurre por tanto al cargar el contenido al cargar en vivo es que vuelve a aparecer un botón es decir yo soy el archivo html pero sin embargo aunque yo soy el archivo html finalmente tienes el botón de pulsa me y verás lo que pasa por qué pues porque yo he dicho que cuando cargue el documento lo que quiero es que dentro del contenedor quiero cargar el archivo dame el botón php y qué es lo que hace el archivo dame el botón php pues el archivo de la maratón php lo que hace es simplemente ejecutar un botón en pantalla hasta aquí en principio parece que no hay demasiado problema fijémonos que el botón tiene el y de mi botón pues el problema viene ahora porque yo lo que voy a hacer es decirle que cuando sobre mi botón haga clic quiero ejecutar una función que dirá algo tan sencillo como alert has hecho clic es decir como yo he traído un botón que tiene él y demi botón pues en ese caso seleccionó por él y demi botón hago clic y hago una alerta que dice has hecho clic esto puede funcionar y pueden no funcionar entonces lo digo porque también depende un poco del navegador del servidor y de la versión de jquery pero en líneas generales luego porque era en principio no debería funcionar pero igual me deja mal y funciona en líneas generales si hago clic aquí veremos que pulsa me y verás lo que pasa ya ha ocurrido lo que tenía que ocurrir y es que no ha funcionado pero un momento que he hecho mal porque en principio le he dicho contenedor punto load en el botón y me ha cargado el botón estoy llamando al y de correcto vamos a comprobarlo vamos a ver que el botón tiene él y demi botón beige y de mi botón almohadilla mi botón y le digo hago clic y ejecutó un alert que dice has hecho clic pero el alert ejecuta el área no funciona curiosamente le doy a la consola y la consola no me dice nada dice no si no tienes un error pero no funciona por tanto lo que vamos a ver es por qué no funciona este clic y cómo solucionarlo antes de explorar la solución por tanto tenemos que comprender el problema y el problema mirada es que para vosotros como seres humanos existe el botón en la pantalla si yo le doy a inspeccionar compruebo como el botón existe en la pantalla pero si le doy botón derecho ver código fuente de la pantalla observo que no existe ningún botón por tanto ese botón es un contenido en vivo por eso hemos llamado a este proyecto en vivo y en vivo quiere decir que no es un archivo que existía inicialmente en el dom no es un archivo que existía inicialmente en la estructura en el documento object model en la ordenación de etiquetas que tenían esta estructura inicialmente sino que es una etiqueta es un nivel es un elemento html que se ha creado a posteriori y que se ha creado lo que los navegadores llaman dinámicamente o en vivo esta es la razón por la cual el código que hemos escrito en principio es correcto pero sólo funciona para elementos que no están vivos elementos que estaban inicialmente en la estructura este es el problema y a continuación vamos a ver la solución es más o menos sencilla la sintaxis es lo complejo pero bueno la solución es usar un par de métodos que encontramos en jquery antiguamente muy antiguamente teníamos el método life a mí me gustaba mucho este método pero no lo uses porque ya no se usa así que podréis comprobar que a dónde está por aquí pone de pri keitel vale bife a ver si lo tenemos por aquí dice mj y 1.7 el método life está depre y kate ed está desfasado y por tanto está retirado y ya no funciona así que en este caso lo que nos dice es si quieres usar lo que antes era con life tienes que usar el método on así que pinchamos en el método vemos su sintaxis diremos que la sintaxis es parecida aunque no igual mira en lugar de decir mi botón voy a decir en el documento entonces en el documento lo que hago es decir punto o no y dentro del paréntesis pongo evento lo estoy viendo en castellano para que lo entendáis evento selector función es decir qué evento es un clic es un toque de botón es una pulsación móvil que es una carga quizás vale en nuestro caso el evento es un clic selector el selector es a quien quiere seleccionar sobre quién hace es el clic lo estoy haciendo en sobre mi botón y la función es esta misma función de aquí así que damos cuenta que él el método on es parecido al método click la diferencia es que aquí pones selector punto click y aquí dices en el documento voy a hacer clic en un nuevo elemento que se ha creado llamado botón no tienes que buscar tienes que rastrear pero la diferencia es que el clic es estático y el on es dinámico el clic no puede detectar elementos que se han creado después de la carga del archivo mientras que los ciclos puede detectar si creéis comentó este tampoco hace ningún daño pero lo comento porque ya no lo vamos a usar con este tipo de peticiones por supuesto recargo para darnos cuenta para que el sistema se dé cuenta de los cambios y ahora le digo pulsa me y verás lo que pasa y dice has hecho clic así que donde antes no funcionaba ahora así que funciona por tanto veremos que este problema se nos va a dar muchas veces y no pasa nada es un problema muy común y está esa solución y el problema es simplemente que lo que hacemos es intentar hacer clic sobre uno de los elementos que hemos cargado mediante ajax a hacer con el ejercicio que tenemos hasta ahora nosotros pulsamos las teclas y al pulsar las teclas pedíamos algo al servidor y el servidor nos devolvía algo diferente pero no interactúa vamos realmente con lo que nos devolvía el servidor no hacíamos clic sobre lo que nos devolvía al servidor pero a partir de ahora es muy probable que en un momento dado pues podamos devolver por ejemplo un menú en mediante ajax el menú ese no existía y vayamos a hacerle clic y nos demos cuenta de que nos responde bien pues que sepáis que cuando eso os pase no es un error vuestro sino que es un error del sistema digamos de la concepción y es que los eventos en principio no están preparados para capturar elementos ajax lo solucionaremos simplemente usando el clic vamos a continuación a programar un chat usando ajax porque de hecho hay poca manera más de programar un chat entonces voy a crear una nueva carpeta llamada chat donde voy a crear un nuevo documento llamado lo voy a llamar index php voy a copiar el jquery js los cargos o lo cargó él index.php dentro de beat y empiezo a escribir que todavía no crea un archivo html crea un archivo head creé un archivo móvil dentro del jefe creo un script src es igual a jquery punto j s y digo documento ya sabéis el documento function y digo a leer hola así que si esto ha ido bien ahora localizó localhost chat y me dirá hola lo cual quiere decir que jquery ha sido cargado correctamente dentro de este proyecto a continuación voy a crear una serie de archivos mirad evidentemente yo creo que está claro que si hablamos de un chat en vuestra cabeza aparece automáticamente el concepto de base de datos si hay un chat tiene que haber una base de datos detrás que almacene ese chat por tanto acabo descargar el archivo admin en php lo acabo de copiar del proyecto multijugador y ahora lo que voy a hacer es que voy a abrir una nueva pestaña con localhost chat barra admin er punto php localizó voy a crear una nueva base de datos le digo que creó una nueva base de datos que se va a llamar el nombre tampoco ocurrente de chat punto de v punto net caray chat punto debe que mediano así que creó una nueva base de datos llamada chat punto debe y ahora voy a crear una tabla nueva porque evidentemente al crear una base de datos nueva por defecto no tiene tablas entonces pincho al crear una tabla para crear una tabla y la tabla que voy a crear se va a llamar mensajes lo que voy a hacer ahora lo que voy a hacer ahora es crear otra cosa es que si esperamos a mysql siempre recomendaría meter una ide porque si ya la usaremos o no pero en este caso no es obligatorio mira lo único que voy a hacer en este caso es poner por una parte el usuario al que localizaremos ahora luego mediante una ip por tanto el tipo de texto va a ser texto a continuación voy a poner el campo mensaje que también va a ser un text y bueno la cuestión está en que técnicamente podría poner fecha aunque realmente no hará falta porque los mensajes se van a organizar cronológicamente sí o sí pero bueno de igual ponemos fechas y demás tampoco está así que todo esto por tanto es longitud 25 52 55 255 por si acaso sí porque no podría ser un entero pero le pongo un texto porque es el tipo de datos más permisivo es decir si pongo un entero luego no puedo poner un texto pero si pongo un texto luego puedo ponerlo entero a los que tengo un interés real numérico y blog hay muchos menos tipos de datos que en mysql entonces le doy a guardar y ahora simplemente voy a meter un nuevo registro que va a decir algo manualmente 192 168 126 este es el usuario y el mensaje que dirá es hola y la fecha que dirá voy a poner uno simplemente pongo uno y ya está simplemente para comprobar que puedo guardar mensajes dentro de este archivo bueno pues lo que voy a hacer ahora por tanto si ya tengo esta base de datos creada es atención miradme crear dos nuevos archivos en el proyecto que me van a ayudar a gestionar los mensajes uno se llamará le mensajes lee mensajes php y otros se llamara a escribir el mensaje y punto php los dos evidentemente los cargos dentro del editor así que dentro del editor ahora mismo tengo cargado tanto index.php como lee mensajes php como escribe mensajes php realmente hacer un chat tiene bastantes similitudes con hacer un videojuego que va lupe 'no porque realmente es un loop así que voy a hacer lo siguiente creo un dip con él y de chat cree un dip con él y de nuevo mensaje y en ese día y de nuevo mensaje voy a tener un input type text y ve mi mensaje y un botón con la leyenda envía con él y de envía mensaje así que aguardo y recargo y podremos comprobar como aparece un hundido con el aire de chat que de momento estaba un poco oculto no pasa nada y los voy a estilizar un poquito así que digo estilo habrá una etiqueta de estilo y digo el chat va a tener un wish de 200 píxeles un hi de 300 y un border de un pixel solid y ahí lo tenemos un nuevo mensaje va a tener un wifi de 200 píxeles y poco más nuevo mensaje y un espacio input tiene un wish del 100% y nuevo mensaje button tiene también un wish del 100% y así lo que tenemos es que tanto el campo de texto como el botón enviar pues están alineados con la cajita del chat así que con tres sencillas líneas pues le damos un poquito más de estilo a este chat otra cosa que puedo hacer un pequeño truco mágico es que pongo a este disco y pongo martín cuatro píxeles y lo que va a hacer es que a todo lo que hay en la escena a todo lo que se encuentre le va a poner un margen de 4 píxeles y separamos un poquito más los elementos y respiran un poquito mejor en pantalla así que atención grado ahora voy a crear una función llamada loop y como os podéis imaginar para crear esta función llamada loop arriba voy a crear un bar temporizador es igual a nada y le digo clear time out temporizador y luego se time out o digo temporizador es igual a z y mount ejecutó loop vamos a decirle milisegundos en el documento 9 lo que haremos es decir que también temporizador es igual a time out del loop en 1000 milisegundos ahora por tanto vamos con la primera parte de la parte contratante porque voy a decir cada segundo quiero que en el chat me cargues el archivo de mensajes php y en este caso estará funcionando lo único que pasa es que el archivo de mensajes php pues de momento no hace nada por eso el mensaje php voy a poner el siguiente código de hecho voy a recuperar el código del proyecto por ejemplo que hemos hecho ya ha llamado multijugador así que le digo renueva creo que es sí muy bien entonces copio y pego este código y evidentemente lo adaptó así que esperado momento mientras lo adaptó digo creó una nueva conexión a una nueva a una base de datos llamada chat punto debe le digo selector from mensajes a copiar en la pantalla simplemente copiar lo que yo estoy escribiendo ya está resuelto es igual a esto de aquí y lo que hacemos es simplemente decidir echo vamos a verlo pues eco row mensaje br así que si todo va bien recargo y me dice hola porque me dice hola pues me dice hola porque acordamos que en la base de datos yo puse hola si ahora pongo un nuevo registro 192 168 126 y pongo adiós guardo y compruebo como el chat me dice hola y me dice adiós es decir el chat lo que está haciendo de hecho veis el parpadeo veis la pulsación aquí abajo lo que hace es que cada segundo está leyendo la base de datos en busca de nuevos mensajes si ya tenemos la lectura de los mensajes únicamente para tener el núcleo el bloque inicial del chat en funcionamiento hará falta un poco de estilo y un poco de modificaciones pero nos hace falta únicamente el él escribe mensaje atención el mensaje requiere lo siguiente voy a crear por aquí un día con el id llamado ajax el nombre es lo de menos pero en este caso lo voy a llamar ajax y por tanto ahora digo lo siguiente cuando sobre el botón llamado envía mensaje haga clic quiero ejecutar una función donde digo mensaje es igual a uri en code o encoder y hay nunca los encoder y mi mensaje y punto vale es decir el mensaje es igual a lo que haya escrito ahí dentro lo que hayas escrito dentro del campo mi mensaje y ponemos la función encoder y porque lo voy a pasar a través de la url y para que se pase correctamente es muy recomendable cuando no imprescindible poner encapsular esa captura dentro de la función en con seguridad os cuenta que en code uri la ula de regla y latina van con mayúsculas ahora por tanto digo dentro de ajax quiero llamar quiero cargar loader y escribe mensajes php donde mensaje es igual a más mensaje es decir quiero llamar al archivo escribe mensaje php y le voy a pasar un parámetro le voy a pasar un valor donde le digo mensaje es igual a mensaje bien por tanto me voy a dejar un momento aquí escribe un mensaje para que podáis ver cómo voy escribiendo nosotros a la vez y voy a decir lo siguiente él escribe mensaje abro la base de datos y el sql que voy a ejecutar es el siguiente insert en tus mensajes values y voy a bajarlo abajo para que lo leáis mejor insert into mensajes values y ahora pongo lo siguiente aquí texto como texto y vigo server remote address creo que era ahora tal amigo esto es el mensaje realmente y esto es os acordáis y esto es beige me falta confirmarlo de php remote address dejadme confirmarlo un segundo os lo paso la pantalla de la izquierda entonces php vamos a confirmar lo que es ritmo te ha de ver ese es el error pero que había algo en la pantalla que no me sonaba correcto remote a beber así que si todo esto ha funcionado correctamente dejadme probarlo era la estructura así usuario mensaje y fecha bien digo voy a recargar digo o la atención envió y pone hola digo le envío y pone el l pero lo mejor de todo esto es que atención conectados todos a mi servidor y digo 19 21 681 23 creo que era yo a 126 si no lo sé pues sí efectivamente conectados todos aquí y escribir cosas y para alguien ha escrito y comprobaréis como ya podemos tratar todos en el mismo chat claro ahora como sabemos quién es quién bueno pues no pasa nada puedo ir al de mensajes atención y puedo poner lo siguiente eco usuario 2 puntos br y ahora pongo por aquí eco hr horizontal rule es una cosa que me encanta vamos a ver aquí me falta un punto y coma ya lo tenemos y fijaos cómo mirad como el problema está que conforme empezáis a escribir venga escribir más cosas de hablas vale yo dije me hago transcribir nada aquí ese es el problema mira el problema es qué pasa cuando hay escribir algo que pasa cuando hay más mensajes de lo que se puede soportar pues que los mensajes desbordan en pantalla con lo cual la solución una solución sería está en el chat le digo no claro escribir en el mío le digo overflow y scroll voy a poner esto en líneas sucesivas para que lo veáis mejor entonces si ponemos overflow y scroll y recargamos en la pantalla comprobaréis que ahora los mensajes aparecen dentro de un scroll pero el problema los mensajes aparecen dentro de un scroll y si yo por ejemplo ahora escribo o la damos cuenta como los mensajes hay que hacer manualmente scroll hacia abajo para poder verlos bueno ahora haremos un pequeño javascript que en el que haremos un pequeño scroll tú y lo que voy a hacer lo que voy a hacer en este caso vale si bien muy maduros y tal vale entonces lo que voy a hacer en este caso es que en index.php pero cómo ponéis esto si ponemos de 34 o sea que bien entonces en definitiva si yo digo hola veis que el scroll hay que hacerlo manualmente pues voy a hacer lo siguiente voy a decirle en chat punto scroll tú y voy a decirle 10.000 o 100.000 o algo así eso lo que hace es lo que hace vamos a leerlo espera que scroll tú el scroll tú no me está funcionando vamos a ver jquery scroll tú es cruel top vale voy a ponerle las formas el scroll tú también debería funcionar vale recargo y si yo ahora pongo adiós fijaos como automáticamente el segundo siguiente aparecen los nuevos mensajes la idea es poner 100 mil como quien pone un millón para que ponga siempre un número tan grande que tengas el número de mensajes que tengas por siempre baje abajo del todo bueno con lo cual tenemos ya nuestro chat realizado ahora hace falta utilizarlo un poquito así que voy a decir lo siguiente en body le digo el font family es sam's sheriff el fondo 6 es igual a 10 píxeles y por tanto será guarda y recargo comprobaremos como pues bueno tenemos un chat un poquito mejor el br es un poco fuerte la hr perdón es un poco fuerte así que quiero decir lo siguiente martín 0 píxeles padding 0px border pero pixeles solid white y ahora le digo border top un píxel dust y lo voy a poner en líneas y así lo veréis mejor en el hr la margen de 0 padding de 0 border en principio de 0 para luego ponerle un border top alineado de color gris y como veis pues eso me da unas líneas un poquito más así también puedo ponerle pues rgb 220 una cosa así y así pues poco a poco vamos por ahí creando nuestro chat luego el de mensajes pues puedo quitar por ejemplo este ver para que los mensajes aparezcan un poco más en línea en definitiva ahora ya pues depende un poco de vosotros el especificar cómo formatear el mensaje es decir como forma page el chat para permitir que cada uno de los usuarios pueda leer correctamente lo que están escribiendo el resto de usuarios en este caso resulta que uno de vosotros me ha colado un botón por ahí por medio y esto es porque simplemente habéis escrito button habéis escrito una etiqueta html aquí como ola así que envió y aparece un botón que pone hola pero lo peor de todo es que podríais es haber escrito un script ya lo sé es que mira que sois mal esa es la maldad entonces pongo mensaje momento porque este igual no se envía bien ya he visto ya envió y pone el mensaje y lo peor es que fíjate que ahora cada segundo me va a devolver en pantalla el mensaje vale hackeado efectivamente dejadme que borre evidentemente ese mensaje bien entonces eliminó y bueno vamos a ver un pequeño método para protegernos de la inserción de elementos no deseados o esto que acabo de escribir aquí que se llama directamente cross-site scripting que se llama directamente la escritura de código entre dominios es decir inyectar hay otra cosa peor atención todos a la pantalla lo que voy a hacer mira y no estoy hablando hoy todavía de seguridad web pero bueno es una manera de empezarlo así que le digo ya no le digo chad me voy a hacer una copia de seguridad de la base de datos y ahora veréis por qué pero lo peor de todo esto es si escribo algo como lo siguiente comillas voy a probar a ver qué pasa punto y coma y voy a decir un drop table mensajes bien entonces si envío esto no sé no lo sé es que estoy pensando un momento vale sí espera espera déjame que saque escribe el mensaje escribe mensaje no es sí vale mensajes los mensajes creo en mensajes y digo bueno no le iba a poner vale voy a enviar envío siguen existiendo unos mensajes así que voy a poner algo así envío drop table mensaje se ha puesto voy a poner con esto envío drop table mensajes tengo que verlo pero con una combinación de punto y coma para escapar hidro drop table mensajes lo que haría es escaparme del código y hacer un drop con lo cual lo que estaría haciendo es eliminar la tabla o por ejemplo puedo hacer lo siguiente era con una simple no con una comilla doble trump kate voy a probar esto envío no digo tengo que verlo entonces la idea por tanto es no permitir al usuario realizar ninguna acción parecida para ello lo que voy a hacer es un principio de sanador entonces voy a hacer lo siguiente un momento php con times eso no eso así que digo lo siguiente sí es cierto que get mensaje contiene el carácter este de aquí digo die y la instrucción de php lo que hace es matar a php lo que hace es matar a php y decirle no ejecute es nada más intento de hackeo así que si al abrash así que recargo y si pongo por aquí pues algo así como button si todo va bien me dirá intento de hackeo si yo escribo si yo ahora escribo hola en ese caso escribo hola pero si intentó poner script me dirá intento de hackeo otra cosa que puedo hacer es lo siguiente también puedo poner punto y coma o puedo poner algo como delito o drop o lo que sea entonces en definitiva pongo palabras para que la si digo por ejemplo punto y coma drop dead habéis envió y pone intento de hackeo claro si no ponga un punto y coma en ese caso por dentro que acabéis hay que tener cuidado vale os voy a decir a continuación que os recomiendo un archivo en una librería que yo tengo desarrollada que sirve precisamente para evitar todo esto entonces mirad yo tengo un archivo voy a quitar estos dos de aquí tengo un archivo que he copiado en la carpeta de proyecto de atención todos a la pantalla que se llama sanitizer php y sanitarios php es un script que hace lo siguiente es un script que es un poco de magia negra porque dice cógeme todo lo que venga porque o por post cógeme cualquier cosa que venga a través de la url y pregúntale si tiene alguna de estas cosas si tiene select o insertó delito o update grand trunk el punto y coma o table 'notables' o drop order o having o tiene script o tiene and y puedo poner realmente cualquier cosa o tiene simplemente menor que o mayor que o lo que quieras entonces en ese caso además lo que voy a hacer es escribir esto donde esto os lo voy a dejar ahora marcado y hablaremos de ello otro día y si no tiene es decir si tiene alguna de estas cosas en este caso mata la ejecución y no ejecute es nada más ahora si las tiene ya sé perdón si no las tiene si en principio está limpio además le meto el html especial charles y le meto el adeslas es decir lo de convertir el texto a código que no es html pero eso es después de haber realizado este saneamiento es la detección quiero decir si alguien comete un delito no quiero que me lo sane es lo que quiero es que me lo pares porque es un intento de ataque vale entonces lo que voy a hacer ahora es decir bueno pero como ahora perdón aquí como ahora copio este código dentro de mi proyecto pues vamos a ver una instrucción que a partir de ahora veréis muy útil que se llama incluso lo que hace es sanitizer php y lo que hace include simplemente es llama me ejecuta me incluye me como si estuviera aquí el código del programa llamado sanitizer php por tanto si ahora recargo y yo pongo hola vale andy finding decks mensaje en la línea 10 a interesante pero no pasa na propone hola simplemente el sanitizer en la línea 10 voy a decir eso es muy bien porque fijaos que es un notice no es un error bien pongo hola y correcto pero yo era pongo button envió y fijaos que a ver great and the fame mex no no fijaos que pongo drop y un segundo ah claro muy bien pero vale esto es lo que decíamos hace un momento esto lo que hace es lo de html especial charles y es que fíjate que si yo pongo un botón me lo pone como texto no como código html y eso es lo de html especial charles pero esto no debería funcionar así porque yo le había dicho por aquí que también quería este menor que bueno no sé voy a poner botón o algo así que ahora escribo el botón envió y dice no en definitiva tenéis por tanto está estructura de control donde simplemente haz un break match ball y dice que esto ya lo explicaré esto se llama expresiones regulares es un infierno no es para hoy el momento hoy quedaros con éste sanitizer vale pero simplemente lo que hace el sanitizer es decir es cierto que lo que me estás enviando tiene algo de esto si intento de ataque para no es cierto vale no es un intento de ataque pero por si acaso me limpias el código siguiente cuestión otra cosa que os dejo hoy en el código no os explico hoy por qué no toca explicar el otro día mañana mismo si queréis porque mañana mismo sí que puede tocar tendré les digo además si me estás intentando hacer un ataque me abres un archivo csv y me guardas los datos de quién me ha intentado atacar por tanto comprobaréis dentro de chad ha aparecido un archivo csv y ese archivo csv tiene un registro de quién ha intentado hacer qué tipo de ataque vale por tanto por eso digo ahora os lo paso para que lo tengáis hay un poco a mano pero es un sanador muy interesante en cuanto a que simplemente con unas cuantas líneas te protege no digo de cualquier tipo de ataque pero de un mundo de tipos de ataque y además te genera automáticamente un registro de quién te ha intentado atacar la siguiente cuestión que os voy a decir es que esto que tenemos aquí nos sirve como habéis visto para poder escribir y por ende también nos sirve para poder leer archivos del sistema de archivo lo cual nos llevará a otro tipo de persistencia hasta ahora qué mecanismos de persistencia hemos visto pues hemos visto cómo trabajar con mysql hemos visto cómo trabajar con ese kulite bueno pues llegado el momento mañana mismo por ejemplo querré que sepáis que el hecho de poder escribir archivos en el sistema de archivos del servidor y el hecho de poder leer esos archivos otra manera de poder guardar información una manera no tan sofisticada como generar una base de datos pero a veces como ya veréis tiene sus ventajas voy a empezar con una duda que recibí ayer por correo electrónico entonces no por whatsapp entonces la duda es que esto que hemos hecho ayer funciona a través de una red local pero qué pasa si no quiero subir a internet qué pasa si quiero usar este chat para hablar con mis amigos pero no en una red local que también podría ser sino en una internet externa por tanto aparte de que arranque el samp evidentemente para poder ver esto en local os voy a decir que lo único que tenemos que hacer para que el chat funcione en internet para que el chat funcione en un servidor en internet es simplemente subirlo a un servidor de internet específicamente en este caso en este chat concreto os voy a decir que debido a que lo hemos programado con el security el chat está preparado para ser subido directamente a través de un gestor de ftp o cualquier otro tipo de cliente así que mira me voy a ir a mi servidor me voy a ir a la carpeta de código de juegos dentro de juegos voy a crear por ejemplo mismamente un chat una carpeta llamada chat y voy a subir este archivo mira todos a la pantalla voy a subir esta programación a box me voy a chats voy a venir por aquí el chat en zip y atención todos la pantalla voy a añadirlo a un archivo que va a ser un zip por tanto lo que hago a continuación es subirlo aquí así que por tanto fe jump hp books chad por aquí logramos los hubo se sumen un segundo y lo descomprimimos una vez que lo descomprimido dejadme que mueva los archivos porque se me ha metido en una sub carpeta llamada chat y por tanto lo que quiero que hagamos todos ahora es que quiero que vayáis a jose edición de garza la puntocom barra código barra juegos chat y encontrareis que sin hacer nada más sin hacer nada más el chat de entrada de repente funciona pero hay un pequeño pero por ejemplo josé luís ha dicho chad alguien ha dicho hello world habla muy bien yo le digo envía pero efectivamente la ip es la misma entonces cuando nos estamos conectando en una intranet la ip que aparece es nuestra propia ip pero cuando nos estamos conectando en una infraestructura de cliente servidor a través de internet no en una red local espera que déjame dibujar un pequeño gráfico en descargas summit yo lo que acaba de hacer ahora es subir el software a un servidor en este caso cada domicilio o cada empresa cada persona que se conecte desde su casa tener una ip diferente cada uno de estos elementos tiene una ip una pipe una y p y una ip pero el problema está en que nosotros estamos realmente usando ahora mismo varios ordenadores dentro de la misma organización con lo cual aunque seamos 4 finalmente la ip que ve el sistema en nuestro caso es la misma por tanto lo que quería deciros es que en primer lugar si yo suelto el chat sobre un servidor comercial sobre un servidor en funcionamiento el chat funciona directamente pero tenemos este pequeño problema de que si coincide que estamos varios chateando bajo el mismo router pues tenemos todos esa misma pega que tenemos la misma ip bueno no pasa nada a continuación voy a ver cómo solucionar esto de una manera de sencillísimo ahora os voy a decir una cosa de hecho voy a ser parecido a lo que dice la semana pasada pero os voy a decir una cosa si implementa es un chat sobre un servidor comercial yo en este caso lo estoy implementando sobre un one on one en este caso es especialmente recomendable usar ese culito por una sencilla razón porque los servidores comerciales a menos que paguen un plan de los grandes te limitan el uso de mysql específicamente para aplicaciones de chat y aplicaciones de analítica por qué porque machacan mucho la base de datos pero sin embargo nadie pone limitaciones al uso de esecurity porque sécurité realmente no marcha con una base de datos machaca un archivo así que la idea por tanto es que no es que lo haría así en plan fácil es que lo haría así prácticamente en cualquier caso evidentemente asegurando la información que ahora mismo no está asegurada pero ya hablaremos de eso entonces lo que voy a hacer en este caso mirad y ahora luego paso el código es que dentro de juegos me voy a ir a chat me voy a ir a index.php y me voy a crear por aquí un día si luego yo aunque nos acercaremos otros 14 en fin y digo dif y de nombre usuario y dentro de ti y de nombre usuario tengo un input tide text y de nada bien por tanto lo que hago ahora es decirle todo aquello que sea esto dónde está valentín bien todo aquello que sea nuevo usuario input pues va a tener una anchura de 200 píxeles para que cuando guarde y recargue veáis ahí que tengo usuario al tener ahí usuario por ejemplo si pongo jose vicente lo que quiero es que cada vez que yo chapi como jose vicente no como la ip por eso lo que voy a hacer va a ser algo tan sencillo como decirle un usuario copio esa línea de código de mensaje y digo usuario es igual a en code uri la verdad es que esta idea podría ir aquí y ve un punto usuario por tanto ahora vengo aquí y digo input usuario punto vale así que digo mensaje es igual a mensaje i un usuario y usuario es igual a usuario le estoy enviando escribe mensaje php tanto el mensaje que escribo como el usuario que lo escribe por tanto así que guardo y recargo y ahora en el php lo que haré es poner el código que atrapa el usuario y lo mete en la base de datos pues evidentemente lo único que tenemos que hacer ahora simplemente es que si yo estoy llamando escribe mensaje php y le estoy prometiendo que le voy a pasar un usuario pues me voy a escribir mensaje php y le digo que en el usuario no me pongas el remote address no me pongas necesariamente atención y desde la pantalla momento no me pongas necesariamente el ritmo padres sino ponme el post usuario pero yo os digo sabes que es que no guardar la ip de quién está escribiendo algo en un chat es un poco pecado porque si guardas el usuario por no guardar la ip cualquiera puede empezar a decir animaladas y no tienes manera de localizar la ip de quien ha dicho es animaladas por donde hoy os diría que antes de hacer eso mirad voy a hacer lo siguiente me voy a ir a josé vicente carratalá puntocom código barra juegos barra chat mainer punto php me voy a abrir la base de datos chat punto debe me voy a ir a mensajes voy a ir atención todos la pantalla a modificar la tabla voy a añadir un nuevo campo llamado ip y así por tanto mirad ahora tengo cuatro campos en lugar de tres tengo usuario mensaje fecha e ip y así que por tanto lo que hago ahora es decirle que en el insert into mensajes digo esto lo pongo aquí y esto lo pongo aquí así que en el primer campo estaba afuera en el primer campo guardo lo que venga como un usuario en el segundo campo guardo lo que venga como mensaje en el tercer campo guardo la fecha y en el cuarto campo guardo la ip pero ten en cuenta que en cualquier inserte en sql los dos primeros campos van con comas menos el último que nos lleva a una coma porque es el último no hay nadie después esa es una fuente de error muy común al escribir este tipo de sentencias así que si ahora guardo atención todo es la pantalla y recargo la pantalla digo josé vicente digo hola así que si no está bien ahí aparece josé vicente hola cómo estáis envío y veréis que a partir de ahora ya no aparece la ip si no acapare aparece cada uno con su nombre pero aunque aparece cada uno con su nombre fijaos cómo se sigue guardando la ip aunque la ip ya no sea un dato tan visible pero se guarda la ip importante el tipo de sistema si ya se quería seguir pensando como reventarlo pero es que guardéis siempre la ip bien la siguiente cuestión que vamos a comentar es añadir que funcione el botón de enter en la caja del chat por qué pues porque es un poco rollo vale que tiene que estar el botón de enviar no te digo que no de hecho en el móvil es mucho mejor el botón de enviar que en enter pero cuando estás en un chat en un ordenador con teclado es mucho más cómodo darle a enter que tener que el ratón y tener que moverlo hasta el botón enviar por tanto voy a modificar un poco la parte del código de javascript para que sea capaz de escuchar el botón enter dentro de la caja lo que hago a continuación por tanto es escuchar alguna tecla y para escuchar alguna tecla voy a sacar el código que hicimos en multiusuario o en flap y ver o donde sea qué es el código de escuchar una tecla así que le digo champ hp docs le digo multiusuario por ejemplo un segundo multijugador le digo index.php y miradme un segundo le digo document key down era muy grande todo esto lo voy a pegar aquí pero voy a hacer lo siguiente en el documento no el key down no quiero que sea en el documento quiero que sólo estés pendiente cuando pulso una tecla dentro de mi mensaje no quiero que estés pendiente cuando pulso un enter en cualquier parte de la pantalla sólo cuando tenga el ratón dentro de mi mensaje entonces por eso aquí no le digo document sino que le digo mi mensaje punto cada uno lo único que tenemos que hacer ahora es capturar el código que corresponde al botón de enter por tanto digo javascript charcos ojo la página que encuentre más fácil y pongo por aquí enter o intro vamos a ver enter número 13 así que vengo aquí y digo y el botón que se ha enviado es el 13 en ese caso escribo esto mismo de aquí es decir copio y pego ese código porque es el mismo por tanto guardo recargo y digo vamos a ver lo que cargue hay un error vamos a ver lo tengo un error y el error dice que vamos a ver si claro que si bien esto es un key down y por tanto tiene aquí un paréntesis por tanto aquí tiene que haber un paréntesis porque steve tierra aquí pero esta llave cierra aquí y este paréntesis tierra vale así que guardo y recargo en principio ya no debe haber error y ahora digo hola pulso enter y parece que sí ah vale claro que soy jose vicente y mirad hay un problema y es que algo así envió pero no se me borra esta cajita de texto bueno ese problema no es ningún problema porque digo atención digo cuando envíes la información dijo dis punto html no disputó vale quería decir nada this punto vale nada lo que hace es vaciar el campo de texto así que guardo recargo y ahora digo hola pulso enter cuidado tengo que poner a mi hijo suficiente pulso enter y fijaos cómo se envía y se borra cómo estáis y se envía y se borra y ya tenemos pues tienes que no un chat que empieza a tener cierta funcionalidad voy a devolver este código a local host para trabajar más cómodo porque se trabaja en el servidor pues también como demostración pero a la larga es incómodo así que dentro de juegos me cojo el chat lo comprime me lo bajo aquí está me voy a disco local me voy a xbox lo voy a guardar como chat 2 puntos vaya ya guardado como chad oeste así que extraigo aquí y atención todos a la pantalla porque ahora voy a trabajar sobre la carpeta chat 2 la segunda versión me voy ahora por tanto al localhost barra chat 2 lo que os barra 2 ahora sí y lo pongo aquí y voy a hablar en este caso a continuación un poquito de seguridad cuando digo seguridad lo que quiero decir es de alguna manera en pantalla o en la base de datos poder proteger los datos que hay mirada ahora a cualquier persona que entrara dentro de admin er podría simplemente conectarse a la base de datos desde luego toda piedra hace montaña entonces para empezar claro de repente en un chat hacer que la base de datos y amer chat punto debe pues ya es un punto para que no sea muy segura evidentemente entonces efectivamente lo primero que haríamos sería cambiar el nombre del chat pero mira tenemos un problema y el problema es el siguiente y eso que me acabas de decir de hecho me sirve para enseñaros una cosa muy importante que crees que pasaría si yo ahora vengo aquí a chat 2 y simplemente cambió el nombre de chat punto debe por mi nombre de chat extraño pongo extra no por no poner extraño porque no mola mucho entonces qué pasaría si yo hago esto deja de funcionar pero qué puedo hacer para que empiece a funcionar de nuevo cambiar los códigos porque el problema está en que para esta aplicación tan sencilla que acabamos de hacer fijaos que tanto escribe el mensaje como lee mensajes los dos están utilizando es la misma llamada pero esto ha sido porque este programa este chat ahora mismo es muy sencillo cuando tienes un juego complejo cuando tienes un programa complejo no hay un archivo no hay dos archivos que leen la base de datos hay 30 archivos que leen la base de datos así que esto que me acabas de comentar me viene muy bien para explicaros el concepto de archivos de configuración el concepto de archivo de configuración se basa en lo que ya os enseñé ayer que es la inclusión del sanitizer entonces para ello voy a hacer lo siguiente mira dentro de esta carpeta mismo ahora luego si queréis organizamos un poco que lo tengo un poco desorganizado voy a crear un archivo llamado config punto php el archivo conflicto php lo que va a hacer es que aparte de abrir php va a tener mira va a tener esta línea debe es igual a new school y t3 chat debe atención mirad lo voy a cortar y lo voy a pegar dentro de config cortar con solo x y ahora le doy a include confía punto php de la misma manera en mensajes corto borro quito la conexión a la base de datos y hago un include a conflicto php y esto qué quiere decir por tanto pues esto quiere decir por tanto que a partir de ahora los dos archivos están llamando a conflicto hp por tanto si yo hago un cambio en conflicto hp ese cambio va a aplicarse en cascada en todos los archivos cosa que no digo ya que constituye una buena costumbre sino la costumbre imprescindible en cualquier desarrollo mínimamente complejo en php por tanto ahora evidentemente esto no funcionaría pero yo vengo aquí y digo mi nombre de chat extra no punto debe lo cual me ayuda lo cual me ayuda a que cuando yo ahora recargo el juego sigue funcionando como si nada porque lo que he hecho es externalizar no solo la medida de poner un nombre más largo y más complejo de base de datos sino que además también centralizamos la gestión de la llamada de forma que tú imagínate que vive yo tengo 30 archivos y cambio en la base de datos de nombre y oye me pegó lo curro y cambio los 30 archivos de firme a ya está lo he hecho pero claro al día siguiente dicen no hemos pensado que le vamos a volver a cambiar lo dices otra vez 30 archivos otra vez a cambiar la idea es que te dice es cambiar las veces te dé la gana porque cada vez que los cambios yo voy a un archivo modificó ese un archivo y se me va a cambiar en todos a la vez pero vamos a ver ahora además otro método de codificación que consiste básicamente simplemente en codificar con un algoritmo que se llama base 64 estamos hablando en este caso de una codificación muy ligera muy sencilla muy poco segura vamos a empezar por ahí evidentemente y a partir de ahí iremos a cosas más complejas pero la cuestión está en que fácilmente en javascript os vais a los vais a reír hay un método de codificación que se llama youtube en youtube y en javascript que básicamente es un método que dice aquí está que dice weiwei no al revés beat way para codificar y ahí tuve para descodificar esto qué quiere decir pues que mira codificar puede ser algo tan sencillo como que él escribe mensajes pero no lo voy a hacer en php es más fácil vale le digo el get mensaje digo base 64 guión bajo en code del mensaje yo que estoy haciendo ahí atención todos a la pantalla pues lo que hago es que cuando yo digo o la actuación es que esto le digo hola me dice ranking hola a ver que el clave a 64 en código escrito correctamente chat 2 a ver mensajes claro si bien mi nombre de chat extraño mensajes t un segundo conducto pasa aquí marsé jose vicente ha escrito hola cómo estáis y sale eso que les parece muy bonito de hecho si me voy a la base de datos y refresco la tabla comprobaréis como que realmente es la información que se ha introducido con lo cual yo lo que hago en primer lugar es introducir la información codificada en base 64 pero claro luego el de mensajes atención tengo que usar base 64 de code del mensaje ahora se va a truncar todo sí lo sé un momento mirando la pantalla participar en mi chat atención miradme que no miréis mensajes vacío bien escribir métodos hola cómo estáis estos son unos mensajes frank dice hola qué tal cómo estás dime todos la ip que tenía el otro día echados así que fijaos bueno sólo fran me escriben los demás ay no no tenéis que en este caso localhost 2 porque lo he bajado así que mirad atención como vosotros como usuarios estáis viendo el chat pero si alguien se descarga el chat lo que ve es eso 9 que puede por eso digo que de la misma manera que para mí simplemente ha sido esta información y decirle a 64 de ccoo de cualquier persona que vi que vea esto y diga hoy es tiempo de ser un 64 pues lo descodifica ya está pues os digo que hoy es un método primero y muy primigenio y muy sencillo de codificación también te digo una cosa la atención que insisto que el próximo día en próximos días os enseñaré métodos más avanzados de codificación pero hoy ya podríamos hacer esto mira yo hago en escribe un mensaje atención dime frank un número dime un número entre 1 y 10 no entre 1 y no más entre 12 bien así que mira atención todos a la pantalla 1 2 3 4 5 6 7 8 9 10 11 y 2 bien ahora digo 1 2 3 4 5 6 7 8 9 10 11 y 12 no me creo la cuenta y ahora fantástico y ahora no más esquema 64 es el algoritmo entonces mirad uno 1 2 3 4 5 6 7 8 9 10 11 y 12 y ahora 1 2 3 4 5 6 7 8 9 10 11 y 12 y guardo pero sí exactamente muy bien entonces hay que llegar entonces le digo vaciar atención y ahora escribimos al escribir hola cómo estáis estamos escribiendo con 12 bucles pero no pasa nada porque estás mal josé luís no sé por qué estás mal con lo bien que estamos aquí programando un chat al entonces de cara al usuario el chat funciona perfectamente pero si me voy a la base de datos lo que veo es esto ojo y la cadena está recordaba que se hago así es pero modificó se hago así verás que la cadena es eso por tanto es pequeña la idea pero sabes que puedo esta idea más allá y puedo decir pues mira con las mismas que codificó una cosa codificó todo lo demás entonces me voy a escribir mensaje y digo este va 64 en code pero quiero que veas qué pinta tiene lo que hago es meterlo en get usuario y sabes qué porque yo no quiero que nadie sepa qué usuarios tengo en mi chat sabes que también lo puedo hacer con el ritmo anotador es así que vengo aquí y lo hago con el ritmo anotadores ahora me voy a leer mensajes hago lo mismo con el usuario dejadme que borre la base de datos vamos a escribir ahora otra vez hola cómo estáis joseluis siento mucho que tengas frío pero esto en valencia pasa tres días al año el resto del año es primavera cuando no verano entonces alguien dice tenéis un problema de soriano en el router bien qué pasa que está abierto o algo así no es muy seguro pero en fin no pasa nada entonces a lo que le ponemos una clave entonces si ahora me voy a la base de datos y me voy a mensajes lo que quiero que veáis es que el chat sigue funcionando desde el punto de vista del usuario final pero desde el punto de vista de la base de datos tanto el usuario como los mensajes como la fecha no como la ip todo está codificado con esa primera estructura de varios bucles fort para que quien en un momento dado se baje la base de datos no les sea imposible ni mucho menos pero ya no sea tan sencillo que claro si ya se tiene que empezar a poner a probar y obviamente digo que si yo leo esto y leo vm los primeros caracteres digo y vm eso tiene pinta de la 64 vale por tanto en una sesenta y cuatro sería bueno descodifica una vez no me ha salido nada va lo voy a seguir descalificando hasta que llega hasta que pruebe hasta que lo consiga vale por tanto este método no es infalible pero bueno ya es algo mejor que no codificar nada de la base de datos vale insisto que el próximo día estaremos hablando de otros métodos de codificación os enseñaré alguno que tengo yo propio para ponerle una cosa que se llama sal a la codificación para que sea mucho más difícil averiguar pero nunca es imposible vale porque yo estoy especializado en programar pero no estoy especializado en hackear hay gente que está especializada en desencriptar mensajes encriptados evidentemente esa gente dedica su vida a ello pero bueno se trata de ir poniendo pues pequeñas zancadillas para no sea imposible pero por lo menos cada vez sea más difícil que descompriman que te des compile en los mensajes dentro de qué sqlite pues no lleva a usuario y contraseña como sí que lo lleva mysql portante sécurité pues para ciertas cosas está bien pero para ciertas otras como esa seguridad pues no está tan bien por ejemplo como mysql yo antes lo que he hecho es subir este bloque de código es decir este esta pieza del software directamente a mi proveedor ai proveedor de hosting entonces mi proveedor de hosting en este caso me provee el soporte para ese culito que prácticamente todos lo proveen no hay ningún problema por eso la cuestión es que en la gran mayoría de proveedores de los básicos de los planes baratos te limitan el número de peticiones de mysql cada hora mientras que no te limitan el número de peticiones de ese culito porque pues por qué porque para ellos no es lo mismo que tú tengas una página web con una base de datos que tú tengas un chat con una base de datos porque pues por una razón muy sencilla mira yo tengo mi página web que es un wordpress por otra parte que está hecho con mysql porque wordpress viene así pero cuanta gente se conecta al día ami wordpress pues no es que te lo diga yo es que me voy a analytics punto google.com y vamos a verlo así que me voy a mi web ese sabe alguien que no lo parezca y yo digo mira al día como máximo se me conectan 100 personas y cada una de esas 100 personas ve como máximo veamos con un máximo de 3 mil 184 perdón ve 3.1 páginas no jala ya me gustaría a mí ya me gustaría mirar a cada uno tres mil páginas eso quiere decir que digamos al día como máximo la gente hace clic 300 veces en mi página y eso quiere decir que en 24 horas al final se hacen 300 peticiones a la base de datos 300 en principio es mucho pero repartido entre un periodo de 24 horas es muy poco con lo cual no hay ningún problema ahora bien si yo instaló este chat en mi servidor en war on one con mysql y por ejemplo nosotros cuatro estamos hablando durante una hora que son 60 minutos por 60 segundos por 4 personas que somos y recordad que el chat los refrescamos cada segundo lo podríamos refrescar cada menos pues son 14 mil 400 peticiones así que la idea es esa tú montas una página web es la página web tiene aunque tenga tráfico al final son 300 conexiones una base de datos en 24 horas pero esto un sistema de chat son 14 mil cuatrocientas peticiones en una hora que si lo multiplicó por 24 me da 345 mil peticiones a la hora mucha con un chat de cuatro personas como mientras hay 40 personas pues ya son 3 millones 400 mil peticiones de una base de datos 24 horas no vamos a ver yo no engaño a nadie yo me adapto pero no te cuento yo me adapto a lo que el proveedor me dice entonces si el proveedor me dice claro vamos a ver el proveedor en este caso one on one como podrían ser cualquier otro tipo de empresa tienen administradores de sistemas y tienen programadores que están ahí no te digo todo el día pendientes de mi hosting pero exacto pero tienen sistemas de detección de quien abusa y quien no abusa y quién usa y quien no usa es decir que ellos mismos son los que me han dicho mysql limitado pero ese cohete lo que quieras pero es que aunque no me lo hubieran dicho aunque estuviere de avanzar la falla ellos tienen sistemas que detectan cuando yo estoy abusando de un cierto recurso y me enviarían una notita o me bloquearía en el acceso a esa carpeta concreta o me penalizaría en el rendimiento que tienen muchos mecanismos para hacer eso quiero decir con esto que no os lo estoy contando en plan mira que fugia estoy haciendo sino en plan del propio proveedor me dice esto está limitado pero esto no con lo cual si es que tiene en cuenta que no es lo mismo también mover un ese culito que mover un mysql una conexión a mysql por la seguridad y por la potencia del servidor y todo es mucho más pesada que una conexión a ese culito una presión de su colita y no deja de ser leer y escribir un archivo una cosa son mysql eso no está nuestra conexión hay un servidor aparte que tiene que estar escuchando mis peticiones pues yo vengo y le digo es cierto que tengo este usuario esta contraseña momento electro válido entonces a males si puedes pasar por un momento de usuario qué tipo de usuario ves puede escribir puede leer qué límites tiene el usuario a qué tablas puede acceder en red es claro todo eso quieras que no es más carga en el servidor mientras que así que eso no pasen y vean escribe ya está reportando sqlite existe la misma palabra lo de élite es la conexión mucho más ligera mucho más liviana si fuera pensada evidentemente de war on want me dirían oye entonces lo que ocurre aquí mira al final es una mera cuestión de euros por tanto yo me voy aquí porque ya estáis previendo que al final prácticamente hagáis el proyecto que hagáis no ya cuando lo desarrolláis aquí en el aula sino cuando desarrolláis para ponerlo ya en internet prácticamente cualquier juego multijugador os va a requerir que os compréis un servidor de alquileres un servidor entonces en el momento en el que vayáis a alquilar un servidor yo os diré mira me voy a hosting y en hosting pues si yo uso uno de estos que son compartidos en estos son donde está limitado mysql por tanto en estos son donde tengo que usar ese culito pero digo bueno pero son cuatro euros al mes pero son siete euros al mes pero son diez euros al mes pero son catorce euros al mes he hecho yo suelo recomendar este aunque no recomienda este vale no te digo que no pero pues al final son siete euros al mes no ya la oferta imaginemos que ya es el segundo año vale por tanto siete euros al mes por 12 meses 84 euros y puedes empezar a meter ahí la base de datos que quieras en ese culito en mysql hay 20 bases de datos para bases ilimitadas tienes que ir a ella las mysql el security ilimitadas en cualquiera de los planes ahora bien yo me voy aquí a performance hosting y en performance hosting ahí ya tienes los servidores dedicados este es un v ps creó un 91 en muchos precios servidores y servidores dedicados a ips ahí está bien es claro yo digo mira tienes servidores virtuales desde 499 al mes servidores dedicados desde cero euros o meses propuestos en tres meses gratis luego te con la leña habrás entonces digo servidor dedicado configuró el servidor y claro aquí ya estamos hablando de que después de la oferta son 39 al mes 99 en arte cuento que muy buena pregunta 60 euros al mes 60 euros al mes 60 euros al mes 80 euros al mes esos son los dedicados luego también tienes los servidores virtuales que hablamos de dos euros al mes veinte euros al mes como ves tienes un poco de todo tienes los esperan que estos son los performance vale tienes los baratos tienes los intermedios hasta treinta euros y tienes los verificados entonces te cuento cuando usar una cosa y cuando usar otra realmente todo depende de tu tamaño de juego entonces la pregunta es esa base de datos a cuántos usuarios va a albergar a esos usuarios una vez albergados ahí cada cuánto van a refrescar estamos hablando de un juego en plan el maestros castells que no se conecta online sino que únicamente cuando acabas la partida guardas la puntuación en el servidor no te hace falta un dedicado para eso no te hace falta un compartido para eso no te hace falta gastar te 80 euros en ello vale en este caso coge uno de los baratos y va que sobra ahora estamos hablando de un juego como los que estamos haciendo ahora donde los usuarios se conectan diez veces cada segundo varios usuarios entonces te pregunto de cuántos usuario estamos hablando porque estamos hablando igual de menos de 10 usuarios y te digo mira menos de 10 usuarios que siguen cayendo en un hosting como éste ahora esto me dices simultáneos ahora si me dices no yo es que quiero tener 100 usuarios y no quiero ese cool y te quiero 100 usuarios y la seguridad de mysql quiero que cueste más de calcular pero no quiero que se pero quiero tener lo proyecten en un usuario y contraseña que obtener seguridad pues en ese caso yo te diría pillate por ejemplo este de aquí en el servidor virtual xl y xxl pero no 20 euros al mes momento y ahora os cuento otra cosa pero y si quiero tener mil usuarios dos mil usuarios a la vez pues en este caso yo te diría mira aquí lo vas a reventar lo que tienes que hacer es irte a un servidor dedicado a un servidor dedicado es una máquina para ti en el hosting conectado 24 horas al día y probablemente tienes que gastar 80 euros al mes un momento porque ahora viene lo que os quería decir la donde yo creo que la cámara y siempre porque la caja todo el mundo ahí es que 80 euros por 12 meses son 960 euros pero momento es hablando de 960 euros dos mil cuatro mil usuarios la pregunta ahí es bien la pregunta exactamente es esa y es si tienes cuatro mil usuarios a la vez conectados a la vez lo cual quiere decir que al día podrías tener 40.000 usuarios hablando de cuatro mil a la vez en el mismo momento al día podrías tener desde 40 mil hasta 4 en 2000 no a la vez la pregunta es que monetización estás haciendo de esos digamos 40 mil usuarios porque si tú me dices ninguna yo te digo la estás claro porque te digo si tienes 40.000 usuarios en tu juego tienes que buscar algún método de monetización más o menos para tener beneficios o solo para cubrir costes pero de alguna manera tienes que empezar a contemplar eso porque mantener un juego tan grande a ti te va a suponer costes no ya el coste en máquinas que es muchas veces lo de menos el coste humano es mucho más caro entonces ahí yo no te digo cómo hacerlo yo te digo múltiples opciones que digo cobro por publicidad cobro por acceso pay to pick to win efectivamente el que pagar por mejoras lo que vosotros veáis o todo eso a la vez pero en definitiva no puedes tener 40.000 usuarios en un servidor sin haber encontrado antes la manera de monetizar parte de esa gente que está en el servidor por tanto cuando yo veo esta cifra yo realmente no estoy viendo esa cifra a mí me da igual esa cifra yo sé que cuando tenga 40 mil usuarios voy a tener gastos mucho mayores que esto de aquí cuál va a ser mi gasto mucho mayor que lo que me gasté al año en un servidor pues me gasto mucho mayor va a ser que 40 mil personas yo sé que de vez en cuando el sistema va a apretar y hago problemas o bugs o de repente la base de datos que funcionaba o la tabla que funcionaba perfectamente con 4000 personas pues 70 con 40 mil porque hay cosas que hasta que no las metes en sobrecarga no te das cuenta que apretan y cuando eso que ocurre pues que tiene que haber uno de los programadores aplicando código a muerte para devolver el juego el funcionamiento en el menor tiempo posible y esos cobráis en lo que cobráis al ahora es mucho más que 960 euros al año pues te digo que cuando llega ese momento el costo del servidor es un poquito lo de menos pero cuando llega ese momento tienes que haber visto porque si tienes cuatro en dos mil usuarios dando problemas dando correos de hoy esa nueva función ayúdame oye el juego deja de funcionar y tú de repente estás pringao programando para que vuelva a funcionar estoy probando esto gratis esto que es que estoy trabajando para 40 mil personas sin cobrar nada a cambio por eso digo que cuando estáis hablando por ejemplo del juego de master of castle sobre lo que sea realmente el menor de los problemas es la programación lo que tenéis que empezar a considerar es cuánta gente va a jugar ese juego qué problemas nos va a dar y de qué manera podéis recoger dinero de ese juego no hablo de hacerse ricos hablo de que no llega un momento que llega a rastras esclavizado con el juego esté gastando de pasta es todo tiempo y no estoy recuperando nada de dinero de ello vale así que exacto pero algo que por lo menos no me hecho rico pero cuenta con paga por no es tampoco me arruinado por sacar a un juego porque básicamente no hay nada más en el mundo que tener que pagar por trabajar que no sean los primeros pero no quiero que lo hagáis bien hay un caso más extremo todavía en el que no creo que lleguéis a ese caso al menos hasta dentro de un tiempo me sorprendería mucho que llegaréis rápidamente a ese caso pero bueno a ver qué pasa qué es el caso que digáis mira es que no tengo a verlo a ver si es verdad tu primero escucha el reto muy bien el reto es que yo os diga mira no tienes 400 sanz no tienes 40 mil 400 mil usuarios tienes 400 millones de usuarios es claro no hay plan de one on one que te valga es más con 400 millones de usuarios tú no necesitas un servidor dedicado tú necesitas como 20 servidores dedicados como 40 servidores dedicados es que en ese momento quiero decir cuando tienes 400 millones de usuarios primero estás ganando se supone esperemos suficiente dinero como para contratar unas instalaciones como para comprarte una serie de servidores y como para los servidores estén en tu empresa no subcontratados a una empresa como one on one sino que seas tú el que maneja servidores por supuesto en ese momento como te puedes imaginar con 400 millones de usuarios tú tendrás mínimo tres turnos rotatorios de ocho horas de ingenieros de sistemas que estarán así sentados mirando los servidores esperando que alguno para arreglarlo y esas personas y esos que te cobran te voy a decir pues mira igual a una persona de esas que cobra dos mil euros al mes digamos que hay tres técnicos en cada turno o tres ingenieros lo que quiere es contratar por tres turnos con lo cual al mes te vas a gastar si quieres o multiplicamos por 12 realmente por 14 contando las pagas extra están contratados te vas a gastar un cuarto de millón de euros en los salarios de los técnicos de sistemas sí claro pero no de tres tiros por la mañana tres tiempo tarde tres días por la noche eso esos mantenimientos los que hacen que los servidores de encendidos y luego más los programadores como te puedes imaginar cuando tienes 400 millones que hace falta gestor secretario o secretaria contable administrativos evidentemente los programadores alquiler de oficinas compra de equipos marketing entonces lo que lleva una empresa grande y en el marketing se va a una pasta en el marketing bien hecho se va a una pasta entonces exacto es que el marketing y marketing no saben de las cosas que es lo que os decía ayer que no es los ejes los juegos no pensáis como lo que pasa que ayer nos lo decía en plan aficionado en plan de bueno a ver algún colega famoso que tengáis pues que hable bien pero cuando hablamos de estas cifras ya hablamos de algo más serio entonces por eso os digo que en cuanto a servidores pues pueden escalar realmente todo lo que queráis también os digo que no soñé con que vais a lanzar un juego y al día siguiente vais a tener 400 millones de usuarios ojalá es que eso es morir de éxito entonces eso es lo que yo quisiera para vosotros prospectar al servidor porque tener al servidor es que te da muy bien con lo cual sabes que decir más vale que te pretende el servidor porque tienes muchos más usuarios lo que habías pensado que hemos es un servidor y aquí no se conecta ni el tato entonces bueno en ese momento pues sabes que el problema cuando te peta en el servidor es contra transferido de más grande pero también insisto cuando el contrato es un servidor más grande ves pensando no sobre la programación en las matrices sino en cómo de alguna manera no te digo extraerle el dinero a la gente pero por lo menos que la gente contribuya de alguna manera que por lo menos cubra los gastos y si puedes tener algo de beneficio pues mejor que mejor porque pues porque no sólo cubre el gasto sino cuando lleves un año trabajando en el proyecto y llegar muy bien que cobra gastos cubiertos gastos pero ganado cero y hoy no vivo del aire pues quieras que no si le dediquéis un equis tiempo ese videojuego pues mínimamente querréis cobrado por ello no te digo que este es 24 horas al día pendiente del juego dices pero mira tengo otro trabajito me encontraba otro trabajo pero a este juego le acabó dedicando una hora al día pues esa hora al día por lo menos que tenga cierto retorno porque si no el tiempo básicamente te cansarás es que sepáis en cuanto a servidores que hay múltiples opciones hay múltiples escalabilidad y a partir de ahí depende de cuántos usuarios tengáis pues tenéis que elegir un sistema u otro o una base de datos u otra ahora de momento para prototipar videojuegos para hacer juegos sencillos que además podamos y soltarlos y que funcionen directamente pues ese kulite desde luego nos va a hacer bastante función otra manera de persistir voy a escribir una carpeta llamada archivos otra manera de persistir consiste index.php mirad consiste en escribir el siguiente código que es un código parecido al que estuvimos trabajando ayer atención vamos a ver es este código de aquí es muy sencillo y dice los siguientes afp es este de aquí un momentín fp es igual a hola punto txt y diego en fp quiero escribir hola cómo estás ya está así de sencillo no este código es lo pase ayer él sanitizer lo estamos dando hoy entonces en archivos tengo un archivo que básicamente dice la variable fp equivale a abrir un archivo llamado hola punto txt y abrirlo en modo a plus ahora os cuento en qué consiste la flag la bandera a plus eso es si no está la archivo lo crea y si está el archivo añade al archivo y a continuación pongo efe right donde digo en el archivo escribo el texto hola cómo estás si yo ahora ejecutó mirad ejecuto este código pongo localhost archivos aparece de repente que antes no estaba un archivo llamado hola txt pero atención todos a la pantalla mirad si lo ejecutó otra vez el archivo o la txt ahora tiene hola cómo estás si lo ejecutó otra vez ahora tiene tres olas cómo estás recomiendo poner al final del archivo index.php contra barra en contra barra r si lo que hace es bajar de línea fijaos recargó unas cuantas veces recargo el archivo y pone hola cómo estás voy a poner voy a hacer una cosa sólo contra barra en eba el señor lo que hace es bajar una sola vez mf bright por tanto tenemos una serie de banderas una serie de flags donde fijaos que en la documentación de la isla vista de banderas valentín efe rights no perdona efe open ep efe open y bueno hay como siete u ocho qué son las siguientes grado tenemos el modo ver que es abrir para solo leer el modo r plus que es que apertura para la lectura y de escritura y coloca el fichero el puntero al principio aperturas sólo para escribir con punto del principio apple apertura para escritura colocando el puntero al final es decir él viene de apem l lr es de ruiz en la w 6 wright y la a es de a pena añadir a plus lo que hace en este caso es que abre el archivo para lectura escritura coloca el puntero al final y si el archivo no existe se intenta crear vamos a ver tengo x creación y apertura solo para la escritura x plus es sólo para escritura en definitiva los que se llevan usando es r sólo para leer w para escribir y cuando digo escribir quiero decir lo siguiente mira eso es le digo w recargo la página me voy ahora y dice hola cómo estás yo recargo la página y me dice hola cómo estás lo que ha hecho es borrarlo todo y escribir solo lo que digas en ese texto que a veces interesa a veces es lo que quieres para que otras veces que quieres que el archivo sea como una especie de mini pequeña base de datos con lo cual lo que quieres es que vaya almacenando registros y registros bien esta es la primera mitad de esto que os quería enseñar en esta mañana la segunda mitad de lo que os quiero enseñar es como leer hemos visto cómo escribir vamos a ver como leer por tanto en archivos me voy a crear un nuevo documento llamado leer php y en leer php digo lo siguiente php ferring moment in que buscaba un ejemplo por ahí tengo alguno en el servidor pero en el que tiene un bucle a este vale hay que ir a algún ejemplo en el servidor un segundo ferrer y wilde esto es unos discursos lo que quiero es uno voy a este lo voy a simplificar el or die lo voy a quitar digo quiero ir a hola punto txt y digo mientras que no alcance es el final del archivo el file end of file eco efe gets my fire vale pues sí guardo y recargo esto archivos leer php vamos a ver dice que no lo encuentra no encuentra o la coma txt no es que no es coma es punto así que pulsa enter y dice hola cómo estás pero dice hola cómo estás por qué no la txt pone hola cómo estás así que en definitiva el primer archivo index.php lo que hace es escribir algo en un archivo de texto y el archivo leer php lo que hace es leer algo de ese archivo de texto y juntos por tanto lo que os permiten es en definitiva persistir entendiendo por persistir el que de alguna manera podéis guardar datos en el sistema de archivos de manera persistente para que cuando alguien se vuelva a conectar recupere sus datos y siguiendo los datos posiciones vida armas puntuación lo que sea y a lo largo de los días y a lo largo de las semanas vais a ver que yo de momento hasta la fecha os he empezado a enseñar mysql os he empezado a enseñar sqlite ahora os he empezado a enseñar escritura y lectura de archivos para que cada uno de vosotros según el caso en el que se encuentre según el juego que se encuentra desarrollando valores pros y contras y pueda elegir el sistema o la combinación de sistemas de persistencia que en un momento dado más os pueda convenir en la clase de hoy vamos a ver un uso un poco diferente de lo que estamos aprendiendo hasta ahora pero siempre dentro del marco de lo que vais a necesitar dentro de un juego y de por supuesto lo que os exigir en los deberes semanales mensuales o algo así que es la idea de crear un configurador pero por ejemplo un configurador de personaje pero no un configurador de personajes al nivel de por ejemplo imagínate que tienes un personaje y dices oye pues tienes yo que ese chaqueta de cuatro colores y puedes elegir uno de los cuatro colores no no a ese nivel no al nivel de que la persona que está jugando al juego pueda abrir como una especie de micro photoshop y le puedo decir que no pinta tela chaqueta como quieras es decir que las posibilidades del juego sean ilimitadas que abras el juego de manera que cualquier persona se lo pueda configurar o por ejemplo si habláramos de imagínate algo rollo minecraft pues que tú puedas crearte las texturas pero no hablo de bajarte un patio texturas editarlo en photoshop y luego subirlo si no hablo de una parte del juego donde dentro del mismo juego tengas como ya os digo como un micro photoshop como un mini editor así que vamos a por ello vamos a crear en este caso me voy a ir a la samp me voy a ir a http voy a ir a crear una carpeta llamada micro editor y dentro del micro editor vamos a verlo dentro de micro editor vamos a crear un archivo va a ser index php aunque no sé si usaré php en la primera parte de este proyecto la segunda seguro que sí pero bueno lo llamamos php y así pues nos curamos en salud y sabemos que lo tenemos preparado para que en cualquier momento pues pueda tener contenido php ya sabéis que también me voy a vamos a verlo me voy a copiar la librería de jquery porque la suelo necesitar así que micro editor bien y por tanto vamos a hacer un documento html que va a tener un jefe que va a tener un móvil que va a tener un script con src es igual a jquery punto j s entonces dentro de este script digo no comen punto 9 es una función qué va a hacer lo siguiente es una función dónde pues bueno digo a leer todas así que cargo bueno por supuesto arranco apache vayamos en fin el sant contra el panel arranco mapache esto fuera empezamos aquí y vamos a verlo ahora me voy al localhost me voy a micro editor y de momento evidentemente no tengo nada por el momento por no tener no tengo ni el alert hola bien que está pasando aquí vamos a ver lo tengo un error en la consola y así es que he puesto en función y es function así que recargo y ahora dice hola lo cual quiere decir que este elemento ya se está cargando pues correctamente ahora lo que voy a hacer es crear un canvas y este canvas va a tener el aire llámalo lienzo porque como vamos a pintar en el iba a tener un wifi de 32 píxeles y va a tener un height de 32 píxeles entonces les voy a decir con estilo simplemente para verlo en pantalla que todo aquello que sea el canvas pues tenga un borde de un píxel solid grade así que guardo y recargo me dice hola otra vez vale tengo ahí el canvas una cosa voy a hacer un pequeño zoom mirada puede ser un pequeño zoom para que se vea más grande y por tanto pueda pintar ahí dentro correctamente más que pueda pintar adentro correctamente porque poder pintar es que lo veáis en la pantalla correctamente entonces la idea es que dentro de javascript ahora voy a empezar voy a poder empezar a reconocer cuando pinto un punto en la pantalla creo recordar me viene a la mente que no hay una instrucción llamada pintar punto en canvas pero sí que hay una instrucción llamada pintar rectángulo y puedo hacer un rectángulo de pixar por un píxel por tanto mirad para hacer una primera prueba estática me voy a sacar el html5 canvas shit así que me saco esto miro la imagen está prohibida mira otra y encuentro esto y en bueno estos son paz vamos a ver tengo create images trata esto no éstos son rectángulos con lo cual pues básicamente va a ser esto hay un punto extra pero tenemos lo mismo tenemos bien voy a hacer en este caso por tanto un rectángulo por tanto en un rectángulo va a ser en este caso un fil recto un rectángulo rellenado recordamos una vez que antes de hacer nada antes de mover un dedo pues lo que necesitamos es crear un canvas como se crearon canvas pues lo voy a tener por aquí en la pista en w en index por ejemplo y recordamos que lo primero que teníamos que hacer era poner estas dos líneas de código es decir le digo en primer lugar el perdón esto no va a dentro del documento 9 y esto va afuera esto va en las estará en las condiciones iniciales así que por tanto ahora lo que hago ahora lo que le digo y es más recordáis que casi este script por seguridad me lo voy a poner bajo del canvas lo que ellos quitarlo de arriba y ponerlo bajo bien pues les voy a decir que quiero manipular ese rectángulo entonces para decirle que quiero manipular ese rectángulo pues le digo qué vamos a ver contexto punto el recto y le voy a decir qué pues 4411 es decir quiero un rectángulo que empiece en el pixel 4 en x que empiece el pixel 4 y que tenga un píxel de anchura y un píxel de altura así que por tanto le digo vamos a ver le digo con texto punto field style y le digo feel style es igual a rgb y voy a poner 25 500 vamos a verlo si todo va bien vamos a rossi sí totalmente no es mi canvas sino que es lienzo así que guarde y recargo y lo que veis en la pantalla de momento es que lo que sale es pues como veis hay un punto de color rojo un punto de color rojo porque evidentemente es el punto como he hecho la imagen grande se ha hecho anti alias pero realmente el punto se vea y estacionalidad el cuadrado que así que me conviene que se vea grande que así que me conviene que se me ha difuminado pero el objetivo de momento como veis fácilmente al principio es simplemente comprobar que somos capaces de crear un punto del color que queramos en la posición que queramos a continuación vamos a hacer algo un poquito más divertido y es que podamos pintar dentro del canvas así que al pintar dentro del canvas lo que vamos a hacer es lo siguiente voy a decirle que cuando esté dentro de el lienzo y haga mouse move es cuando muevas el ratón voy a hacer una función con el parámetro qué va a decir lo siguiente veis que he puesto el lienzo mouse move que es cuando muevas el ratón por ahí dentro le pongo una función y atención a el parámetro porque el parámetro es el que me permite es el que me permite capturar el evento y sacarla x la y de la posición con respecto a dónde está el ratón entonces para ello hago los siguientes 90 jquery mouse move que era el punto cliente x creo pero me voy a asegurar para averiguar la posición x quiero recordar que sí porque de hecho demostrar una vez entonces función event page x casi entonces este hecho yo creo que el cliente x también existe cliente x 61 cliente x page x no sé vamos a ver cuál funciona bien entonces yo por tanto ahora le digo este contexto lo pongo aquí dentro y el lugar atención en lugar de poner 4 y 4 pongo el punto cliente x y punto cliente y si todo ha ido bien vamos a verlo lo que estoy haciendo es que mirad cuando voy pasando el ratón daos cuenta cómo puedo empezar a dibujar con un poco de desfase no te digo que no ahora veremos porque con un poco de desfase pero puedo empezar a dibujar y en el desfase está producido por el zoom con lo cual si ponéis el zoom real ahí bueno luego también el cursor también me está afectando la posición del cursor vale con lo cual pues lo que voy a hacer es lo siguiente vamos a verlo porque aquí ya no me detectas lienzo magos veis que me detecta solo esa parte de ahí me detecta como máximo hasta aquí vale pues vamos a ver page x y page y no sigue teniendo un cierto paralaje es interesante que no me deje ir más allá de eso vamos a verlo no es una cuestión de no es una cosa de márgenes parece vale pues voy a ver qué es lo que ocurre y qué podemos hacer porque tenemos hay un editor pero no está ajustado al límite si veis siempre y pintando no está ajustado al límite exterior bueno ahora lo veremos voy a ir con otra cosa que con el tema de color pero bueno ahora veremos el por qué no me deja porque me deja un margen de x píxeles en cuanto al selector de color os voy a hacer sufrir poco porque en html5 ya existe un input llamado color así que mira digo input type es igual a color y de es igual a mi color por tanto fija o simplemente recargo y fijaos que me aparece un recuadro que de momento es negro donde si yo hago clic me aparece un selector de color donde yo puedo seleccionar el color que quiera así que con esto fijaos que hace un pintado pues es más fácil de lo que parecía en un principio con esto lo que puede hacer es algo tan sencillo como lo siguiente lo que hago es que cada vez que voy a pintar cada vez que muevo el ratón le digo el color es igual a mi color punto vale entonces lo digo con texto fill style el fil está el del contexto es igual al color por tanto guarde y recargo y vemos como si seleccionó el color morado pues pinto de color morado y seleccionó el color verde pues pintó el color con el color verde y seleccionó el color naranja pues pinto con el color naranja así que bueno como veis hacer un pequeño editor y permitirle a la gente que pueda editar sus archivos pues no es tan difícil como podría parecer en un principio luego se puede complicar más se puede complicar todo lo que queráis pero de momento vale como veis es sencillo siguiente cuestión mirad y esto que tengo aquí quieras que no lo digo porque al principio de la formación pues no era importante pero yo creo que ahora empieza a ser esto que tengo aquí se llama una variable intermediaria es decir primero he colocado aquí un color mi color punto vale luego llamó aquí el color me preguntaron muy de haber puesto directamente mi color punto vale por la verdad es que sí que está haciendo esta variable no cumple una función de variable realmente si no hace una intermediación lo que hace es guardar temporalmente un valor para a continuación comentarlo entonces en refactorización ya sabéis que siempre digo que la prematura es el origen de todo mal pero en este caso es la re factorización sencilla que podemos hacer entonces simplemente lo que voy a hacer es este mi color punto vale lo voy a pasar aquí dentro de color me cargo esa variable intermediaria y por tanto lo que voy buscando en este ejercicio dentro de lo posible es la sencillez y cuando digo sencillez quiero decir que todo lo hagamos de la manera más sencilla y más fácil posible con menos líneas de código posible pero que evidentemente funcione si la pregunta es si el script tendría que estar dentro del body la respuesta es que no debería pero es mejor que esté dentro del body por qué pues porque yo hago lo siguiente mira supongamos que yo cojo el script lo meto dentro del head que es donde debería ir pero corro el riesgo de que al recargar me dé un error y me dice no puedo leer la propiedad de get context of null y digo cómo es posible que antes daba nuevas error y ahora sí creadas bueno el game el get context es del contexto y el contexto es el documento el mlm del lienzo el problema está en este caso que el script en este caso está llamando a un elemento que no existe todavía y por eso da error sí claro para ello lo que podríamos hacer es poner las condiciones iniciales dentro del documento web y sólo carga las condiciones iniciales cuando el documento esté preparado sin embargo esto nos generaría un problema y es que tendríamos declarada estaba como variable local dentro de la función o tendríamos que declarar la vacía y luego declarar la aquí dentro para que fuera global para que pudiera ser compatible o compartida entre las funciones mucho más sencillo aunque no muy estándar pero verás que todo el mundo lo hace es colocar el script detrás del elemento quiero decir con esto que yo primero creó el canvas y luego llamó al canvas y por eso cuando guardo y recargo verás que no da ningún tipo de error porque en el momento en el que estoy llamando al lienzo ya existe un elemento llamado lienzo en pantalla y por eso es por lo que nos da el error una vez que te asaltan la regla de sacar el script del head que es dentro de done debería ir realmente un script se puede poner en cualquier parte del documento no te digo ya solo ponerlo después del body sino puestos a ponerlo después del body para eso lo ponemos después de html para que esté completamente fuera de lo que es la estructura del documento y ahora sí insisto funciona pero no sólo eso sino que podemos saltarnos otras cosas como yo por ejemplo puedo hacer lo siguiente esto no es que recomiende hacerlo pero te digo se puede hacer entonces fíjate que pongo un style y digo canvas es igual a background ping entonces guardo y recargo y comprobarás como en este caso poner un estilo dentro del body no es lo que deberíamos hacer pero se puede hacer entonces html dentro de los lenguajes de marcado programación es de lo más permisivo que hay en cuanto a que html te marca una serie de reglas pero tú te puedes saltar bastante de esas reglas y el programa sigue funcionando en este caso por tanto no voy a poner esta él dentro de body aunque lo que os quiero decir es que funcionar funciona porque no me aporta nada la idea es que solo me salto las reglas en este caso me salto esta regla de aquí cuando saltarme esta regla de aquí ponerlo bajo o ponerlo dentro del body me aporta una ventaja y la ventaja es más sencillez a la hora de trabajar con variables globales o con variables locales ahora mismo cuando estoy dibujando por ejemplo seleccionó un color ocurre que estoy dibujando solo por mover el ratón pero claro a mí lo que me gustaría es solo dibujar cuando yo tenga el botón izquierdo del ratón pulsado vale es que hay por ejemplo que vamos pinchar y arrastrar pero ahí lo que hago es dibujar o sea me admite el madre desde el clic pulsado así que lo que quiero hacer como os podéis imaginar es que el lienzo mouse move y voy a hacer lo siguiente mira vigo jquery check i left click y expresa y quiero comprobar vamos a verlo no es un evento es un estado de texto les mouse press vamos a verlo detesto y vent button vamos a ver lo opera y chrome muy bien si ven which o even button vamos a ver así que aquí digo even which es igual a 1 hoy ven button es igual a 1 en ese caso lo que hago es pintar y si no pues no el punto waits punto widget punto de punto which no lo sé no por qué esperas pero espera si vamos a verlo esque esto esto gvc es igual a window vent es un elemento de la ventana claro es que es para el magos move así que por eso digo que efectivamente faltaba decir que es vd así que recargo y solo cuando hago clic es cuando realmente empieza a pintar es más si funciona en ese caso prefiero poner y para ahorrarme una línea de código pues si funciona fuera el window lenta y así más sencillo todavía así que bueno fijaos que de esta manera fijaos que de esta manera yo puedo pintar y puedo elegir por tanto por donde estoy pintando hay una cosita que me gustaría hacer que es el poner una especie de cursor que me diga por dónde voy a marcar el punto por donde voy a dar el punto sin embargo esto lo haremos mucho mejor en cuanto hayamos solucionado el problema de porque hay un cierto paralaje porque hay un cierto desfase entre el principio del marco y el objeto así que voy a solucionar eso primero y a continuación seguimos pintando parece que encontrado una solución entonces lo que voy a hacer es lo siguiente mira le digo muy voy a hacer lo contrario en lugar de centrarlo lo que voy a hacer es que al mode y le voy a decir martín 0 píxeles padding 0px el es así que guardo y recargo a ver que seleccione un color vale y ahora al pintar pinto perfectamente bien con lo cual lo que voy a hacer mirada atención es implementar esta solución donde en este caso lo que tenemos es que el canvas es el cliente x vamos a verlo claro hay que el canvas bien pues digo y punto cliente x menos contexto offset left ahora pongo la y sigo y digo lo siguiente digo el cliente y en lugar de contexto voy a poner fe creo que puede ser eso por lo que está fallando así que guardo recargo vale me falta a cypress pero también falta uno el cliente x aquí me sobra un punto y coma por tanto guardia y recargo y ahora yo sé atención cómo puedo quitar lo del martín y el padding del body y seguir funcionando con normalidad por tanto ahora fijaos que puedo pintar como quiera fijaos que puedo pintar como quiera puedo pintar como quiera puedo pintar como quiera como ya os digo un micro photoshop pero en definitiva tenemos ya la posibilidad con esta sencilla con este sencillo bloque de código de decirle a nuestro usuario y puedes dibujar te puedes personalizar tú mismo el juego bien la idea a continuación va a ser la siguiente yo tengo un dibujo y ese dibujo lo hemos hecho en la parte del cliente usando el canvas pero de qué sirve que mi usuario pueda crear una pintura si luego no puede guardar su información así que lo que vamos a hacer a continuación y esto va a ser un poco lo teóricamente difícil de la clase va a ser permitir al usuario que pueda guardar esa información en pantalla por tanto lo que voy a hacer ahora va a ser tan sencillo realmente pero es por animaros entonces cómo crear un botón por aquí abajo crear un botón con él y de guarda llamado guardar voy a poner un br voy a poner un ver voy a poner un verde la idea por tanto es que el usuario primero pueda pintar y cuando le dé a guardar pues que la información se guarde en el servidor para ello por tanto me voy a crear una carpeta en micro editor llamada esto no es una navaja al final puede crear una nueva carpeta llamada imágenes para que todo aquello que cree el usuario pues se cree dentro de esa carpeta de imágenes y atención por lo tanto ahora voy a hacer lo siguiente como os podéis imaginar como os podéis imaginar todo aquello que ocurre en el lado del servidor requiere un archivo llamado guardador php así que tengo guardado php y en guardado php guardador no puede guardar nada si previamente no le pasó yo la información así que lo primero que necesito es pasar a la información y por eso en el documento ready bajo de todo este rollo del lienzo le digo cuando sobre guardar haga clic en ese caso voy a ejecutar una función en la que sobre ajax que es ajax pues ajax es un dip y de ajax que creo aquí arriba entonces le diré sobre ajax punto load punto cargo guardador php dónde donde el código donde fe es igual a que pues espera que no lo sé espera que no lo sé porque tengo que registrarlo pero vamos a ver html5 de canvas data eso es eso sí get inmediata es más html canvas to data url eso es lo que estoy buscando muy bien una representación el valor por defecto es png un segundo aquí está así que lo que hago es decir tu data url y de hecho mirad si queréis voy a hacer lo que propone en este ejemplo me parece muy buena idea qué es poner decir mira de paso le digo con soul efe url para que veáis que es lo que previsualizar qué es lo que se va a enviar así que guardo recargo y mirad luego ya con solá pinto un poquito veis pinto un poquito por aquí le doy a guardar vale no sobre nada guardar punto clic guardan guardas que es guarda vaya aquí es guarda yo le he hecho guardar vale pues guarda en definitiva así que pinto y le doy a guardar y fijaos que sale eso vaya si no es un link puede ser un link se hago clic en una imagen si pero lo más importante mirad qué cosa más curiosa de que os suena esto de la 64a y bartolo de ayer y os acordáis que ayer los elementos tendrían empezar por uve mayúscula ya acababan con signos iguales o parecidos de desplome acuerdo ponemos a repasar los vídeos de ayer y lo veréis vale entonces eso que estáis viendo en la pantalla es el código realmente de un archivo png codificado en base 64 porque representarlo en binario sería un poco duro vale pero que los representa 64 así que eso si os fijáis es lo que yo le voy a pasar a guardador oye que quieres guardar vale pues mira cojo esa información se la pasó a guardado y evidentemente cuál va a ser la misión de guardador pues la misión de guardador va a ser a vale pues cojo lo que me envías y te lo guardo en un archivo png así que a continuación lo que quiero es escribir el código de guardador php y digo que la variable f es igual a g es decir mirad si aquí en index.php atención estoy llamando a guardado el punto php y le estoy para pasando el parámetro ce pues aquí estoy llamando a que se dé más ni menos por tanto yo ahora lo que quiero es guardar un archivo png para ello me va a hacer falta sin duda alguna la librería php head es una librería de tratamiento de gráficos que viene ya pre instalada con php en prácticamente el 100% de los servidores está ya pre instalada así que un segundo voy a poner php head va 64to png aquí mira la pantalla vale entonces vivo voy a poner directamente esto froome que no lo pongáis si quereis esperar un segundo al comprobar que me funciona simplemente si lo que estoy pasando es un 64 codificado pues lo primero que quiero es decodificarlo a partir de ahí por tanto vamos a ver email create from string pero yo lo que quiero luego es guardarlo al disco duro eso es lo que quiero para el putt contents y un segundo todavía porque esto puede ir cambiando estoy buscando la fórmula más sencilla para conseguir el objetivo así que yo ahora vengo aquí y digo prueba punto jpg se lo guardó como png así que mejor así que por tanto si todo ha ido bien no lo sé imagínate que va bien y todo a él lo guardo en imágenes prueba png así que dibujó un poco le doy a guardar tengo ahí el data y ahora lo que hago es que me voy a micro editor me voy a la carpeta de imágenes si todo ha ido bien aparece una carpeta llamada prueba me escapa un poco que no me haga una previsualización ocupa 266 bytes y bueno menos es nada le doy a vista previa y parece que el archivo está dañado o es demasiado grande vale pues voy a hacer lo siguiente voy a llamarlo como jpg como proponía el ejemplo así que recargo dibujo le doy a guardar me aparece una imagen con formato jpg tampoco parece que el archivo sea correcto pero en definitiva estamos cerca en definitiva estamos cerca en cuanto a que lo que estamos enviando por pantalla voy a decir lo siguiente voy a decir que voy a asegurarme que lo que estoy enviando es lo correcto y quiero comprobar una cosa mirad quiero comprobar que algo así le voy a guardar y si esto acaba en un igual eso acaba en un igual lo que quiero comprobar es que lo que se está enviando y lo que se está recibiendo coincide exactamente para asegurar que no se me esté recortando ningún dato vale pues una vez averiguado eso vamos a ver por qué por tanto puede estar fallando la creación de la imagen la creación del archivo vale si eso no pasa esto me hace un poco más de ilusión entonces voy a este ejemplo así todo digo voy a minimizar esto y digo esto es gay está haciendo un reemplazar todo esto de aquí vale bien muy bien vale 164 de code aunque yo creo que eso ya lo tenía pero vale file put content png esto es imágenes así que vamos a probarlo por tanto recargo le voy a guardar es que creo que el data email ya lo tenía por tanto dónde está aquí el micro editor imágenes bueno vale pues esto ya es algo sale negro sí claro cierto pero y abrirlo con el ejemplo y a ver qué me dice el tiempo porque del visor de imágenes de windows no es que me fijé mucho con lo cual me fue bastante más de lo que me digan en este caso el game ya me está sacando una imagen vale aunque vacía si bien vamos a hacer lo siguiente voy a pintar con unos cuantos colores pinto con unos cuantos colores le voy a guardar me sale esta imagen sigue estando vacía vale vamos a ver vamos a ver este str lo voy a poner a nada pero espera está esto es correcto lo que hago es que busco esto y lo reemplazó con nada vamos a verlo bueno pues finalmente grabamos la solución que es esta de aquí gracias a josé luís que ha encontrado el truco este de quitar los espacios y ponerlos sustituirlos por un signo más ya ves tú pero en fin bien entonces bueno esta es la solución que se nos queda que básicamente es lo que viene por la url quitarle la pre coletilla de data emails png va 64 sustituirla por nada a partir de ahí a hacer ese reemplazado de quitar los espacios por el signo más y a partir de ahí ya un the code y un file get contents bien pues lo que quiero ahora curiosamente es hacer lo siguiente mira en este imágenes prueba png voy a quitar lo de prueba y voy a reemplazarlo atención por nate es decir no quiero cada vez machacar la imagen sino que lo que quiero es que cada imagen se guarde en el segundo que se ha enviado y además quiero saber quién está guardando la imagen por tanto lo que hago es también decir dólar guión bajo server remote adr era ritmo de r creo que sí así que guardamos copiamos pegamos buscamos vayan a otros copiados así que copio pero y remote a tpr bien para por tanto lo que ocurre si todo va bien vamos a verlo mirad el momento en la pantalla y es que yo hago así guardó bien vale me dice fail y valen argumento y mal porque los dos puntos no se valen como tal entonces voy a poner 12 192 168 120 quién era yo 4 creo o 26 no lo sé sí porque no sé si estoy guardando ahora estoy viendo nuestro y el código entonces si eso es entonces voy a hacer un ip con cic para comprobar que realmente soy el 26 o sea que estaré viendo el código de uno de vosotros vale pues ahora sí pues lo que hago es pintar le doy a guardar y ahora no me da error y compruebo espera que no ves el código ahora sí y compruebo como en la carpeta de imágenes pues tengo 145 todo esto y 19 21 681 26 con lo cual compruebo que estoy realmente ya empezando a guardar voy a poner por aquí un guión así que compruebo como estoy empezando a guardar las imágenes me estoy guardando para cada una de las imágenes pues en qué momento se ha guardado y qué ip ha guardado esa imagen concreta ojo que esto es un salto de línea quiero deciros con esto que esto realmente va en una única línea es un dato o un encadenamiento con un guión para separar es una cadena y luego el remote address y por último para este ejercicio por último para este ejercicio no solo quiero poder crear un beat map y poder guardarlo sino que mientras lo voy guardando quiero ver los beat maps que la gente va colocando en mi servidor por tanto para eso voy a hacer lo siguiente mira me creo por aquí debajo del ajax por ejemplo un dip y de igual a galería y en el código me creo una función loop que ya sabéis tiene el mismo rollo de siempre de bar temporizador es igual a nada entonces le digo aquí por ejemplo le digo temporizador es igual a set time out ejecuta me loop dentro de un segundo y luego le digo pues temporizador tres cuartos de lo mismo y le digo clear time out temporizador así que guardo así que recargo y ahora dentro del loop lo que haré es que dentro de galería quiero lo quiero cargar el archivo galería punto php como os podéis imaginar el archivo galería php lo que va a hacer es una vez por segundo pues enviar la galería es decir revisar esa carpeta a ver qué tiene y lanzarme lo que tenga esa carpeta en la pantalla es decir a medida que la gente viendo nuevas imágenes pues me las va poniendo en la pantalla una galería de arte libre para ver cómo funciona así funcionará tanto en lan como en internet externa a todos ver todas las imágenes de todos sin haber guardado base de datos a las palabras con lo cual ahora por último esto lo tengo donde pues mira esto lo tengo tan cercano sabéis el software que usáis todos los días para ver los contenidos de máster pues ahí tengo entonces a la temática index bien pues mirad eso está aquí abajo esto está aquí abajo y bueno digo lo siguiente no te cuelgues al hambre déjame que recargue si hay una radio break un segundo que no solo se ha colgado sino que ahora no y no sólo no va bien entonces bajó abajo del todo y digo lo siguiente archivo x estamos ahora en tenemos que crear ahora el archivo llamado un documento llamado galería php lo que hace es lo siguiente digo archivo x es cambiar el directorio imágenes esto quiere decir mira lo que hay dentro del directorio de imágenes así que para cada uno de estos archivos de aquí vamos a ver para cada uno de esos archivos de aquí eco img src y esto es archivo es decir esto es archivo así que si todo ha ido bien yo creo que sí yo creo que sí yo creo que sí todo bien ahora recargo vamos a ver lo vale ahí me empiezan a aparecer seis imágenes las seis imágenes no tienen la url correcta un segundo donde un segundo que ahora lo pongo en pantalla pero ya empiezan a aparecer x imágenes y digo a ver esta imagen porque falla aclaró muy bien vale porque falla porque le tengo que decir entra en la galería imágenes entra en la carpeta de imágenes y sácame el archivo por tanto ahora ahí va alguien me ha dejado una sorpresita ahí que pone hola por tanto ahí la idea es que ahora cada segundo veis cómo se pueblan cada segundo pues si yo ahora vengo aquí y digo mira dibujo esto y cojo color morado y dibujo esto y cojo color verde y dibujo esto guardo y a continuación aparece esa imagen en la pantalla es decir por tanto lo que vais haciendo si entráis en mi web lo único es que voy a hacer que el refresco no sea cada vez se usan o sea cada segundo sino que sea cada diez segundos o que sea cada equis momentos pero una vez cada segundo parece un poco excesivo pero fijaos que yo puedo pintar yo digo ahí otra vez hola así que y ahora dibujo en morado claro nuestras cargas el codo le voy a guardar y la próxima vez que haga un refresco pues ahí me pone hola y por tanto lo que estoy haciendo es que en el momento o fíjate en saliendo de php en el momento en el que le estoy dando a guardar está igual donde las imágenes en mi servidor vale y la siguiente cuestión que os quiero decir es que esta última parte del ejercicio sirve para enseñaros cómo no sólo como os diría yo no solo se puede guardar datos en mysql no sólo se puede guardar datos en ese kulite no sólo se puede guardar datos un archivo de texto sino que también porque no el contenido de una carpeta puede ser directamente tu base de datos bueno únicamente nos quedaría averiguar qué pasa por aquí con estas imágenes que no han salido correctamente entonces os digo en estas imágenes mírate en cualquier carpeta imágenes corresponden a esto de aquí veréis que para cualquier carpeta no hay no lo veis pero en el futuro sí que se ve aparece primero un enlace que pone punto y otro que pone dos puntos eso quiere decir subir y bajar de carpeta entonces para eso simplemente lo que voy a hacer es algo tan sencillo mirad cómo es decir en galería contador es igual a cero aquí en cada este for each le digo contador + + o el contador más abajo del todo entonces le digo contador es mayor que 1 lo cual quiere decir básicamente que en las dos primeras rondas de este for its no me pinte nada en pantalla vale por tanto vamos a ver lo contador más contratos más es una variable y tiene que llevar un dólar así que lo que quiere decir básicamente que es en las dos primeras rondas no me pintes nada y a partir de ahí empieza a pintar pues lo que sea que quiere decir esto pues que con esto por una parte hemos hecho un ejército triple porque lo que hemos hecho es básicamente permitir que como os diría yo permitir que el usuario por una parte pueda pintar primera parte del ejercicio segunda parte del ejercicio pintar permitir que la pintura se pueda guardar en el servidor y tercera parte del ejercicio que podamos ver las obras de arte que hacen nuestros usuarios por tanto fijaos que a partir de ahí pues el darle por ejemplo no haya un lienzo vacío sino una plantilla vacía un personaje en blanco al jugador y decirle oye pinta de lo como quieras y guárdalo pues ya es mucho más fácil ya estamos un paso más cerca de conseguirlo