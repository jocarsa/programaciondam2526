ha grabación Entonces vamos a continuar por donde estábamos antes y yo ahora a continuación antes hemos hablado de la toma de medidas Vale y hemos puesto algunas muestras acerca de las medidas que se pueden tomar ahora a continuación vamos a hablar de Los criterios en base a los cuales podemos tomar unas medidas u otras Entonces cuando yo estoy en Linux o en Windows o en Mac y yo pincho el administrador del sistema Pues yo por ejemplo tengo una gráfica que me mide el rendimiento de los núcleos tengo una gráfica que me mide la carga de la ram y tengo una gráfica que me mide Bueno también las lecturas y escrituras a disco Por qué no vale Y la carga de subida y de bajada de la red y yo veo que la red en este momento se sitúa en una cierta carga de subida y otra de bajada vale la que sea por lo tanto yo a continuación lo que quiero es vamos a ver esto por aquí es averiguar Cómo se averigua eso es decir vengo por aquí y digo python get bueno get upload and download in vale Y lo que va a hacer vamos a abrir idel lo que va a hacer es probablemente medir en un momento dado esperar un segundo y realizar la el diferencial vale esto quiere decir vamos a ver Speed test Bueno tengo Speed test Bueno quería algo más manual Pero vale quier de speedest Pues también está bien vale lo que bueno pensaba que no a ver va a ver Speed test cli terminal pegar cli vale copio lo digo porque lo iba a hacer más manual pero si es que si precisamente la razón por la que lo estamos haciendo con python es precisamente por las librerías Pues bueno o se al final voy a usar una librería de una forma u otra Así que segundo eh servicios y procesos generación de servicios programación de servidores y 008 análisis del tráfico de red entonces vengo por aquí pulso f5 y me dice A ver espérate no no Esto no es esto no es porque lo que está haciendo es medir mis capacidades No yo no quiero esto no not That I want Get my current upload and Download bandwidth usage Network no me estaba haciendo un test de velocidad pero no quiero eso con PS útil Sí eso ya me suena mucho más vale bien pues a continuación ahora Esto sí que me suena mucho más esto es 009 uso de la red vale Y entonces ahora sí Bueno entra en un While true vale lo que hace es bueno hace un Time slip que el Time slip de intervalo será un intervalo de un minuto aquí está Perdona de un segundo quería decir en el intervalo lo que hace es el inicial el final y medir aquí lo veis el diferencial Así que le doy f5 y me dice que el upload es de 22,98 cas el Download es de 2,93 Y en este caso como podéis ver Pues he entrado en un bucle y en un bucle observo que en una utilización normal eh puedo empezar a observar como una especie de media pero si ahora a continuación Yo vengo por aquí y por lo que sea hago una imagínate no una descarga anormalmente alta me voy a ubuntu.com me voy a descargar vale fijaos que al entrar en una web la Perdón la descarga está subiendo aquí vale así que quiero Download madre de Dios esto Qué es productos ubun to desktop Descargar y descargar Vale y a continuación la empieza a continuación me lo empiezo a descargar no voy a acabar de descargarlo y la descarga si os fijáis la descarga bueno ha hecho un pico vale había pasado a 5 por segundo ahora vuelve a 500k por segundo en este caso probablemente estoy limitado por el ancho de banda de la conexión Wii en la que estoy vale con loal si me conecto a cable pues la amplitud del ancho de banda pues aumentará pero la idea Está en que si yo paro la descarga cancelo y fijaos como ha caído la tasa de descarga qué quiero decir con esto pues lo que quiero decir con esto es que con este Script podemos eh averiguar podemos analizar el tráfico de red podemos hacer que el propio servidor llegue a la conclusión de Qué es lo normal y qué no es lo normal y que por tanto a partir de ahí empieza a tomar una decisión vale vamos a ampliar este Script vamos a fusionarlo con los scripts anteriores Y vamos a ver a continuación Qué medidas podemos tomar bien me voy a 010 eh saco unos valores normales lo que consideraríamos un valor normal Entonces vamos a ver aquí vale aquí hay un Network usage no quiero esto quiero pasarlo a un software aquí intervalos igual a un vale intervalos igual a un esto no lo quiero esto tiro para atrás dident vale Y entonces hago los siguiente vamos a ver Eh descarga es igual a cer subida es igual a c y digo for gu bajo in Range de 0 a 10 es decir repito algo 10 veces y entonces digo lo siguiente vamos a ver el print no me hace falta aquí voy a parar no me deja parar pues paro a mano vale Y entonces digo descarga más igual a esto subida más igual a esto de aquí con lo cual al final del todo voy a decir eh subida es porcentaje igual a 10 y bajada Perdona dividido igual a 10 y bajada es dividido igual a 10 es decir durante 10 iteraciones estoy sumando y sumando y sumando con lo cual Claro si durante 10 iteraciones estoy sumando y sumando pues al final tengo que dividir si he sumado 10 veces pues divido 10 veces Vale y digo print eh A ver un momentín print y eh subida coma bajada no sé ni siquiera En qué estará expresado nu y vale partido 1024 2 me da igual es que me da igual que esté en kilobits probablemente f5 espero 10 segundos en esos 10 segundos estoy calculando los valores de subida y de bajada Ah no estoy en bytes vale bajada is not Define descarga es descarga y descarga vale espero segundos y tras 10 segundos vamos a verlo me dice que el valor en bytes es de 34000 de subida porque estoy haciendo un Stream y eh de bajada es 2538 si lo divido entre 1024 pues me dará el valor en kilb pero es que me da igual Es decir lo que quiero son valores normales me da igual que están expresados en bytes o en bits o en kilobytes o en lo que sea ahora a continuación una vez que tengo los valores normales Ahora sí me voy a ir a un Wi true así que digo While true ahora que ya tengo atrapados los valores que puedo considerar normales Y entonces vuelvo a decir esto Neo Time slip interval Y entonces digo subida es igual a esto eh nueva subida es igual a esto nueva descarga es igual a esto y digo si es cierto vamos a ver si es cierto que la nueva subida Es mayor que la subida multiplicado por 5 Es decir lo que yo consideré normal Vale pues si excedes en cinco veces lo normal va a pasar algo or nueva bajada es mayor a Nueva descarga Perdón nueva descarga Es mayor que descarga multiplicado por 5 en ese caso print hay alguna anomalía voy a poner un par de prints cosméticos print Empezamos el cálculo de valores normales vale Y ahora digo print ahora comenzamos la toma de datos que en este caso insisto se hace de forma constante en un While true pero luego a la hora de la verdad pues se puede hacer en un chom tad que lo mira una vez cada hora vale o una vez cada 5 minutos lo que queramos bien pues f5 Por cierto no perdona salimos vale Else eh print De momento todo parece normal vale Okay empezamos con el cálculo de valores normales vamos a dejarlo ahí 10 segundos luego he puesto el Sprint vale que luego en la ahora de la verdad nueva descarga is not defined vale nueva descarga esto es un igual Okay f5 Empezamos el cálculo de valos normales Vale y De momento todo parece normal De momento todo parece normal De momento todo parece normal hay alguna anomalía vale Okay Tú crees Pues sí parece que detecta alguna anomalía vamos a hacer una cosa un momentín nueva subida nueva descarga una anomalía pues Oye vamos a verlo eh print nueva subida coma nueva descarga vamos a ver por qué Porque se ha enganchado en la nueva anomalía y no sé por qué vamos a verlo Empezamos el cálculo de valores normales vale De momento todo parece normal no va subiendo va sumando va subiendo y va sumando no sé por qué no sé por qué en qué momento está subiendo vamos a ver wet Time slep está subiendo vamos a ver voy a Buscar esto eh nueva subida and nueva descarga They are Always incrementing ah muy bien no OK ahora sí Ok Ok vale vamos a verlo ahora y Ok si mejorar la salida me da igual vale empezamos el cálculo de valores o sea no quiero el acumulado de la descarga Quiero la descarga en ese segundo diferencial vale De momento todo parece normal OK ahora a continuación nos aseguramos de que todo va normal ahora a continuación me voy a ir a la página de wun Download un me voy a descargar un to desktop me lo descargo ahora me conectaré por cable Más que nada porque por cable puedo petar la conexión más porque estoy pensando que con WiFi tengo una limitación es decir tengo el lancho de banda limitado Vale Voy a conectarme por cable un segundo vamos a ver momento y a ver que me conecte aquí vale me conecto por ethernet un momento calculo que ahora se me cortará un poco la conexión ahora Volveré valeo y un segundo paro por aquí vale Voy a volver a recargar a ver ahora vale parao un momento el WiFi me quedo solo por cable pruebo a descargar de nuevo okay Ahora sí y vamos a probar de nuevo Vale entonces si he vuelto avisadme cuando podáis de si he vuelto avisadme cuando podáis por mensaje por chat de si me seguís viendo Vale y Ok perfecto vale Y ahora vengo por aquí de no para para vale cancelo porque estaba tomando los valores de descarga de ubuntu como valores normales evidentemente No puede ser O sea necesito tomar valores sin Descargar vale De momento todo parece normal ahora a continuación me descargo ubuntu y al Descargar ubuntu m bueno dice que todo sigue pareciendo normal no me parece normal que le parezca normal vale Vamos allá vamos a parar vamos a ver qué valores está dando print nueva subida nueva descarga Vale f5 y vamos a ver con Qué valores está trabajando todo el rato Ah cero fantástico Muy bien pues por eso le parece normal A ver no you counters no a ver eh instead of incrementing get values of Last Second Network usage on While true vamos a ver vale Uy madre mía vale lo ha simplificado bastante Okay 011 he ampliado y lanzamos Vale entonces okay Estos son bytes por segundo vale Y es normal normal y ahora me voy a ir a descargar al Descargar guardamos anomalía anomalía vale Y ahora cancelamos la descarga y normal normal es decir podemos establecer una serie de valores normales en este caso hemos hecho que el sistema lo detecte automáticamente lo que he hecho es implementar un algoritmo que se conoce Generalmente como el algoritmo del ruido de fondo que básicamente lo que hace es que tú lo expones a las condiciones normales y el sistema detecta esas condiciones se hace un promedio y dice vale Este es el ruido de fondo normal Y a partir de ahí ASUME que eso es lo normal porque tú se lo has dicho y cualquier cosa que sea parte de lo normal se considera una anomalía si ahora a continuación si ahora a continuación me vengo por aquí y digo voy a hacer vale 012 avisar al administrador a ministrador vale Yo ahora puedo venir por aquí y decir Ok pues admin avisado es igual a false el administrador no ha sido avisado con lo cual si hay aquí si hay una anomalía detectada me vengo por aquí me voy a envío correo copio las librerías esto me lo pondría en una función es decir Death envío correo lo pongo por aquí lo pongo por allá y digo pues subject anomalía detectada eh Hola que sepas que hay un consumo anormal en tu servidor entonces me vengo por aquí y si es cierto vamos a ver y aquí anomalía vale envío correo no If admin avisado es igual a false en ese caso envío correo y después admin avisado es igual a true es decir ya ha sido avisado el admin no hace falta que le vuelvas a avisar vale Así que ahora ejecuto f5 Empezamos el cálculo de valores normales vale comenzamos la subida de datos y yo ahora hago dos cosas Una me voy a abrir mi correo electrónico e anomalía detectada vaya por Dios Bueno pues mira justo ha detectado una anomalía a ver ahora vale Y ahora vuelve a lo normal Vale y un momento y dam anomalía detectada que sepas que hay un consumo normal en tu servidor vale igual pues como te diría yo igual multiplicado por 5 Pues voy a multiplicarlo por 15 vale Yo que sé para que no sea tan sensible vale f5 quiero decir que todo esto es ajustarlo evidentemente que se considere normal y que se considere normal pues también depende mucho de lo que es tu servidor y tu uso vale Así que yo ahora hago así abro el correo electrónico vale Ok y ahora a continuación en descarga veis va todo bien De momento en descarga Me descargo ubuntu anomalía detectada con lo cual paro la descarga Ahora vuelvo a lo normal y habré recibido Hola Abre dónde estoy abr recibido un segundo correo de que sepas que hay un consumo anormal en tu servidor de la misma forma como os podéis imaginar Pues podría unir el resto de códigos podría unir lo que hemos estado haciendo antes donde si detectas una subida anormal de información pues en ese caso lo que tienes que hacer es cerrar Apache vale Y en un caso extremo pues Apaga el servidor es decir todo depende un poco de Qué medidas queráis tomar vamos a retocar un poquito más este software y digo 013 eh guardo en un archivo yo en este caso lo que estoy haciendo Es que este archivo se guarda Perdón se ejecuta porque lo estoy ejecutando yo a mano pero claro tengamos en cuenta que esto más adelante será ADO con un cron no sé cada 10 minutos Eso quiere decir que cada 10 minutos se levantará ejecutará y Se volverá a dormir vale entonces para esto para un momento parao esto para esto lo que hago es lo siguiente vamos a ver y okay vale Y Okay el Wi true no vale esto no lo quiero esto no lo quiero esto no lo quiero Esto va divent y de momento lo voy a comentar Okay Vale empezamos la toma de datos Okay y a continuación lo que hago es que guardo esto en un archivo es decir archivo es igual a Open eh red txt y quiero write no perdona en modo wr y quiero archivo write str subida más coma más descarga esto un segundo Dónde está el bucle for aquí vale Ok Y entonces ahora le digo python check If file exists aquí file no me hace falta Ok If p exist red txt en ese caso pas en caso contrario o puedo poner If not p os p XT y esto lo que hace es calcular la carga si no existe créalo en este momento y archivo. Close en caso contrario haz esto en caso contrario un comand sangro quito y vamos a probar Vale pues f5 os is not defined os de hecho el correo lo voy a matar de momento voy a decir print hubiera enviado un correo vale f5 empezamos con el cálculo de valores normales porque no existía el archivo bien eh vamos a ver dice es un str Vale pues str de subida más str de descarga okay Y luego por cierto Tengo que leer los archivos esa es otra entonces claro espérate Esto no es correcto archivo es igual a red en modo read e líneas línea es igual a archivo. readline vale Y entonces digo momentín que se me ha apagado el monitor vale Y entonces digo previus No aquí está subida es igual a no perdon partido es igual a línea punto split de la coma y ahora subida es igual a partido de cer y bajada descarga es igual a partido de un esto quiere decir ahora existe ese archivo No lo sé porque creo que se ha quedado a mitad de crear en dam en segundo en servicios y procesos en Uh generación en servidor en Red no vale ejecuto Empezamos el cálculo de valores normales vale Y ahora lo que hará es que se saldrá es decir aquí y se ha salido ahora que existe el archivo ahora bueno en principio me habrá guardado los valores normales aquí y tendré dos valores normales separados por una coma Vale pues Ahora en la segunda ejecución deberá leer el archivo y comprobar si lo que tiene en este momento es normal o no es normal f5 bien not supported vale en aquí Ah Sí perdón esto es float de partido de cer Y esto es float porque me los lee como strings de partido de un f5 y dice es normal vale solo lo hace una vez si os fijáis solo lo hace una vez eh subida 0 bytes y descarga 0 bytes no está bien Vamos a ver no está bien Vamos a verlo on el Case Getting 0 bytes vamos a ver eh mín No es que esto no es que esto no es eso no Vamos a ver problem on Second execu When redx exist And then I only want to execute el Case I am Getting Z by lectures reading Network usage on the last One sec vale Esto sí ya pero no O sea sí entran en un wel true Eh vale vamos a ver el esto Ahora sí bien me ha desbloqueado el envío de correo cuidado con eso vale me ha desbloqueado el envío de correo lo voy a es más print hubiera enviado un correo Vale f5 y Okay vale Y es normal ahora f5 y es normal ahora empiezo a descargar algo fuertemente ejecuto y dice anomalía detectada hubiera enviado un correo vale con lo cual ahora puedo parar la descarga y sé que en este caso lo que hubiera hecho es pues bueno lo que haría a continuación es ejecutar esto en un Chrome Tab y medirlo por ejemplo pues lo que te digo cada 5 minutos cada 10 minutos cada minuto dependiendo un poco de pues lo que sea lo que haga falta es decir la naturaleza del servidor la potencia del servidor en la fragilidad o la importancia de los datos que estén contenidos en ese servidor y de la misma forma que he hecho un que he hecho un envío correo Pues podría hacer un apaga Apache O podría hacer un apaga servidor O podría hacer un cierra puertos O podría hacer un lo que quisiera vale la idea un poco de esto es mostraros herramientas para que veáis que tenéis el control y que gracias a python pues tener control sobre el sistema esto por ejemplo en C y c+ má Sería para cortarse las venas vale pero en python tenéis un control bastante sencillo y bastante entendible y podéis programar los mecanismos que hagan falta para controlar el estado del servidor vale bien una vez dicho esto vamos a ir pasando a la siguiente asignatura a la asignatura de acceso a datos vamos a echarle un vistazo vale Así que vamos a ir a drive y vamos a ir a acceso a datos Okay vamos a hacer una cosa dadme 10 minutos hacemos un pequeño descanso y ahora volvemos Ah 55 vale Y ahora hablamos un poco de esto es básicamente Pues aquí hablar de Por una parte el tema de bases de datos documentales donde os acordáis que estuvimos trabajando con y vamos a seguir trabajando eh con y vamos a empezar a analizar el sentido y el significado de esta parte que es la programación de componentes que técnicamente ya lo hemos hecho vale que es creación de componentes propios de acceso a datos pero en este caso de lo que se trata en este último punto es de que contemplemos la creación lo que comentábamos el otro día no la creación de soluciones personalizadas os acordáis que el otro día estuvimos hablando de soluciones personalizadas basadas en js para crear nuestras propias bases de datos Vale entonces eh lo que os digo parao un momento grabación