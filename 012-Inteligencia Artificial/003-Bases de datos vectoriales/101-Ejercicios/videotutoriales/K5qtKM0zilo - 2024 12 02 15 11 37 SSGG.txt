bien el a ver un momento porque los aquí perfecto vale me estaba in escape que calculo que no habrá guardado nada vale Así que documento nuevo y estaba analizando pues como os digo el supuesto caso digo supuesto porque me lo estoy inventando de una empresa que fabrica sillas o mesas bien entonces tengo una eh fábrica de mesas o de sillas o de mobiliario o de lo que sea Vale entonces hago así relleno de color negro Vale y estábamos diciendo que tenemos por aquí teníamos por aquí un departamento de ventas el departamento de ventas cuando realiza una venta vamos a volver por aquí vale cuando realiza una venta se lo pasa a facturación el departamento de facturación le pasa las facturas a contabilidad de la misma forma por aquí en ventas Pues habrá un departamento que será producción el departamento de producción Pues claro para que pueda funcionar pues probablemente tendrá que porque Generalmente una fábrica digamos trabaja con eh con materias primas vale convierte materias primas a productos elaborados productos acabados y con lo cual tiene que haber un departamento de compras vale que se encargue de comprar ese departamento pues suele estar en comunicación con producción en producción pues son los que dicen Pues Cuánto se ha transformado en productos vendibles claro Cuánto se ha transformado en productos vendibles le importa a ventas porque para que ventas venda algo primero ventas tiene que saber cuánto producto vendible hay en el almacén vale Y luego también pues suele haber por aquí un departamento lo pongo un poco apartado que es recursos humanos el departamento de recursos humanos Pues trata de Cuántas personas hay en la empresa eh las nóminas de cada uno de ellos las vacaciones de Cada trabajador porque así pues ocurre que en verano Pues igual el departamento de recursos humanos intenta Buscar e intenta colocar las vacaciones de los empleados de tal forma que siempre haya alguien en la empresa o no Vale o hay empresas que cierran todo agosto y cierran todo agosto y ya está Vale o también pues cada empleado Pues cuántos días ha estado enfermo Cuántas vacaciones le quedan vale la cuestión es debería ver el departamento de recursos humanos las facturas de cada venta realizada pues no evidentemente no vale debería ver el departamento de contabilidad las vacaciones que se ha cogido cada ad pues no es ya que no deberían verlo vale aquí hay dos cuestiones de las cuales Debemos hablar la primera de ellas es acerca de la privacidad de la información es decir qué persona debe ver qué información y luego hay otra cosa de la cual debemos hablar que es que cada persona trabaje con la información que realmente le corresponde es decir no es ya que contabilidad eh deba haber por protección de datos si lo queréis llamar así vale debe haber o no debe haber las vacaciones de Cada trabajador es que probablemente para su operativa diaria y para su trabajo diario a la persona o a las personas que trabajan en el departamento de contabilidad pues les va a molestar estar viendo datos de recursos humanos porque probablemente ellos únicamente van a querer ver sus datos con lo cual Por una parte estamos hablando de que cada departamento de la empresa Pues en cierta forma es una burbuja aislada de información pero luego por otra parte estamos hablando de que como hemos comentado antes sí que debe haber una comunicación por ejemplo entre ventas y facturación en el momento a ver un segundo en el momento en que lo que se venda debe entrar a facturación y lo que se haya facturado debe entrar a contabilidad y lo que se haya comprado también debe entrar la contabilidad y lo que se haya comprado influirá en producción porque cuando producción diga Bueno vamos a ver cuántas sellas voy a fabricar hoy producción dirá bueno espérate O sea primero vamos a ver eh cuánto tengo en el almacén vale Y si hay poco en el almacén pues producción deberá decirle a compras Oye compras Necesito que compres no sé cuántos metros de madera más porque es que si no ya no podemos fabricar mesas y si no fabricamos mesas pues ventas no va a poder vender nada vale Por otra parte en ventas tendrán que saber qué es lo que hay producido para saber cuánto pueden vender y luego de todo esto pues al final Hay personas en el departamento de ventas Hay personas en el departamento de facturación Hay personas en contabilidad Hay personas pues todas las personas están aquí metidas en recursos humanos vale insisto una vez más lo vuelvo a decir lo mismo que he dicho antes y es que eh este esquema que he dibujado no pretende ser un esquema polivalente para cada empresa vale porque si ahora por ejemplo suponemos un centro de formación Pues en un centro de formación no hay producción no hay un departamento de producción Sí hay docentes pero los docentes no producen no transforman materia prima a productos elaborados para vender vale igual en un centro de formación pues compras y ventas es el mismo departamento y a veces facturación también es el mismo departamento también hay que decir que no es lo mismo una pequeña empresa donde hay tres personas y hay O sea fijaos que aquí hay más bloques que tres personas vale con lo cual una sola persona adopta varios bloques a departamentos o sea a empresas grandes donde cada uno de estos bloques hay x personas trabajando bien una vez que hemos ilustrado vamos a guardar esto por aquí en alguna parte esto es segundo esto es sistemas de gestión empresarial Y esto es esquema general empresa concreta svg vale el problema de todo esto está en que como os digo como cada empresa funciona de una forma ahora que he puesto el ejemplo concreto ahora tenemos que abrir nuestra perspectiva y decir Vale qué nos vale de este esquema que acabo de dibujar en la pantalla Pues que en una empresa puede haber departamentos ese esa afirmación va a ser cierta para prácticamente cualquier empresa y nos vale también la afirmación de que en cada departamento habrá datos que serán específicos de ese departamento y habrá datos que deberán ser compartidos entre varios departamentos Como por ejemplo en ventas pues las ventas realizadas Y esa afirmación pienso que también es una afirmación polivalente para cualquier dato y para cualquier empresa la pregunta ahora empieza a ser vale una vez que empezamos a comprender esta idiosincrasia de vale o sea lo que he dicho hasta ahora ojo la realidad es muchísimo más compleja vale Pero vamos a empezar con esta simplificación eh una vez que he empezado con esta simplificación y una vez que he puesto esta premisa encima de la mesa La pregunta es qué tenemos y cómo transformamos lo que tenemos para que sirva para este modelo es decir vamos ahora a repasar lo que tenemos es una aplicación que sí en cierta forma está preparada para esto O sea en el momento en el que yo he hecho una cosa que tenemos muy sin tocar que se llama escritorio vale Yo vengo aquí pongo jarsa le doy a login vale 5 segundos eh Bueno aquí debe haber un error por algo que habré cambiado del escritorio pero aquí recordáis que hay un escritorio Vale pues el escritorio Precisamente lo creé porque el escritorio es una oportunidad fenomenal para De hecho si os fijáis casi coincide la maquetación vale para poner aquí cada uno de los departamentos y que cada usuario del sistema de gestión empresarial pues entre en el departamento que le corresponde haga clic en el departamento que le corresponde que luego otra cosa que tenemos que analizar vale el os acordáis que en acceso a datos estábamos hablando el otro día de encriptación pues es un poco niveles de privilegios vale es decir quién puede entrar en qué bien De momento vamos a ver aquí Qué pasa bueno Cuando hacemos clic en cada cosa entramos en el superc controlador pero claro el superc controlador es una cosa Que Mola digamos es una especie de Super panel de control para cualquier cosa pero claro es para cualquier cosa y para ninguna realmente vale esto es que el otro día me cargaría yo la tabla porque efectivamente estoy viendo que no hay nada salvo en clientes Ah sí porque lo quito la encriptación vale porque si hago así en aplicaciones error pero no pasa nada vale ahora quitaré la encriptación pero claro teóricamente cuando hay un superc controlador y el otro día os acordáis que empezamos a hablar hace dos semanas del tema de aplicaciones Pues debería haber un superc controlador para ventas otro superc controlador para facturación otro superc controlador para contabilidad otro supercontrol para que cada vez que alguien entre en un superc controlador pues entre y se le muestren únicamente las tablas que tocan y cómo se sabe las tablas que tocan pues es otra de las cosas que tenemos que pensar vale bien Vamos a ver en primer lugar porque hay un error y probablemente el error está por la encriptación como os decía Entonces vamos a la base de datos local Host php my admin el otro día os acordáis que hicimos una encriptación un poco bestia vale Y es que pues enpt todo luego al final de la clase comentamos hace dos semanas Pues que se podría encriptar solo el Ivan solo el correo electrónico solo las contraseñas Vale entonces me voy a empresas a empresa no empresa es la mía crimson vale Y me voy a aplicaciones Ah okay No hay ninguna Vale y clientes Aquí está Vale Aquí está todo encriptado y recordamos como el otro día pues esto estábamos desencriptando no entonces me voy a ir al proyecto como el otro día estuvimos viendo que encriptar todo igual es un poco bestia incómodo y Tiene efectos secundarios por ejemplo en los datos numéricos vale sin ir más lejos o sea no puedo encriptar una columna de datos numéricos pues me voy a sistemas de gestión empresarial me voy a proyecto voy a crear una versión vale desencriptar voy a crear una versión llamada 107 desactivo encriptación fuerte y esto quiere decir Que de momento voy a desactivar la encriptación para todo y más adelante ya veremos En qué casos la activamos vamos a abrir hedit y así por lo menos sabemos que tenemos ahí una incitación implementada segundo sistemas de gestión empresarial proyecto Ah desactivo vale la incitación fuerte estaba en el servidor entonces eh vamos a ver en conexión de B no en Index Ok Ah Espera que haga la tipografía más grande porque los fines de semana me la pongo pequeña para trabajar yo Ok vale venga muy bien J sonen code no jv codifica vale Ok entonces Pues básicamente for each mis datos Ok pues voy a la encriptación momentín mis datos es igual a seleccionar tabla Ok pues desactivo la codificación Vale y yo creo que estará en otra parte también como mínimo estará en insertar Vale y codificador codifica Vale pues cierro por aquí Esta no es una forma muy elegante de incitar o sea de Desactivar vale que es dejar cachos comentados por ahí pero bueno de momento ya sabéis que yo ya tengo esta filosofía vale Y a lo largo de del curso os la estoy intentando eh transmitir que es intentar encapsular intentar hacer todo como componentes aislados que luego se puedan activar y Desactivar vale por tanto en este caso me estáis viendo como estoy comentando un cacho de código pero ya sabéis que probablemente luego esto lo meteré en una burbuja que se pueda conectar y desconectar a voluntad bien entonces ahora a continuación me voy al proyecto me voy al s tengo ahí la encriptación para más adelante en acceso a datos hacer una implementación mucho más elegante hacer algo así como solo cuando un campo sea Ivan pues entonces codifíquelas eliminarlo de hecho eliminar los clientes bien y ahora a continuación elimino los clientes vale todo ha ido Ok bien Ahora a continuación Quiero crear una aplicación Ah Perdona y habrá otro departamento por aquí que este interno o externo a la empresa que es it vale que es el departamento técnico es el departamento de informática en este caso quién crea en el sistema de gestión empresarial de las aplicaciones Pues el departamento de informática vale quién asigna roles quién Configura Qué es lo que ve cada departamento Pues el departamento de it que luego ya os digo que Bueno como todo vale se puede externalizar lo que pasa es que externalizar facturación pues no es normal externalizar contabilidad pues a veces sí pero it es un departamento que se externaliza mucho vale que es pues una empresa externa que proporciona el servicio pero da igual quiero decir da igual que sea interna o externa mientras que tenga acceso pues ya está Vale entonces voy a crear como os digo una aplicación eh que se va a llamar ventas y ya está Vale y activa así okay nada fuera bien V bueno ruta aquí ha insertado no vale qué ha pasado eh columna activa Ah vale que requería que pusiera activa bueno Vale venga ventas eh icono ruta ventas y yo creo que ya está Vale qué más quieres ah activa uno okay Vale venga clientes aplicaciones y ventas Okay ahora a continuación Pues voy a crear una tabla nueva llamada facturación descripción de momento nada e facturación y activa uno Okay Vale y tengo aplicaciones ventas y facturación Y por último voy a poner contabilidad y contabilidad Uy la mar contabilidad qu he tocado que no debería haber tocado y1 Okay básicamente como os digo eh lo que estoy haciendo es implementar la primera fila de esto que hemos dibujado aquí más adelante ahora pues no sé al final del día de hoy o algo así hablaremos de qué es lo que tenéis que hacer vosotros Bueno pues evidentemente cada uno de vosotros lo que va a tener que hacer luego es implementar una empresa diferente vale es decir yo estoy implementando una empresa de fábrica de mesas pues evidentemente vosotros no tenéis que implementar una fábrica de mesas sino que idealmente en base a vuestro conocimiento vale porque seguro que cada uno de vosotros pues conoce algún tipo de empresa diferente pues tenéis que implementar una empresa que se parezca al flujo de información que vosotros conocéis vale Y luego yo por otra parte lo que voy a hacer aquí Hoy es implementar una metodología pero a continuación vosotros tenéis que eh elegir si aquellos que seáis más idos cuestionándose que yo planteo son las más sencillas posibles pero frecuentemente tengo alumnos que me demuestran que no es así vale que me demuestran que había una solución todavía más sencilla yo ya os digo vale un parámetro de la formación que imparto no solo a vosotros sino a cualquier grupo es siempre intentar enseñaros el camino más corto y más sencillo vale el camino menos enrevesado posible pero no soy perfecto Vale y siempre hay alguien que dice no es que y si lo haces así y yo siempre digo pues es verdad pues se podía hacer así bien entonces a continuación este ventas tiene dos as vale Okay a continuación eh yo ahora lo que voy a hacer es que si me voy al escritorio si me voy al escritorio Okay ahora en principio debería ver las aplicaciones vale aquí tenemos ventas facturación y contabilidad y luego pues tantas aplicaciones como sea necesario pero qué es lo que ocurre cuando voy a ventas hago click Y entonces me voy al superc controlador pero no es decir qué ocurre cuando voy a facturación me voy al superc controlador Pero de alguna forma yo tendría que estar entrando al superc controlador y tendría que estarle diciendo si quiero el superc controlador pero el superc controlador de ventas y aquí tendría que decir si quiero el controlador pero el superc controlador de facturación Vale entonces a continuación Ahora sí voy a crear una nueva versión del proyecto ahora que desactivado la encriptación fuerte y 108 de escritorio A controlador con parámetros eh cuidado Ah 018 no 118 Este cambio va a ser muy sencillo porque simplemente me voy al cliente me voy al escritorio me voy a Index html vemos que hay un comportamiento voy a quitar el ajuste que también me lo he activado para mí vale vemos el comportamiento y decimos Ah era 108 Okay OK Vamos allá ah no 108 Tienes toda razón entonces me he ido yo de ahí 108 correcto el hedit se me ha ido a la porra porque el hedit ha detectado un cambio no permitido vale con lo cual Pues nada vuelvo a edit 108 cliente escritorio comportamiento vale Y entonces digo vamos a ver aquí icono y cuando hago click Windows location es igual a sí no desde luego Sí tanto y tanto vale me voy a superc controlador me voy a superc controlador y en principio y aquí viene la cuestión vale en principio le paso un parámetro Cómo le puedo pasar un parámetro Bueno pues eh Hay un parámetro que le puedo pasar que es aquí arriba por ejemplo poner eh aplicación es igual a ventas vale por ejemplo es una forma de hacerlo lo que pasa es que luego cuando hago clic por aquí pues técnicamente ese app ventas se me puede perder Aunque estoy trabajando en full stack quiero aprovechar la excusa para guardar información de forma persistente en el navegador para guardar información de forma persistente en el navegador y esto que os voy a enseñar ahora es algo de lo cual Tenemos que hablar muy en profundidad yo diría en muchas asignaturas pero en esta especialmente si yo voy a application y yo voy a local storage en local storage que creo que hemos visto esto autosave no que creo que hemos visto aquí crimson usuario Ahora sí vale lo hemos visto cuando hicimos login es decir vamos a verlo estilo login Vale y tengo por aquí eh No mensaje fetch Sí pero aquí local storage set item Vale pues de la misma forma que utilizamos anteriormente un local storage para guardar nuestro usuario Pues por qué no podemos decir local storage s item me voy aquí a comportamiento y le digo cuando yo haga clic en cualquier aplicación le digo aplic o aplicación activa llamad como creáis y la aplicación activa es un segundo aplicación onclick es dis punto qué Pues no lo sé vamos a ver que tiene una aplicación okay ver qué tiene ventas eh Ah pues fantástico Bueno pues voy a hacer una cosa de claro espérate Bueno sí de ventas vale el p pues dis query selector p punto text content no es una solución muy elegante no me gusta mucho pero bueno de momento va a funcionar Creo vamos a probarlo Ok vale lo probamos como os decía recargo me voy a ventas vale me voy al superc controlador pero si todo ha ido bien si todo ha ido bien a ver un momento recargo Pues no ha ido bien crimson usuario Dark usuario claro por bueno crimson usuario Pues voy a poner crimson aplicación vale Y así nos guardamos todos los local storage juntos Pero ah desac encriptación Espérate que no estoy en el sitio correcto por eso no funciona vale 108 cliente jarsa login vale me voy a ventas Ok y ahora sí crimson aplicación ventas vale si hago clic para atrás y pincho en facturación pues crimson aplicación facturación lo cual quiere decir que ahora cuando paso a esta siguiente pantalla del superc controlador técnicamente el superc controlador ya tiene algo a lo que agarrarse porque sabe que está en facturación ahora qué tiene facturación Bueno pues de esta forma yo ahora aquí lo que tengo que hacer es que cada departamento sepa qué tablas puede ver y qué tablas puede no ver con lo cual ahora a continuación Yo hago lo siguiente vamos a ver me voy a hacer aquí me voy a hacer aquí una tabla nueva insisto una vez más esto es una forma de resolverlo vale tabla nueva llamada eh tablas aplicaciones número de columnas cuatro vale mismo identificador entero 255 autoincremental Vale ahora ventas debe ver clientes y ventas vale vamos a ver Mira me lo voy a inventar no perdona quieto esto es el esto es la aplicación y esto es la tabla ya me estaba rayando yo la aplicación técnicamente Debería ser una referencia externa vale por tanto Debería ser aplicaciones y nombre aplicaciones nombre y la tabla claro no hay una tabla llamada tablas podría haberla vale esta Va a ser varchar muy bien entonces eh yo creo que ya de momento ya probablemente más adelante lo complicar remos más vale guardo una longitud válida para quién 255 Y entonces ahora creo una relación esto es e tablas aplicaciones a tablas y entonces digo aplicaciones nombre está vinculado a aplicaciones identificador okay Y entonces ahora en Tablas aplicaciones digo ventas va a ver la tabla clientes voy a hacer un ejemplo vale o sea el ejemplo que voy a hacer va a ser un poco desastroso pero para que lo veáis ahora inserto y digo eh facturación va a haber pedidos Y por último contabilidad va a ver productos insisto me lo estoy inventando vale Mira contabilidad va a haber productos y contabilidad también va a haber pedidos porque tal y como hemos comentado antes Pues habrá entidades que tengan que ser compartidas entre diferentes departamentos es decir ventas crea pedidos facturación coge pedidos para convertirlos en facturas Vale y facturación crea facturas y contabilidad no crea facturas contabilidad coge facturas para convertirlas en la contabilidad de la empresa bien así que una vez que tengo esto ahora lo que quiero es que anteriormente tengo por aquí en eh En Tablas vale vamos a verlo en el superc controlador tengo por aquí una parte del programa que lo que hace es que cuando entro en el superc controlador me da todas las tablas Okay pues ya no a continuación lo que quiero es decirle Dame solo las tablas que correspondan a qué perfil o a qué aplicación bueno perfil no estamos hablando Todavía vale Pero a qué aplicación Pues a la aplicación Espérate que se u local storage a la aplicación facturación vale es decir voy a simular primero la consulta le digo Select todo de momento from eh from tablas aplicaciones vale we claro Aquí tengo que hacer un left join aplicaciones on tablas aplicaciones nombre es igual a aplicaciones punto identificador vale we aplicaciones nombre es igual a facturación Y qué quiero pues quiero momentín porque necesito 5 minutos que tengo que ir al baño un segund voy a acabar esta consulta sql por lo menos Y esto es aplicaciones punto nombre entonces si yo pido facturación nombre facturación no perdona No esto es aplicaciones tablas aplicaciones punto tabla Ahora sí continúo vale Yo pido facturación pues me tienes que enseñar pedidos Vale pues dadme un segundo dadme 5 minutos por favor que tengo que ir al baño lo siento mucho vale Y ahora vengo