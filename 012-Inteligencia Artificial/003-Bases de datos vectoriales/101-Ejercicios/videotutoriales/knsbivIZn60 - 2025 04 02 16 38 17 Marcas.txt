bien pues vamos a seguir y ahora a continuación con cuidado y con precaución Quiero la parte correspondiente a la programación vale recordad que eh con esto yo no estoy diciendo que a partir de ahora las aplicaciones tengáis que hacerlas así vale el objetivo de la clase de hoy y también la de El objetivo de la clase de mañana un conjunto es deciros Oye las bases de datos están ahí Para apoyar Oye las bases de datos tienen herramientas que os pueden venir bien y existe una metodología mediante la cual pues podéis Descargar responsabilidades del lenguaje de programación y podéis darle esas responsabilidades a la base de datos ya que si son responsabilidades que tienen que ver con el tratamiento de datos pues no es descabellado pensar que sea la el propio motor de base de datos si tiene esas capacidades y realmente los tiene el que pueda asumir Esa responsabilidad vale insisto una vez más no como obligación sino como posibilidad que si decís Oye es que todo esto lo quiero hacer con el lenguaje de programación no hay ningún problema podéis hacerlo vale son diferentes alternativas para hacer lo mismo bien Así que ahora voy a hacer lo siguiente probablemente me hará falta crear más tablas pero de momento voy a trabajar con las tablas que tengo o más procedimientos o más lo que sea eh Now let's create an application make use of All of that database Let's go Little by Little y digo First We Will Start by creating a login screen All the application Will be php html css vale and then If login is successful We Will Go If login on index php dashboard php Blank by the moment Vale Nos centramos únicamente de momento en login Así que vamos a verlo Of course make use of login procedure o como se pronuncia procedure create a minimal yet Clean Modern and professional css vale más que nada porque ese tipo de aplicaciones pues acaban siendo funcionales pero acaban siendo feas con lo cual pues no Mola vale No Mola quiero decir que pues aunque la aplicación funcione a veces si la vemos fea es como que por muy programadores que seamos decimos claro es que la aplicación es fea es como Bueno vamos a crear un css que no perdamos tampoco mucho tiempo en el css Porque tampoco es el objetivo de las clases de hoy y de mañana pero que sea un css mínimo vale mínimamente bonito vale va a utilizar pdo interesantemente bueno no soy especialmente fan de pdo Pero vale Vamos allá así que archivo index pantalla de login Vale y server local hor ad del Brown database connection vale prepare Field y aquí está Vale Select login Ok as login OK Y entonces básicamente lo que va a hacer vale es preparar los parámetros del username y del password vamos a verlo vale tenemos por aquí esto Ey Ah bueno Sí espera Bueno sí vale pero Ah bueno vale Ok estilo css vamos a por ello venga Vamos allá Vale pues vamos a empezar con un Index php salimos de la carpeta sql vamos a un index.php y preparamos el login vale aquí dashboard.php Que de momento obviamente de momento va a estar muy vacío vale el logout.php Por qué no vale logout.php este archivo sin título se puede ir a la porra porque a quita porque no lo voy a usar bien quitamos Sí vale comandos lo guardamos y el css que al parecer lo quiere en el mismo en la misma carpeta Pues bueno pues Vale pues estilo css vale estilo css vamos a ver qué aspecto tiene esto localhost barra jocars gu sadel Brown vale sadel Brown Okay login vale Venga pues jarsa y login Vale y welcome jocars ya está en este caso lo importante es que veáis que desde el punto de vista de sql Bueno tengo un log ad por supuesto vale desde el punto de vista de sql pues php lo único que ha hecho es Llamar a un check login para ver si es cierto o no es cierto vale o sea el típico caso de Select all from usuario Where usuario es igual a esto and password es igual a esto Dime si existe si no existe no vale lo está haciendo mysql nosotros simplemente llamamos a un método que realiza esa acción con lo cual Pues todo el trabajo que hemos hecho mysql nos lo evitamos Aquí bien Ahora a continuación digo vale Esto me gusta ahora a continuación vamos a ver dónde estás aquí vale digo dasb devel the dashboard como siempre in the wordpress admin Style header on top Now on left with the tables list and When clicking on each Table on create an html Table with Data on Main Pain vamos a ver bueno Vamos a darle a ver qué hace con esto y en base a esto si nos da eh tablas que no tienen las columnas correctas pues Oye lo miramos vale le pedimos que haga vistas le pedimos que haga procedimientos le pedimos que haga lo que sea vamos a verlo ahora luego Probaré lo de monday que me ha llamado la atención lo de chat gpt pero sal y te diría el contrario o sea razonamiento finalizado eh please re elaborate o sea Dame un Friday o sea dame un chat gpt optimista para pesimista estoy yo Pero bueno vale Okay no no un ejemplo de código para wordpress no es para wordpress es en el estilo de wordpress que es diferente vamos a verlo vale Ah vale al estilo Okay perfecto muy bien muy bien vale Y admin Ok for each tables stable Pero qué es tables Select all from ah no sí Ok y no sé Ah vale No quiero Esto vale Así que copio dashboard Ahora me voy a dashboard css vamos a verlo no es lo que quiero pero bueno ya es una primera aproximación Así que login Okay Vale clientes y me selecciona los clientes vale perfecto productos hasta aquí bien pero el problema está en que me voy a pedidos y ID de cliente vale o me voy a líneas pedido y todo empiezan a ser números con lo cual Pues empieza a ser e cómo te diría yo empieza a ser un panel de control pero no quiero exactamente Esto vale quiero otra cosa Vale lo que quiero es lo siguiente Okay p I would like eh I would like uno on Table list Don't create a static array show tables on database If necessary create A View on my sql and on php call that View vale un poco artificial Pero bueno nos puede servir eh dos on html tables show foreign Ke Data for tables with foreign Keys try to approach try to make an abstract approach that might be reusable and If possible make as much As you can on the database using views joins procedimientos or Any Tools you like vamos a ver qué pasa Le damos esto lo hemos hecho muchas veces es hacer peticiones a tablas vale pero la novedad en este caso está en que lo queremos todo volcado en la base de datos vale para que el código php digamos que tenga la menor cantidad de responsabilidades posibles vamos a ver es decir no quiero que me crees un una vista para clientes otra para productos otra para pedidos porque probablement ente luego voy a crear más tablas dentro de esta aplicación con lo cual pues ese tipo de soluciones locales Pues luego no son extensibles lo que quiero es que haga algo que se pueda reutilizar vamos a verlo vale vamos a ver solución en dos niveles almacenado dado el nombre de la tabla construye dinámicamente una consulta como todos sus consultas brutal me encanta a nivel de aplicación se modifica el dashboard para que consulte la vista y cuando se haga de clic en una tabla se llama procedimiento almacenado para obtener Ros enriquecidos fantástico es justo lo que quiero vale eh vista de base de datos Vale pues para crear todas las tablas comandos vista para obtener todas las tablas Okay procedimiento madre de Dios procedimiento para consultar bueno vale No es muy largo Okay a ver vale procedimiento para consulta rica enriquecida vale eh Por cierto Espérate que lo tengo que ejecutar vale creo una vista Ok creo un procedimiento Okay y no qué pasa a ver vale Y luego a ver aplicación php dashboard ahora vamos a esto y ya yo creo que poco más vale Y css el mismo css Vale y decimos on this procedure error y qué error nos ha dado esto Uy quieto eso no aquí vamos a ver qué ocurre ah eh Okay prepare statement no falta un punto y coma vamos a ver vamos a verlo vale prefijado Ok variable local okay vale Bueno lo que sea vamos a verlo okay Y entiendo que en php esto no causará ninguna modificación vamos a probarlo sql consulta preparada vale tiene buena pinta vamos a verlo así que si yo ahora a continuación me voy al panel de control me voy a clientes funciona correctamente clientes Ah sí sí de cliente Ah vale Ah no me lo ha puesto en el mismo orden me lo ha puesto en orden alfabético Qué curioso vale bueno líneas de pedido no vale Ok vamos a ver Oh Ah vale View tables pedidos y de cliente nombre vale Mola productos vale usuarios vale has pedido Okay Bueno casi Almost Everything perfect bat on líneas pedido luego siempre se le puede decir que no me muestre las vistas y todo esto el view tables y todo eso vale pero eso ya me da un poquito más igual quiero decir que a tiempo de limitar o a tiempo de separar lo que son tablas y lo que son vistas Pues siempre estamos eso no pasa nada vamos a ver vale Ya os digo que es una consulta difícil con lo cual Pues que acierte a la primera como ya os digo es difícil vale No pasa nada si en un momento dado Eh Pues vale No pasa nada si en un momento ahora luego vale Eh Pues eso vale si en un momento dado pues hay que retocar un poco la consulta vamos a ver Okay vamos a ver el procedimiento vale entonces vamos a ver aquí el procedimiento el de aquí get Table Data with foreign key creo que es a ver no s que me carg el incorrecto vale get Table Data with foreign key eliminar Ok sql Ok continuar vale en las consultas create proceder for vamos a probarlo líneas pdu líneas pedido a ver clientes Ok pedidos no Okay no productos usuarios ah no sí ID cliente es ID cliente nombre y de pedido no sé Claro y de producto sí que está haciendo ahí sí que está haciendo una la primera sí que la está haciendo pero el resto parece que no pero bueno da igual quiero decir okay es una primera aproximación vale lo que nos importa en este caso es que no ven ven sí es un momento estoy en clase pero es un momento vente por aquí eh Mira te cuento Ahora luego os enviaré un correo vale porque Dark salmon porque esto empieza a estar fantástico eh Ya sí Pero claro yo no soy worker administrador ahora sí Vale entonces por aquí empieza a ha un panel de control de empleados y todo eso bien Y entonces luego aparte por aquí ahora sí si entramos como trabajador en un teléfono móvil Voy a Juan López u Juan López Iniciar sesión Y entonces en asistencia vale Fíjate que la última es la 10 registro entrada Y si le doy a asistencia ahora la última es la 11 con unos parámetros de latitud longitud Sí y bueno se registra la hora de entrada esto es la hora de entrada y esta otra columna es la hora de salida Si yo ahora registro la salida ahora refresco esa tabla Y fíjate que ahora hay hora de entrada a las TR hora de está con 2 horas de retraso es sea el servidor tengo que actualizar la hora y la latitud longitud de todo esto entonces la cuestión está en que dentro de un rato voy a enviar un vídeo pero claro tengo los correos de tus padres pero no el tuyo voy vamos a ver te envío de momento un correo para meterte en David carrion @ame formation.com te pongo hola y más que nada para meterte ya en la agenda y ahora luego te pongo con copia y os envío un vídeo con la demostración de Esto vale Y a lo largo de los días pues vamos desarrollando más y todo eso Y por cierto y funciona en el móvil vale O sea quiero decir que está pensado y está formateado como web app lo que te decía ayer para que sin necesidad de instalar pues aparezca el icono y a partir de aquí registrar entrada y todo eso vale Y a partir de ahí claro ahora mismo no Pero por supuesto se podrá Claro todavía no hay ni incidencias ni siquiera está lo de reordenar por columna o el buscador y todo eso reg sí correcto un click y que sí correcto yo lo mismo de momento o sea se permite cualquier coordenada no he implementado todavía lo de tras x radio con respecto a clo Claro incluso Fíjate que aquí arriba que está preparado para poner herramientas pone a porque no se sabe todavía las herramientas que hay vale con lo cual ahora luego cuando envíe el vídeo te pongo en copia Y estás informado vale a ti esta hora sí pantalla secundaria Sí es que como estoy en clase esto es el chat con los alumnos y esto es la grabación de esta pantalla Sí es que por tarde todas las clases se graban y luego la subimos a YouTube eso eso correcto eso al est ahora Ah sí truco truco no eh la pestañita muévela sí No gir gíralo eso es correcto Sí es que le estaba preguntando el correo para ahora luego ponerle en copia en el correo que os envíe vale Hasta ahora nada a ti Vale entonces vamos a ver Vale pues Ahora lo que vemos es que nos hemos dado cuenta de que únicamente nos está haciendo un left join con una de las columnas probablemente la primera que se encuentre pues bueno ya que estamos pues Oye vamos a pedirle cosas Vale entonces nos vamos por aquí y digo Now Uy ostias bueno da igual porque lo ha hecho Now mat Beta but it seems to me that is only showing Cross Data from the First link Table it should do the same but with as many link as might be vale vamos a ver si es capaz de Modificar el proceso entonces eh A ver a ver No es que siempre se dice detener o sea es que tener la base de datos en un servidor diferente al servidor de Apache Es una posibilidad vamos a ver nosotros tenemos la posibilidad de tener una apach que sirve php html css todo eso vale Y eso lleva un consumo de recursos y luego tenemos podemos tener un servidor mysql que gestiona bases de datos al cual le podemos dar las responsabilidades de las que estamos hablando hoy y eso conlleva otro consumo de recursos si ese consumo de recursos es poco y suele serlo poco pues en un momento dado podemos tenerlo como lo tenemos ahora mismo que es básicamente tener en el mismo servidor tanto la base de datos como los archivos ahora en el momento en el que o bien por cuestiones de rendimiento o bien por cuestiones de seguridad o lo que sea podemos tener la base de datos en un archivo diferente en un servidor Perdona diferente al servidor de Apache Cómo se hace eso pues es tan sencillo como que cuando yo me conecto yo le estoy diciendo local Host ASUME que el servidor de mysql se encuentra en el mismo servidor donde se encuentra Apache si yo simplemente vengo aquí y cambio local Host por la ip de otro servidor que sea un servidor Dedicado para mysql asunto solucionado vale o sea que no tiene más complicación que esa Bueno luego evidentemente en el servidor de destino pues hay que abrir el puerto 3306 para que se pueda comunicar pero más allá de ello no hay mayor problema O sea que solo para casos en los que tu servidor vaya creciendo y llegue un momento en el cual digas Oye por rendimiento o por seguridad o por otros factores que tú quieras me conviene más tenerlo en dos servidores pues en dos servidores te digo dos servidores como que dice cinco servidores quiero decir Imagínate que tienes cinco aplicaciones que consumen mucho consumo pues Oye en un momento dado puedes tener el código de las aplicaciones en un servidor y cada una de las bases de datos en un servidor diferente si ya te digo tendríamos que estar hablando de aplicaciones muy intensivas con muchos usuarios y con mucha concurrencia Pero vale si se da pues no hay ningún problema vale vamos a verlo me parece poco código pero vamos a ver si hay suerte Entonces vamos a ver Oh varias cosas primero en procedimientos me cargo el procedimiento segundo lo aplico Okay tercero me vengo por aquí líneas pedido Ok pedidos Uh uh muy bien muy bien Ahora sí fantástico vale perfecto Ahora sí así que actualizo el procedimiento Vale y ahí lo tenemos bien Y a partir de aquí puedo seguir pidiendo más cosas por ejemplo ahora lo que quiero es separar lo que bueno es que ahora todos son vistas con lo cual e líneas Sí Perdón no no líneas pedido no perdona productos clientes líneas y de línea y de pedido yo juraría que parecía que estaba bien pero bueno da igual No pasa nada Pues voy a dejar esta parte aquí porque hay una cosa que me falta que es crear la acción para crear un pedido con un cliente vale que casí me importa más dejar eso resuelto más que nada para que veáis lo de el ento de crear pedido vale entonces ahora okay vamos aquí a ver un momento porque no sé si he pegado el procedimiento correcto ahora estoy dudando eliminar Ok sql Ok continuar Okay Vale vamos a ver líneas pedido sí que parece que vale hace lo mismo Ok perfecto Now create an action to make use of procedure to create a New order stating customer information and to order Lines create a form to fill then on form Send call procedure vamos a por ello Y así hacemos uso de ese procedimiento que ahora veréis que Mola una barbaridad vamos a ver y create order vale vamos a crear una archivo llamado create order no me Mola que esté en un archivo aparte Pero bueno es un poco lo de menos ahí vale Ahí ahí Okay vale Y ahora lo que va a hacer es a ver Select ok Ah Select producto vale muy bien y al final lo que debe hacer es llamar No lo estoy viendo al procedimiento call Aquí está perfecto pues create order Ya sí Pero de dónde se llama esto bueno a ver lo voy a ejecutar vale porque esto se llamaría des de create order.php vale create order vale dashboard Ok create order full name Qué Tengo por aquí clientes Okay perfecto pues José viicente carratala email info @jcarreraandrade y quiero balón jarsa 2 le doy a confirmar orden creada satisfactoriamente me voy al dashboard Y entonces en clientes veo que no está vale Ok y líneas pedido no y pedidos no a ver eh create order isel Brown vale Qué curioso vamos a decirle lo siguiente uno eh create a link to that form in Main dashboard dos everything seems Okay and System gives an Okay message but Nothing is inserted on database lo cual en realmente Es bueno e Qué pasa lo cual realmente es bueno momentín que está recargando los datos vale lo cual realmente es bueno venga va porque así nos aseguramos vamos a verlo por aquí así nos aseguramos de que eh o sea o se mete todo o no se mete nada Es decir probablemente acabamos de provocar sin quererlo pues una un rollback vale es que algo ha fallado pues no metas nada per pero quiero que se meta todo obviamente vamos a ver vale en el dashboard Okay Ah Venga pues Vale pero dashboard heer le vale entonces le y li Y luego el forage vale eso por ahí ahora el problema gordo eh Ya sí pero vale el procedimiento es este backup usuarios procedimiento no transacciones a ver el procedimiento actual es este con las transacciones Por cierto aprovecho para deciros Lo eh siempre pasa esto vale que hacer que la transacción funcione es muy peliagudo es muy delicado porque o la transacción funciona 100% bien o no hace nada vamos a ver ejecuta manualmente esta consulta sql okay No es eso No vamos a ver un momento no nuevos nuevo order vale vamos a pedirlo en un archivo nuevo Por cierto yo tenía por aquí un python funcionando sí bien Vamos a ver ahora ejecuto carpeta de proyecto cojo sadel Brown Sad Brown Ok Ok copio Ok pego order insertion from form not from form inserting anything Problem with transaction Maybe que Insisto que esto que me estoy encontrando puede parecer un obstáculo pero realmente no lo es porque desde el punto de vista de la seguridad vale que esto ahora mismo es una tienda ficticia que no va a ninguna parte vale pero imaginemos que esto es un banco imaginemos que estoy haciendo una aplicación para un banco dices Oye prefiero que se da un error no se inserte nada antes de que se inserten los datos a mitad y luego tenga la base de datos en un estado no eh No homogéneo o no fiable por eso os digo que trabajando con transacciones pues como os he comentado antes lo que tienen las transacciones es que son muy puñeteras Vale y o la haces perfecta o no ocurre nada Por cierto mientras esto avanza voy a ver si tengo algún backup Oye no tengo ningún backup Pues nada bueno no sé a ver un momento en eventos en base de datos en eventos puedo claro no puedo darle ahora vale Y en procedimientos va capsa del Brown Ah vale Okay el servidor mysql está ejecutándose con un comando que no permite Acceder al sistema de archivos con lo cual no se puede ejecutar okay No pasa nada vale bien Mientras tanto vamos a ver okay vale okay String entero vale OK Vamos allá y vamos allá bueno Y aparte error reporting vale Ah mira error reporting espérate vale Bin parameters Vamos allá me voy a create order me voy a Mira sí que está sí que hay un Esto vale Ok le meto el cambiando el tipo de dato Ok el error reporting está hecho o sea que poco más vale error reporting error loging pero es que está hecho o sea lo voy a copiar y pegar pero es que ya está Vale y vamos a por ello vengo por aquí me voy al dashboard New order José Vicente email phone address camiseta 1 bón 2 quantity teóricamente es order created y me voy al dashboard No lo sé vamos a verlo me voy a clientes sigue que no vale sigue que no pasa nada eh tendría que ver porque el caso es que me dice que sí pero luego es que no vamos a ver otra cosa que puedo hacer vamos a ver aquí have on eo de sql to execute to test it Against database no puedo hacer un eco porque está lleno de interrogantes ig emplazar los interrogantes por los datos para que lo pueda ejecutar contra la base de datos y pueda probar directamente Más que nada porque php me está diciendo ok pero claramente no es OK con lo cual pues vamos a ver claro php No me da una forma de Ver el final Vale y puedo hacer esto okay a ver qué tal entonces sql de bug aquí Bueno aquí vale vamos a probarlo New order José Vicente email phone address camiseta 1 y balón 2s aquí Ok vale Esta es la petición parece correcta pero ahora me voy a la base de datos me voy a sql me voy a pegar todo parece correcto y continuamos ostia pues ha dado OK Y si me voy a clientes Ah pero no da Ok O sea no es OK realmente pues esto ya es más complejo de debugar no imposible pero es más complejo A ver vamos a ver parece raro porque la sentencia parece válida eh Okay vamos a ver el procedimiento sí que inserta o sea sí que startar transaction Okay y comit no veo como el programa cree que le estoy pidiendo todo el código de php voy a decirle que solo quiero el código de la transacción para que entienda mejor lo que le estoy pidiendo Hola dime no te suena de esto o algo no Qué es eso encontrado Ah me dicho que a ver pero V Un segund Inn está en inglés no esta en No sí pero quiero decir que está en inglés o sea el idioma es inglés sabes Entonces como parece que bueno tampoco hay mucha letra ahora que lo dices pero como parece que está en inglés preguntar a las profes de inglés a ver si es algun dellas vale venga hasta ahora vamos a ver y vale vamos a vale Este es el procedimiento que es crear pedido con cliente me voy a procedimientos me voy a pedido con cliente me voy a sql continuar no ay el imiter del limiter estamos bien continuar Vale ahora probamos el procedimiento vamos a probar si el procedimiento funciona a Palo Seco Ok dice que s Ah error Ur transaction roll Back pues bueno ya os digo que esto luego habría que pelearlo a ver un momento bueno está indicando un sql exception O sea que atrapemos el error para ver qué dice el error completo pero bueno a ver okay entonces en procedimientos eliminamos el crear pedido con cliente vale en sql creamos el procedimiento vale en ejecutamos con parámetros vale Y si hay error vale pero enséñamelo A ver vamos a ver Table Don't exist Vale customers orders y order details a ver procedimiento no procedimiento con cliente customers orders order details Ah okay okay vale a ver tablas Table names Are Not correct tables are voy a hacer una cosa voy a los creates por aquí arriba para no darle todo creación de tablas e vale a ver si con el nombre correcto copiamos eliminamos generamos vale probamos sql continuamos teóricamente Es OK order created successfully vale eh nos vamos a clientes Ok nos vamos a líneas de pedido todo irá Ok en dashboard en clientes vale Ok y ahora vamos a probar desde aquí Así que full name José Vicente info carsa número de teléfono virgen desamparados camiseta 3 y balón 4 confirm order me voy al dashboard me voy al dashboard me voy a Clientes no se ha creado todavía vale Ah info carsa líneas de pedido y de línea cantidad no a ver a Ah Ah y 2 vale dashboard No A ver sql an error occur vale Entonces entonces me voy a create order y digo okay Now it works directly on database but not in this php file Al final todo esto de lo que estamos hablando hoy en este primer ejemplo no es más que una cuestión de balanceo de recursos es decir dónde nos interesa más que esté la carga de proceso si en el servidor que lleva la programación o en el servidor que lleva la base de datos Mi objetivo como os digo es simplemente pues mostraros que es posible para que a partir de ahí vosotros Pues contéis como siempre os digo con cuantas más herramientas mejor para hacer posible las aplicaciones vamos a ver vale Yo juraría que ya había cambiado lo del SS pero bueno a ver eh a ver php desde aquí hasta aquí probamos New order José Vicente info phone address 1 2 Ok duplicate and trve vale Ok vale esto ya es otra cosa a teléfono address 1 y 2s Ok dashboard clientes Ahora sí esto estaba claro vale Y ahora sí ya tenemos por aquí el proyecto funcionando vale Así que en este primer proyecto de la tarde como veis el objetivo consiste en probar como Pues bueno tenemos eh la posibilidad de utilizar diferentes recursos que nos ofrece la base de datos Y a partir de ahí ya pues dónde hagamos las cosas dónde hagamos los cálculos dónde hagamos las funciones pues depende de nosotros si os dais cuenta no hemos hecho como te diría yo nada Ah Por cierto el stock me lo ha bajado productos sí Mira ves el stock poco a poco me lo va bajando y si os dais cuenta nos hemos ahorrado tener que hacer eso es decir No le hemos dicho la lógica en el código php de cuándo debe quitar un producto del stock por qué porque hemos creado un Trigger dentro de la base de datos que se encarga de esa cuestión vale con lo cual con este primer ejercicio hemos trabajado como veis la parte diríamos de eh de esto de creación de aplicaciones empresariales ahora en la en el segundo ejercicio que traigo pensado para la tarde de hoy quiero enseñaros un uso un poco diferente de las bases de datos a través del concepto de motores de base de datos que es algo que tampoco nunca hemos tocado voy a cerrar por aquí