pues iniciamos grabación con el módulo profesional segunda sesión de eh procesos y servicios antes de empezar voy a dibujar un esquema de repaso y ahora continuamos con el ejercicio del otro día para bueno sé que eh os está causando bastante confusión por llamarlo de alguna forma el tema de los workers pero es que esta asignatura es así es muy abstracta es computacionalmente compleja Yo creo que es bonita Vale entonces el otro día estuvimos comentando que existe el concepto de El Bueno de Hilos de proceso hasta el momento a lo largo de los meses del año pasado hemos estado trabajando con el concepto de hilo principal y realmente hasta el momento no habéis trabajado con otro concepto que no sea el concepto de hilo principal el hilo principal básicamente es el programa que hemos construido hasta el momento que es un programa que hace a b c d e fg y sale y todo eso quieras que no Aunque vosotros no lo hayáis controlado de forma consciente Pero eso forma parte de un hilo de procesamiento es decir ocupa un hilo de ejecución dentro del procesador el otro día estuvimos eh trabajando con una entidad dentro de html5 hay entidades similares en prácticamente cualquier lenguaje de programación moderno subrayo la palabra moderno eh que es los workers Entonces en un momento dado yo puedo disponer de un worker que básicamente es un hilo de ejecución asincrónica quiere decir que no está sincronizada con el hilo principal es decir no se coloca de forma secuencial al hilo principal sino que se coloca de forma asíncrona Por una parte se le puede llamar cuando queramos nos puede responder cuando él quiera pero sobre todo no bloquea la ejecución porque se ejecuta como digo en otro hilo de ejecución diferente del hilo principal lo cual nos abre las puertas a la programación multinúcleo y a la programación multihilo el worker Eso sí aquí viene la cuestión aquí viene el repaso requiere suele requerir no es obligatorio pero es lo normal suele requerir que se le emita una esto fuera una información de entrada eh al revés Ay Hola Qué ha pasado aquí entonces cuando ejecutamos un hilo de ejecución como un worker Pues claro Generalmente es porque le enviamos alguna información a ese worker como mínimo un arranca y opcionalmente además de arranca Pues también le podemos pasar datos para que el worker trabaje con algunos datos vale opcionalmente además ese worker cuando finaliza su tarea le devuelve un mensaje al hilo principal acordaos del otro día que estuvimos comentando ahora lo repasamos que yo en este esquema estoy haciendo estoy pintando un worker pero la gracia no es tener un worker la gracia es tener un montón de workers que funcionan en paralelo y cada worker usa un hilo de ejecución y por tanto pues eh digamos petamos el procesador la comunicación mediante workers implica en la terminología concreta de los workers cuando hablemos de python hablaremos de que el concepto es el mismo los términos cambian pero los conceptos son iguales Entonces cuando le emitimos un mensaje hay un método llamado post message está en el dispositivo que emite el mensaje Vale post message emite envía y cuando el origen le ha enviado un mensaje al destino el destino recibe ese mensaje con un método un evento llamado on message por tanto en esta primera parte el hilo principal una vez que hemos instanciado un worker en alguna parte si queremos que el worker se ponga en funcionamiento le tenemos que enviar un post message le enviamos un mensaje y el worker se entera de que alguien le está llamando porque el worker debe iniciar siempre con un on message Cuando alguien me envió un mensaje me pongo a hacer cosas de la misma forma Generalmente no obligatorio vale pero Generalmente cuando el worker acaba su trabajo el worker genera un post message porque se comunica con el hilo principal en este caso el bst message no hace falta decir a quién lleva porque inevitablemente lleva el hilo principal que es quien ha llamado al worker y el hilo principal a su vez tiene un message vale Esto es lo que os Lía bastante a vosotros y a todos los alumnos de todos los años porque claro post message por allí on message por allá no me entero de quién es post message Y quién es on message Vale pues el flujo de información básicamente un momento el flujo de información es este que os Voy a pintar un momento click relleno vale estilo de trazo voy a redondear trazos tampoco ha redondeado mucho Pero vale Y clic aquí y voy a pintar el cor de trazo rojo un poco para que se vea que es otra cosa aquí vale Y ahora Bueno este texto lo voy a poner por encima y Generalmente como os digo el flujo de la información es la Flecha roja que os acabo de indicar el hilo le envía con post message el worker recibe el on message el worker trabaja y el worker le devuelve un mensaje al hilo principal con un post message y el hilo principal lo recibe con on message claro evidentemente como os podéis imaginar y aquí nos quedamos en la clase anterior y aquí es donde vamos a continuar hoy la gracia de todo esto es que además Por una parte el hilo principal Uy Espera que tengo ahí ok Por una parte el hilo principal le puede dar al worker datos Por tanto se transmiten datos y por otra parte digamos podríamos decir en cierta forma que esos datos que se transmitiran al worker podrían ser datos en crudo datos sin procesar porque quizás ya estamos llamando un worker para que sea el worker el que procese los datos y a continuación Generalmente Pues el worker nos va a devolver datos No necesariamente los mismos a veces son menos porque el worker procesa datos y nos devuelve el resultado no nos devuelve los datos originales vale la semana pasada Estuvimos viendo que en todo este proceso y solo con lo que acabo de pintar en la pantalla yo creo que más o menos ya os lo imagináis solo en este proceso hay una serie de penalizaciones entonces el proceso en el cual el hilo principal prepara los datos y los envía por post message esa preparación de datos es una penalización el proceso mediante el cual los datos viajan desde el proceso a hasta el proceso B dentro del mismo ordenador pues ese viaje de los datos dependiendo de comoo de grandes sean los datos tiene una penalización en tiempo vale o sea tiempo que el worker no ha empezado a trabajar porque el worker está esperando a que le lleguen los datos el tiempo en el que el worker recibe el mensaje y procesa los datos vale eso no es penalización eso es lo que toca eso es procesamiento pero luego el worker tiene que preparar un paquete de datos en Post message los datos tienen que viajar de vuelta al hilo principal y generalmente el Elo principal pues tiene que recibir los datos tiene que desempaquetar losos y tiene que asignarlos al sitio al cual correspondan por eso la semana pasada creo recordar así a ojo que cuando ejecutamos el ejercicio que estábamos haciendo en el ISO principal nos tardaba 11 segundos pero cuando lo ejecutamos en el worker tardaba 17 segundos que dijimos qué mal negocio vale a partir de Aquí vamos a ver varias cosas Y es que para empezar y aquí es donde empieza Ahora sí la clase de hoy después del repaso del otro día y Es que creo recordar que el otro día por ejemplo cuando creamos un worker si quiero que el worker me procese una parte de la imagen yo le estaba enviando toda la imagen entonces claro de esa forma le estoy enviando un montón más de información de la que toca ahora hablaremos en estrategias de optimización que yo por ejemplo el otro día le estaba enviando información Alfa es decir rojo verde azul Alfa para qué estoy enviando yo un Alfa para hacer un cálculo de grises no vale para nada estoy enviando un 25% de información que no sirve para absolutamente nada por tanto el otro día lo que nos salió en la pantalla es correcto pero hoy lo que tenemos que hacer es una serie de optimizaciones para que no ocurra lo del otro día vale que lo del otro día no es que sea un error es que es lo que tiene que ser hasta ese punto del desarrollo del ejercicio Vale entonces voy a guardar este esquema por aquí me voy a dam me voy a segundo me voy a procesos y eh servicios y procesos me voy a multiproceso y Eh pues no me acuerdo dónde estábamos estamos por aquí y Ok worker y ahora en hilos No pues aquí vale Okay entonces me guardo 001 esquema repaso y ya está bien okay Vale ojo si entramos al temario de esta asignatura veremos que empezamos trabajando con multiproceso lo cual quiere decir que se crean diferentes procesos en el mismo ordenador y nos comunicamos entre los procesos pero acordaos que en el segundo tercer tema es computación distribuida donde no nos comunicamos con otro proceso nos comunicamos con otro equipo para lanzarle a ese equipo proceso y recoger de ese equipo los datos como os podéis imaginar las penalizaciones en ese caso serán más grandes todavía porque el tiempo de transferencia por red pues es grande Vale entonces yo me vengo por aquí me voy a guardar vale me voy a cerrar por aquí eh guardar como svg escape vale va svg venga bueno sg Okay y Oh qué pesado cerrar sin guardar bien y a continuación vamos a abrir el código que estábamos haciendo el otro día vamos a repetir lo que hicimos el otro día esto es de ayer Vamos a darle a abrir y nos vamos a segundo a programación servicios y procesos multio no perdona multiproceso ilos vale Y el otro día nos quedamos eh haciendo esto eh siete cálculos a worker y worker voy a hacer una cosa Me lo voy a copiar Ah segundo programación eh multiproceso estados me copio el si copio la foto también me voy aquí me voy a hos lo pego no es el siete es el oo y aquí el ocho y vamos a ver qué es lo que ocurre bien Ahora me voy aquí me voy a o y me voy a ocho aquí vale Y lo principal que empiezo a ver es que teníamos el otro día un worker que al cual le envió todos los datos vamos a ver tiempos vamos a ver tiempos vamos a ver vamos a empezar a medir tiempos aquí local Host dam segundo procesos y servicios servos y procesos multiproceso ahora hilos y cálculos worker bien Vamos allá estoy ejecutando vamos a esperar unos pocos segundos 15 16 17 segundos y vamos a ver está computando no o qué O no voy a guardar de nuevo vamos a ver Es más voy a sacar esto y no debería haber algún hilo a tope Vale pues voy poner el clásico Mira worker Ah vale Perdón perdón 008 worker Ahora sí worker arrancado vamos a trabajar y tras unos 15 segundos más o menos pues veremos cóm nos devolverá la ejecución Ok work finalizado devos lo principal y quédate con esto 17 O sea casi 18 segundos vale 18 segundos como tiempo de partida pero yo ahora a continuación digo a ver espérate en lugar de enviar todos los datos qué os parece si envío solo el canal rojo el canal verde y el canal azul vale Y aquí de hecho no estaba utilizando el canal rojo el canal verde el canal azul aquí estoy utilizando vamos a ver y gris esto de aquí y más igual a 4 Muy bien pues ahora a continuación en lugar de enviarlos todos yo voy a decir que vamos a ver mín trabajador Ah no post message Perdón trabajador post message datos. Data pues no yo aquí ahora lo que voy a hacer es que led recortado o led sin transparencia es igual a Ray y ahora digo sin bueno for Let I es ig a 0 Y es menor que datos. datata leng y más = 4 y ahora lo que digo es sin transparencia punto Push datos punto Data de i datos pun Data de I + 1 y datos punto Data de I + 2 Qué quiere decir esto Pues que estoy creando un array al cual no le estoy metiendo la transparencia ya me estoy ahorrando un 25% Así que ahora trabajador post message datos. datata no sin transparencia antes te estaba enviando los cuatro ahora te envío tres vale los cuatro canales ahora te envío tres en el worker trabajo todo esto de aquí claro ahora ya no hace falta que haga I + ig a 4 porque ahora ese cuarto canal ya no existe Vale ahora I más y ahora vamos a ver for I tal Vale pues cdi esto Me lo voy a cargar esto es la operación ya sabes machacona de multiplicar Okay y es gris Ah vale Bueno pues voy a hacer más igual a 3 espera vale más ig a 3 Ok porque entonces ahora hago esto de aquí que es el gris muy bien Esto es datos datos Y en principio una vez que tengo esto pues lo que hago es devolver al Principal el datos punto Data Por cierto que aquí me lo ponía gris bien Ahora voy a ejecutar esto de nuevo y probablemente va a salir un desastre la razón por la que va a salir un desastre es porque aquí estoy enviando packs de TR pero cuando recibo el mensaje lo interpreto como si fuera px de cu Y ahí se va a lar parísimo vamos a verlo recargo acuérdate 18 segundos vamos a verlo worker arrancado vamos a trabajar y ahora saldrá un desbarajuste de imagen probablemente Vale y tras finalizar el worker vamos a ver cuánto tiempo está pasando aquí worker finalizado devolvemos al hilo principal Vale y ahí es lo que ocurre porque lo que está ocurriendo es que lo que les estamos enviando no tiene ningún sentido vale bien Vamos a ver ese no tiene ningún sentido venimos por aquí vale esto es I + = 3 Claro sí I + = 3 correcto vale Y ahora aquí en el proceso principal aquí on message lo que tenemos que hacer es decirle lo siguiente vamos a ver ahora si el registro principal tiene bloques de tres y le quiero poner bloques de cu a ver un momentín Eso es correcto vale Aquí tengo que hacer lo contrario Aquí tengo que datos del worker es igual a mis datos voy a hacer un console punto log de mis datos o datos del worker lo ejecutamos y Los vemos antes de que de error ahora acabará el worker vale worker finalizado Vale y nos da esto Ah datos. datata Esto es lo que tengo que trabajar message event vale message tendrá un Data es nul Qué raro vamos a ver on message misdatos pun datata Ok mis datos. datata vale vamos a recargar hay una cosa que me extraña un poco y es que dice que mis datos es nul ahora vemos porque eso no me cuadra nada vamos a ver si en algún momento entre que hemos traído aquí los datos. datata si se ha perdido algo aunque no debería otra cosa es console.log eh datos pun Data para asegurar que al worker le llega información vamos a acabar esta ejecución y a ver qué tal bien worker finalizado y aquí nul ahí hay un problema recargo vale worker arrancado vamos a trabajar pero no aquí teóricamente datos pun Data Debería ser algo y no está haciendo nada vale Ok pues vamos a verlo sin transparencia es igual a Ray sin transparencia Así que console pun log lo que le voy a enviar al worker es dos puntos console log sin transparencia y vamos a ver si ha cogido correctamente esto aquí vale recargamos lo que le voy a enviar al worker es Nada ese es el problema vale sin transparencia es igual a Ray datos. datata leng + ig a 4 principio todo esto es correcto en principio todo esto es correcto datos. Data de i Okay Ah ok vale cálculos a worker línea 26 vale worker arrancado vamos a trabajar en el worker arrancado vamos a trabajar Se supone que estoy sacando datos pun datata aquí fijémonos que está enviando los datos correctos si nos fijamos 93 167 2 3 16 214 es el mismo tono de color pero no hay un cuarto componente 255 que sería el alfa por tanto hasta ahí hasta este punto es correcto trabajador post message sin transparencia vale Ahí le estoy enviando los datos con lo cual aquí eh vamos a ver worker arrancado vamos a trabajar HM yo a ver voy a sacar datos pero es que el worker Yo diría que no me está haciendo ni caso botón derecho Vaciar la cach y volver a cargar de forma forzada recopilo datos voy a probar igual otra estrategia que va a ser enviar una porción de los datos un momentín y a ver si así a ver hago control Z Ok 008 aquí hago control Z vale Y voy a hacer una cosa en lugar de enviarle todos los datos lo que voy a hacer es enviarle un una cuarta parte de los datos yo he dicho antes que datos es igual a contexto que tage Data de 6000 por 4000 Pero qué pasa si recargo y envío 6000 por 1000 es decir una cuarta parte en lugar de 4000 1000 vale Vamos allá Yo creo que ahora sí Esto está tirando proceso porque ahora estoy oyendo aquí el ventilador OK ahora Vale ahora m event Ok Venga pues worker arrancado vamos a trabajar worker finalizado y ha tardado 4500 o sea 4572 milisegundos Pero por qué Pues porque he hecho solo una parte y si os fijáis ahora esta par parte de aquí arriba esto de aquí está gris es decir recargo daos cuenta que eso es azul es azul worker finalizado devolvemos ahora es gris pero me ha hecho una cuarta parte Por qué me ha hecho una cuarta parte pues porque yo le he enviado una cuarta parte de los datos ahora bien qué ocurre si yo ahora a continuación en lugar de crear un worker creo cuatro workers y esos cuatro workers cada uno de ellos tardará 4,6 segundos os acordáis que el tiempo original era 11 segundos no el otro día claro o sea el hilo único eran 18 segundos correcto pero el tiempo original contra el que competimos era 11 segundos hacer procesar la imagen en el hilo principal digamos Vale pues Ahora a continuación lo que voy a hacer es que en lugar de crear un worker voy a crear varios workers vamos a hacer esto con eh 009 Ahora varios workers ahora esto es 009 worker vale Y eh envío al 009 y además a continuación yo digo bar trabajadores es igual a Ray sabes qué mira lo voy a hacer a lo bestia voy a hacer a lo bestia porque así igual me entendéis mejor lo hacemos a lo Bestia y luego ya lo hacemos bien con una Ray Así que yo me copio todo esto yo me copio todo esto yo me copio todo esto y ahora a continuación digo trabajador voy a hacer un bloque es má esto de datos va Aquí bar datos vale Okay datos uno y ya está Vale vamos a comprobar que funciona hago así vamos a comprobar que funciona y eh 009 worker varios workers worker arrancado vamos a trabajar y en 4 segundos vale eh Data en el varios workers En qué línea datos vale datos uno y Okay Vale volvemos a ejecutar comprobamos que no da error comprobamos que lo podemos escalar a la bestia Okay Vale pues yo ahora me puedo copiar esta parte insisto a lo bestia pero a lo bestia para que lo entendáis y ahora digo que datos dos es contexto get image Data desde a ver desde 0,1000 hasta 6000 com2000 vale o sea cojo el segundo cuarto de la imagen un momento 00000 hasta 6000 2000 vale correcto trabajador 2 es igual a New worker trabajador 2 post message le envío los datos dos trabajador 2s mis datos vale eso se puede quedar así y datos dos es datos 2. datata contexto put image Data datos dos en 0 1000 Entonces yo ahora lo que he hecho es que recargo eh momentín varios workers me he cargado algo parece que no parece que sí porque esto de aquí vale esto de aquí va aquí y esto de aquí va Aquí el tiempo ya no servirá vale Pero bueno puedo poner un Ok vale recargo y podemos contar el tiempo en segundos vale Y no sé si veis como ahora esto se ha convertido en gris y esto se ha convertido en gris el tiempo ya no vale el tiempo ya esto ya no vale Pero podemos calcularlo a mano si queréis Oye esto Ah esta imagen Es que no cabe más o qué no es cuando ya no Calcula más pero esta imagen 6000 por 4000 igual es que no realmente no cabe más en la pantalla vale Bueno pues ahora si tengo una imagen de 4000 como veis la estoy cortando en cachos de 1000 con lo cual ahora como os podéis imaginar pues hago así y tengo datos tres empieza en 2000 llega a 3000 trabajador 3 trador 3 trabajador 3 datos 3 y lo pongo en 2000 Y por último creo un cuarto worker ahora lo vemos en los procesos Por cierto datos 4 es igual a empiezas en 3000 y acabas en 4000 trabajador 4 trabajador cuatro trabaja datos cuatro datos 4atro y datos cuatro Okay Vale recargo saco los procesos en los procesos veo cuatro hilos que se ponen ahí a tope ya sabéis que se van recargando ahí ahora comento el código Blanca pero en el código básicamente lo que he hecho es eh multiplicar el código por cuatro es decir código he cogido el código el otro día y lo multiplicado por cuatro con cuatro workers Vale entonces ahora ha tardado unos 4 segundos en hacerse los y los han parado Y entonces comento esto no interfaz esto es de ayer vale Uy aquí entonces comento vamos a ver para cada uno de los workers comento un worker y luego evidentemente los otros cuatro son iguales vamos a ver vale Leo los datos de la memoria pero sí pero no es decir Espera que no pulse un botón por accidente Leo la primera cuarta parte de la imagen porque es la primera cuarta parte pues porque ah no perdona el worker que tengo que comentar es este de aquí arriba Sí pues porque si la imagen tiene 4000 píxeles de altura estoy cogiendo desde cer hasta 1 No desde c hasta 4000 vale la primera cuarta parte en vertical de la imagen con lo cual cargo con una cuarta parte de lo que cargaba antes y esto quiere decir que si me voy al esquema de incape No me digas que cado incape no sé para qué cierro incape eh No sé no esto Qué es eh documento nuevo y en archivo en reciente debería estar aquí fantástico me encanta Ah a que no se ha grabado aquí esquema repaso fantástico Bueno pues no se ha guardado el esquema repaso eh un momentín porque eso también me extraña bastante que no se haya guardado porque esquema repaso 14k sí que se ha guardado pero igual me ha faltado ponerle el la extensión Ahora sí abrir con visor de imágenes vale un poco bestia entonces me vengo aquí y me voy a abrir y me voy a esquema repaso ostia Bueno pues no sé sabes Voy a abrirlo con Chrome fantástico también Bueno pues nada eh local Host bueno Pues nada tampoco Vale pues en ese esquema de repaso básicamente yo lo que estoy haciendo aquí es recortar la cantidad de bolitas que le pasó al worker le pasó una cuarta parte de bolitas a continuación vengo por aquí y digo creo una nueva instancia de un worker eh Y lo pongo en el identificador llamado trabajador o sea ahora trabajador se ha convertido en un worker ahora post message pues lo que os he comentado antes cojo los datos y mediante post message se los envío al worker Así que tomo los datos y se los envío al worker en trabajador ya está o sea hasta aquí me olvido vale Y voy a poner por aquí un comentario y ahora me olvido porque yo ya le he enviado los datos al trabajador y ya si eso el trabajador me dirá algo Cuando quiera pero yo ya no puedo hacer más en lo principal Vale entonces ahora cuando el trabajador ha acabado cuando el trabajador finaliza me devuelve un mensaje O sea me devuelve un mensaje literalmente un toque sabes como e ya acabado y además te envío los datos Y entonces yo ahora lo que hago es que tomo el array de datos que me da el worker y lo vuelco al array de datos de la imagen porque yo lo que quiero al final es una imagen y por último esa imagen que he construido con los datos que me da el worker pues la pongo en el Canvas vale contexto put image Data de los datos qué he hecho a continuación Pues he cogido este bloque de código que es para un worker y simplemente lo he copiado y pegado para hacer varios workers concretamente para hacer cuatro workers Albert eso es lo que voy a mostrar a continuación vale De hecho eso es lo que iba a hacer pero he pensado que si ya estáis liados con el tema de los workers como encima le meta por ahí a Rise pues os vais a porque entonces ya me mandéis a tomar por saco Vale entonces ahora evente ente Esto es lo que en inglés se llama un code smell es cuando el código huele cuando dices os esto tiene mala pinta no sé qué es pero tiene mala pinta vale solo de repetir tantas veces esto ese código no es mantenible es entendible en el sentido de que te envío uno te envío dos te envío tres te envío cuatro pero no es mantenible y tampoco es ampliable porque yo a continuación os digo bueno Por qué he elegido tener cuatro workers si por ejemplo mi ordenador tiene 16 núcleos Así que la idea es que yo he elegido tener cuatro o sea cuatro workers porque esta imagen estaba por aquí esta imagen tenía 4000 píxeles de alto con lo cual yo digo pues Oye 4000 píxeles cuatro workers 1000 por píxel o sea 1000 píxel por worker y ya está pero claro y si mi imagen no tuviera 4000 píxeles Y si mi ordenador no hubiera cuatro núcleos u ocho núcleos o 16 núcleos Vale entonces lo que voy a hacer a continuación Albert es mostraros una metodología eh donde Por una parte el código obviamente va a ser más eficiente no lo voy a partir en cuatro trozos lo voy a partir en un número ilimitado de trozos y eh lo que os voy a enseñar a continuación es una metodología basando en una cosa que se llama backets Los backets consiste en no partir la imagen en cuatro cuartos sino partirla en cuadraditos los cuadraditos se llaman backets y cada backet lo enviaremos a un núcleo diferente de procesamiento vamos a hacer eso vamos a hacer 010 backet a continuación el worker 09 lo convertimos en también en 010 worker vale Y yo a continuación ahora obviamente voy a eliminar todo este código redundante de aquí eh lo del tiempo inicial y tiempo final Pues bueno me ya me importa menos porque hemos visto que funciona vale si queréis lo dejo porque tampoco hace daño ese código igual marea un poco pero tampoco hace mucho daño bien y yo a continuación eh lo que hago es decir bueno la imagen es de 6000 por 4000 porque la imagen original Era De ese tamaño Vale y vamos a ver vale Y ahora digo lo siguiente barbet es igual a lo que quiera por ejemplo 64 pixels vale puedo poner 64 128 256 puedo poner 100 o 50 o 20 se suele recomendar que ponga potencias de dos pero puedo poner técnicamente lo que quiera a continuación yo lo que voy a hacer eh vamos a ver vale es que estoy viendo Bueno ahora veremos lo que hacemos vale a continuación yo lo que hago es decir bar x = 0 y bar y es = 0 con lo cual a continuación voy a decir que voy a empezar cogiendo el contexto en x el contexto en y el trozo que voy a es de backet por backet es decir 64 por 64 no estoy cogiendo toda la imagen no estoy cogiendo un cuarto de imagen estoy cogiendo un cuadradito de la imagen ahora también para que me veáis mejor ahora que hemos demostrado el tema est del gris lo que voy a hacer es que me voy a bajar otra imagen de internet momentín me voy aquí me voy a Drive me voy a mis fotos esto de no esto no eh fotos mías 2024 vale Okay ahí estoy yo okay Me descargo esto esta imagen Es muy grande vale Ahora la vamos a hacer menos grande un momentín me lo descargo en escritorio me lo abro me lo voy a abrir dónde estás Hola eh No lo veo vosotros lo veis a ver aquí vale la voy a abrir con gimp bueno no esto no bien Voy a recortar un trozo una cosa así espera e cuadrado Uy ha pasado de mí fantástico Gracias O sea habéis visto que le pongo uno Ah ahora vale hago así eh Me la ardo como Eh bueno la pongo como 1024 por 1024 vale Y así no tengo una imagen tan gigantesca como la que tenía hasta ahora me la guardo como eh imagen original Okay bien y ahora imagen original me la voy a pasar a bam a segundo a procesos a multiproceso a hilos a imagen original.jpg vale a continuación Aquí voy a hacer un Lienzo de 1024 por 1024 y así ya no es tan monstruosamente grande 1024 por 1024 la imagen hemos dicho que se llama No me acuerdo Esta no es se llama imagen original Vale y imagen onload context draw image backet Vale y vale luego en el worker también voy a quitar toda esta traya y aquí Okay aquí y aquí o sea os acordáis le he quitado todo ese bloque de cálculos artificial que hacían que fuera más lento porque ya hemos demostrado esa parte muy bien Por lo tanto vamos a probar si esto funciona hilos me voy a 10 buet y vamos a ver Hola Okay Ah un momentín no está la imagen vale la imagen es imagen original jpg ahora bien y no sé si os fijáis pero ahí arriba ese cuadradito se ha puesto de color gris lo cual quiere decir que ha habido un worker vamos a ver ha habido un worker que ha procesado eso de ahí claro ahora como le comentaba a Beltrán que íbamos a hacer ahora a continuación como te puedes imaginar Beltrán si cojo 64 por 64 y empiezo a multiplicar cuadritos por toda la imagen copiar y pegar código no es una alternativa porque eso va a ser una barbaridad lo que tengo que hacer ahora es decirle al sistema que vamos a ver esto de aquí es un worker que se va a ejecutar a sí mismo cada vez en el sentido de que cuando el worker acabe es decir cuando el worker finalice lo que quiero es que se vuelva a llamar a sí mismo Para ello voy a meter el worker en una función por tanto vengo por aquí y digo function mi trabajador o fun trabaja mucho dentro de trabaja mucho lo que voy a hacer es ejecutar esto vamos a ver aquí Ok contexto datos un get image Data Ok vale Y aquí contexto put datata Okay Vale trabaja mucho vamos a probarlo esto fuera esto permitirme que lo quite y así ahorramos cosas que no utilicemos ya vale y ejecuto trabaja mucho datos creo que no lo estoy utilizando ahorro todo esto Vale y ya está vamos a probarlo recargo si no da error x not Def trabaja mucho Pues si que está Def Ah s vale bar x y bar y por qué Pues porque son variables globales x bueno porque barbet ahora comento el código y aquí pondré que estos son variables globales vale Okay ya lo tenemos es decir trabaja mucho lo que hace es llamar al worker pero ahora cuando hemos hecho el worker a continuación lo que puedo hacer es decir que cuando el worker finaliza X + ig a 64 o x más igual a backet y trabaja mucho atención qué acabo de hacer ahí Eso es peligroso lo que acabo de hacer es que la función trabaja mucho llama la función trabaja mucho o sea acabo de hacer una función recursiva pero cada vez que la función se llama pues aumenta el buet vale recargo y vamos a ver momentín vale Ahí vamos a hacer un Ahí está pillado veis botón derecho está pillado vale voy a decir que set Time out function el set Time out es lo mismo que estamos haciendo en multimedia es un temporizador o sea espera un segundo a ejecutar trabaja mucho esto se ha quedado frito frits muy frito pero muy muy frito Mira mir mira mira la ram Mira la ram fuera para para o me voy a quedar sin ordenador vamos a ver forzar salida Ok fantástico vamos a ver la ram Mira Ram esto se llama el salto del Ángel vale esto de hecho es uno de los peligros de este de esta asignatura pero es divertido que pase esto así que vengo por aquí trabajo y local Host y servicios y procesos y multiproceso y los Vale y volvemos backet venga Okay vale No sé si veis no sé si veis que está sí está haciendo lo mismo Está fallando vale No pasa nada de hecho acaba de parecer mi calva por ahí pero ahora a continuación yo digo vale No pasa nada porque aquí cuando pongo los datos Pues los pongo en x y Entonces ahora va a funcionar vamos a ver o no Ah claro Así mismo vale Sí sí x - 64 a ver ahora sí bien Ahora lo que estáa haciendo es que me está ejecutando la imagen en buckets ojo atención todos e he dejado de grabar no no Blanca Claro No por qué dices que he dejado de grabar Blanca No lo sé vale Pero bueno bien pero Perfecto me parece bien que estéis al tanto porque prefiero que Blanca diga que he dejado de grabar y que no haya dejado de grabar a que sí que hubiera dejado de grabar y que nadie se Hubiera enterado vale No lo había cerrado lo había sacado simplemente para comprobar que no se había colgado no por los procesos no quiero decir por los procesos estaban petad Pero eso no quiere decir que automáticamente se cierre obs pero lo que os digo eh o sea más vale comprobarlo dos y cinco veces y comprobar que estamos grabando que no al revés bien el problema del sistema no quiero informar El problema del sistema bien Ahora lo que ha pasado es que claro cuando acaba la primera línea no baja Pero por qué no Baja porque yo no le he dicho que baje si yo no le digo que baje Vale entonces ahora a continuación vengo por aquí y le digo 011 baja a la siguiente línea y tranquilos que ahora os libero en 5 minutos para que podáis ir con Pilar creo que os toca Pilar Vale y 011 Vale y Eh bueno eso estaba en 09 de hecho Vale 010 worker ahora 011 Vale y ahora a continuación le voy a decir que a vamos a ver If x Es mayor que 1024 en ese caso x es = a 0 y más igual a backet Y eso qué quiere decir pues eso quiere decir que ahora el buet ahora sí que va a estar entrenado para que cuando acaba esa línea cuando acaba esa línea si todo va bien se va a bajar la siguiente línea una cosa muy divertida Es que esto ahora mismo Está ejecutándose en un en proceso aparte en un proceso aparte ahora luego haremos que se ejecuten más procesos y e Perdón no mal mal porque aquí esto es y- 64 Aquí voy a poner 100 en lugar de poner 1000 y ya vale Y Mirad ahora u me cago en la Man espera Sí ahora baja mi calv para arriba un momentín ahora así Si os fijáis tengo un programa que para cada worker cog un trozo de imagen le da ese worker ese trozo de imagen el worker proces ese trozo de imagen recoge ese trozo de imagen y la pinta en la pantalla vale con lo cual la metodología de los workers e insisto eh No hemos acabado con los buckets pero la metodología de los backets y los workers es mucho más segura porque yo no sé es la imagen ni sé cuántos núcleos tengo pero yo sé que voy enviando backets y ya está Vale sí no Termina ahora le pondré una condición de que pues sí eh vamos a ver si aquí vale Si no espera Albert que queda mucho más lo que viene por delante es mucho más interesante ahora veréis si x es menor que 1024 y es menor que 1024 e error no pasa nada vale ahora veréis que Hola Ah un error vale consola Hola Vale pues mira A ver vamos a hacer una cosa como son 56 y aparte esto no sé por qué ha ocurrido esto Ah vale Ok si x es menor y es menor que 1024 esto se debería estar ejecutando x es menor que 1024 and y es menor que 1024 vale se ha quedado frito no sé por qué este If está devolviendo falso cuando no debería devolver falso Pero bueno voy a quitar de momento este If y ahora luego en la siguiente parte vale devuelvo ahí el cálculo no algo pasa ahora luego cuando volvamos Insisto que esto se está ejecutando en un único núcleo vale con lo cual lo ejecutaremos en x núcleos y lo que haremos es empezar a repartir backets según los núcleos que tengamos vale Y ya os digo o sea ahora mismo si esto ya os parece más O sea si esto os parece interesante se va a volver mucho más interesante pero sobre todo ahora en esta parte del ejercicio de hecho ahora Luego si queréis comento también estas líneas que me faltan por comentar ahora mismo lo que me interesa es que el código sea Claro en el senillo en el sentido de que entendáis lo que está pasando vale en el sentido de que tengáis el esquema este que estaba dibujando antes en la cabeza y que en todo momento sepáis que lo que ocurre es esto que está ocurriendo aquí vale bueno dicho esto hago una pausa