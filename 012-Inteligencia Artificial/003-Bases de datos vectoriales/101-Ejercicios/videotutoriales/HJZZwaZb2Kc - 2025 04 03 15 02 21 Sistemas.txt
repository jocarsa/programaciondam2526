eh En primer lugar eh Hoy vengo a clase audo a clase con el chat gpt fundido Cuando digo fundido lo que quiero decir es que tengo el modelo o1 bloqueado Hasta mañana a las 8 y tengo el modelo eh o3 mini que se desbloqueará dentro de un rato bien eh lo he bloqueado merecidamente cosas como son lo he bloqueado de usarlo aprovecho para deciros que el motivo por el cual lo he usado es porque Eh Pues esta mañana he estado haciendo esta aplicación que se llama White Smoke que es un creador de currículums Vale entonces pues esto que lo sepáis ahora luego os lo cuento y básicamente pues es un es una aplicación en la cual tú vas metiendo tus datos y sale el currículum Vale y sale tu currículum y ya está O sea que eso bien pero hoy eh el objetivo de hoy es Eh Pues bueno lo que comentábamos ayer el tema de persistencia aplicada a objetos Y ayer por la tarde la segunda mitad de la tarde hace la noche estuve pensando que realmente este ejercicio El ejercicio del cual hablamos ayer es una oportunidad fantástica para hablar de programación orientada a objetos eh a nivel fuerte vale Y luego por supuesto evidentemente para hablar de cómo persistir eso objetos así que si yo cojo esto veré que Eh bueno Esto recordáis que es pues una vale una aplicación la cual ahora hacemos esto más grande una aplicación en la cual pues eh Hay unos personajes que van viviendo y todo esto vale Bueno aparte de que he perdido los controles de del visor Pero bueno da igual vale pero el código no está muy bien hecho vale No está muy bien hecho en cuanto a que cada agente cada npc cada personaje Pues tiene un num agents vale Y al final están metidos en matrices con lo cual Bueno aparte de que aquí hay una función Dear y todo eso con lo cual hay una serie de funciones pero claro siempre hablamos de que cuando explicamos programación orientada a objetos siempre ponemos de persona porque una persona es un ejemplo muy bueno para hablar de programación orientada a objetos de clases Entonces lo primero que como ya os digo ayer Cuando acabó la clase dije Bueno cuando acabó cuando acabé la clase vale dije vamos a empezar a replantear este código para la sesión de mañana pero claro Cuanto más lo pensaba más decía no es que el problema de este código no es la persistencia de base de datos el problema de este código es un problema de base y es problema de que el código en su momento fue creciendo y creciendo pero llega un momento en el que dices espérate esto hay que replantear y además replantear es muy sencillo y muy obvio y replantear en primer lugar lo que requiere es que hagamos una clase vale porque si esta si este código representa personas virtuales y siempre que explicamos programación entada objetos pues hacemos una persona pues o sea es que es obvio que hagamos una persona vale Así que vamos a empezar por ahí vamos a hacer que el código sea más entendible claro voy a ir a lechat hasta que me devuelvan por lo menos el modelo Mini o el mini noan mini el mini H vale Y voy a hacer lo siguiente cojo esto vamos a replantear en javascript ahora luego os cuento Por qué vale porque igual quiero que sea multijugador y hago así y digo let's e Mira voy a hablar español vamos a replantear este código en primer lugar lo quiero convertir a javascript usando el framework Canvas d html5 para representar la información ya le digo pero muy importante lo primero que quiero es crear una clase vale es crear una clase Class para representar a cada uno de los npc vale a cada uno de los agentes por lo tanto Crea una clase y crea un número suficiente de propiedades y de métodos para eh Para ello vale eh para representar a las personas virtuales Así que tendremos tres archivos a html principal con el bucle y la interfaz de usuario B la clase e persona vale vamos a llamarlo directamente persona y persona digital persona virtual vale pero persona al fin y al cabo Porque al fin y al cabo estamos modelizado el comportamiento de personas digitales y C funciones adicionales y auxiliares tales como por ejemplo la función asar vale ya queo funciona Star yo creo que debería estar fuera de la clase pero no lo sé vale a ver qué dice el sistema a Star Vamos a darle y vamos a ver vale de momento cuatro archivos vamos a por ello vamos a hit Vale y nos vamos a html nos vamos a no me acuerdo Ah entonces vamos a ver vamos a dónde está no acuerdo la verdad no acuerdo dónde estábamos ayer Eh bueno estábamos en python simulación pero yo creo que no estábamos aquí Bueno da igual Pues en python simulación va y luego si hace falta lo movemos a otro proyecto Así que python simulación la leche espérate No aquí hay que reformular las cosas vamos a ver python simulación Obviamente no voy a borrar nada voy a meterlo todo en una carpeta anterior y ya está vale el real meno realme es necesario y las casas también son necesarias vale anterior OK ahora esto es Ah muy bien vale esto es el archivo principal Así que index html vale esto es el persona. js Este es el primer archivo que estaba esperando persona. js vale Y plch aquí estamos muy bien Ahora vamos a ver funciones auxiliares utils.js Vale utils.js y aquí está el a Star el eí y el Second to date Time vale Ok lo que sea y luego tenemos a el Main Ok vale el main.js de esta forma si estamos modelizado personas virtuales Pues claro Yo veo aquí que tengo Espera que haga el texto más grande Yo veo aquí que tengo espera aquí 20 vale que tengo una serie de propiedades que si posición de su cama que si posición de dónde está su trabajo que si posición de dónde está su comida que si en qué necesidad se encuentra ahora mismo vale o sea y tengo un update need Vale tengo un move y tengo pues Esto vale con lo cual digo okay esto ya está más estructurado está más entendible de lo que estaba hasta ahora bien y sobre todo utilizamos una clase porque esto es que insisto que ayer cuando acabé la clase y estaba revisando el código digo es que esto está pidiendo a gritos una refactorización a objetos porque es que es el clásico ejemplo de una persona vale vamos a ver si con esta refactorización que ha hecho el programa de momento ha funcionado porque lo que he hecho es copiar y pegar del chat confiando en que vale eh python simulación Okay Vale vamos a ver si hay algún error bien cannot read properties of unf muy bien en utils 2s en utils línea dos empezamos bien eh Okay Ok vale bueno Esto lo que nos devuelve es el valor absoluto la distancia y no sé por qué persona move Okay Vale pues vamos allá así que copio está todo guardado Vale y vamos a ver porque parece que pues hay algo que no existe Okay vale una propiedad de un objeto undefine copiamos utils esto es utils Okay copiamos persona vamos a ver persona okay y ya vale probamos No invalid aquí Start or Go position vale vamos a ver vale una posición de inicio de destino que no es válida clase persona Ahora veremos porque no es válida Por cierto en el en js se está cargando como una matriz 2D espérate no el problema no vale Yo creo que el problema no es este vamos a probarlo pero yo creo que el problema no es ese vale eh vamos a ver hay O creo que el problema es que en aquí en momentín dónde estás en utils no Dónde está el terreno Ah aquí en Main aquí en The rin layer está esperando a que yo introduzca una matriz Y al igual que ocurre en el código original de python debe cargarse el archivo eh casas.png Y debe derivarse la matriz directamente desde ese archivo como te digo igual que en el código original en python vamos a verlo vale sin embargo javascript el navegador no tiene acceso directo al sistema de archivos No sí que lo tiene no me dice html para cargar la imagen vale con lo cual aquí me está dando una información parcialmente correcta en el sentido de que si yo ejecuto esto en un servidor sí que tiene acceso vale con lo cual momentín vamos a dejarle acabar pero ahora en cuanto acabe pues lo que haré es decirle No fíjate que dado que esto está en un local Host Esto está en una Apache sí que tienes acceso a al directorio digamos vale al menos al directorio en el que estás Vamos a ver venga va vale vamos a ver no that is not necessary application will be execut jod no es necesario la aplicación se va a ejecutar en un servidor con Apache y por lo tanto se puede acceder a la imagen casas.png mediante una instancia de un objeto image de javascript por ejemplo led mapa es igual a New image y mapa. src es igual a casas.png vale Ahí de esta forma Pues nos ahorramos el input que en este caso añade una dificultad adicional que no es realmente necesaria vale con lo cual pues cargamos la imagen donde realmente le corresponde y vamos allá vale eh configurado para cargar los scripts dice que Index html no tiene mucho misterio vale javascript para cargar la imagen en Main js correcto a ver vale Bueno vamos a ver primero inicializar Ok Vale y aquí está el context image el get image Data y ahí lee los colores Vale ahora sí por lo menos carga el mapa vale si funciona o no funciona Pues ahora lo veremos pero por lo menos ya está cargando correctamente el mapa Vale entonces me voy a main.js anteriormente 130 ahora mismo 160 vale lo que sea vamos a probarlo recargamos Mira la imagen está ahí pero assignment to constant variable Bueno ya hemos avanzado un paso pues vamos al siguiente paso vale Okay esto parece un error más trivial es que parece que algo que es constante alguien lo ha intentado reasignar Pues bueno vamos a ver intentas asignar un nuevo valor vale utils js vale podría todo lo que está en a Star y convertirlo a led En lugar de const pero bueno El caso es que como esta aplicación va a ser extensiva en cuanto al cálculo Pues casi que vale vamos a dejarlo así con const Okay Vale pues vamos a útil Okay vamos avanzando poco a poco recargamos no bien Vamos a reiniciar nuevo chat vamos a sacar la aplicación Golden Road Yellow rad nos vamos a wow no vaya python simulación anterior lo quiero meter en escritorio más que nada porque si no me lo va a poner vamos a ver eh python simulación Ok gener prompt python simulación aquí error y este error vale vamos a ver Ah pues mira pues lo que os decía cambiamos un led o sea un con L A ver nos vamos a estar Y dónde estamos dónde estás con no lo veo a ver curr Ok Ahí está pues l vamos a ver si esto lo soluciona Ok Vale ahora time str is not defined yo Oh ha desaparecido Wow dónde está esta función falta vale esta función falta pero está aquí recargo justo esa función la tengo conversión de simulación e vamos a ver game Loop vale en una de las en uno de los remakes pues se ha Pulido esa función Así que vamos a recuperarla y ya está esa función era sencillita a game Loop no casi draw end Aquí está Vale qué rabia da cuando se queda un trozo de código Okay Vale pues parece que ya empieza a estar vale lo único que pasa es que pues bueno ahora vamos a tocar un poquito la interfaz de usuario porque aquí no veo un pimiento vale no veo un absoluto pimiento Okay bueno Están todos durmiendo ahora haremos Por cierto que la animación vaya más rápida vamos a ver men js request Animation frame vale va todo lo rápido que puede aham Pam update no no hay por ahí una cosa que es el paso el procesador empieza ya a rascar aquí está current Time seconds vale Time Step seconds 100 vamos a hacer que el tiempo vaya más rápido Vale y vamos a ver como las 5 vale las 6 y las 8 se Ah miralos míralos qué bonicos ahí están se despiertan empiezan a caminar vale Ok perfecto Muy bien pues ahora a ver durmiendo claro es que no llegan a dormir Es que no llegan a su casa vale ahora están durmiendo y ahora se levantan Claro en este caso es culpa mía que los estoy puteando un poco porque no les dejo tiempo para volver a su casa se van a dormir deen irse a dormir vale ahora se están yendo a dormir ahora están ahora os cuento un poco esto cómo va y vale están durmiendo de vez en cuando alguno se debe levantar a mear Pero vale ahora están durmiendo ahora también voy a formatear esto de una forma que lo pueda ver mejor y ahora a las 8 Se levantarán para desayunar ahí bueno no sé dónde están yendo pero no sé dónde puñetas van vale Y ahora ah vale Sí es que es domingo okay Vale es domingo con lo cual Pues ahora están comiendo domingo a mediodía ahora después de comer se van al parque a jugar okay Y ahora veremos como los dos edificios de oficinas están vacíos OK Vamos a ver Mientras tanto qué tenemos aquí tenemos un simulation Canvas vale Okay y ahora voy a editar un poco la simulación para editar un poco la simulación y verla mejor es domingo a las 11 de la noche o sea ahora van a dormir y se preparan para el lunes ahora es lunes de madrugada vale con lo cual a las 9 se Irán todos a trabajar a estos edificios de aquí vale Ahora cuando lleguen las 8 pues se levantarán para desayunar y una vez que desayunen pues vamos a ver vamos a esperar a que lleguen las 8 y ahora veréis que pues una vez que desayunen pues irán a trabajar a estos edificios de aquí vale ahora van a desayunar cambian de casa para desayunar y hay un problema y ahora se van a trabajar y ahora al trabajar se meten en estos edificios ahí están Y se ponen cada uno en su puesto de trabajo y ya está Vale están trabajando Al parecer Y eso muy bien Vamos a ver ahora es mediodía Se van a comer muy bien Ahora ya tenemos pues una clase funcionando de tal forma que ver cómo lo podemos maquetar a ver cómo está esto maquetado Ay vale esto es un Canvas con lo cual voy a hacer un table a ver hago un table s un table TR TD y hago el Canvas y ahora TR Vale ahora en el siguiente TR voy a hacer un stats y esto lo pongo no el clock perdón vale Y ahora en el siguiente TR voy a hacer un TD que sea eh call span no al revés Perdón un TD por aquí otro TD por allá Y entonces en el primero pongo el Chart o sea el stats y en el segundo pongo el p Chart y aquí digo span es igual a 2 y aquí digo col span es igual a 2 vale esto ya empieza a ser otra cosa Vale ahora a continuación vamos a cómo qué dimensión tiene esto Table Vale pues vamos a ver Table with 100% Canvas with 100% Ok esto ya es otra cosa Vale ahora tengo esto aquí que es lo principal que claro cuidado tampoco no pasemos Vale pues entonces a ver cómo loed puedo organizar Bueno sí lo voy a organizar así porque aquí así como siempre voy a tener Sacada la consola Vale entonces clock es background black eh color White text Aline Center Y también voy a decir que Body es eh font family monospace Okay Vale y el clock es spading 20 píxeles esto ya me gusta un poquito más bien Ahora a continuación Vale ahora a continuación mientras vemos a los agentes moverse y todo eso pues esto de aquí a ver cómo lo podemos hacer Bueno Esto me voy a dejar así que son las gráficas que es un poco más adicional vale son las se de la mañana y ahora en cuanto lleguen las 8 pues se van a despertar Cuántos agentes hay vamos a ver Perdón aquí m js número de agentes 10 hay pocos vamos a probar con 100 y OK ahora esto tiene un poquito más de marchita vale se están yendo a descansar Ah míralos aquí están okay vale están descansando son las 5 de la mañana y ahora cuando lleguen las 8 Pues veis el rollo está en que cada vez que paro la simulación hay que volver a empezarla cuando realmente mira aquí las 8 podríamos decir Oye vamos a sabes Vamos a reutilizar recursos todo es muy Vale ahora están yendo a divertirse al parque al parecer o deberían Vale entonces vamos al par que ahí Y ahora dónde están yendo Ah nean descansar y dónde están descansando bien Aparte de todo esto a ver van al baño vale aparte de todo esto la a ver el python simulation que ya no es python por cierto pero eso es lo de menos en la Casas vale el aspecto que tiene es muy diferente M es muy diferente aquí estoy como entre comillas perdiendo colores Vale pues vamos a ver el Por qué lanzamos este proceso de nuevo lanzamos este proceso de nuevo son las lo cual quiere decir que todavía no tengo habilitado esto a 38 5 minutos bueno Vale y digo on sofware create two Canvas One For background map and the other for Players o npcs dos seems to me that Deep Green pixels are Being drown on map pleas use original rendering map vamos a verlo vale le iba a pedir multi multinúcleo pero vamos a hacerlo así vamos a representar solo npcs y tal como el asar está funcionando y lo sabemos Pues tampoco hace falta más ahora como os digo Pues todo está funcionando en un núcleo en un solo núcleo con lo cual Pues otra cosa veis ahí vale otra cosa que le voy a pedir es usa workers para eh utilizar el multinúcleo vamos a ver vale a las 10 dónde se van a dormir Supongo yo tengo muy claro que lo estoy haciendo correctamente Pero bueno ahora veremos vale se van a dormir okay es la 1 de la mañana con lo cual Pues ahora se levantarán pero ya os digo o sea cuando paro esta simulación y la vuelvo a arrancar pues me gustaría persistir de alguna forma que los personajes puedan recuperar el estado que tenían porque si no en cierta forma entre comillas es como que los estoy matando vamos a ver eh okay esto Index html dónde estás Index voy a cerrar aquí cosas vale recargo ok Ya Sí vale pero los Canvas deberían estar solapados Pero bueno no pasa nada Ahora lo solo apoyo vale Okay Vale entonces simplemente lo que voy a hacer en este caso es que me voy a ir al css y le voy a decir TD Pos relative Y entonces Canvas posi absolute top cer píxeles left 0 píxeles vamos a verlo y así pues están uno encima del otro vale Y a ver eh ha pasado no A ver Mira sabes que eh div ID contiene Canvas porque parece que a la tabla no le ha molado mucho lo que he hecho con lo cual le decimos contiene Canvas Y así pues no peleamos vale okay vale venga Okay qué ha pasado aquí qué ha pasado aquí como col span contiene canvas pero qu posi relative vale Y no lo sé voy a decirle no sé que he hecho mal contiene Canvas lative with 100% y H Pues yo que sé 500 píxeles a ver qué tal Pero qué Mira sabes qué este TR me lo voy a quitar de entrada este TR va a tener un display no Uno esto no arregla el error pero por lo menos vale eh ojo y esto es el reloj Ah el reloj está ahí vale Okay bien y H 400 píxeles vale venga muy bien ahora que tengo esto y ahora que de hecho Sony 38 con lo cual debo haber recuperado el control vamos a ir haciendo Por cierto Push y me voy a python simulación esto parece que lo he eliminado pero no está en el sitio está guardado vale Sunday a las Ok y teóricamente deberían irse al parque Pero bueno no sé qué puñetas están haciendo para eso les creé yo dos parques bien bonitos para que pudieran ir los domingos Pero en fin no sé queé están haciendo Están en sus casas vale lo que sea bien entonces ahora a continuación ahora van a comer vale están comiendo vale vamos a ver vale me voy a chat gpt me voy aquí me han desbloqueado ya el mini vamos a reventarlo y digo lo siguiente genero promto copio pego on software please use workers to manage npc behavior put each npc into One worker per npc to use all available computing Power to accelerate simulation ahora cuidado we might encounter a bottleneck cuello de botella on drawing npcs so Just draw npcs in Canvas without erasing Just draw y b create some kind of timer to eras One time the Canvas the npcs Canvas once per Second npcs might show trails on Canvas but It is Okay Vale o sea veremos estelas Pero no pasa nada o sea lo damos por hecho lo digo porque cuando trabajamos con workers y hay una operación de pintado la operación de pintado siempre es un cuello de botella porque hay que esperar a que el último worker acabe de trabajar con lo cual se pierde la gracia de los workers cuando además en este caso cada npc funciona de forma independiente es decir no hay por qué esperar o sea no un npc no tiene por qué esperar al otro para redibujar con lo cual es como no tú dibuja vale tú dibuja y ya está y claro al dibujar Pues será un caos de dibujo okay No pasa nada cada segundo e refresca el Canvas cada segundo Borra el Canvas y ya está vamos a ver esto probablemente pues hará que haya que replantear un poco el código pero habrá que replantear el código que instancia los workers pero no la clase vale la clase aparte de que ahora luego igual le pido más métodos y propiedades para la clase pero eso es otra cosa diferente vamos a ver refactoring voy a asegurarme de que vale de que estamos al día más que nada porque las refactorizacion de worker son peligrosas porque nos lo podemos cargar vale porque eh trabajar con a ver npc worker Uh interesante vale las refactorizacion con multinúcleo son delicadas ya os digo que de segundo hay una asignatura que se llama procesos y servicios media asignatura es multinúcleo o sea es vale y la clase no la ha tocado muy bien Vamos a verlo entonces create npc worker Ok y le metemos este contenido ahora en el archivo main.js main.js introducimos esta lógica y vamos a verlo vale be mindful that creating One worker npc puede introducir overhead es cuando utilizas o mejor dicho intentas utilizar más recursos de los que tiene tu sistema vale si esto te ocurre pues considera utilizar una piscina de workers vale agrupar bien Es correcto es cierto vale eso es cierto que puede ocurrir de entrada para evitar que ocurra o para trackear si ocurre lo que voy a hacer es bajar número de agentes a 20 teniendo en cuenta que tengo 16 núcleos de procesamiento 20 es un número razonable Vale supera mi capacidad de proceso Pero no por mucho pero claro si tengo 16 núcleos tengo 100 agentes pues eso sí que supera por mucho vale vamos a ir subiendo poco a poco y Si vemos que se produce realmente ese overhead esa sobrecarga pues hacemos lo que el programa ha dicho vale bien Vamos a ver simulation simple objects Back and Forth with Which keeps the overhead minimal vale Okay Canvas trails vale verás trails cuando los agentes se muevan Ok vale que me da igual quiero decir no es óptimo pero es un mal necesario vale recargamos bien bien bien vale Ahí estamos viendo los trils casi que lo prefiero vale casi que lo prefiero Okay perfecto porque así con los trails Pues ves un poquito Hacia dónde van vale Y ahora en un momento a las 8 de la mañana pues ahora en cuanto se levanten vamos a ver el procesador qué dice ok vemos Que de momento no hay overhead vale vemos Que de momento no ha LG Perfecto entonces ahora vamos a subir a 50 agentes recargamos y procesador dónde estás aquí bien vemos cómo va subiendo linealmente vale 3 de la mañana luego ahí evidentemente el procesador no mata mucho y a las 8 de la mañana cuando tiene que recalcular las rutas es cuando vale el procesador Machaca Okay Ahí está y el procesador ahí subiendo En el momento en el que tiene que calcular los asar míralo Ahí está míralo qué bonico Ahí está Vale perfecto fenomenal y ahí vemos có está repartiendo la carga bastante bien entre los procesadores disponibles vale perfecto y cuando no hay que recalcular pues el procesador baja muy bien Vamos de vuelta con 100 agentes es decir vemos Que se nota Mira ves ahí la cosa empieza a cambiar cuando calcula la ruta la primera vez Es cuando el procesador machaca Vale ahora están durmiendo el procesador no está muy en uso y ahora cuando lleguen las 8 de la mañana es cuando el procesador pues al calcular las rutas a estar es cuando pues subirá vamos a verlo 8 de la mañana está llegando ya vamos a por ello muy bien vale Y la subida el consumo de procesador como vemos es bastante al con 100 vale con 100 fijáos que lo estamos usando bastante bien si usáramos 1000 por ejemplo Pues evidentemente todo parece indicar que ahí tendríamos que vale que realizar algún proceso de agrupamiento pero de momento con 100 agentes de npcs digamos pues vamos bien vale otra cosa que quiero hacer es no borrar tan a bes bestia entonces me vengo por aquí y en Main vamos a buscar el Clear rect Aquí está Vale pues en lugar de hacer un Clear re lo que voy a hacer es lo siguiente Player context punto hostias punto Ay fill Style no me acordaba fill Style es igual a rgba no a ver vale Sí rgba 255,255 0. qué 0.1 vale Y ahora eh Players contexto clearrect no fillrect vale Y entonces lo que va a ocurrir de forma un poco caótica ahora veremos ahí vale es que poco a poco se van Como aclarar ahí lo vemos están durmiendo vale Ahí están durmiendo pero el Canvas de fondo se está empezando a aclarar Por qué Pues porque estoy sumando ahí lo vemos parce un circuito integrado vale Y ahí están pero pierdo la parte de detrás Bueno pues no pasa nada porque vale No pasa nada porque yo le puedo decir css3 e color Fusion multiply es que no me acuerdo del nombre mix Blend Mode eso es eso sí mix Blend Mode multiply vale con lo cual al Canvas Cómo se llama Players Canvas al Players Canvas le digo mix Blend Mode multiply Y eso lo que va a hacer vale Ya no se ve nada eso lo que va a hacer es que se multiplica sobre el fondo y por lo tanto pues no se blanquea Okay están desapareciendo como veis los rastros pero ahora cuando Vale ahora cuando se Despierten otra cosa que os digo es que igual no lo sé vale Pero igual ver tanto colorín Pues nos perturba un poco los colorines en este caso son necesarios porque es donde se define cada que es lo que hace o dónde va o lo que sea vale pero vamos a ver Ok vale vemos cómo se mueven Cómo se van a comer y todo eso qué estáis haciendo estáis descansando o qué pasa aquí no sé si es que están yendo al B qué están haciendo ahora Vale ahora se van a cenar ahora se van a dormir Ahora se van a dormir me da la sensación de que sus camas no están en la misma casa donde comen Pero bueno da igual vale Y ahora el monday a las 8 de la mañana pues Eh pues se irán a trabajar ahora hay que empezar a preocuparse por Eh Pues por guardar estos datos ahora veremos estos datos Qué son y cómo los guardamos os adelanto ya que vale Ahí se van a trabajar ok ahí están trabajando Ahí llenan las oficinas vale fantástico Okay se van a comer fenomenal voy a aplicar un filter sobre el continene Canvas sobre el backround Canvas vale Y voy a decirle que filter y voy a poner saturate y voy a poner cero vale para que sea pues como no sé no como más gris además otra cosa que puedo hacer vamos a verlo vale otra cosa que puedo hacer es hacer el Canvas más grande vamos a ver Ah tuesday vale ya es martes y ahora se levantarán para ir a trabajar de nuevo ahí están Vale pues vamos a aplicar el Canvas vale otra cosa que os digo que podemos hacer es vamos a probar hacer un mapa más grande a ver cómo va el rendimiento para ello edito casas creo que no me va a dejar editarlo directamente Desde esa carpeta vamos a probarlo creo que me tendré que hacer una copia de seguridad en el escritorio Y sí correcto Okay venga vale casas me lo copio en el escritorio Es que tengo un problema con gim que no me deja acceder a esa carpeta pero bueno a ver vale Y ahora a continuación pues lo que voy a hacer simplemente va a ser en imagen en tamaño de Lienzo en eh dónde estás lo quiero En porcentaje lo quiero al 200 por vale Y redimensionar ahora duplicamos la capa Okay Vale y sobreescribir vale Y ahora casas pego reemplazo recargo y ahí tenemos vale lo mismo pero más grande vale tenemos digamos un una ciudad más grande y claro una ciudad más grande pues requiere vamos a verlo por aquí requiere más vale overhead venga 8 de la mañana okay Muy bien pues ahora lo que quiero es irme preparando para guardar esta información así que por ejemplo cada segundo quiero sacar en la consola el contenedor de datos claro Bueno vamos a verlo porque ah vengo por aquí genero promt y digo vale Ahí está Okay y digo I would like to prepare this program persist Data reload pues npcs status can be resumed so for example to Start on each Second on each Canvas F with transparency Show in conso an array of npcs with their properties current properties No digo que me lo saque en cada iteración primero porque cada uno está funcionando en un worker con lo cual cada uno está un núcleo diferente y por tanto no están en el mismo espacio de memoria y segundo porque si lo intento sacar en cada iteración el navegador se me va a fundir vale por eso y tampoco necesito guardarlos cada segundo o sea Perdón en cada iteración sino que cada x cada segundo cada 10 segundos cada minuto cada lo que queráis es como vale reagrupamiento las necesidades de la solución pues sácamelo por pantalla vale sos por pantalla y evidentemente los quiero sacar por pantalla para ver qué aspecto tienen y los quiero sacar vamos a ver vale Y los quiero sacar por pantalla simplemente para saber Vale qué aspecto tiene ese objeto ese array ese jas ese lo que sea vale vamos a ver en el function update Vale dice tienes esto Pues espérate Oh you can add vale Oh persist no no no Oh o sí sabes o qué bueno es que me dice de guardarlo en el local storage que no me interesa especialmente Pero bueno la verdad es que como una primera versión de guardado pues no está mal vale con lo cual en el function update a ver en Main js en el function update Y sí ya Pero dónde está aquí current Time va venga local storage set item vale Ok Bueno npc States Vale ahora restoring bueno initialize agents okal ag está aquí Ok initialize agents desde aquí hasta allá vale siguiente login npc stat Every Second en el set interval hay un set interval Aquí sí F Style Vale pues console log Val Aunque si está en el local storage podría ir al local storage pero da igual vale Ok venga Mola tiene buena pinta eh vamos a verlo vale Ahí Ah ahí vale Ahí es donde está el tema Qué hay pues en cada uno de ellos vale está el cero lo que necesita el recorrido que es Cero en este caso y la posición cero Porque se ve que ya estaba descansando vamos a cogerlo aquí ahí y ahí el Paz míralo míralo Qué bonico vale Okay Tú imagínate guardar esto es como olvidaros de vale es el camino que tiene que hacer o sea olvidaros de esto olvidaros de Mira domingo a las 12 vale recargo plun ha vuelta a empezar hanc vale okay se ha quedado frito vale vamos a application vamos a local storage vamos a local Host vamos a ver no record no esto V sa ver será de algún framework vamos a Clear vale npc States Ahora sí ahora ahí tengo un jas brutal ahí vale pero en utils 2 vamos a verlo de momento muy bien Es cierto que se guardan en local storage Es cierto que sale en la consola sale exactamente lo que esperaba que saliera da un error al recargarlos pues Vale pues vamos a ver Ah sí pero no para moment this error seems to arise When loading npcs from local storage on page reload also not only save npcs to local storage but also eh save current time to resume Time from last time safed Claro si me guardas los npc y no me guardas la hora es un poco raro porque es como que están no sé trabajando y de repente al reiniciar es como estáis trabajando pues un domingo por la noche es como pues qué hago yo aquí sabes Entonces si por ejemplo es un martes a las 9 de la mañana pues cuando recargamos que sea un martes a las 9 de la mañana vamos a ver luego también obviamente pues crearé algún tipo de botón que me permita reiniciar la simulación vale porque habrá veces en las que diga Vale ahora no quiero reiniciar con memoria quiero reiniciar desde cero no sé ahora veremos vamos a ver e an vale Guardado de restauración en Main js el function update en m js Okay no Okay vale Y ahora qué Ahora initialize agents aquí está vamos a verlos y actualiza el worker para restaurar su estado en na y please full code for Esto vale ya que como me dice me mostra un trozo a mitad del código pues vale Yo lo que quiero como os digo en este caso es eh guardar esto en algún medio donde ya luego a partir de ahí podemos decir Oye y si es un no de js para que múltiples personas participéis en la simulación vale que esto sea como una especie de Matrix donde cada uno aporte sus npcs como una especie de juego multijugador vale No lo sé ahora iremos viendo esto es todo a ver npc workers son message Sí pues vamos a verlo recargamos okay parece que sí vale Y es Sunday in the morning vale a las 2 de la mañana okay están durmiendo ahora aquí tenemos el console pun log y que ya estamos viendo que funciona vale Y ahora recargo plun y ahora es Sunday A las 6 de la mañana vale con lo cual pues continuamos desde donde estábamos y ya estamos utilizando como os digo un medio muy no sé cómo calificarlo vale muy primitivo realmente no es primitivo no es nada primitivo local storage vale pero e Sandy a las 10 Sí pero bueno Vale pero es un medio pues no muy seguro desde el punto de vista de la persistencia depender de un navegador Pues bueno ahora veremos dónde metemos esto eventualmente por qué no podemos crear una Api vale De hecho como es razonablemente pronto vamos a decírselo y vamos a decirle Mira Crea una Api php y cada segundo guarda esto en un mega jas y ya está vale porque esto lo podemos tener perfectamente en un jas ahora cuánto ocupará No lo sé Vale entonces vamos a verlo son Sunday a las 9 de la noche Vale pues vengo por aquí genero promt no voy a hacer ninguna una modificación sobre la clase persona más adelante igual lo haré y ahora digo ya sabéis hasta que me funda de nuevo el ch gpt y digo Ok perfect Now un create an end Point In php To save Second not in local storage but in a j on server Side for that create that php endp each Second Send the array of npcs to server and let php save theming son file y ahora veremos cuánto ocupa ese archivo vale que es una de las cosas que quiero ver siguiente on page reload save also current Time can be Ahora mismo cómo estará guardando a todo esto aplicación local Host a npc States Cómo lo está guardando bueno dónde estás aquí save also current Time can on the same J or on another up to you vale on page reload Don't load from Data from local storage but from that php end Point instead so I understand that in endp there should be at least two roots aquí claro eventualmente no estamos hablando de un guardado cada segundo insisto no es el objetivo al menos no de momento vale sino que estamos hablando de un guardado tipo copia de seguridad que luego hacemos unos websockets con no Djs para hacerlo multijugador y todo eso vale Ok no te digo que no pero no es ese Nuestro objetivo ahora mismo Nuestro objetivo es pues cada segundo realizar un guardado para asegurarnos que al menos pues de forma persistente Y de forma más fiable que un local storage que no es que tenga yo nada contra local storage pero ostias a ver something went wrong While generating your answer please Eh retry vale Ya os digo que no le tengo nada en contra al local storage pero es que local storage no sirve para eso o sea no está pensado para eso vamos allá Bale okej vamos a ver eh npc end Point php Vale pues npc Point php copiamos pegamos Vale ahora javascript replace or add eh No lo tengo claro no lo tengo claro please full code for main.js estaba leyendo hoy provecho mientras que ch gpt va generando estaba leyendo hoy a raíz del anuncio ayer de lo del tema de los aranceles y todo eso pues una noticia vamos a ver aquí vale Francia denuncia la postura imperialista de los nuevos aranceles y amenaza con atacar a los gigantes digitales bien entonces lo que ocurre es que Oh vaya antes podía leer la noticia vale lo que ocurre es que Francia dice Bueno pues si nos ponéis aranceles y los servicios digitales estadounidenses no tienen ningún tipo de arancel Pues habrá restricciones es decir se forzará a las empresas europeas a que utilicen proveedores de servicio digital europeos y esto es lo que llevo diciendo hace meses vale que la situación actual pues para ciertas para ciertos contextos y ciertas industrias puede ser una situación amenazante pero donde hasta el momento era como Pero qué haces sacando una aplicación si es que Google o sea la gente se va a ir a Google y la gente va a contratar Google Bueno pues mira tú por dónde Mira tú por dónde que igual Donald Trump nos resuelve esa papeleta profesional vale o sea nos resuelve ese muro de que hasta el momento era como que no podemos competir contra los proveedores de servicios estadounidenses no por ellos sino por nosotros vale porque cualquier empresa hasta el momento no ha tenido ningún reparo en priorizar contratar a un Google en lugar de una empresa de aquí local nacional Pues mira tú por dónde Mira tú por dónde que nuestro gran Donald Trump igual va a cambiar eso y Mira tú por dónde igual no lo sé qué pasará pero igual hasta salimos beneficiados vale Así que pues bueno estad pendientes vale porque ese tema puede ser muy importante en el momento en el que Europa diga sí pues nada que nos metéis aranceles Bueno pues vamos a meter aranceles a los proveedores de servicio digital de Estados Unidos o vamos a priorizar a proveedores europeos pues bueno eso chicos se llama oportunidad Vale y importante tenéis que estar preparados Para aprovechar esa oportunidad Vale pues vamos allá esto es utils no esto qué es esto no sé qué es esto es Main js vale Ok 2 31 ahora es vale 281 vamos a por ello y recargamos no sé que no sé qué día es ahora vale Sunday creo que ha empezado de nuevo bien y ahora no hay errores sí que hay errores anect token is not valid J a ver qué está pasando eh Ah bueno igual lo que está pasando Es que tengo que dar permisos bar W html sud ch 777 men r y python simulación Vale y efectivamente eso es lo que estaba pasando vale Okay perfecto bien pues ahora atención vamos a verlo Vale pues Ahora me vengo aquí veo que aparece un npc State J son el npc State js ocupa 117k Okay no es mucho npc State y es un archivo que me está guardando para cada uno de los npcs sus posiciones su estado su todo vale vamos a ver cómo va el procesador a ver cuidado Vale cuidado porque ahí puede tardar en guardar o puede ser costoso de guardar Pero vale bien con lo cual ya ten una primera medida de vale de guardado Bueno ahora luego a la vuelta de inglés quiero hacer más cosas por aquí quiero hacer un montón más de cosas ahora quitaré el console Por cierto voy a quitarlo ya men j65 porque el console era solo para verlo vale en la consola pero ya hemos visto que sale y el console pues quita un montón de dónde estás aquí console.log vale Esto me da una rabia den Data no me gusta esto de den porque no me permite tener control Data y console log Data vale esto De dónde viene de aquí Ok vale Y así puedo quitar el console y así quito el console recargamos monday a las 8 perfecto hostias pero ah 209 Vale ahora nu o 209 fuera vale Y así sé que se está guardando no me hace falta verlo en la consola vale tu day a las 2 de la mañana y bueno y ahora pues lo que haremos es generar algún archivo más grande todavía para pues complicar más las cosas para hacer una ciudad más grande ahora luego haremos más npcs igual hace falta agrupar y Entonces es cuando tenemos que empezar a pensar pues qué es lo que ocurre con el agrupamiento ahora lo miramos a ver si hacemos Igual algún servidor de websockets para que esto funcione en tiempo real y lo podáis ver digamos vale conectaros a Matrix también quiero hacer que la escena sea más grande para que los personajes caminen digamos en fin ahora veremos vale Y mientras tanto como os digo pues me cuesta relativamente poco en imagen en tamaño del Lienzo voy a decirle que quiero el 200 por de ancho vale voy a combinar ahora voy a duplicar ahora lo voy a mover voy a hacer un mundo el doble de grande voy a sobreescribir vale voy a copiar y ahora voy a recargar y ahí vamos a ver no sé qué están haciendo ahora mismo ahora están durmiendo y ahora se despiertan claro problema eh claro no van otro sitio porque no tienen la memoria de que tengan que ir no tienen la instrucción vale vamos a cargarnos dónde estás Vamos a cargarnos el estado por tanto ya no existe el estado Ahora sí Uy un error un sigil vale parece un error de memoria a ver vale va Okay perfecto digamos que con una casa o sea con un terreno más grande pues están obligados a viajar más están obligados a procesar de forma más potente vale Y ahora en este caso lo que voy a hacer también voy a empezar a reventar el sistema ahora ya para irnos al descanso y luego a inglés y para reventar el sistema Pues voy a decirle que quiero número de agentes 400 a ver qué pasa vale me elimino el State recargo Wow y a ver qué pasa Ahí vale volver a cargar ahí ok No supera supera vale supera con lo cual lo intenta voy a probar con 200 y no me quedará más remedio que acudir a la agrupación vale Ok wow A ver vale va No pues no admite es que ya os digo hay una limitación que básicamente consiste claro cuidado porque ahora básicamente consiste en generar más workers muchos más workers de los que con respecto a los núcleos que tiene mi sistema entonces pues evidentemente vamos a ver vale Ahí se despiertan ahora están usando todo el mapa Vale y Ahí los vemos pues vivir Entonces tenemos que pensar pues Qué formas tenemos de persistencia Si queremos que esto sea un software online o queremos que esto sea un software en local o incluso que podamos utilizar una granja de cálculo en nuestro propio virtual private Network vale es decir o virtual o en nuestra red de área local una red pod net bien pues como os digo llegando a las vamos ahora a vosotros en este caso media hora de descanso para ir a inglés eh Y luego a las 6 pues nos vemos aquí de vuelta y volvemos con este ejercicio y seguimos viendo pues Qué formas tenemos de persistir la información de tal forma que sea eficaz que sea eficiente que sea fluido y que nos permita que la simulación Oye qué están haciendo domingo a las 7 Ah mira ahora se van a haen vale otra cosa que tengo que hacer es comprobar que cada npc tiene una sola casa porque me da la sensación Mira mira mira aquí me da la sensación de que van de una casa a otra para comer y para dormir pero bueno resulta divertido Vale pues