hasta ahora todos los ejercicios que hemos hecho estaban hechos teniendo en cuenta imágenes fijas y no hay ningún problema por ello en el sentido de que un archivo de imagen fija pues puede ser una fuente de adquisición de información tan válida como un archivo de cualquier otro tipo pero evidentemente es también interesante analizar qué es lo que ocurre cuando tenemos archivos en movimiento vamos a ver entonces hay la idea está en que voy a crear un documento nuevo voy a ir a inteligencia artificial avanzado voy a ir a ejercicio 2 y lo que quiero ahora vamos abrir brackets lo que quiero ahora es trabajar sobre un código que me permita trabajar realmente en animación en vídeo voy a crear nuevo archivo lo guardo en ejercicio 2 guardo como index html y lo primero que quiero es el alcade e información así que para adquirir información voy a seleccionar la plantilla voy a ir a chrome voy a buscar html5 webcam y voy a la información de una webcam así que vamos a ver vamos a alguna plantilla de las muchas que hay por internet código javascript vale estoy donde buscar la más sencilla posible yo creo que con esta me puede servir ahora también lo que hace recién que el código asiste vengo por aquí hoy vamos a eliminar este point copiamos esto de aquí y ahora voy a crear un script y en el script lo que voy a hacer es introducir este código muy bien e introducir este código en este caso y digo voy a limpiarlo para hacerlo lo más sencillo posible y además este ejercicio que estoy haciendo quieras que no pues va a constituir una especie de plantilla así que bueno hay un controller con un botón hay un vídeo eso sí entonces lo que voy a hacer es esto fuera el vídeo sí el capturen no lo quiero es decir no quiero empezar a capturar cuando pulse sobre un botón quiero empezar a calcular directa a capturar directamente luego elegimos empezar a capturar con un botón fantástico pero snap por qué me dice snap cuando el botón es nada vale vamos a definir unas constantes que es la definición del vídeo mientras entienda por 720 de momento vale y en este caso tenemos una función donde lo que hace es intentar con un try cats ejecutar el vídeo y si no puede en ese carro suelta un error me parece fantástico es decir yo soy el primer digamos defensor de del trayecto pero en este caso yo lo que quiero es simplemente pues ejecutar el código así que esto fuera quiero dejar el código lo más sencillo posible y luego evidentemente está clarísimo que el try cut siempre es una variable perdón siempre está la estructura de control muy positiva muy conveniente para intentar hacer algo y si falla pues entonces lo que sea vale pues vamos a ver el contexto vamos a ver por aquí vamos al contexto y en este caso no veo que se esté definiendo el contexto aquí está el contexto es igual a camp basket con textos de igual esto lo cambio ahora y en el disney para lo que quiero es que esto se ejecuta constantemente entonces esta es la función de inicio a la función de inicios ok y ahora 7a el inicio dentro de un segundo y función inicio y la función de inicio va a tener esto vamos a probarlo a ver si de algún error ejercicio 2 permitir la cámara vale pero no será audio bien aquí tengo la cámara ya está y vamos a inspeccionar pero ya elementos consola vale y ahora quiero elementos esto que estoy viendo es el vídeo y aquí tengo el canvas de momento no está todavía dibujando vale pues vamos allá tengo ahí el vídeo correctamente representado y ahora lo que quiero básicamente es decirle al sistema que constraints de pecho está cogiendo el vídeo correcto y con texto email vídeo en 00 lo que sea vale pues a partir de ahí voy a hacer que esto es bar temporizador es igual a esto te digo killer time out temporizador y s time out inicio dentro de un segundo es decir me lo va a ejecutar cada segundo vamos a verlo ahora vale es como estoy oyendo doble es un poco la pista de micrófono que te oí es doble no puedo bajar esto voltear el audio controles esto permite bajar el volumen aquí sigo grabando volumen hasta el ritmo pero ahora lo que voy a hacer es decirle al sistema que quiero bajar el volumen entonces esto en 5 videos set volumen con nadal salomé es esto entonces punto volumen voy a decirle aquí que vivió punto volumen entonces recargo y así directamente el volumen es cero y no me vuelvo tarumba escuchando en el mismo abs y no ha perjudicado al audio correcto y para a continuación podemos observar como lo que estoy haciendo podemos ver ahí es pasar el contenido del vídeo al canvas que está por ahí abajo con una actualización de un segundo en este caso el vídeo en el canvas lo que puedo hacer es 1280 x 720 para qué tenga la misma resolución y 1280 y por simplemente más que nada para que no me distorsión y ahora debajo a un segundo de definición o un segundo de retraso tengo el objeto y por último también lo que puedo hacer es en un momento dado con el estilo pues puedo el vídeo y decirle display mount para qué solo me muestre el canvas vale que curioso ahora deja de mostrar es interesante que por nuevo vídeo porque es pleno se me deje beber el canvas cuando está hecho de unas cuantas veces y nunca sucedió de esto mira transformó es kyle y le voy a decir 0 sí pero para el vídeo está ahí y se dejó el vídeo que digo quiero display no y se me queda congelado que es curioso porque display none no elimina el vídeo sino que cosméticamente lo oculta o sea sigue estando en el don pero cosméticamente lo oculta entonces no lo sé pues 0 píxeles height 0 píxeles usa lo quiero ocultar le quiero que el vídeo esté pero yo no lo vea quiero únicamente el canvas vale esto está mejor muy bien pues ahora a continuación evidentemente en lugar de pues una vez por segundo puedo hacer 10 fotogramas por segundo ahí lo veo más claro o lo podría hacer a 33 a 30 fotogramas por segundo no me hace falta que sea tan fluida ahora mismo vemos que estoy viendo algo que parece un vídeo pero no es un vídeo realmente es un canvas no quiero que esté tan fuerte vale lo voy a poner igual a 200 a 5 fotogramas por segundo muy bien ahora si yo tengo esto a continuación no vamos a poder demostrar la misma forma que muestro hasta ahora realmente como yo puedo interceptar este canvas entonces voy a hacer una sencilla operación simplemente de demostración para por ejemplo invertir los píxeles ahora a continuación lo que voy a hacer es simplemente vamos a verlo con textos de emails y ahora bart datos es igual al contexto agett image data desde cero como acerbas también los 80 como las 720 y ahora y esto es punto dato que directamente los datos y realmente no realmente estos son los datos entonces quiero por mar y es igual a 0 y es menor que datos punto data punto link y más y ahora voy a hacer que datos y más no y es más igual a 4 porque quiero ir cada píxel y me quiero dejar el alfa sin tocar entonces datos de datos punto data es igual a 255 menos datos punto trata de ello es decir estoy invirtiendo el color y lo mismo lo quiero hacer con el componente rojo que es este con el componente verde que es este y con el componente azul que es este y por último contexto punto put emails data datos vamos a verlo será recargo lo que va a ocurrir ok porque no está funciona primero se trata de datos y dimensión y estos datos de ataque y más 3 es igual a 255 vale ok vale no hay nada en el kart no es lo cual me extrañó converso muy bien no veis el sofá por último se trata así si ese es el perdón pues se trata de datos como 0,0 es lo que quiero poner y dónde lo quiero poner y ahora si nos fijamos lo que ha ocurrido es que tengo la imagen en negativo es decir he invertido los tres canales de color simplemente esto que acaba de hacer es una demostración para comprobar que podemos un vídeo meterlo en el canvas y una vez que el vídeo está en el canvas podemos hacer lo que nos dé la gana podemos empezar a tocar el vídeo podemos empezar a gestionar podemos empezar a hacer literalmente lo que queramos bien una vez que tenemos esto es cuando ahora voy a guardar esto como una siguiente versión del ejercicio y es cuando a continuación lo que quiero es saber cuando hay movimiento dentro de una imagen y cuando no es decir y ahora mismo en esta imagen donde la imagen está quieta lo que quiero averiguar es qué píxeles se están moviendo y qué píxeles están sietes porque básicamente lo que voy a necesitar lo que voy a querer es descartar al igual que el ejercicio anterior nos ha servido para diferenciar el frente del fondo nos ha servido para y poder extraer los objetos que están delante y quitar el fondo este ejercicio nos va a servir que de hecho y luego lo vamos a combinar con el anterior nos va a servir para decirle al sistema que es lo que queremos es quedarnos únicamente con aquellos píxeles digamos que se estén moviendo vamos allá así que con esto lo que vamos a hacer realmente es reutilizar parte de lo que hemos utilizado hasta ahora entonces me voy con texto esto es contexto con texto y vamos a comprobar cómo se funcionando y algún error quizás en contexto 10 vale ahí está y en lo que quiero es como decía reutilizar parte del código del ejercicio anterior para localizar cuánto se mueven los píxeles vamos al ejercicio 1 a por ejemplo el index 9 vamos a ver aquí está aquí lo que quiero en este caso distancia pero otro canvas por cierto para pintarlo en el mismo vamos aquí pero contiene canvas pero otro cambio se igual y el resultado y voy a ver si eres contiene canvas exposición absoluta posición relativa mientras que canvas es posición absoluta 20 píxeles y left ser píxeles y así estarán los dos pegados bien ahora lo difícil es esto porque me voy al index 2 quito lo de convertir lo negativo ya hemos visto cómo funciona y ahora quiero los datos ahora quiero crear una imagen anterior una imagen con la que comparada es decir que quiero que cada fotograma se compare con el fotograma anterior y por eso es por lo que tengo que decirte bar el fotograma anterior entonces voy a decir qué fotograma anterior es igual a contexto punto image dato 0,0 a 1280 720 y así me guardo el fotograma anterior ahora lo que quiero en este caso es fotograma actual es igual a lo mismo una vez que ya tengo los fotogramas lo que quiero del ejercicio 9 es para equis y para ella y es decir dar paso es igual a los 16 por ejemplo quiero bar x es igual a 0 x es menor a 1280 x no es igual paso y menos y paso esto 7 venta vale y ahora lo que ocurre vamos a verlo es que ahora quiero este código para ver cuánto se ha movido dibujamos la imagen contador suma jornada diferencial de x ya estamos a distancia es igual a cero diferencial de x es todo esto al fin a distancia y esto es el radio este espiral pero esto ahí muy bien ahora esto no va a funcionar directamente evidentemente por supuesto pero vamos a verlo vamos a hacer una cosa en este campo y voy a colocar otro campos llamado anterior con texto anterior es igual a camas anterior y canvas anterior es igual a anterior cada vez que pase por aquí con texto anterior punto por email data e este fotograma network el fotograma actual ok y vamos a esto de momento lo voy a nuclear lo voy a meter vamos a ejecutarlo muy bien multimedia se trata esto lo pongo en 0 ok pero ahí lo que estaba ocurriendo y esto es el resultado de hunted y esto es la anterior el resultado un resultado vale contiene canvas louis 1280 píxeles height 720 píxeles vale contiene canvas ahora parece que sí pero está como parado ahora así que lo que estoy viendo en la parte de abajo hace momentos aburridos pero que estoy viendo en la parte de abajo hasta que se quedó frito vamos a verlo ahora lo que estoy viendo en la parte de abajo es el fotograma anterior parece que no igual podemos ver si tiro un retraso de unos dos mil 200 segundos milisegundos y ahora se mueve la mano claro ahora mismo no hay ahora mismo hay diferencia prácticamente ok aquí esto lo pongo aquí y lo que quiero es comprobar que funciona más actual programa actual con pero igual a 1 contador + + y soy contador es mayor o igual que 1 en ese caso solo en ese caso ejecuta me este código ahora vamos a verlo ahora a horas todo bien quieres que la imagen sea y al revés creo que hay una diferencia de un fotograma entre las imágenes desde el tipo i versador e vale fotograma actual vamos a ver mallorca 2 y ahora el siguiente ahora sé y ahora veo que siempre hay una diferencia entre un fotograma y el siguiente es el anterior ahora es cuando puede buscar la diferencia entre los dos y al buscar la diferencia entre los dos elementos vamos a ver el resultado está ahí ahora es cuando puedo averiguar cuántos se mueven el uno con respecto al otro vamos a cerrar el siguiente ejercicio en el siguiente vídeo para ello lo que voy a hacer en este caso es guardar el index 3 y ahora ves lo que estoy aquí yo creo que no va a funcionar a menos que y lo empiece a modificar entonces esto es contexto área búsqueda no está definido muy esto es contexto anterior y esto es con un texto resultado a ver muy bien ni siquiera tiene vale canvas resultado entonces canvas el resultado claro es que esto tiene que ir allí contexto resultado es igual a canvas un resultado y entonces contexto resultado y bueno me va a dar errores porque me hacen falta variables y esto es amplitud cuadrado para su imagen de estos y vamos a ver recargamos espero errores parecería raro no voy a ningún error de hecho no está pasando nada así porque estoy en la línea extra esencia yo me extraña que no haya ningún error zuma satisface pues suma su máxima de esta suma súmese igual a esto y éste no lo ha copiado vamos a echar vale momento bueno es curioso porque en el momento por lo menos está dibujando cosas no parece que sean correctas pero por lo menos está dibujando cosas así que ahora para empezar paso 16 paso 64 por lo menos porque además quiero que el software vaya fluido estas son líneas en el momento no están encontrando nada evidentemente voy a bajarlo a 200 y bueno y poco más bueno valen ok las líneas de momento los transformó nada por cierto voy a decir con texto el resultado cada vez que arranco con texto resultado apuntó que recto es 0,0 a 1280 720 para que lo borré cada vez y ahora lo que tengo que hacer es buscar esos puntos de uno a otro contexto que tenéis trato con texto anterior temporales 1 y esto en principio parece correcto pero evidentemente no lo será no será porque además voy a ponerlo cada por ejemplo y ahora en la consola menos 32 menos 16 es decir no está encontrando correctamente ninguno de los píxeles que vamos a ver la siguiente iteración menos 32 menos 16 exactamente estoy en lo mismo es decir no estaba cogiendo correctamente texto con texto anterior principio tibio es correcto evidentemente en alguna parte no lo es ya voy a buscarlo y a continuación comprobaré a ver dónde está voy a grabarlo como index 4 y en x 4 lo que habré hecho es aplicar el código del ejercicio anterior vale pues lo había ocurrido es que estaba mezclando por una parte el super paso y el paso entonces he puesto aquí el paso super imagen y aquí el paso es que paso le haya puesto 32 con lo cual no hacía realmente ningún cálculo bueno para el paso de hecho el puesto 4 a cabal para el 4 porque manera de búsqueda es muy grande pues así un poco aligerar los cálculos entonces volvemos aquí y ahora veremos como para qué ahora en cuanto se refresque el fotograma vemos como bueno salvo la televisión negra para que el fondo que tengo es un poco extraño pasar esto a más velocidad para que el límite sea el cálculo bajar la cámara iremos viendo como el programa intenta seguir el movimiento de la cara pero un fondo tener un fondo neutro tampoco me conviene para esto pero bueno y ahora lo que voy a hacer es decirle al sistema el paso super imagen lo voy a bajar a 32 recargó podría hacer pruebas con imágenes más pequeñas también es cierto lo que está ocurriendo es que no hay pequeño la mujer es un grande quería decir con lo cual bueno cómo hacer espero si puedo trabajar con la imagen más pequeña de hecho que seguro que puedo para ello vamos a guardar el ejercicio 5 y voy a hacer lo siguiente voy a tirar un 640 por 720 resolución anchura altura el resto del código el 5 y así lo que está tardando el sistema de éxtasis metros a ver si la podemos bajar paso super imagen 32 es correcto pero el paso bueno hasta 4 y está bien hay perdido profesión llegado ahí porque cuando me muevo rápido el sistema me deja de detectar porque he puesto un área de búsqueda de por subir a 32 de nuevo y el paso de 8 y en paro super imagen pues igual 16 u 88 aunque probablemente va a ser mucho bueno estudia otra cosa pasó super imagen 16 haciendo es moverme para comprobar que el sistema me está siguiendo y puedo hacerlo con la mano si el sistema realmente me está detectando por cierto otra cosa que quiero hacer y por ejemplo veo como unos asteriscos es que quiero descartar aquellas sumas que no sean correctas entonces en este caso digo si suma es igual a cuanto a esto de aquí quiere decir que realmente ha habido algún cambio vamos a verlo y lo que quiero es que sólo aparezca en el caso de que realmente haya algún campo pero esto debería buscar un fondo bueno no sé si de la vuelta a la mesa realmente donde no tengo una pared blanca para que el sistema se pueda mejor porque cuando el fondo es demasiado blanco simplemente no lo atrapa correctamente voy a probar a darme la vuelta a la mesa para eliminar tanto ruido voy a optar por una estrategia razonablemente sencilla qué va a consistir en lo siguiente voy a cada uno de estos píxeles voy a mutar y para ello voy a grabar una siguiente versión del ejercicio desde aquí hasta aquí vamos a la versión 6 un nuevo error quejas 7 18 vale pues ahora lo que voy a hacer es que voy a marcar solo aquellos puntos que realmente sean diferentes entonces digo punto 1 es igual con texto en data tx y en 111 de lata llegar punto 2 es igual al contexto punto getty image data de x y como 1 punto data así que a continuación punto y jugador esto es contexto el anterior punto 1 punto data de y punto pero el punto de alta no hace falta el valor absoluto es mayor que no sé 40 por ponerlo en ese caso contexto resultado punto field recto en x y coma vamos a probarlo y es notifam y claro de 0 vale entonces ahí como podemos fijarnos lo que apruebe el programa hace es detectar únicamente los puntos que realmente están en movimiento y después de haber hecho este filtrado es cuando podemos indicar que solo queremos realizar el cálculo sobre aquellos puntos en los cuales se cumplen esta condición así que ahora lo que puedo hacer es primero des comentar el código voy a guardar una versión incremental vamos a por las 7 y vamos a desbloquear el comentario y por otra parte la llave del condicional la voy a colocar al final de todo este código tras lo cual lo voy a sangrar para que quede claro que está dentro de ese bloque condicional vale si todo ha ido bien y estamos ahora en la versión 7 del ejercicio lo que vamos a poder comprobar es que solo va a realizar el cálculo sobre a aquellos puntos que ahora mismo se estén moviendo en la pantalla con lo cual el rendimiento del sistema mejora bastante ya que ahorramos una unidad de cálculos y podemos ver que los vectores en principio empiezan a ser correctos hay que tener en cuenta que en aquellas superficies en las que el color es similar es difícil que realmente coja un vector de movimiento pero en aquella superficie es donde hay una cierta irregularidad en el color pues es más fácil detectar la dirección estamos trabajando a 200 milisegundos voy a probar a bajar a 100 aunque sospecho que ya tenemos un cuello de botella con el rendimiento pero no por si acaso va bastante bien y ahora lo que puedo hacer es cambiar el super paso lo teníamos a 16 ahora sí puedo probar a bajar a 8 algo que era prohibitivo antes de hacer el filtro ahora nos lo podemos permitir entonces en la primera interacción evidentemente no ha podido detectar pero si nos fijamos ahora mismo los vectores de movimiento son bastante mejores bien lo voy a volver a poner a 16 porque a 8 en el primer filtro así que innecesariamente cargante simplemente lo que me gustaría ahora es trabajar con flechas entonces para eso he encontrado por aquí una pequeña librería que dibuja una flecha más que nada porque aquí ya están calculados los senos y los cosenos de la punta de la flecha para ahora no perder tiempo calculando un poco de trigonometría entonces voy a esta función tengamos en cuenta que el autor nos está diciendo que tengo que poner el contexto begin pad y contexto stroke antes y después así que me vuelvo al código voy a desactivar mi código de línea por si acaso más adelante lo quiero recuperar voy a poner esta función fuera del código ahora quiero contexto resultado punto beijing paz y contexto resultado punto stroke no hace falta tanto contexto resultado punto estruch y aquí en el medio lo que voy a hacer es poner la función de canvas a row que me invita a poner el contexto resultado el from es la equis el from es la y el tú es la equis más el diferencial de equis y el y slayer y además el diferencial de y si todo ha ido bien a decirle que quiero recuperar esta línea es el stroke white vamos a volver y vamos a verlo y ahora muy bien bueno yo diría que las flechas están al revés están absolutamente al revés así que esto va a ser más diferencial de x más diferencial de y el destino le quite los diferenciales así que si todo bien ahora comprobamos como las flechas están correctas y bueno voy a hacer el punto aquí este fin recto contexto resultado punto feel style es igual a white y voy a hacer unos puntitos de 2 píxeles por 2 píxeles con esto podemos comprobar vamos a por la mano con esto podemos comprobar como el sistema es capaz detectar qué píxeles están en movimiento y a partir de ahí comprobar cuál es la dirección de movimiento de estos píxeles esto será interesante más que nada para que el sistema descarte toda aquella información que no es importante y se quede con aquella información que realmente debe valorar por ejemplo también nos puede servir para quitar el fondo y dejar el frente y en definitiva para filtrar algunos tipos de cálculo