bueno en la sesión de hoy vamos a realizar un repaso desde el principio desde cero en qué consiste la programación en arduino he abierto de nuevo tengo por aquí un close up de la placa y a continuación he abierto este esquema que hace tiempo que no abrimos y que a continuación actualizaremos tenemos por ejemplo como sensores tenemos el dispositivo bluetooth tenemos infrarrojos y hacemos una serie de dispositivos actuadores y sensores que hemos estado viendo últimamente y que sin embargo pues bueno no hemos ido actualizando en lo que sería el esquema del curso bien voy a añadir un elemento más dentro de este esquema que es la programación que es de lo que vamos a hablar hoy entonces en primer lugar dejamos claro que a nivel de hardware estamos hablando de que la placa de arduino y es más porque lo diga yo sino porque lo voy a mostrar en la pantalla la placa de arduino 1 text y estamos hablando vamos a ver aquí estamos hablando de una placa que vale veinte euros como hemos hablado anteriormente y en tex a parte del consumo de voltaje evidentemente hablamos de que tiene una memoria de 32 kb de los cuales 505 kilobytes se usan para el cargador del sistema entonces tenemos memoria ram que realmente es flash y tenemos 32 kilobytes bien porque hago esta matización de que realmente no es memoria ram sino que es flash la memoria ram es una memoria de tipo volátil esto quiere decir que cuando en un ordenador metemos alguna memoria ram y reiniciamos el sistema esa memoria desaparece por tanto no estamos hablando de una memoria volátil sino que estamos hablando de una memoria persistente vale por tanto se vendría a ser algo así a ver editar el nuevo vendría a ser algo así como ram hd vale por eso digo ram pero suele ser inexacto suele ser incorrecto decir ese término es más como una memoria persistente luego en cuanto a la s ram ahí sí que hablamos de una memoria de dos casas una s ram de 2 kilobytes y en cuanto al procesador estamos hablando de un procesador de 16 megahercios procesador estamos hablando de un núcleo a 16 megahercios bien esto qué es lo que quiere decir vamos a comparar con un ordenador moderno y así ponemos un poco en situación que es lo que quiere decir esto y esto es lo que va a dar pie a lo que voy a explicar a continuación un ordenador moderno tiene un hdd vale por ejemplo hd de ram y procesador por ejemplo este mismo ordenador en el que estoy y es un ordenador que está lejos de ser lo último de lo último es un ordenador de 2011 estamos en 2020 o sea para dejar claro que no es que voy a hacer la comparación con el estado del arte del ordenador de sobremesa y tiene 4 gb de ram con un disco de 200 256 gb de espacio más un disco secundario entonces hablamos de 4 gb de ram estamos hablando de 4 gb qué son cuatro mil 96 megas esta vez mayúsculas es 4.096 cuatro mil noventa por 1024 x 1024 son 4 millones voy a copiar esto 4 millones de kilobytes démonos cuenta que mientras que arduino tiene 32 kb de ram un ordenador moderno tiene 4 millones de kb de ram para que entendamos la diferencia entre una cosa y otra en cuanto a hb teniendo en cuenta que esto es más o menos lo mismo vale son 256 gb de disco duro que multiplicados 256 x 1024 son 260 y 2000 buena falta son 262 mil megabytes de disco x 1024 son este número que tenemos aquí a ver 33 268 millones de kilowatts mientras que en una placa de arduino tenemos 32 kilobytes para que entendamos la diferencia claramente entre una cosa y otra y el procesador de un ordenador por ejemplo el que tengo yo tiene cuatro núcleos lo podemos ver aquí nos lo decía la información del sistema no lo dice pero bueno core i5 son 234 hilos de procesamiento realmente a 2.5 gigahercios son 25 gigahercios lo cual son multiplicando por mil dos mil 500 megahercios x 1000 de nuevo va son 2500 123 son 2 millones 500 mil kilos hercios multiplicado por 4 porque son cuatro núcleos digamos que es un millón de kilos ejercios comparado con 16 perdón megahercios alegada fuera megahercios pues ya está a 2 mil 500 megahercios x 4 110 mil megahercios contra 16.000 megahercios con esto nos hacemos una idea de noia lo limitadas que son las capacidades de arduino sino que un ordenador de sobremesa es una máquina multipropósito es un ordenador potente razonablemente potente pensado para cumplir un montón de tareas por ejemplo dar clase yo ahora mismo estoy dando clase utilizando estas características yo no quiero usar arduino para crear una máquina para hacer una videoconferencia para eso tengo un ordenador yo lo que quiero es utilizar arduino para manejar servomotores esto no lo puede hacer un ordenador para manejar leds para conectarme por un puerto de infrarrojos para medir la luz los ultrasonidos la temperatura la otro sensor que si nos acordamos era el de giróscopo acelera un metro es decir que todo esto no lo puedo tener en un ordenador normal entonces estoy comparando pero no con el objetivo de decidir quién es mejor o quién es peor sino un poco para ponernos en situación ahora como decía la clase de hoy va de programación que ocurre cuando yo puedo programar para un equipo que tiene 4 gb de ram o sea 4 millones de kb de ram con respecto a cuando programa para un equipo que tiene 32 kb de ram bueno pues lo que pasa lo que ocurre es que en un equipo que tiene 4 gigas de ram puedo malgastar en cierta forma la memoria pero en un equipo que tiene una que puede tener 4 millones de casas puedo malgastar en un equipo que tiene 32 cajas de ram no puedo malgastar vale tengo que utilizar de la forma más correctamente la forma más correcta posible la memoria que tenga en el sistema para ello lo que voy a hacer es vamos a plegar un poco esto lo que voy a hacer es analizar cuáles son los componentes de un lenguaje de programación de cualquier lenguaje de programación en este caso de arduino bien tengo por aquí conectada a una placa vale al ordenador lo tengo aquí y lo que voy a hacer en este caso es establecer cuáles son estos componentes de un lenguaje de programación y a partir de ahí lo que voy a hacer es aplicarlos dentro de arduino un lenguaje de programación para empezar arduino está basado sé más es un lenguaje de programación derivado de fe del lenguaje de programación de cualquier lenguaje de programación tiene por una parte estructuras de datos estas estructuras de datos son almacenes de información es donde almacenamos la información tenemos diferentes tipos de estructuras de datos constantes tenemos también variables y tenemos también estructuras de datos tales como por ejemplo matrices para a continuación vamos a ver de qué tratan cada una de ellas a continuación tenemos también estructuras de control mediante las estructuras de control lo que hacemos es analizar cómo es el flujo de ejecución de nuestro código fuente tenemos estructuras de control de tipo bucle y tenemos estructuras de tipo de estructuras de control de tipo condicional para ser más concretos las de bucle son una llamada while otra llamada for u otra llamada de while por ejemplo las estructuras condicionales son una estructura llamada eve y otra estructura llamada switch entre otras a partir de aquí una vez que tenemos las estructuras de datos y tenemos las estructuras de control vamos también a aprender a hablar de funciones entonces hablamos de funciones como se declaran parámetros y cómo se usan e inevitablemente hablaremos también de programación orientada a objetos no porque la vayamos a utilizar pero sí desde luego porque hay ciertos elementos de arduino que utilizan este tipo de programación y tiende y tenemos que entender qué es lo que está ocurriendo en ese caso vale por ejemplo en el caso de que utilicemos por ejemplo como diario en el caso de que utilicemos servomotores los servomotores funcionan con ese tipo de programación bien pues vamos a empezar y vamos a empezar a continuación lo que voy a hacer es crear un programa nuevo en árbol voy a crear un programa nuevo y para crear este programa nuevo ahora luego usaré parte del código de un proyecto ya existente arrancando arduino lo primero que voy a hacer es declarar cuál es la estructura de cualquier programa de arduino entonces voy a hacer un nuevo sketch lo voy a guardar en escritorio un curso arduino pero 23 programación y tenemos por tanto que aquí tenemos dos tipos de funciones esto que vemos aquí son de hecho funciones estas funciones que vemos aquí las funciones no son más que agrupaciones de código entonces lo que hace arduino es que nada más empezar hay dos funciones de sistema que ya existen y es la función setup no puedo cambiar el nombre que se ejecuta una vez se ejecuta una sola vez al principio el programa de la ejecución y el loop se ejecuta esto fuera ejecuta de forma constante una vez que se ejecuta setup en otros lenguajes de programación se requiere que desde setup hagamos una llamada a luz pero en arduino no en arduino ya viene preparado para que sabiendo que existe setup sabiendo que existe luz primero ejecutar setup y luego ejecuta loop y lo hace de forma automática de la misma forma que en otros lenguajes de programación si queremos que el loop se ejecute en muchas veces tenemos que desde el loop volver a llamar a loop pero en arduino esto no hace falta de la misma forma nosotros podemos declarar nuestras propias funciones ahora luego lo haremos pero dentro de estas funciones podremos elegir los nombres de nuestras funciones pero nuestras funciones no se pueden llamar setup ni loop son dos palabras reservadas para el sistema a continuación en cualquier programa en primer lugar importamos librerías las librerías como las de los serbios son pedazos de código que vienen ya preparados para que podamos manejar ciertos elementos es decir manejar un servo te puedo asegurar que es más difícil de lo que en un primer momento puede parecer entonces esa librería de servo lo que hace es que ya tiene un montón de código preparado para que lo utilicemos a continuación declaramos variables globales qué diferencia hay entre una variable global y una variable local bueno las variables globales existen en todo el programa yo digo int tiempo es igual a 1000 cualquier instrucción en el lenguaje de programación tiene que acabar con un punto y coma así que yo ahora bueno voy a validar no dará error pero voy a cargar y evidentemente el programa va a dar error está compilando vale el programa da error por la sencilla razón de que no está conectado entonces voy a la placa la voy a conectar y ya tenemos y ahora si es cuando puedo lanzar este programa y ahí lo tengo bien entonces ahora yo a continuación digo tiempo es igual a 100 y por ejemplo el vengo y digo tiempo es igual a 10 acordémonos del punto y coma al final de cada línea vuelvo a lanzar el sketch se lanza el sketch por aquí y como podemos ver no hay ningún problema ahora qué ocurriría si yo desactivó con un comentario esa línea pues lo que ocurre es que ahora cargo y dará un error y el error dice que el tiempo no ha sido declarado en este ámbito es decir estás usando tiempo pero dónde está a tiempo yo puedo declarar tiempo aquí pero claro el problema es que es como es he dicho de que lo que ocurre en las vegas se queda en las reglas para después la variable que se declara dentro de una función no sale de esa función mientras que la variable que se declara fuera de la función existe en todas las funciones con esto lo que quiero decir es que habrá veces que nos interese que una función se declaré fuera para que exista en todas las funciones y ahora a veces en las que nos interese que una función se declaré dentro de una variable perdón se reclame dentro de una función porque sólo quiero que exista dentro de esa función vale ahora a continuación vemos que tenemos por aquí la en la declaración de una variable que a continuación quiero declarar una serie de notas musicales vale entonces las notas musicales son varias es decir vamos a ver frecuencias notas musicales y frecuencias de generación del piano por ejemplo a veces tengo una tabla venga vamos a empezar con esta de aquí entonces empiezo por ejemplo con el do vale 277 y digo claro nota es igual a 277 pero claro si yo ahora digo nota para el rey no este es el de sostenido del 61 será vengo aquí y quiero el rey es 293 que acabo de hacer pues lo que acabo de hacer es machacar una variable vale entonces yo lo que quiero realmente en este caso no es machacar una variable sino que lo que quiero es decirle al sistema es donde hay que poner quinto nota lo que quiero es decirle al sistema y notas y le digo en este caso que quiero una serie de notas es decir quiero dos es uno coma 293 voy a entrar con esto vamos a verlo un momento a ver si esto lo he definido ok vale una descomposición pues vamos a ver si me deja declararlo de esta forma o que ya vamos a verlo y entonces vamos a hacer lo siguiente no estás voy a decir que voy a poner por ejemplo 12 notas voy a decir qué o menos pongo unas llaves y digo 2 es uno coma 293 coma 349 aquí ya lo tengo compiló el programa y ahora veo por tanto que esta variable que realmente es un array que se puede traducir malamente como matriz pero realmente se traduce como colección o arreglo tiene una serie de valores incluidos dentro entonces a continuación lo que voy a hacer es lo siguiente quiero ver quiero analizar todos y cada uno de los elementos de esa matriz para ello recordamos que tenemos una estructura de bucle llamada for entonces de vigo int y es igual a cero es decir empiezo en cero y es menor que la longitud de notas vamos a ver momento valen 3 diego 6 off y notas y más y lo que voy a hacer es lo siguiente voy a poner la nota musical en el base para ello tendré que recuperar el ejercicio del bayern él va a ser ahí está vale muy bien le digo noto en el pin 8 ahora tú en 8 quiero que vamos a ver quiero un delay de tiempo por eso ha creado la variable tiempo y vamos allá yo creo que ya ahora evidentemente tengo que conectar el componente entonces voy a buscar por aquí donde tengo un buffer va a ser un cable bien entonces vamos a ver por aquí conecto macho al puerto este cable lo conecto uno de los puertos ground y encima de la mesa para que se vea por aquí encima y vamos allá vamos a ejecutarlo lo lanzamos y por último en el otro vamos a ejecutarlo de nuevo y un punto y coma vamos a verlo pero no quedó claro no es esto vale esto es en el puerto 8 tengo que poner notas ahora sí saco el valor correspondiente a la matriz que vamos a verlo ahora sí dónde vas porque hace esto tengo do re mi fa no sé por qué luego me ha dado estas notas tan altas dirá el tiempo qué curioso haber momento vamos a ver cuatro notas vale desconozco la razón por la cual luego suena eso entonces voy a poner ahí noto conozco porque hay 2 a ver 6 soft notas menos 1 no creo que sea eso pero de cosas a seis notas menos solo a ver no estás -3 es un poco raro parece que eso lo resuelven vale vamos a ver ahora yo lo que quiero son el resto de frecuencias de la escala de ero a ver si puedo a ver si puedo averiguar a ver si tengo algo que sea una lista es un modelo separadas por comas estoy buscando a ver si analista que pueda copiar y pegar como está más o menos la cuarta octava empezando el lounge querría empezar en sol perdón bueno esto sí a verse suerte no pego no pero bueno puede servir porque sé ahora algo así y los voy encadenando con una coma pues tengo lo necesario muy bien ahora logré lo mismo para el resto de notas ejecuto de nuevo el programa veo que tengo una matriz de notas musicales la cromática se va se ve un poquito mal ahora a continuación parte de que sigue a continuación lo que quiero es poder manejar las notas musicales mediante él mediante el sensor de ultrasonidos entonces para esto lo que voy a hacer es utilizar el sensor de ultrasonidos lo voy a conectar así que cojo el sensor a ver momento dónde están los setentas de la cámara a ver qué aumente un poquito la sensibilidad ahora abre un poco la luz bien vamos a ver un segundo para ti vamos allá bien y ahora como digo voy a utilizar el sensor de ultrasonidos pero tenía por aquí y lo voy a conectar con sus cuatro cables correspondientes los tengo en modo hembra voy a utilizar cables nuestro para convertir y cuatro cables machos el sensor aquí por ejemplo voy a conectar amarillo el negro rojo y me falta uno vale entonces abrimos el proyecto del servo del ser bono perdón del ultrasonidos y recordamos que lo conectamos al puerto 7 y 8 pero yo en este caso tengo ya el puerto 8 conectado con lo cual lo voy a conectar al 7 y el cels entonces rojo al ground azul al voltaje de 5 voltios negro al 7 amarillo al 6 ahí tengo el sensor de ultrasonidos voy a colocarle encima que se vea ok y voy a empezar a convertir código entonces long duración distancia y tono ahora veremos si esto es correcto serial baking para el puerto serie y ahora en el loop vamos a poner esto de aquí vamos a probarlo únicamente puede ocurrir que no esté correcto en cuanto a los puertos no pasa nada si hace falta los cambios esperamos a que acabe el bucle principal y ahora arrancamos el puerto serie bueno el día que se ha quedado un poco frito ahora y ahora ya está midiendo allí como podemos ver la distancia por ahora es decirle que en el puerto 8 en el puerto 8 pero eso no esto lo quiero desactivar y lo vuelvo a lanzar vale qué pasa el puerto 8 no quien va en el 8 vale a ver sin entrada sin salida es igual a 76 es igual a siempre entrada salida y ahora salida a valdés salida y en el puerto de entrada leemos la señal vamos a verlo lo que estamos haciendo ahí es asegurarnos que lee la distancia de la mano y que la danza qué está pasando ahí pues que nos asimile correctamente y 20 como máximo vale parece que tiene algún tipo de limitación así allí está esta limitación que yo le puse en su momento el tono lo voy a multiplicar por 20 para que sea más pequeño vamos a verlo ahora como vemos ahí la distancia de la mano me permite elegir la nota y ahora es activo tiene un máximo creo que es un máximo de 3 metros vale ya y apagarlo será a continuación ahora lo enciendo en a continuación lo que voy a hacer en el siguiente bloque es intentar formatear esto para que podamos aplicar conceptos hemos visto ya por ejemplo qué es lo que ocurre cuando hacemos un bucle es tratar de control de bucle y yo quiero mapear por ejemplo estos valores de aquí en los valores que puedo admitir en el sistema entonces para eso primero voy a crear mi propio mi propia función entonces mi propia función boyle voy quiere decir que no tiene por qué devolver nada vamos a hacerlo en un siguiente vídeo vale hoy quiere decir que no tiene por qué devolver nada y vivo dame nota lo que hace es que tiene todo este código de aquí estoy declarando la función llamó a la función void dame nota lo que hace básicamente es llamar a esto de aquí y ahora vuelvo a conectar será vuelva a conectar lanzó y veremos que el funcionamiento será el mismo además tengo el número en enteros el número lo tengo en enteros porque vamos a ver tengo duración tengo distancia pero tengo tono y tono vamos a ver esto no es un número entero lo giro justo no barbosa por ello lo lanzó a la placa en el serial veo que me está imprimiendo un número entero mientras que la distancia es long voy a ver cómo puedo evitar esto para lo que he hecho por una parte es cambiar la variable de distancia del longa flowtown que gasta más memoria de hecho cuidado porque fijémonos que si la tengo el nunca lanzó y me dice que usa 4.544 que es el 14 por ciento del espacio de almacenamiento del programa o sea tengamos en cuenta que lo que he dicho antes al principio de la clase es muy cierto es que no vamos sobrados de memoria pero es que solo eso de cambiar la distancia de long a flow de solo cambiar el tipo de variable hace que use del 14% al 16% por cambiar una variable de tipo démonos cuenta vale entonces ahora a continuación lo que hago es que si hago esto y le digo y dover cuatro decimales veremos como ahora si estoy viendo la medida concreta del cálculo de la distancia en este caso lo que quiero es hacer un mapeado y el mapeado consiste en lo siguiente el mapeado consiste en que yo quiero decirle al alto no digamos vamos a ver esto es la distancia tono es igual a la función map que hemos utilizado anteriormente qué hace lo siguiente tono vale y quiero lechero todo a distancia y en este caso lo que quiero que haga spears désde pero en centímetros a 5 centímetros hasta 25 centímetros y quiero que vaya desde el índice 0 vamos a verlo 0 1 2 3 4 5 6 7 8 9 10 11 son las 12 notas de una octava desde 0 hasta 11 ahora haremos más octavas entonces con esto lo que quiero es aquí en el tono hicieron notas de tono no estás de tono si esto va bien lanzó y ahora ya no tendré algo tan caótico que pasa que no está conectado ya no tendré un sonido tan caótico sino que tendré un sonido en una escala musical lo lanzamos y irá será sensible entre 5 y 25 vamos a verlo nos fijamos si lo oímos en el micrófono ahora tengo una escala cromática le voy a convertirlo en una escala mayor voy a buscar un momento las notas por internet vale pues averiguado en una hoja de excel cuáles son estas frecuencias de las notas musicales en la escala de dos y las he introducido en el programa introducido aquí en notas con lo cual ahora voy a volver a conectar al sistema voy a lanzar el sketch hoy vamos a verlo vamos a ver qué sale vamos a ver quiero 25 0 desde el índice que realmente es el 29 hasta el índice 51 que es el 50 lanzamos y aquí podemos ver ya la escala musical y bueno ahora vamos mejorar un poco pero como vemos es una magia de hacer música con la mano para ir de esta forma como podemos poner en funcionamiento un programa hecho en arduino de esta forma como vemos trabajamos tanto con variables con arrays con estructuras de control y podemos trabajar también con nuestras propias funciones cuidado con el uso de memoria en el sistema evidentemente ya lo que voy a hacer es perfeccionar un poco más este ejercicio para obtener un resultado algo más complejo