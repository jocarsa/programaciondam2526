php tiene un set de funciones específicamente diseñadas para ser capaces de leer y escribir de archivos de texto plano en el disco duro o directamente en el servidor web esto no substituye completamente al uso de bases de datos con lenguaje sql Pero hay algún caso como el que veremos en el vídeo a continuación en el vídeo siguiente de este donde puede tener cierta utilidad vamos a hacer un ejercicio donde he creado una carpeta llamada flat Fil y dentro de esa carpeta he creado dos archivos de momento vacíos uno llamado flat file.php y un archivo de texto plano texto.txt texto.txt ahora mismo está vacío está completamente vacío y en flat file.txt voy a escribir el siguiente contenido lo primero que voy hacer es var donde definiré el archivo en el que voy a escribir que como sabemos se llama texto.txt a continuación voy a escribir el contenido que quiero escribir mediante php dentro de ese archivo txt Este es un contenido y ahora necesito dos cosas Una un manejador o handler en inglés voy a traducir directamente en el que al que le igualar la función F Open abriendo el archivo coma e indicándole el modo en el que voy a trabajar en este caso el modo de trabajo eh que más suelo usar es a Plus lo que hace es abrirlo en modo de lectura y escritura y en a Plus lo que hace es append al final del archivo hay otros modos donde lo que hacemos Es abrir un archivo Borrar todo Su contenido y escribir archivo nuevo a mí lo que me suele interesar es abrir un archivo respetar el contenido que ya había pero poner nuevo contenido al final del archivo Por eso voy a usar a Plus como modo de apertura Y por último voy a usar otra función primero F Open para ver el archivo no puedo escribir nada si no abierto previamente el archivo y ahora que lo tengo abierto hago fwrite para escribir y qué voy a escribir Pues en el manejador voy a escribir el contenido es decir en el archivo indicado voy a escribir ese contenido voy a guardar voy a ejecutar me dice el archivo ha cambiado quiere volver a cargar sí que deseo volver a recargar Y compruebo como aquí aparece este es un contenido si ahora ejecuto varias veces el archivo por tanto como estamos viendo lo que hemos conseguido es mediante php escribir contenido en un archivo de texto plano en un archivo texto.txt alojado en el servidor un ejemplo claro de para qué podemos usar una un Guardado de archivos flat file en archivo plano al disco duro puede ser un sistema de creación de logs de registros de visitas de una página los logs de una página se escriben desde luego se escriben bastante frecuentemente pero eh luego Únicamente se leen y no se suele requerir actualizarlos ni borrarlos Porque la idea de un log es muchas veces escribirlo ni siquiera leerlo tenerlo ahí por si acaso pasa algo y si hacemos algo con él Desde luego es únicamente leerlo por tanto si no vamos a usar ni update ni delete ni nada de esto podemos hacer un sistema de logs voy a poner log.php con eh texto plano voy a hacer eh un log.php como archivo que gestionará esos logs y un log.csv aquí está la gracia donde eh almacenar en texto plano Sí pero al final en un formato de archivo separado por comas de tal forma que en un momento dado podamos abrir incluso ese log directamente con un programa de hojas de cálculo como Excel o como openoffice cal voy a abrir log.php y voy a crear un pequeño Script que lo que hará es registrar los accesos a esta página el archivo al que en el que voy a trabajar es log.csv Aunque en principio esta función está pensada para trabajar con archivos de texto plano no nada por engañar al programa y hacerle creer que un csv es un archivo de texto plano cuando realmente Bueno realmente lo es contenido el contenido que voy a escribir será el siguiente el contenido va a ser separado por comas va a ser la cantidad de segundos que han pasado en la era unix y en cadeno con una coma y ahora quiero el año voy a copiar esto unas cuantas veces Ahora quiero el año Quiero el mes y quiero el día ahora lo corregiré y vuelvo a separar con coma y lo que quiero ahora por ejemplo es sacar la IP del archivo en el que estoy trabajando por tanto voy a hacer que voy a decirle que la variable ip es igual a la variable de entorno getn Remote address además quiero saber el navegador con el que la gente a mi web con lo cual navegador es igual a variable de servidor y entre comillas http gu baj user gu bajo agent el agente con el que están entrando a esta web por tanto voy a encadenar ahora con la IP encadena una vez más con coma encadena ahora con la variable navegador e importante al final voy a encadenar con contrabarra n equivale a retorno de carro en archivos de texto plano por tanto ahora ya puedo volver al manejador es igual la f Open donde apunto al archivo y le digo que lo abro en modo a mayúsculas ap mayúsculas y por último ejecuto fite manejador coma contenido si no he cometido ningún error y espero que no vamos a asegurarnos del date el año es y el mes es en minúsculas el día es de minúsculas ahora lo que hago es guardo y ejecuto log.php Y si ahora cargo log csv compruebo como estoy guardando los datos que he especificado en un archivo de separado por comas voy a ejecutar varias veces log csv v y comprobaré como cada vez que lo ejecuto se crea a ver que he guardado voy a ver como cada vez que lo ejecuto se crea una nueva línea de registros por tanto lo que tengo aquí como puedo comprobar es un registro de los accesos que ha tenido a mi web y lo interesante aparte de que he ido capturando el utc el año el mes el día la IP y el navegador que sea Us es que estoy trabajando con un archivo separado por comas que ahora podría por ejemplo cargar en una hoja de Excel si ahora vamos a ver voy a abrir este archivo un segundo y ahora lo muestro en pantalla bien tengo por aquí flat file Y si ahora cojo ssv le digo que lo abro con libre Office cal o con Open Office cal o con Excel con lo que queramos lo separo por coma y delimitador de texto es ninguno porque lo he decidido como podemos ver puedo abrir ese archivo que he guardado mediante php con una aplicación de hoja de cálculo Como por ejemplo Excel u openoffice cal Y esto es Interesante como vemos aunque aquí parece que se ha enganchado porque había una coma en medio del texto y bueno Cómo arreglar esto ya que estamos por qué ha pasado esto porque ha dividido estas columnas vamos a verlo esto ha sido por la sencilla razón de que el navegador incluye una coma Por tanto la coma parece que en este caso es un mal símbolo para separar el texto Así que eh lo que podría hacer una cosa que se suele hacer bastante en los csvs es hacer lo siguiente voy a dejar esto por aquí voy a poner esto aquí y lo que voy a hacer es separar no solo con comas sino también delimitar con comillas en este caso tendría que poner contra barra comillas como carácter de escape Así que ahora pongo contrabarra comillas antes y después de cada coma y Aunque parezca mentira lo que voy a hacer con esto voy a poner contrabarras comillas y por último n es al escribir al ejecutar el log.php ahora lo que estoy haciendo es separar cada uno de los valores con comillas por tanto esa coma que tengo aquí ya no se va a ver afectada voy a borrar todo el log porque ahora tengo registros anteriores incorrectos y registros nuevos correctos voy a ejecutar de nuevo el Script varias veces ejecuto recargo para comprobar que ahora está separado todo en principio Está correcto por comillas y si Ahora vuelvo a abrir ese archivo log csv con calc vamos a verlo por aquí lo que voy a hacer ahora es decir que los campos están separados por comas y que el delimitador de texto es comillas porque si ahora acepto comprobaré como ya no ha afectado esa coma que tenía ahí me he dejado por lo que veo alguna coma en la IP voy a seguir corrigiendo en la i efectivamente me dejar una coma guardo destruyo estos registros cierro que está abierto bien está abierto y ahora me dice que hay un error en la línea 7 hay un error porque eso está mal pegado realmente va aquí ejecuto ahora ya no da error si Ahora vuelvo a log csv parece que esté correcto Y si ahora lo recargo en la base de datos en la hoja de cálculo compruebo como ahora sí que está correcto Yo de todas formas tengo un truco para esto de los archivos de texto plano que es el siguiente el problema que una coma es un carácter muy común es demasiado común por tanto yo lo que suelo hacer es usar un carácter que no sea tan común como una coma los archivos de csvs coma separated values en principio están pensados para ser separados con comas o con puntos y coma pero la coma y el punto y coma son dos caracteres que están condenados a darnos problemas porque son muy comunes Por eso yo lo que suelo hacer es eh poner en lugar de coma voy a buscar una en lugar de coma si pulso alt gr y el número uno del teclado tengo una barra vertical algr y número uno digamos la barra de oro esta barra sí que es muy poco frecuente Y si ahora ejecuto el Script con esta barra voy a borrarlo todo está abierto en la hoja de cálculo Ahora sí y ejecuto varias veces el log comprobaré como el resultado es que en lugar de comas estoy separando los valores mediante estas barras verticales usar esas barras verticales a mí me suele dar buen resultado para que el programa no confunda comas separadoras caracteres separadores con caracteres internos de los registros stros