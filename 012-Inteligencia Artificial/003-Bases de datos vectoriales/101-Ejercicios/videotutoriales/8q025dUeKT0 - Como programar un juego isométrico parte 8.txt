Bueno pues he estado preparando una serie de assets vamos a verlos Por aquí bien Vamos a mapas y en mapas aparte de que he creado un archivo de gim pues tenemos por aquí vamos a verlo creo que no lo he guardado vale vamos a guardarlo vamos a abrir el gimp vamos a ver este mapa que he estado haciendo vamos a verlo bien entonces en este mapa Por una parte vamos a exportar el terreno Z vamos a llamarlo vamos a ver pam imágenes mapas vamos a llamarlo mapa uno Ahí está vale Por otra parte vamos a guardar esto como mapa uno colores terreno o algo así y luego por otra parte tengo eh un mapa de arquitectura que he creado Así que vamos a llamarlo mapa uno arquitectura que son elementos arquitectónicos que es diferente de los props ahora hablaremos de ello bien Entonces eso quiere decir que ahora sí tengo por aquí el mapa uno tengo por aquí el mapa arquitectura vamos a crear también el mapa de los personajes por lo menos para que aparezcan al principio así que vamos a crearlo por aquí y voy a decir que por ejemplo hago una nueva capa bien y por ejemplo aquí en el medio Voy a pintar un píxel rojo a continuación Voy a pintar un píxel verde y a continuación Voy a pintar un píxel azul bien Así que aquí lo tenemos esto es personajes y vamos a por ello Así que ahora exporto solo esta capa mapa un personajes no nos olvidamos en ningún caso de guardar el archivo original por capas bien y cerramos el gimp lo tengo en una carpeta llamada vamos a verlo Ah a ver lo tenía por aquí js originales quería poner originales y aquí tenemos el mapa y una serie de elementos arquitectónicos que también he creado hablaremos de ellos están aquí en img en arquitectura y he creado pues una serie de bloques de paredes de ventanas de puertas y de todo esto ahora los meteremos dentro del juego pero antes de ello vamos a arrancar el propio juego vamos a arrancar el propio juego vamos a ver vamos a ir a local Host videojuegos vale le damos a jugar bien en este caso me aparecen los tres personajes es normal No pasa nada porque he creado Pues todo un bloque de escenario lo cual pues hace que están todos a la vez ok No pasa nada por eso bien y ahora si bien el terreno si bien la altura del terreno viene definida por un elemento los colores del terreno vienen definidas por otro por cierto también quiero decir que aquí en videojuegos en dónde estás en terrenos en terreno he creado también pues una serie de elementos de colores he cogido el bloque principal y lo he ido cambiando de color estos no estos son los antiguos y lo he ido cambiando de color para Pues digamos que coincidan con el propio color del terreno Entonces ahora teniendo en cuenta que tengo estos dos elementos voy a cargarlos voy a ir a condiciones iniciales y dentro de condiciones iniciales pues vamos allá vamos a ver tengo por una parte mapa uno terreno m lo que sea bien pues dónde está prop 1 terreno 9 Vale pues vamos a empezar a nombrar bloques de hecho los voy a poner todos en línea voy a sacar la carpeta y los voy a ir nombrando por orden entonces bloque aca bloque acera vamos a ocultar esto asfalto jardín pavimento casa y vaya jardín Así que bloque asfalto bloque jardín bloque pavimento casa y bloque valla jardín entonces bloque acera bloque asfalto bloque jardín bloque pavimento casa y bloque vaya jardín y ahora esto es acera esto es asfalto esto es jardín esto es pavimento casa y esto es vaya jardín bien con esto tengo ya las imágenes cargadas ahora por supuesto me hace falta cargar el propio mapa Así que vamos a verlo Esto está en mapa uno colores entonces vengo por aquí y voy a llamar a esto mapa colores src es igual a mapa colores mapa uno colores y entonces ahora lo que voy a hacer es eh poner los siguientes elementos voy a decirle al programa voy a indicarle al programa Dónde tiene que pintar cada uno de bueno de estos elementos diferentes para ello lo que vamos a hacer es pues bueno indicarle al programa al repasar la imagen vamos a cargarla vamos a por ello vamos a cargarlo dentro de un contexto inicio vamos a verlo y por ejemplo aquí en el inicio vale voy a decir a ver primero en condiciones iniciales el contexto aquí creamos un contexto Canvas Lienzo mapa colores y en las condiciones iniciales contexto mapa colores es igual a Lienzo mapa colores ahora en el inicio por ejemplo voy a decirle contexto mapac colores punto draw image y voy a poner mapa colores Ahí está mapa colores com11 com0 haciendo esto ya tenemos ese mapa ahí ese contexto Ahí vamos a ver el Index vamos a ver el estilo Vale y Lienzo mapa colores eliminamos todos estos le decimos que lo queremos ver de momento y vamos a ver si lo podemos ver si todo ha ido bien Le damos ahí a jugar cuidado porque ocupa demasiado ahí bien y en principio ahí aparece ya el contexto de color con lo cual Pues ahora lo que tenemos que hacer es que cada vez que el programa pinte un elemento en lugar de pintarlo verde Pues venga aquí y diga Bueno de qué color lo tengo que pintar realmente Es decir de qué color es en realidad cada uno de los elementos Pues voy al momento en el cual pinto el terreno vamos a pintar el terreno vamos a pintar el terreno dónde estás terreno vamos a funciones y vamos a hacerlo desde ahí ahora por tanto Busco pinta terreno aquí está dibuj terreno y básicamente pues lo que voy a hacer es cuando voy a draw image voy a decirle qué es lo que voy a dibujar digamos Con qué bloque voy a dibujar entonces hago esto vamos a ver Ok y ahora vamos a decirle que If contexto mapa colores punto get image Data y bueno voy a decir lo siguiente incluso bar colección Ray es igual a contexto mapa colores punto get image Data de X y11 punto Data Y entonces ahora sí digo si array de 1 es igual and array de 2 es igual a algo and array de 3 es igual a algo en ese caso pinta este bloque Bueno pues esto lo pongo por aquí cuidado esto como decía por aquí esto lo pongo por aquí y ahora lo que tengo que hacer es averiguar Cuáles son los colores de cada uno de los bloques Entonces vamos a por ello vamos a por ello antes lo quiero sangrar bastante vale Y este bloque lo cambio Cuántos bloques de terreno hay de momento hay 1 2 3 4 5 y 6 pues entonces cojo esto y digo 1 2 3 4 5 y 6 sangro convenientemente vale Y entonces Vamos allá voy a el gimp por ejemplo para averiguar Cuáles son estos colores y voy a abrir mapa xcf cuidado porque como he renombrado la carpeta ya no lo encuentra vamos a ver sistema de archivos aplicaciones mamp ht docs videojuegos Uh originales mapa bien me voy a terreno y Bueno voy a empezar por el asfalto por ejemplo así que asfalto de 0 a 255 es 42 Así que si esto es 42 Y esto es 42 Y esto es 42 entonces bloque asfalto pinta bloque asfalto vale Ahora hay un error ahí ok perfecto ahora esto es a cera 67 66 Qué curioso 66 bloque acera ahora bloque pues por ejemplo pavimento 90 Así que 90 esto es bloque a ver claro cómo lo hemos llamado bloque pavimento y bloque pavimento casa muy bien bloque pavimento ahora bloque pavimento casa 138 Entonces esto es bloque pavimento Vale ahora esto es 65 96 54 65 54 esto es bloque jardín Y al parecer solo me falta bloque vaya jardín que es 111 133 104 Y esto es bloque vaya jardín me acabo de dar cuenta de que los índices de la de los arris los tengo mal Entonces esto es cer0 esto es uno esto es dos esto es 0 esto es uno esto es dos 0 1 y 2s 0 1 y 2s 0 1 y 2 vamos a verlo por aquí y 0 1 y do y vamos a probarlo Bueno pues a continuación vamos a bueno Elim lo puedo ya quitar un segund Inn vamos a otra vez aquí el gimp cancelamos ahora lo abriremos venimos por aquí y bueno vamos a ver si nos da algún tipo de error Así que vamos a verlo consola le damos a jugar Vale Voy a refrescar bien Voy a refrescar del todo porque yo juraría que me ha cogido el anterior Vale y contexto mapa colores get image Data no parece claro get image Data va con mayúsculas en funciones en la 107 get image Data la d con mayúsculas ponemos jugar y bueno si todo va bien sí que parece que está cogiendo los bueno los estos los correctos bien tenemos ya el pavimento tenemos ahí un jardín tenemos una calle tenemos un asfalto vale parece que está todo correcto tenemos ahí el final del escenario Okay muy bien ahí yo juraría que el terreno no acaba ahí pero bueno no pasa nada vale Ahí tenemos una calle tenemos un personaje persiguiéndonos y ahora a continuación vamos a trabajar la parte de arquitectura del de este proyecto ya que bueno Pues he preparado una capa más con elementos arquitectónicos que a continuación vamos a poner los he dejado en una carpeta como arquitectura Hay un montón de ellos cargarlos va un rato pero vamos a alinear vale pero básicamente voy a empezar cargando uno de ellos por lo menos pero básicamente pues corresponden a los elementos arquitectónicos de la casa Además he preparado dos versiones una de bloque alto y otra de bloque bajo ahora vamos a ver para qué sirven y eso nos permitirá que cuando estemos fuera de una casa veamos la casa cerrada pero cuando nos metamos dentro de una casa veamos por dentro vamos a verlo entonces nos venimos por aquí nos venimos por aquí voy a condiciones iniciales bien en condiciones iniciales voy a empezar a cargar cosas así que bar bloque arquitectura y como lo voy a empezar pues lo voy a empezar por vamos a ver dónde está el bloque más sencillo simple uno y simple dos vale simple uno es igual a New image y bloque arquitectura simple es igual a arquitectura y simple uno y ahora de la misma forma Pues voy a poner bloque arquitectura simple dos cuidado con el bar esto no va simple dos bien Así que ahora además dentro de Index html quiero Lienzo mapa arquitectura además en condiciones iniciales tengo que cargar Lienzo mapa colores pues contexto mapa arquitectura Lienzo mapa arquitectura Y entonces ahora en la función de inicio siempre igual contexto mapa arquitectura draw image mapa arquitectura y vamos a verlo así que ahora me voy a estilo Lienzo mapa también arquitectura recargamos jugamos bien mapa arquitectura is not defined en vamos a verlo aquí mapa arquitectura Y esto es porque en condiciones iniciales mapa colores mapa arquitectura mapa uno Cómo se llama se debe Llamar mapa uno arquitectura Así que ahora sí recargo Y si todo va bien ahí tengo ya el mapa de arquitectura y por tanto empiezo a pintar desde el punto de vista en el que en la de funciones pues me vengo aquí en pint terreno Y es donde voy a empezar a pintar por defecto voy a decir lo siguiente vamos a ver var Ray vale Aquí y ahora donde acaban los ifs digo bar array contexto mapa arquitectura es get image Data x y tal lo que sea bien Y entonces ahora digo si a ra de momento 3 es igual a 255 de momento ahora hablamos de ello contexto arquitectura contexto fondo si no contexto fondo Sí ahí también contexto fondo yo juraría que sí es igual a bloque arquitectura bloque ya no sé bloque arquitectura simple uno vamos a verlo recargamos le damos a jugar vale vamos a verlo en principio no está saliendo Nada igual es que lo está pintando no anchura dibujo Okay vamos a verlo anchura dibujo voy a decir console.log pintando para comprobar si de momento Es cierto que está cogiendo el dibujo le doy a jugar y pintando sí que 102 elementos me parecen pocos pero bueno sí que elementos los está pintando OK Así que recargo por aquí bloque arquitectura simple vamos a verlo más altura bloque Z es un bloque grande son bloques grandes también lo tengo que decir esto es vamos a verlo anchura dibujo por tres y aquí voy a poner más 500 vamos a ver dónde lo pinta vale porque en alguna parte digo yo que en alguna parte lo estará pintando voy a decirle igual que lo quiero pintar en 700 guardo recargo y bueno en alguna parte deberían aparecer El caso es que 100 me parecen pocos para todo lo que hay ahí pero bueno altura bloque Z bloque arquitectura simple vamos a asegurarnos arquitectura simple 1. png arquitectura simple 1. png y luego El otro es simple dos o sea que teóricamente sí que está bien vale pues en funciones voy a ir probando hasta que salga en la pantalla voy a hacer una cosa voy a hacer una cosa voy a comentar todo esto para forzar a que no salga nada forzar a que no pinte el terreno Y a ver si pinta los elementos arquitectónicos ahí está problema no pinta nada no está pintando nada no está pintando nada bloque arquitectura simple lo está pintando voy a hacer una cosa con texto fondo. voy a pintarlo en 0,0 y a ver si así saca Ahí está de hecho lo está pintando de hecho lo está pintando parece que con el tamaño correcto pero sin embargo Entonces por qué no pinta correctamente el bloque es curioso o sea lo que está pintando es eso okay Y por qué ISO x e ISO y no lo está pintando recargo juego Ah ahora sí aunque me da que igual no lo está pintando en el sitio correcto bien De momento En este caso lo importante es que aunque las paredes no están bien aunque están todas con el mismo giro Pero lo importante es que realmente aparte de que está matando ahí las ahí realmente a la casa se entra más o menos por aquí okay Este es el pasillo ya hablaremos de delante y detrás pero bien en principio está representando bien por lo menos las paredes no sé por qué antes no ha funcionado Entonces quito esto igual es que no lo había cargado todavía no lo sé Ah interesante Ah muy bien muy bien o sea solo funciona si le quito el 700 vale porque no era más 700 yo creo sino que era menos 700 porque no tengo que levantarlos O sea no tengo que bajarlos sin no subirlos esto ya es otra cosa Y entonces ahora puedo quitar esto puedo quitar el comentario recargo le doy a jugar vale Y esto ya empieza a salir claro ahora evidentemente tengo que cuadrar losos en el sitio hay un error parece vamos a verlo porque el juego se ha detenido Ah no Okay no sé cuál es el motivo por el cual de repente han desaparecido los elementos arquitectónicos ha sido curioso bien y ahora los elementos deberían estar cuadrando con esa casa debajo Entonces vamos a verlo Ah claro nivel dos muy bien porque me he metido directamente con vale fantástico vamos a verlo y en principio Ahí está -700 parece demasiado fuerte vamos a poner men 100 con -100 no aparecen vamos a poner -200 ahí empiezan a aparecer -300 vale llega un momento en el que ya aparecen correctamente no quiero vale aparecen correctamente en el sitio ya tengo una pared digamos Ya tengo la pared principal Bueno pues ahora lo que tengo que hacer es medir correctamente decirle al programa que mira correctamente cuánd pone una pared y cuando la pone la otra y cómo voy a hacer esto Bueno pues eso lo puedo hacer no va a ser fácil pero eso lo puedo hacer diciendo Bueno pues cuando tengas un pixxel Mira a ver qué píxeles tienes al lado Entonces si el píxel que tienes al lado es de tal tipo de tal otro pues en ese caso quiere decir que eres De tal tipo de pared o de tal otro tipo de pared vamos a analizar Cuál es la lógica en el siguiente vídeo y la implementamos Vale pues la lógica es la siguiente si por ejemplo Tengo este píxel de aquí y digo Bueno tengo que mirar todos los de alrededor y decir si el de arriba está ocupado si el de la derecha está ocupado pero el de arriba a la izquierda no está ocupado el de abajo a la derecha no está ocupado Eso quiere decir que eres de tipo tal de tipo l o de tipo pues como te diría yo segmento recto o de tipo segmento vertical o de lo que sea entonces vamos a en primer lugar cargar las imágenes Eso sí porque eso lo tenemos que hacer Sí o sí ya habíamos empezado a cargar las imágenes por aquí así que Bueno vamos a crear una plantilla Y empezamos a cargar bloque arquitectura simple esto es una plantilla esto ahora luego lo cambiaremos vale Y voy a cargar tengo los simples y tengo ls y tengo ts es decir bueno ls tes y Cruz De hecho tengo Cruz tengo ls tengo ts y ya está Vale pues voy a decir bloque arquitectura x esto es Cruz ahora tengo que agregar las cuatro ls y las cuat tes Así que l1 esto es l1 2 3 y 4 dos 3es y cu dos 3 3es y cu y dos 3 y cu Y por último voy a cargar las tes T T T y t bien entonces ahora como digo lo que tengo que hacer es eh mirar digamos Qué tienen los siguientes elementos entonces me voy aquí a funciones me voy donde estoy pintando la arquitectura Y entonces ahora voy a decir eh lo siguiente vamos a ver bar centro okay Y entonces digo bar arriba bar abajo bar derecha y bar izquierda muy bien Esto es arriba es y- abajo es + 1 derecha es x + 1 e izquierda es x-1 bien entonces yo ahora lo que voy a hacer es decir vamos a ver si centro es 255 vale Ok bien Esto está bien y ahora digo si centro No si arriba de TR es igual a 255 y es cierto que abajo de 3 es igual a 255 y es cierto que izquierda de TR es igual a 255 y también es cierto que derecha de 3 es igual a 255 pues en ese caso tengo que pintar bloque arquitectura x es una x Porque si arriba abajo izquierda derecha tiene solidez es que es una esquina de X ahora voy a hacer lo mismo voy a decir si arriba es sólido abajo es sólido izquierda no es Sólido y derecha no es sólido es bloque arquitectura simple un Igual me equivoco Pero bueno y al revés 0 255 es arquitectura simple 2 vamos a verlo vamos a evaluarlo le doy a jugar bueno parece que he acertado Por casualidad el videojuego va lento está yendo Lento no pasa nada Ahora nos ocupamos de eso pero sí que parece que por lo menos está yendo bien ay me he puesto contra el objetivo ahora trabajaremos para que no vaya lento pero por lo menos parece que los bloques simples los he acertado de casualidad y estoy buscando un bloque x Estoy buscando un bloque x igual no tengo ningún bloque x estoy pensando igual Es cierto que no tengo ningún bloque x Bueno pues casualidad vale por lo menos veo ahí a las paredes Pues voy a hacer las test y voy a hacer las eles pero en todo caso pues ya vemos como parece que la cosa está marchando correctamente Así que vengo por aquí vamos con las eles vamos con a poner comentarios bloques simples Así que esto son las test son cuatro tes y las cuatro tes son 255 2550 2 550 255 0 255 y cuál me falta el segundo cero 250 255 Vale entonces esto es l1 no tengo ni idea de si voy a acertar ahora es imposible que acierte a Ojo si acierto me voy a comprar lotería l4 vamos a recargar le doy a jugar e no las ha puesto no ha puesto ninguna vale bueno esto son las tes Ah ahí estoy viendo Ah claro l es que es T T y T vamos a verlo vale vamos con las tes bien efectivamente Hay una que está mal hay otra que no la ha puesto no sé por qué hay otra ahí que está mal vale Y hay algunas que no las está poniendo pero evidentemente est mal Entonces yo creo que puedo saber cuál es cuál vamos a ver si abajo vamos a sacar los bloques vale Este es el de abajo cero este3 abajo 0 este3 Eso quiere decir que arriba cer es t1 arriba cer es t1 vale Y los otros cómo estaban vale también mal izquierda cero es t4 y el otro este2 izquierda cer Ah momentín no hay ninguna izquierda cero a ver este cu e izquierda cero es T2 vamos a verlo jugamos Okay parece que ahora está bien parece que ahora está bastante bien y nos faltan las eles Así que si ya tenemos las tes pues vamos a por las eles okay Vale entonces vamos a por las eles es 255 00 a ver no no esto no puede ser vale esto es arriba izquierda esto es arriba derecha ahora abajo izquierda y abajo derecha okay ahora esto es l1 L2 bueno l lo que sea va a salir mal de nuevo le doy ahí a jugar okay Vale Hay una que ha salido bien De casualidad esta de aquí ha salido bien aquella de allá vamos a verla esa ha salido bien también de casualidad lo cual quiere decir hay una t mal pues bueno pues hay una l mal pero las demás están bien y hay una t que está mal vemos como por lo menos está empezando aparecer lo que quiero vamos a ver otras casas vamos a ver como í en otras casas Sigue apareciendo bien vale Y siguiente cuestión Por cierto que el pavimento de la casa se suponía que es más clarito el pavimento de la casa se supone que es más clarito vamos a verlo vamos a ver bloque pavimento ahí está bloque pavimento casa recargamos vemos que el juego se está ralentizando bastante Ahora sí con lo cual a continuación vamos a ver si podemos hacer que el juego vaya más rápido bien Voy a ocultar los Canvas Eso sí porque ya los tengo Así que display known bueno y ahora la cuestión es que me está calculando las paredes de Trozos de escenario donde el personaje está lejos Si yo ahora vengo hago una inspección y en la inspección hago un análisis de rendimiento pues probablemente voy a ver que prácticamente estaré consumiendo todo el procesador y no es necesario entonces para ello lo que voy a hacer como digo es pues digamos el trozo de personaje que realmente esté cerca vamos a parar vamos a verlo ahora en un momento lo vamos a ver H ya adelanto evidentemente que va a salir poco positivo y ahí lo tenemos prácticamente nos estamos cargando el rendimiento por esto que acabo de hacer por lo de la arquitectura Y esto es porque pues realmente no vale la pena eh calcular digamos cada uno de los bloques Y es que ahí lo vemos vale solo quiero calcular aquellos que realmente estén cerca y da la impresión de que está calculando Pues todos ahí cuidado da ahí la impresión de que está calculando todos los que haya entonces a continuación ahora a continuación veré si puedo realizar algún tipo de optimización vamos a verlo vale de momento estoy comprobando que puedo Navegar ahora pondré Por cierto puertas y ventanas y tal que las tengo ahí preparadas pero de momento lo importante es ver como pues ya tenemos un escenario por el cual nos podemos mover vamos a ver sí correcto Bueno voy a poner las puertas y las ventanas en este caso la puerta de momento lo que voy a hacer es no poner nada Es decir en el elemento aquí la puerta es de color rojo Así que voy a hacer lo siguiente en funciones en los simples bloques simples voy a decir Pon eso Si arriba es esto vale bloque arquitectura simple y voy a decir and eh centro de cero es igual a 2s a cer eh No a 255 A ver es centro sí Y también es centro que también es cierto que centro de un es igual a 0 Y es cierto que centro de dos es igual a 0 A ver no un segundo Este es el bloque simple Vale entonces esto es puerta con lo cual me copio estos dos a ver momentín okay puerta Así que claro realmente esto por aquí vale Y ahora si es cierto esto de aquí no pongas nada de momento Ok y ahora ventanas Vale ahora digo la ventana es de color verde d y entonces digo y centro de 0 es igual a 0 y centro de un es igual a 255 y centro de 2 es igual a 0 entonces voy a poner bloque H vamos a verlo bloque ventana un y ahora pongo esto mismo aquí a continuación Y esto es bloque arquitectura ventana dos Espero no haberme equivocado puede que sí Ahora lo veremos recargamos le damos a jugar hay un error vamos a ver cuál es al llegar a alguna ventana ha cometido un error bloque arquitectura ventana un cómo se llama ese bloque Ah no lo he cargado Ah pues no lo he cargado Qué interesante bien puesa vale bloque arquitectura ventana uno y ventana dos lo copio lo llamo ventana uno y ventana dos bien y si todo ha ido bien jugamos y Vale y vamos a verlo a ver Bueno vamos a ver creo que ha puesto los dos bloques Y entonces le tengo que decir que cuando se encuentre un bloque de ventana no pinte pared y ahí ha puesto una puerta o sea en la puerta ha puesto una ventana vamos a verlo me voy a funciones y claro le digo donde pinta okay claro vamos a ver tengo que decirle que a continuación no es blanco los bloques simples vale Y no es cierto vamos a ver y no es cierto esto no me lo va a dejar poner a ver que el bloque sea blanco a ver y centro de cero centro de uno no es igual a 255 o centro de 1 de cer no de dos Perdón no es igual a 255 si todo esto ha ido bien lo pongo también por aquí y lo que estoy diciendo es que solo ponga en el caso de que sea pared vamos a ver vale vamos a verlo veo ahí algo raro está poniendo test no sé por qué realmente centro de uno y centro de dos no sé por qué los pone los voy a quitar de momento a ver los voy a quitar de momento y ahora en el siguiente bloque de contenido los volveré a poner y analizaremos pues qué es lo que está ocurriendo de momento los tengo pintados dobles Vale pues voy a dejarlos así y así vamos implementando pues más funciones dentro del juego otra cosa que quiero hacer eh Por ejemplo es poner pues la misma lógica para crear las vallas que tiene cada uno de los terrenos con lo cual como nos podemos imaginar Pues procederemos igual que al crear las barreras digamos de los elementos pero en lugar de ser barreras blancas pues serán barreras de color verde pero por lo demás pues tampoco tendrán mucho misterio