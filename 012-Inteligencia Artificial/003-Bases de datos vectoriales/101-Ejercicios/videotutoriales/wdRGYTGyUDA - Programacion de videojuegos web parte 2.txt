bien pues vamos a continuar vamos a ir realizando avances vamos a ir realizando mejoras voy a poner esto a pantalla dividida vamos a ver vale Y activamos Chrome sacamos el videojuego bien y ahora vamos a intentar arreglar unas cuantas cosas vamos a ir avanzando en el desarrollo y voy a decir que si desfase es menor o igual intentando evitar esa vibración que hemos visto hace un momento vamos a jugar y ahora cuando el personaje esté en la pantalla bien vemos como los objetos todavía vibran un poco bueno otra cosa que quiero hacer es determinar dónde va a estar el personaje inicial Y dónde van a estar por ejemplo los enemigos Así que para ello vamos a volver al gimp y vamos a utilizar diferentes tipos de píxel ya sabemos que un píxel digamos sólido es en este caso pues un terreno Pues ahora por ejemplo Voy a pintar con un color rojo vamos a verlo y voy a decir que donde estén los rojos pues va a ser donde vamos a crear un enemigos vamos a crearlos por ejemplo aquí ahora un píxel verde vamos a hacerlo perfectamente verde va a ser el personaje inicial no ahí no Aquí bien y el píxel azul va a ser el objetivo final azul que sea perfectamente azul y este será el objetivo final que estará aquí con todo esto sobre escribo el mapa ahora mismo es Exactamente igual porque recordé monos que recordemos que lo que hacía es comprobar únicamente la solidez bien y ahora lo que voy a hacer para empezar es decirle al sistema Pues dónde están esas condiciones iniciales Así que vengo a las funciones y voy a crear una función de post inicial jugador vengo por aquí y cojo esto por ejemplo vamos a ver dibujo el terreno píxeles aquí está y ahora vengo por aquí y digo Si hemos dicho que el personaje era verde si CR es = a 0 and c Green es igual a and c Blue es = 0 and c Alfa es ig a 0 en ese caso voy a decir que Pos x es igual a x y Pos y es igual a y con esto por tanto lo que voy a hacer pu inicial jugador es decir que esto lo quiero en la función de inicio antes de empezar el juego recargamos jugamos y si todo ha ido bien el personaje aparecerá vamos a verlo vamos a recargar todo porque me da la sensación de que el personaje no está ahí vale Okay vamos a recargarlo todo Vamos a darle a jugar bien y bueno también vamos a ver si esa función está funcionando en tal caso voy a decir console pun log he encontrado al jugador vamos a verlo porque hay veces que directamente lo que ocurre es que no funciona y vamos a ver como efectivamente no he encontrado al jugador entonces lo que voy a hacer es en este caso decirle Bueno pues si el rojo es menor que 10 Si el verde Es mayor que 240 si el azul es menor que 10 y si el alfa es menor que 10 no perdón si el alfa a ver momentín claro ya sé dónde puede estar aquí el error log enc en este caso El Alfa era 255 ya que es opaco ahí lo tenemos por fin tenemos ya a nuestro personaje bien a partir de aquí a partir de aquí lo que vamos a hacer a continuación es ahora crear los personajes en el sitio es decir crear los malos en el sitio no pasa mucho con esto porque digamos que hasta ahora lo que estábamos haciendo era que en la función de inicio en la función de inicio los creamos de forma digamos completamente aleatoria vale vamos a verlos Por aquí Ahí está pues yo lo que voy a hacer es que no los voy a crear de forma aleatoria sino que los voy a crear donde encuentre un punto rojo Así que ahora vengo por aquí me voy a funciones voy a crear una función nueva enemigos voy a volver a analizar esto y voy a decir si el rojo es igual a 255 y el verde es igual a 0 y el azul es igual a 0 y el alfa es igual a 255 en ese caso lo que voy a hacer es lo siguiente vamos a ver condiciones personaje número de personajes es igual a cero Vale ahora en las funciones le digo voy a copiarme esto de aquí aray personajes de número personajes es igual a New personaje array personajes de número personaje punto x es ig x y lo mismo para la y lo que hago es poner cada uno de los personajes en la x y en la y que les corresponde y ahora lo que hago es decir que número personajes más es decir aumenta el número voy a desactivar un segn en personaje el personaje mueve de hecho es más Esto está aquí en el bucle vamos a verlo así que no quiero Que de momento ni se mueva ni me persiga porque lo que quiero es comprobar como los personajes están donde yo quiero que estén y ahora los volveré a mover vamos a ver puedo ir a la bestia porque no he programado todavía lo de caerme vamos a verlo vamos a aumentar un poquito la velocidad del desfase vale No recuerdo dónde he puesto los personajes pero está claro que no están apareciendo vale claro y esto es porque en inicio he creado la función de crear enemigos pero no he llamado la función de crea enemigos Así que crea enemigos en este caso Muy bien Entonces vamos a recargar y vamos a comprobar al recargar si aparecen los personajes Ah bueno Vale están apareciendo ahí pero claro Hay que en cuenta vamos a verlos hay que tener en cuenta que habrá que multiplicar les probablemente su posición por 50 Entonces nos vamos a funciones nos vamos a aquí y esto es x por 50 Y esto es x por 50 vamos a por ello habrá que hacer lo mismo por cierto con el personaje original Así que recargamos jugamos bien y si todo ha ido bien no me lo sé de memoria Pero hay tres ahí con lo cual sí que a ver cuidado aquí hay tres Aquí sí que parece que están más o menos en las posiciones correctas había en el siguiente bloque había cinco vamos a comprobarlo en el siguiente bloque había Cinco De momento no se mueven está clarísimo vale Así que como vemos están en el sitio Y por último quiero que el objetivo por último quiero que el final del juego esté pues al final de la plataforma no se están moviendo porque como sabemos he desactivado sus posiciones ahora continuación veremos perfecto vale Y lo que vamos a hacer ahora En definitiva es que pues vamos a la función de crea objetivo guardamos y decimos que si esto es 0 Y esto es 255 en ese caso me voy a condiciones iniciales me voy a premio X Y prem y digo premio x es = x mado por 50 premio Y es igual a y mulado por 50 Y por tanto ahora crea objetivo lo pongo dentro de la función de inicio recargo estoy probando estoy intentando utilizar una función de desfase animada me está dando esta vibración bueno tampoco pasa nada otra cosa que puedo hacer Aquí vamos a verlo aquí al final tenemos la función y cuando me acerco pues estoy en el nivel dos así que en el nivel dos pues Vuelvo a estar ahí bueno Vale ahora veremos qué es lo que pasa al cambiar de nivel no sé dónde estará el personaje parece que está ahí bien otra cosa que puedo hacer es que en la función de bucle en lugar de una función animada vamos a verlo por aquí en lugar de una función animada lo que puedo hacer es eh calcular directamente el desfase entonces puedo decir que directamente desfase x es igual a directamente ISO x es medio pantalla x menos ISO x vamos a probar esta fórmula desfase y es medio pantalla y menos ISO y recargamos jugamos bien y esto lo que hará vamos a ver de momento no está haciendo nada colgado tampoco está vamos a poner console.log bucle y en principio no parece que haya hecho nada como para colgar el programa pero el caso es que está colgado Ah así que el Canvas lo tengo por encima vale Muy bien pues vamos a decirle al sistema que Lienzo mapa Lienzo punto display known ya que sabemos que están funcionando correctamente vale Y ahora volvemos al bucle desbloqueamos el desfase x y el desfase y bien y ahí como podemos comprobar habiendo hecho esto pues lo que tenemos es que el personaje se mueve por la pantalla y no tenemos ya digamos esa vibración que teníamos hace un momento y por tanto podemos llegar al final y podemos llegar a Nuestro objetivo la ventaja ahora mismo es que podemos crear pues tantas tantos niveles como queramos evidentemente con un esfuerzo relativamente pequeño voy a crear ahora una función de colisión para los personajes voy a hacer que los personajes se muevan simplemente se muevan lo que va a ocurrir ahora a continuación es que se van a quedar un poco bloqueados cuando se acercan a mí vamos a verlo a los personajes en principio veis como cuando me acerco a ellos se quedan bloqueados vale voy a hacer una distancia menor si la distancia es aquí no estaba aquí en el bucle si la distancia es menor que 100 en ese caso es cuando pasa algo es cuando me buscan bien están ahí están un poco Inquietos Pero bueno vale lo que quiero En definitiva es que nunca se puedan caer que nunca se nunca puedan salir ahora mismo de hecho el principal problema que tenemos ahí lo vemos Es que su función de colisión Pues realmente está como diríamos está basada en un rectángulo que yo he hecho inicialmente ese rectángulo ya no vale para nada así que yo lo que voy a hacer a continuación es decirle al sistema vamos a verlo en personaje que quiero que carguen digamos la imagen original Esto está en funciones vale Y tenemos esto de aquí V pixeles es igual a context mapa. ge image datata voy a esto lo voy a poner dentro de inicio por ejemplo no en condiciones iniciales Aquí está aquí píxeles mapa bien y ahora a continuación lo que voy a hacer es que los personajes cada uno de los personajes pues tenga ese factor de colisión digamos iren a ver si están saliendo del terreno para ello por tanto me voy a personaje vamos a ver la colisión Aquí está colisiona todo esto ya no vale para nada Lo voy a mutear Pero más adelante lo que haré es probablemente es eliminarlo me lo dejo Ahí un poco como recuerdo y ahora básicamente lo que quiero hacer es averiguar Cuál es la x y la y de eh del personaje vale Así que tengo en este caso un dis x tengo un dis y lo que quiero hacer es averiguar vamos a ver quiero averiguo colisión bar colisionando o colision píxel es igual a contexto mapa punto get image Data y ahora digo disx partido 50 porque 50 es la anchura del módulo que estamos utilizando al menos hasta el momento dis coma dis x y perdón pardo 50 y quiero ver un Pixel Quiero ver el Pixel que está abajo y entonces digo bar alfha es igual a colision a pixxel Data de3 cer es el rojo uno es el verde dos es el azul tres es la transparencia Así que ahora a continuación lo que hago es decir lo siguiente si Alfa es igual a oer pues en ese caso ahora ya es cuando tengo que hacer esto de aquí Menos mal que no he eliminado ese código creo que esta es la primera vez en mi vida que no borro algo y el no borrar algo Luego me sirve para copiarlo y pegarlo porque si no siempre tengo ahí basura comentada pero bueno en este caso me ha venido bien para que dé la vuelta y si todo esto ha funcionado bien No lo sé vamos a verlo pero si todo esto ha funcionado bien lo que va a hacer es que los personajes ya no se van a salir del terreno guardo recargo y vamos a jugar vamos a ver por ahí están caminando vale claro están dando están cambiando de dirección vamos a ver cambia dirección esto debe estar en mueve Okay vamos a mitigar esto vale Y ahí en principio parece que están colisionando con los bordes vamos a verlo y claro ahí colisiona pero un poco más H adelante correcto vale Muy bien pues vamos a decirle en la colisión vamos a ver 50x + 1 y + 1 Vamos a comprobarlo ahora le doy a jugar creo que era menos un al parecer Ah no a ver voy a recargar lo que quiero es que llegue hasta el final bueno H and un momento hasta el final Bueno sí vale más o menos bien ahí tenemos los personajes y ahora sí lo que quiero es que cuando el personaje me tiene pues entonces me persigue vamos a verlo voy a acercarme voy a poner 400 bien ahí los personajes me persiguen vale Y al perseguirme okay al perseguirme También tienen que colisionar al perseguir También tienen que calcular la colisión Y eso hará que no puedan superar ciertas barreras algún error Quizás es dis punto colision le damos a jugar vamos a movernos un poco por aquí y vamos a comprobar que los personajes no deberían poder pasar por esas barreras pero sin embargo están pasando Bueno ahí parece que algo se lo está intentando impedir Pero vale muy bien Hay que afinar un poco más esa colisión Pero bueno vale hay que impedir que ahí parece que intentan bien y al final es cuando lo intentan conseguir muy bien Vamos a crear más personajes enemigos vamos a crear más tipos de personajes enemigos y así un poco le damos más variedad al juego porque son todos de color rojo y bueno a veces puede resultar un poquito aburrido sin tener que entrar en Blender lo que voy a hacer es eh crear en este caso diferentes tipos vamos a verlo personajes personaje rojo teníamos ya el personaje verde pues simplemente trabajando un poco con los colores tonos saturación vamos a crear vamos a acercarnos un poco colores toro saturación vamos a cambiar el tono Pues mira uno amarillo personaje amarillo muy bien sigamos colores tono saturación verde y lo tenía fian personaje cian muy bien tono saturación azul personaje azul creo que a continuación irá al magenta con lo cual por lo menos tendré seis personajes preparados para jugar bien Vamos a ver ahora colores tono saturación vamos con el magenta Y si todo va bien a estas alturas tendré seis personajes digamos enemigos vamos a verlo personajes 1 2 3 4 5 6 los colores principales primarios y secundarios ahora a continuación lo que quiero hacer es crear un personaje vale trabajar con un personaje digamos bueno Vale digamos El Bueno de la película Así que voy a arrancar Blender un momento voy a preparar los sprites para este personaje y así los dejaré calculando para Ah a continuación pues generar Entonces digamos que tendré un personaje protagonista y tendré unos personajes de colores antagonistas y luego veremos qué comportamiento les damos a cada uno de ellos porque digamos qué razón tienen para tener diferentes colores así que bueno vamos a trabajar un poquito aquí el personaje un segundin entonces de momento sin tener en cuenta el personalizador aquí le doy un personaje con un tono de piel le voy a dar un tono de pelo sin especular le voy a dar aquí un color negro un poco de ropa Pues no sé así más o menos azulete los pantalones por ejemplo Se los voy a poner negros las zapatillas grises y yo creo que más o menos ya está así que me voy a ir a la cámara y ahora lo que haré es representar al personaje para a continuación poder meterlo dentro del videojuego voy a renderizar y ahora cuando acabe de renderizar vuelvo con él bien una vez que tengo estos sprites generados vamos a verlo me vengo aquí me al render me voy a htdoc me voy a útil pego reemplazo me vengo a útil recargo ya tengo el personaje y me lo guardo como aquí y personaje directamente así que ahora por ejemplo yendo al código digamos puedo cambiar directamente Esto es lo bueno est es la buena noticia puedo cambiar directamente el personaje en lugar de personaje verde va a ser personaje y directamente en principio va a funcionar vamos a verlo y ahí lo tenemos ahí tenemos el personaje directamente funcionando y ahora lo que voy a hacer es cargar diferentes personajes de colores digamos los malos los que vienen a por mí así que a continuación Así que a continuación voy a hacer lo siguiente vamos a ver personaje rojo en pc1 Pues fijémonos que bueno fantástico Aquí tengo lo tengo digamos webo para 2 3 4 5 y dos seis personaje verde personaje azul personaje cian o amarillo primero personaje cian y personaje magenta y con esto ahora lo que queremos es averiguar Cuál es el color del personaje cuando creamos un personaje tenemos por aquí energía color creo que no lo estoy usando aquí estamos Vale pues color va a ser math punr de ma. Random multiplicado por 6 voy a hacer un maz punto flor y entonces a continuación lo que vamos a hacer en el bucle de Cara a pintar de Cara a pintar imagen npc1 pues es decir vamos a ver voy a crear aquí bar imagen npc es igual a New image Y entonces vengo aquí al bucle y le digo imagen npc todo depende un poco If array personajes de ahí punto color es ig a 0 en ese caso imagen npc es igual a imagen npc1 voy a ponerlo esto aquí directamente en línea para ahora a continuación poner un els If el If 2 3 4 5 y 6 1 2 3 4 5 vamos a 2 3 4 5 y 6 Vale entonces el color tiene que ir hasta cinco Sí recargamos y si todo ha ido bien Vamos a verlo de momento no voy a recargar con fuerza para asegurarme que lo cargue todo desde cero vale sigo sig cogiendo a todos s porque en el bucle Imagen npc tiene que venir aquí Así que ahora recargo le damos a jugar y ahora sí como vemos en cada vez en cada una de las veces va a cargar de forma aleatoria diferentes tipos de personaje de hecho si vuelvo a recargar los personajes ahora serán diferentes y por ejemplo lo que podemos hacer es que pues si son de un color concreto hacen más daño o si son de otro color concreto Pues no sé estoy viendo que por hacer este cambio parece que el personaje parece que el juego vaya más lento parece que vaya claramente más lento vamos a volver a ver si quizás me conviene programarlo de otra forma sí que parece que sí que parece que al hacer ese cambio va más lento Así que igual me conviene más hacer lo siguiente voy a bajar esto voy a bajar esto Aunque el código será más largo pero parece que intercambiar esa variable de forma dinámica está consumiendo muchos recursos Entonces esto lo pongo aquí arriba y esto lo pongo aquí aquí y aquí hace que el código sea bastante más largo lo cual pues evidentemente no me gusta npc1 npc2 npc 3 npc 4 npc 5 y npc 6 recargamos y en principio ahora debería disfrutar de pues varios personajes sin tener que sacrificar el rendimiento ahí lo vemos bien aún así Ahora sí Yo diría que está volviendo a ir lento Bueno ahora veremos A ver por qué puede ser y ahora a continuación lo que haremos es confirmar Cuál es el motivo por el cual puede estar yendo tan lento a partir de ahí hay otras estrategias que puedo utilizar tales como por ejemplo pues el la pintura en este caso por ejemplo estamos pintando las celdas de del personaje digamos las celdas del escenario siempre o estamos pintando el personaje siempre yo lo que puedo hacer es decirle al sistema que solo pinte el escenario o solo pinte el personaje en el caso de que realmente caiga dentro de la pantalla eso también lo que va a hacer es que nuestro juego funcion bastante más rápido antes que eso voy a desactivar un momento los personajes varios personajes simplemente de momento Para no perder rendimiento y luego si hace falta lo volveré a reprogramar pero el no perder rendimiento es un requisito clave y ahora lo que voy a hacer es programar eso que estaba comentando Vale ahora lo que voy a hacer es que si yo vengo por ejemplo a pintar escenario Yo vengo por ejemplo aquí hay funciones a pintar escenario yo lo que hago en este caso vamos a verlo aquí dibuja terreno es que estoy dibujando el terreno aunque no haya que dibujarlo realmente entonces lo que voy a hacer es plantearme en un momento dado si debo dibujar en el terreno es decir no voy a perder recursos dibujando bloques que están fuera de la pantalla para hacer esto voy a hacer lo siguiente voy a decir que sí es cierto algo esto lo voy a poner aquí y voy a decir lo siguiente si aquí voy a tener que poner varios varias líneas si es cierto que ISO x anchura x e ISO y anchora y desfase y vale Es mayor que cer es mayor que C y es menor que anchura pantalla y es menor que altura pantalla en ese caso dibuja el bloque Y eso lo que va a hacer es que el programa no va a malgastar recursos dibujando aquí vale parece que algo ha ocurrido vamos a ver consola anchura navegador nave na vegador recargamos y ahora sí no sé si se va a ver parece que no probablemente no pero ahí vemos ahora sí que lo estamos viendo incluso es divertido porque o sea tenía que haber puesto por ejemplo mayor que men1 o algo así pero casi que prefiero Que de momento se quede así casi que prefiero Que de momento se quede así porque se va viendo lo que está ocurriendo se va viendo como el programa digamos ahorra recursos y no dibuja aquello que se va quedando por fuera y si vuelvo atrás lo vuelve a dibujar evidentemente aquí en el cero pasará lo mismo en el cero pasará lo mismo entonces puedo decir por ejemplo Es mayor que -1 y es mayor que men1 Pero ha estado divertido el que el programa realmente lo dibuje el que se demuestre que lo que estamos haciendo realmente hace algo ahí por ejemplo si le ponemos menos 100 pues ya no se nota lo está haciendo pero ya no se nota con los personajes ocurre lo mismo con los personajes Por ejemplo yo le puedo decir en este caso con este If me vengo al bucle y aquí en dibujo al personaje pongo este If realmente lo mismo Sería para la barra y entonces digo si ISO x del personaje ISO x del personaje Y si ISO y del personaje y soy y del personaje básicamente esto lo que hace es decir no me dibujes el personaje si está fuera de la pantalla es decir No malgastes recursos dibujando un personaje que esté fuera de la pantalla eso qué quiere decir pues eso quiere decir que virtualmente puedo tener cientos de personajes puedo tener escenarios brutalmente grandes puedo tener lo que quiera que no va a haber ningún problema no va a haber ningún problema en el sentido de que digamos que eh No va a cargar yo puedo hacer un escenario lleno de bloques lleno de personajes y no va a haber ningún problema en ese sentido porque digamos que el sistema va a intentar ahorrar recursos bien y ahora vamos a hacer que el personaje Eh Pues bueno eventualmente se caiga digamos por el acantilado Así que para ello voy a hacer lo siguiente me voy a funciones cargo esto vamos a ver De hecho aquí en inicio esto es píxeles mapa me voy a bucle colisión del personaje con el terreno Y esto es píxeles mapa Okay y no porque lo que quiero es bar Pixel personaje es igual a píxeles mapa punto realmente no es contexto mapa punto get image Data de post x post y 1 pixxel personaje y digo x y Ok esto momento nada y digo si es cierto que esto es cero Entonces console.log te has caído vamos a verlo vamos a inspeccionar jugamos pixeles is not defined en bucle 13 esto es pixxel personaje empezamos vale Y si me voy hacia allá vamos a ver parece que no sí porque a ver pu x partido 50 es ma punto round pues x par 50 y Esto va a ser lo mismo por si que llega partido 50 vamos a verlo jugar Okay me voy y bueno por aquí debería Ya empezar a caer así que Okay contexto mapa vamos a ver si es cierto contexto mapa correcto e Por qué tengo esto dos veces muy bien jugar y si todo va bien Te has caído vale Y ahí ya dejo de caerme bien entonces ahora e te has caído Ah digo eso ya me extrañaba bastante Ah sí cuando me acerco vale Esto va a ser -1 -1 ahí te has caído y ahí ya no te caes ahí bien habrá que afinar un poco eso pero vale Ahí no sé por qué me dice que me estoy cayendo Pero vale Ahí tenemos que verlo ahí tenemos que verlo Más que nada porque ahora a continuación Pues voy a utilizar Esa condición para a ver Okay te has caído vamos a ver Ahí te has caído Vale ahora sí Y entonces ahora yo lo que voy a hacer es algo tan sencillo Digamos como Pues que si por ejemplo pues te has caído voy a decir window.to location es igual a window pun location es decir voy a recargar burdamente el juego simplemente para decir vale te has muerto le doy a jugar vale Y si hago así y Pam me muero vuelvo a empezar es decir no puedo continuar ahí por ejemplo pues me he vuelto a caer es decir tengo que tener cuidado y quizás al diseñar el nivel pues tengo que afinar muy bien o hacer pas os más anchos o todo esto porque si hago así En definitiva me voy a caer y voy a volver a empezar bueno voy a dramatizar un poco esto de la caída creando un parámetro Z vale Y el parámetro Z va a servir para hacer como que realmente me caigo vamos a verlo vamos a hacer por tanto dentro de condiciones iniciales vamos a hacer un parámetro Z entonces voy a decir barp Z es igual a 0 Y entonces voy a hacer lo siguiente Y es que en el bucle antes de esto voy a decir post Z más Ya que en este caso lo que hace es bajar Y entonces digo si po Z Es mayor que no sé 100 o 200 en ese caso Windows location es igual a Windows location Y por último al dibujar el personaje lo que voy a hacer es que cuando dibujo la y vamos a ver dónde está es el personaje cuando dibujo la Y pues le sumo directamente la post Z así de sencillo Así que la post Z no está afectada por el isométrico entonces hago así voy a caer vamos a verlo cómo me caigo y me caigo ahora me caeré más rápido y cuando ya me caigo cuando ya llega un momento en el que me caigo muchísimo pues ya entonces el juego empieza otra vez vamos a decir en este caso vamos a ver vamos a decirle al sistema en condiciones iniciales vale velocidad Z es ig a 1 y entonces ahora cada vez que paso por aquí dónde estás velocidad Z por ig a 2 pues x + igual por Z más igual velocidad Z Y eso va a hacer que caiga con aceleración eso va a hacer que en lugar de caer linealmente vamos a verlo ahí un poquito menos 1.3 ha caído muy rápido y ahí pum y ahora ya se cae vamos a hacerle menos 800 para que realmente se caiga de la pantalla y veamos ese efecto antes de poner el sonido y se cae y ya el juego empieza de nuevo Vale entonces en todo caso pues siempre el objetivo digamos es que el personaje se quede dentro de la pantalla y sabemos que ahora ni los npc se pueden salir ni el personaje se puede salir Tampoco porque entonces lo que ocurrirá es que se caerá y el juego volverá a empezar bueno pues eh continuamos con el desarrollo hay eh cosas que podemos hacer hay cosas que podemos implementar Pero lo bueno que tiene este desarrollo tal y como lo tenemos hasta ahora es que eh vamos a ver que a partir de ahora digamos aplicando en principio un poco de esfuerzo pues obtendremos más resultado es decir la curva de del aprendizaje y la curva del desarrollo de este tipo de ejercicios de este tipo de programas pues lo que hacen es que una vez que hemos sufrido al principio una vez que nos ha costado sacar adelante el juego pero eh Digamos que ya meter nuevos elementos y hacer que el juego tenga más cosas Pues nos va costar relativamente poco esfuerzo bien Vamos a ver cómo lo tenemos hasta el momento Así que vale Voy a entrar por aquí le doy a jugar y vamos a ver vale Y ahora mismo el terreno está todo en la en el mismo nivel digamos Eso es porque si yo me vengo aquí yo me vengo aquí yo me vengo a imagen me voy a mapas en este caso mapa uno es tiene esto que estamos viendo aquí digamos que el suelo está todo digamos en el mismo sitio yo lo que voy a hacer ahora es que voy a el mapa lo voy a abrir en el gimp y lo que voy a hacer es separar el mapa en varias capas eso me va a obligar a Bueno a trabajar con un formato nativo del programa gim que es el formato xcf es decir yo voy a venir por aquí y ahora por ejemplo voy a poner Voy a crear una capa llamada mapa y voy a crear una capa nueva por encima a la que voy a llamar por ejemplo pues eh Como te diría yo como si la llamo buenos y malos y luego por encima podría crear otra capa ya llamada recogibles La idea es que puedo trabajar con un mapa en múltiples capas Eso sí al final lo voy a tener que exportar en png Más que nada porque si yo ahora vengo aquí y le digo que lo quiero guardar pues este formato de imagen se guarda con el nombre xcf con la extensión xcf y la extensión xcf es una extensión propia de gimp pero que no es compatible prácticamente con nadie efectivamente vamos a verlo yo necesito por ahí pues un archivo original que me guarde las capas pero este archivo original que me guarde las capas que es el archivo xcf pues no es compatible y luego tengo el archivo png que es el compatible entonces lo que voy a hacer Es que voy a guardar como digo una versión en formato xcf y luego voy a exportar las diferentes capas entonces por aquí voy a volver a sacar esto vamos a ver Mira incluso lo que puedo hacer de momento para tardar menos es duplicar la capa eh buenos y malos voy a eliminar con la varita mágica el color negro sin radio sin difuminar solo elimino esa capa ahí lo tengo bien y ahora en la capa de mapa voy a seleccionar todo voy a dibujar con el lápiz con color negro pues lo que voy a hacer es pintar voy a pintarlo de color negro vale con lo cual Pues ahí lo que voy a tener digamos es que si ahora exporto esto lo voy a exportar como mapa un y ahora puedo venir aquí y esto lo exporto como mapa uno personajes por ejemplo ahí puse el otro día el final puedo poner también el final Boss de cada nivel puedo poner un poco vale lo que quiera Lo único es que evidentemente ahora lo que voy a tener que hacer es actualizar el código de hecho ahora mismo no sé ni siquiera Cómo se va a comportar este juego porque le acabo de quitar el punto de inicio de hecho creo que ha suado al personaje un poco donde le dado la gana y que es en las condiciones en las coordenadas cero ahora Lo pondremos y sobre todo he hecho esto un poco para poder jugar y para poder trabajar con escenarios a múltiples niveles cómo vamos a hacer escenarios a múltiples niveles Pues voy a esto por aquí en el mapa y ahora lo que voy a hacer Es que voy a por aquí voy a poner el color de C 00 a 1 y voy a pintar Voy a pintar y luego ahora también lo que voy a hacer es poner el color dos 2s y pues voy a pintar un poquito por aquí no se ve nada no se ve nada porque prácticamente estamos trabajando con escalas de grises muy imperceptibles por mucho que me acerque es que incluso no lo puedo apreciar pero internamente sí que estoy cambiando realmente los colores del mapa vamos a verlo así que exporto el mapa bien y ahora lo que quiero hacer es que al haber dibujado colores más grises lo que quiero es decirle al mapa que esos colores quiero que vayan como te diría yo hacia arriba es decir si pinto un color más claro quiero que el terreno vaya hacia arriba y si pinto un color más oscuro quiero que el terreno vaya hacia abajo entonces de esta forma ahora evidentemente y por supuesto lo que tengo que hacer es eh Modificar el bloque es decir Modificar el código me voy aquí a condiciones iniciales y voy a decir que bar altura bloque Z es igual a no sé voy a poner 30 por ejemplo de momento y luego lo podemos cambiar Entonces esto qué es lo que quiere decir que esto lo que quiere decir es que cuando pinto en el bucle Bueno si condiciones realmente funciones en el pintat terreno vamos a ver pinta terreno dibuja terreno lo que voy a hacer es Cuál es el color digamos no solo para ver no solo para ver el alfa sino que lo que quiero ver es cuál es la z entonces aquí donde pone draw image voy a la y si quieres voy un momento aquí a separar por líneas para que veamos mejor Qué es lo que está ocurriendo es decir la diferencia entre cada uno de los componentes y entonces aquí donde tengo el desfase y voy a ponerle voy a restarle porque va hacia arriba recordamos que en y sumar va hacia abajo restar va hacia arriba voy a píxeles Data pixeles Data por altura no me acuerdo altura bloque Z si esto ha ido bien No lo sé en principio pensamos que sí si est ido bien recargo le doy por aquí vamos a ver dónde aparece el personaje y no sé si lo ves Pero tenemos ya unos cuantos bloques más levantados parece que la altura ha sido demasiada entonces voy a decirle altura 10 podría dar cinco No lo sé ahí lo vemos como tengo unos bloques más levantados que otros Ah Sí perdón es que ayer implemente esto eso es ahí estamos Vale entonces no veo muy bien lo que está ocurriendo entonces lo que voy a hacer no veo muy bien digamos el resto de bloques voy a hacer un momentín es aquí el videojuego voy a un momento la imagen del terreno nu voy a editarlo con el gimp y voy a hacer un terreno un pelín más profundo tampoco me puedo pasar mucho así que voy a duplicar esta capa que se va a quedar por bajo y voy a mover la capa un poco así para que el bloque sea más profundo Y de esa manera pues pueda ver mejor pueda ver un poco mejor como el terreno sube otra cosa que puedo hacer vamos a verlo ahí otra cosa que puedo hacer ahí vale otra cosa que puedo hacer es que el terreno pues suba a menos Entonces claro ahí también lo que voy a hacer que necesito hacer es que el personaje suba con el terreno voy a ponerle un poquito menos venga voy a poner cinco y así digamos estamos inaugurando el que el terreno Pues ahí lo vemos el que el terreno Pues también tenga ahí lo ves a altura ya tengo esto vamos a hacer que el personaje ahora suba realmente por el terreno yo de momento lo que puedo hacer es lo siguiente lo que puedo hacer es decirle al propio personaje vamos a verlo que aquí en el bucle donde Pinta y donde de hecho Mira la colisión vamos a ver si el personaje se está cayendo ahí te has caído Pixel personaje Y entonces eh vamos a ver aquí en las condiciones iniciales tenemos post Z es igual a o pues yo en este caso lo que voy a hacer es decirle al sistema en el bucle que TACA tacata si c es igual a 0 vale post Z es igual a cb por ejemplo o CR me da igual multiplicado por altura bloque Z y por tanto Ahora cuando dibujo al personaje incluso cuando dibujo a los enemigos ahora hablaremos de ellos pero voy a aquí donde pone de hecho post Z ahí lo tenemos ya está preparado Pues yo vengo por aquí le voy a jugar y vamos a verlo ahí lo tenemos ahí tenemos como el personaje se ha visto ahí baja ahí no sé si ahí está haciendo como que sube y como que baja ahí se ha visto mejor como sube y có baja a veces se ve un poco mejor a veces se ve un poco peor Pero bueno ahí por ejemplo en vertical se ve bastante mejor otra cosa que en un momento dado podría hacer vamos a verlo ahí vale otra cosa que en un momento dado podría hacer sería poner algún tipo de limitación como que por ejemplo si la diferencia de altura es demasiado grande pues el personaje no puede subir tiene que buscar algo parecido a una rampa o tendré que implementar algún tipo de acción como la acción de saltar que tampoco me costaría mucho aplicar una acción de saltar por la sencilla razón de que ya tenemos un post Z entonces dado que tenemos un post Z pues me costaría poco decirle Bueno pues modifica el post Z para que suba y para que baje hay una cosa que por cierto Sí que hace unas cuantas sesiones que quiero implementar que es que el personaje se quede quieto cuando deja de caminar Vale entonces vamos a aprovechar para implementar esto ahora luego implementaremos en los enemigos también que el personaje vaya vamos a ver ahí Es que aquí funciona correctamente Pero ahí no vamos a verlo vamos a ver vale bueno bien pues vamos a implementar esto cuidado no me caiga y ahí me he caído bien Volvemos a empezar Vale pues Ahora lo que voy a hacer es decirle al sistema cuando estamos con las condiciones de inicio y record amos que tenemos las direcciones Pues yo puedo crear una condición inicial recordamos que tenemos las direcciones aquí velocidad Z el ángulo Vale pues digo bar moviendo es igual a false o a cero o a lo que quieras entonces yo ahora puedo venir aquí a inicio y puedo decirle moviendo es igual a true creo una nueva variable y la activo cuando el personaje se está moviendo y moviendo es igual a false cuando el personaje no se está moviendo Entonces qué es lo que voy a hacer con esto Bueno voy a ver el Sprite del personaje a ver en qué posición está quieto vamos a verlo está quieto por ejemplo realmente en la posición dos técnicamente está en la posición dos y en la posición eh la cinco no la seis vale la dos o la seis entonces voy a la parte del código en la que el personaje se mueve vamos a verlo estado animación Ahí está Y entonces digo si es cierto que moviendo es igual a true en ese caso vengo aquí y pongo esto en caso contrario estado animación es igual a dos por ejemplo creo que es creo que técnicamente es un porque es 0 1 2 El un es el segundo estado vamos a verlo recargamos le damos a jugar vemos que í el personaje está quieto está y có podemos comprobar si me voy moviendo pues en ese caso el personaje se anima vamos a verlo Qué curioso que ahí sí que funcione correctamente pero sin embargo en el resto de direcciones no Que de momento se queda quieto que ya es suficiente pero el caso es que se queda en la última dirección mientras que en esa dirección sí que se queda quieto vamos a verlo en input inicio moviendo es igual a false voy a decir Else If ya que técnicamente vamos a verlo bien hace lo mismo que se queda ahí quieto lo cual es como mínimo curioso Pero bueno pues de momento lo tenemos ahí vale Así que ahora lo que vamos a hacer es poner de vuelta poner de nuevo a los personajes eh tanto digamos los malos como el final Boss como lo que necesitemos así que vamos a por ello bien si hemos dividido el mapa en dos sub mapas que realmente han sido tres ahora luego pondremos los recogibles o los props o lo que sea pues ahora lo que vamos a hacer es decirle al sistema que en condiciones iniciales voy a poner esto a mitad pantalla vale tenemos que decir que creamos un nuevo contexto cargamos el mapa y ahora esto es mapa personajes mapa uno personajes creo recordar a ver mapa uno personajes correcto de la misma forma de la misma forma tengo que ir aquí a Index en Lienzo mapa vamos a verlo y correcto Lienzo mapa personajes y en Lienzo mapa personajes Pues voy a poner el contexto así que mapa contexto mapa personajes Lienzo mapa personajes vale Y ahora pues por ejemplo cuando cargo el terreno vamos a ver cuándo cargo el terreno Por cierto me falta un draw image me falta un draw image que es cuando pinto el terreno vamos a ver sí correcto vale dibuja terreno pues copio esto y digo contexto mapa personajes clearrect contexto mapa personajes draw image mapa personajes contexto mapa personajes esto de aquí Ah crea enemigos ya lo tenía espérate pues fuera vale esto es contexto mapa claro personajes Ok contexto mapa personajes Y entonces lo que voy a decir es contexto mapa personajes pun drw image y mapa personal com0 si todo va bien Vamos a verlo le doy a jugar bien mapa personajes is not defined en funciones en la línea 122 personajes porque es personajes recargo jugar y vale ya tenemos ahí de nuevo el bueno y los malos y todo esto y ahí tenemos el terreno como sube Vale y ahora vamos a decirle al sistema Bueno ahí ahora veremos Cómo sube y cómo baja vale Y ahora tenemos que decir que los personajes también digamos sufran esta có te diría yo esta subida esta bajada los malos los enemigos también deben ser capaces de reconocer la altura del terreno pues vamos a por ello Bueno pues ahora simplemente lo que tengo que hacer es que aquí donde dibujo los enemigos donde se mueven los enemigos ahí están contexto mapa colisiona pixxel va Vale pues voy a decir en este caso que el personaje de hecho tenía una posición Z Pues le voy a decir dis Z es igual a vamos a ver bar componente es igual a colisión Pixel Data de cero o sea por ejemplo el canal rojo y componente y por tanto Ahora puedo ir a los personajes Ahora puedo ir a los personajes un momento que los encuentre aquí en el bucle y puedo decir que cuando pinto un personaje de los malos vamos a verlos dónde están aquí draw image y le digo array personajes menos array personajes de I multiplicado por altura bloque Z Así que lo aplico y lo aplico bien Voy a exagerar un poquito más el juego voy a exagerar un poquito más el terreno Y para ello voy a venir por aquí voy a seleccionar esto aquí y eh Voy a pintar con pincel un poquito grande no sé si me lo ha cogido blanco Sí me la ha cogido bien y un poquito más grande Perdón menos opaco quería decir ahora no cuidado no tanto vale Okay lo que quiero es pintar una serie de zonas digamos que como diría yo que tengan como desnivel que se vea el desnivel que puedas verlo mejor le doy a exportar claro ahora cuidado porque ahora la variación de gris es brutalmente grande entonces ahora voy a decirle al sistema que altura bloque cinco Pues no sé voy a poner uno igual tengo que bajarlo más no sé si lo veis ahí yo creo que se ve el desfase la diferencia de altura a ver ahora no sé si ves ahí sí creo que el personaje va al revés Bueno A parte de que se ha caído vamos a ver creo que me da la sensación de que el personaje va al revés a ver sí es como que el lugar de en lugar de subir baja vamos a bucle a ver si es que he sumado y imagen Premio no míralo he sumado Vale entonces hay que restar porque acordémonos que en Canvas pues la y hacia arriba quiere decir que resta es algo que me da mucha rabia pero es lo que hay Entonces ahora sí vemos como el personaje va subiendo Entonces ahora me vengo por aquí y ahora yo creo que sí podemos ver ya como el personaje pues va subiendo En base al desnivel vemos como tenemos como una especie de montañas y el personaje pues va poco a poco subiendo bien Vamos a Qué ha pasado con los malos Dónde están los malos por han desaparecido los malos de hecho también esto ha fallado vamos a recargar todo tengo el personaje aquí Pero de alguna forma los malos no están cargando Entonces si los malos no están cargando eso puede querer decir varias cosas vamos a asegurarnos de que vamos a ver Canvas Lienzo mapa personajes está oculto Por qué Pues no lo sé porque yo no lo he ocultado nos vamos a estilo Lienzo mapa personajes recargo juego Sigo sin verlo Ah display know muy bien y quiero asegurarme de que el programa ha pintado realmente ahí que yo diría que evidentemente no Ah mira sí sí s que ha pintado sí vale si ha pintado Por qué no estoy viendo los personajes vamos a verlo tengo Lienzo mapa personajes tiene contexto mapa personajes Y entonces me voy a las funciones crea enemigos contexto mapa personajes que image Data y crea objetivo bueno contexto mapa personajes así que vamos a verlo y en principio a me caigo y en principio vamos a ver si está el target y veo que vamos a verlo entonces crea enemigos porque qu no está funcionando console pun log un momento un momento un momento console pun log creo un enemigo los consoles Acuérdate que luego hay que borrarlos le doy a guardar creo un enemigo o sea realmente está creando el enemigo y de hecho no sé si has visto hace un momento que me ha parecido que estoy bajando energía Luego si estoy bajando energía es que alguien me está tocando luego entonces parece que el problema no es que no cree los enemigos sino que parece que no los está pintando bien en pantalla Vale pues vamos a ir a bucle de hecho vamos a ver cuando pintamos personajes vamos a ver es array personajes punto y ahí está el problema punto Z Eso es lo que me ha fallado punto Z y de hecho Ahí no sé ni qué valor devuelve eso o sea que probablemente estaba devolviendo un array o algo así le doy a jugar y ahí tenemos ya los personajes y lo que quiero ver es si cuando los personajes me persiguen si suben Y sí están subiendo ya vemos como los personajes realmente respetan el terreno vale muy bien así que tengo terreno tengo personajes y ahora me hacen falta Pues los recogibles en los recogibles por ejemplo eh yo lo que he hecho hoy y es renderizar vamos a verlo por aquí vamos a verlo he renderizado en escritorio en junta en render Aquí he renderizado una poción he renderizado todos los sprites Aunque realmente no es necesario solo quiero un Sprite y vamos a uno vamos a uno isométrico aquí este así que me voy aquí y en imagen voy a poner por ejemplo props Bueno una cosa sería props y otra cosa sería recogibles ahora creamos props recogibles pego esto pongo poción y ahora lo que voy a hacer y ahora lo que voy a hacer vamos a ver en recogibles es decir por ejemplo que puedo usar otra vez el color rojo no hay ningún problema puedo usar el color rojo opacidad tal tamaño tal quito los buenos y malos y digo que pongo una poción Ahí vamos a poner un tamaño de un píxel cojo la herramienta del lápiz y pongo una poción aquí y por ejemplo una poción aquí y entonces ahí me voy a guardar directamente esta capa de aquí como mapa uno recogible Okay Vale y bueno otra vez ya sabes nos toca repetir todo el proceso mediante el cual pues tengo que duplicarlo un poco todo vamos a por ello por suerte no habrá no habrán muchos más en el sentido de que bueno tengo terreno tengo personajes tengo recogibles y tengo props es decir poco más ahora crearemos algunas banquetas algunos árboles también podemos crear Vale entonces vamos a ver por aquí y ahora pues empiezo por aquí a modificar mapa uno personajes mapa recogibles mapa uno recogibles si quieres ya que estamos aquí pues vamos a decir mapa props y mapa uno props esto dará fallo porque no existe todavía entonces voy a crear una capa nueva llamada props la voy a guardar como mapa uno props y entonces podemos continuar muy bien Y entonces vamos a ver voy a venir por aquí a funciones y voy a poner crea props y crea recogibles crea props y crea recogibles vamos a ver ahora contextos contexto más a personajes contexto mapa props y contexto mapa recogibles contexto Lienzo mapa props y Lienzo mapa recogibles muy bien Entonces ahora pinto vamos a ver crea props y crea recogibles vamos a verlo vale vamos a verlo vale contexto mapa props es mapa props contexto mapa props es esto Ok y bien ahí lo que está haciendo es pintar pintar Vale y podríamos definir si los personajes y los props realmente son algo parecido o sea los personajes los recogibles y los props son algo parecido que realmente podría ser que sí es decir esto lo que quiere decir es que de la misma forma que creo personajes puedo crear props para eso lo que tengo que hacer es convertirlo todo en objetos Es decir me vengo aquí a personaje copio y pego de nuevo no sé si un momento copio y pego Y entonces esto se llama props y esto se llama recogibles Y entonces ahora edito esto a ver y lo añado vamos a Index no esto es otra cosa vamos a Index html y cargo tanto el personaje como los props como los recogibles No te asustes en el sentido de que realmente props y recogibles tampoco van a tener tanta caña a ver un momentín que aquí me da que han des aparecido unos cuantos objetos cojo todo lo meto ahí dentro Ahora sí bien y lo que te quiero decir con esto es que el constructor lo tenemos mueve no lo tenemos persigue no lo tenemos colisiona no lo tenemos y cambia dirección no lo tenemos es decir realmente es un objeto tonto pero es un objeto Al fin y al cabo y digamos que tengo x y z y tipo de momento y ya está tiempo de nacimiento no lo quiero De momento todo esto no lo quiero de momento vale Y con props ocurre Exactamente lo mismo y es que elimino todo esto no hay que cambiar el nombre de la clase por supuesto ahora cambiamos el nombre de la clase y efectivamente esto se va a llamar props y esto se va a llamar recogibles técnicamente bueno props y props podría estar en singular podría estar en plural vale pero En definitiva lo importante en este caso es Eh Pues eso que coincida digamos el nombre así como en otros lenguajes Como por ejemplo en Java es obligatorio aquí no es tan obligatorio pero evidentemente es recomendable entonces claro Cuando vengo aquí a funciones Cuando vengo aquí a crear recogibles Pues en este caso voy a crear digamos una raay de recogibles vamos a verlo esto es el alfa no Esto será el azul vale vamos a condiciones iniciales y digo número personajes pues número props aray props y ahora números recogibles y array recogibles eso quiere decir que dentro de funciones ya tengo esto preparado para decir array recogibles Uy números recogibles y aquí a crea objetivo no crea recogibles así y crea props arr props y número props y así con la misma lógica que hemos hecho una cosa pues tenemos la otra como te decía si es rojo en este caso creo un prop Que de momento va a ser que no y creo un recogible es igual a New recogible y New prop voy a ejecutar a ver si da algún error a ver si me he cargado algo en alguna parte parece que sí bien contexto de condiciones iniciales en el número se vale el número se contexto mapa igual a Lienzo mapa props he creado Lienzo mapa props pues no así que Lienzo mapa personajes Lienzo mapa recogibles y Lienzo mapa props y en el estilo Lienzo mapa personajes Lienzo mapa recogibles y Lienzo mapa props recargamos de nuevo parece que de momento va bien recogible is not defined recogible is not defined porque aquí en las funciones acordémonos del singular y el plural recogibles y props lo había definido en plural le doy a jugar vale Y ahora a continuación en principio creo un enemigo y creo un recogible eh son 10 he creado 10 no recuerdo haber creado 10 a ver recogibles 1 2 3 4 y 5 Entonces vamos a recogibles no es contexto mapa personajes es contexto recogibles y ahora entonces recargo jugamos vale creo un enemigo no he creado un recogible Y esto es porque ha tardado un poco en dibujarlo Entonces vamos a ver vamos a ver Esto es Estos son las funciones que tengo en inicio vale entonces voy a hacer lo siguiente voy a hacer lo siguiente aquí en funciones cojo contexto props aparte de que no está recogibles pero bueno contexto mapa recogibles es igual a mapa recogibles yo creo que tampoco va a funcionar porque a esas alturas no lo habrá cargado Vale pues mira ha habido suerte y creo un recogible no sé si veis ahí que tengo 10 enemigos cinco recogibles y ahora me falta pintarlos entonces para pintarlos simplemente lo que voy a hacer es Volver al bucle como verás ahora una gran parte del ejercicio es copiar y pegar es decir una gran parte del ejercicio es duplicar uras que ya teníamos Entonces los personajes han perdido mucha barra de energía o es que no la estoy pintando correctamente puede ser bueno pues ahora venimos por aquí y ahora lo que hago es forar y núo personajes pues dibujo el personaje y toda la pesca vale esto es personajes npc voy a poner un separador para verlo bien eh cuidado okay Y esto por aquí vale personajes npc esto llega hasta aquí Así que ahora cojo todo esto y lo duplico para recogibles vamos con recogibles primero y luego props una vez más No te preocupes porque voy a empezar a simplificar un montón de cosas por ejemplo la barra de energía no está en los recogibles esto es el color la dirección isométrica esto tampoco se aplica muevo al personaje tampoco se aplica Esto me lo voy a cargar todo esto Me lo voy a cargar todo dibujo el recogible números recogibles array recogibles no esto no hace falta esto no hace falta porque los recogibles no se van a mover no se van a salir y esto es imagen npc ahora tengo que cargar array recogibles vale por Z ahora veremos esa Z Que de momento no existe y imagen npc1 Esto es lo que vamos a decir que condiciones iniciales imagen recogible uno esto es recogibles Y esto no me acuerdo Qué nombre le he puesto recogibles y poción si todo va bien me voy al bucle imagen recogible un recargamos bien en principio no hay errores tampoco hay pociones o sea tampoco eso vale por qué Pues no lo sé pero lo más probable vamos a verlo a raíz recogibles Z Cuánto es a raíz recogibles Z pues recogibles dis pun Z es igual a cer0 de momento entiendo que por ahí igual puede estar fallando vamos a verlo en principio no vamos a bucle vamos a console pun log Voy a pintar un recogible esto es muy importante en el sentido de que cuando ves que algo que no me funciona pues pongo un console a ver y bueno de momento vemos como efectivamente está entrando dentro de bucle o sea realmente va a pintar un recogible pero el recogible no lo está pintando bien otra cosa que te digo a hay personajes estado anim esto te digo ya que va a ser que no Entonces vamos a hacer una cosa Esto lo borro Porque estos ya no me hacen falta porque no estoy pintando un Sprite O sea no estoy pintando un Sprite animado quito el console le doy ahí a jugar momento que ahí no sé si ves como está pintando ya la poción vale Y ahí calculo que pintará también otra poción ahora lo que tengo que hacer también hay que decirlo es cuando en la función cuando pintamos los recogibles Aquí los recogibles tengo también que analizar Cuál es el get image en el cómo te diría yo en el recogible digamos del Ay no me sale el recogible para asegurarnos que esté en el en la posición correcta vale en el Z correcto y ahora una vez que hemos hecho esto pues vamos a crear un prop vale un prop Son elementos de la escena entonces un prop puede ser una mesa puede ser una silla puede ser un árbol puede ser una pared puede ser un lo que sea vamos a dibujar un pequeño árbol o una pequeña mesa o algo sencillo voy a abrir Blender vamos a verlo voy a pintarlo de una forma parecida a la poción con lo cual tú dirás Bueno entonces por qué no lo pintas como poción La respuesta es porque no es lo mismo vale no es lo mismo un recogible que en un momento dado desaparece que un prop que en principio está ahí siempre entonces vengo por aquí voy a dibujar no voy a dibujar un cubo vamos a moverlo ahí damos a Z vamos a moverlo ahí F vale escalo en Z Bien voy a ver subdividir lo subdivididos también Ok tenemos ahí una banqueta y ahora vamos a crear no sé Algo vamos a crear un cilindro está ahí vale Okay esto que es la poción Dónde está aquí lo oculto así Perdón lo oculto ahora cojo el cilindro lo escalo en Z y a continuación lo voy a subir lo duplico de nuevo para hay leches que estoy animando vale para girarlo lo duplico lo vuelvo a duplicar para girarlo 90 gr Lo pongo aquí lo pongo allá y ya tengo un taburete claro ahora tengo que a ver la cámara la quiero un momento fuera no quiero claves Y quién se me ha deshecho vale okay duplico Y si todo va bien ya lo tengo Okay Busco un ángulo isométrico como ese de ahí renderizo una imagen un poco blanco pero bueno voy a hacerlo un poquito más gris a ver voy crear un material de madera y se lo aplico realmente a todo madera creo que no me ha hecho ni caso bien entonces ahora voy a sacar una imagen guardo render creo que me he dejado una pata sin material pero bueno no pasa nada vale y ahora voy a guardar me voy a videojuegos imagen o no he creado props parece que no props prop 1 Ok me aseguro de que he guardado y ahora en el código primero vamos a ver si he cargado el prop que no estoy seguro ahora mismo que va ser que no bar imagen prop 1 esto es prop props y por tanto ahora pues por ejemplo en el gimp vengo a la capa de props y le digo que de color rojo pues Quiero pintar no sé unas sillas aquí y otras sillas aquí y otras sillas aquí y otras sillas aquí yo que sé y otras sillas aquí no sé para que digamos notemos que lo que vemos en pantalla realmente corresponde Así que exporto lo exporto como mapa un props vamos a comprobar si al recargar dice ok cargando props creo un prop 32 pues puede ser que haya dibujado 32 y ahora aquí dentro del bucle vamos a dibujar los recogibles cargamos los props Y entonces número props imagen prop 1 array props Z altura bloque Z ahora hablaremos de ello bien y si todo va bien Wow vale ars not Def muy bien condiciones iniciales aray props aray RS se ve que he puesto en alguna parte arrays no esay guardo recargo y vamos a ver bien no se están dibujando los props Pero no pasa nada vamos a verlo imagen prop 1 a ver vamos a las funciones crea recogibles crea props Ok creo un prop Ok esto es correcto aray props New props aray props todo parece correcto vamos al bucle y digo console dibujo un prop recargamos dibujo un prop correcto está técnicamente está funcionando luego hay algo que no se está ejecutando bien imagen prop 1 Vamos a ver mi principal sospechos ahora mismo es imagen prop 1 props prop 1 se llama así props prop 1 sí la imagen existe sí vale si eso está haciéndose correctamente en ese caso mi siguiente sospechoso es el Z pero el Z ahora mismo no sospecho demasiado A ver props pues sí sospecho x y z Por cierto esto más adelante será tipo y entonces dis Z y es igual a 0 vengo por aquí recargo quito el bucle quito el dibujo un prop que machaca un poquito el rendimiento dibujo un prop no lo veo vale recargamos a ver si reacciona no reacciona cuando eso pasa abrirlo en una nueva pestaña su solucionar el problema vamos a ver y jugar vale reinicio Okay pero no okay Porque HM pongo por aquí prop guardo recargo jugamos y El caso es que Ah mira ahora venga los pinta sin tener en cuenta la z ahora vamos a por ello pero los pinta vale muy bien Ahora vamos por ello y como vemos tanto pues ya me está creando ahí en cada uno de los elementos pues una silla Lo único es que no está digamos eh o sea no está cogiendo realmente la z no hay ningún problema Por ello porque lo que voy a hacer en ese caso es decirle al sistema que quiero sacar la z de El del plano vamos a verlo me voy a funciones Y entonces aquí como te digo lo que voy a hacer es decirle al sistema que vamos a ver vale esto es aray props de Z voy a hacerlo en un vídeo nuevo vale array prop de Z es igual y ahora cuidado a qué a contexto mapa punto get Pixel get image Data de 0 no de X y11 punto Data de c eso es el Z y de la misma forma recogibles a raíz recogibles de números recogibles la z es la altura la el gris que tenga el contexto mapa vamos a por ello Así voy a volver a machacar el console que como ves el console pues bloquea bastante la ejecución Y si todo va bien aparte de que bueno parece que ahora veremos pero por lo menos las sillas vemos como ya intentan estar a la altura correcta que lo consigan o no ya es otra cosa pero por lo menos lo intentan ahí parece que lo consiguen un poco más ahí parece que lo consiguen un poco más por cierto estaban en el medio estaban en el medio no estaban en el medio no es porque se me está desfasado un píxel por ahí y un píxel por ahí y eso quiere decir y eso quiere decir un momento a ver no están correctas vale Y eso quiere decir vamos a verlo dónde estás funciones vale vamos a ver un momento x * 50 + 50 creo que es esto + 50 y + 50 y así les damos un desfase a cada uno de ellos pues no era -50 Era - 50 y -50 vamos a verlo ahí al final y sí Es más yo creo que lo mejor que podemos hacer incluso es aquí decir 1 dos 3 y cuatro rodeamos el personaje de cuatro sillas y ahí es d vamos a ver mejor si están correctamente o no y no vale es -50 - 50 - 50 y -50 y así Ahora los profs estarán correctamente en X en y en Z ahora sí bien y con esto como podemos ver tengo algo que parece un poco ridículo evidentemente que es que he puesto pociones y sillas es como para qué me sirve tener pociones y tener sillas Bueno pues la idea Precisamente es que donde he puesto sillas Ahora puedo poner eh sillas mesas bosques jardines paredes puedo poner lo que quiera es decir puedo literalmente configurarme la escena como quiera y donde he puesto pociones pues puedo cualquier cosa que me interese recoger puedo eh pociones puedo armas puedo eh energía puedo lo que quiera vale es decir la idea no es ya implementar un prop La idea es que una vez que hemos visto que hemos implementado un prop pues podemos implementar tantos props como queramos bien Ahora vamos a hacer lo siguiente vamos a empezar implementando el salto del personaje y voy a hacer lo siguiente voy a decirle al sistema que en las condiciones iniciales donde definimos al personaje digo salto personaje es igual a cer y ahora a continuación cuando yo dibujo al personaje aquí en el bucle cuando dibujo al personaje le digo menos post Z menos personaje salto era salto personaje O personaje salto no me acuerdo era salto personaje bien entonces ahora yo lo que puedo hacer es que cuando pulse una tecla podría ser la espaciadora podría ser la z por ejemplo No lo sé puede ser cualquier tecla me voy a inicio y en este caso voy a decirle Sí si la tecla que pulso es la Z en este caso no se aplica dirección Pero si se aplica saltando es igual a true y eh vamos a ver cómo estás Aquí y salto personaje es igual a no sé 20 entonces yo ahora vengo por aquí y en el bucle digo Aquí en el personaje mismo si saltando es igual a true bien en ese caso salto personaje menos igual a 4 voy a probar Y si salto personaje es menor que cero quiere decir que ya acabado de saltar en ese caso salto en ese caso saltando es igual a cer vamos a probarlo recargamos jugamos Hola vale algún error saltando is not defined condiciones iniciales bar era moviendo bar saltando es igual a false vale le doy a jugar pulsamos la z vale Sí que algo salta pero vamos a hacer que salte más rápido vamos a ver aquí en el inicio saltando voy a hacer una cosa vamos a ver vale bar velocidad Z es igual a 0 muy bien Sí esto son como las ecuaciones del tiro parabólico velocidad Z es igual a 40 y aquí en el bucle le digo salto personaje es igual es más igual a velocidad Z Y entonces velocidad Z es menos igual a 5 y ya está vamos a verlo jugar y vemos ahí cóm tenemos ya al personaje saltando no sé si está en el sitio correcto sí debe volver siempre al sitio correcto Vale ahora ya es un salto un poco exagerado evidentemente vale con lo cual pues podemos decirle Por ejemplo que velocidad Z es igual a 20 y en el bucle le decimos que velocidad Z no sé es que menos menor igual a 5 ya es bastante ahí yo creo que ahí está bien vale No tengo muy claro si se ha quedado en el sitio correcto sí se ha quedado el sitio correcto Hola deberías haber recargado el juego vale Ya tenemos el Salto vamos ahora a por la interacción podría disparar podría ser golpear podría ser recoger un objeto podría ser cualquier cosa vamos a por ello si mantengo la z lo que hace es que acumula el Salto cosa que en un principio podría ser una mecánica del juego pero yo lo que voy a hacer es que en inicio voy a decirle que si la z es esto y saltando es igual a false y con eso lo que voy a hacer es decirle que no puede saltar hasta que haya dejado de saltar entonces hago así y fíjate que Puedo saltar muchas veces pero no Puedo saltar una vez encima de otra Entonces bueno es una forma que podemos tener de programarlo bien luego como te decía luego como te decía por aquí en vamos a verlo en escritorio en junta en aquí en Ey a ver aquí personaje acción he preparado una serie de sprites ahora los verás me voy aquí a htdoc me voy a útil en imagen borro lo que había y pego lo nuevo me voy a útil y cargo lo que había vale Y el personaje lo que hace es que da la mano no tiene más como ves vale da la mano Entonces ahora guardo este personaje me lo guardo en videojuegos en imagen en personajes como personaje action lo cargo En condiciones iniciales donde cargo el personaje imagen personaje acción bien Y entonces ahora lo que voy a hacer en inicio es cargar una acción vamos a verlo si la tecla es igual a la e o a la f La que quieras vamos a ver y acción es igual a false acción es igual a true y velocidad Z no se aplica en este caso entonces en condiciones iniciales acción es igual a false vamos a ver y ahora en el bucle en el personaje le digo si acción es igual a true y en caso contrario tal copio pego imagen personaje acción vamos a ver lo que hace hemos dicho que es la tecla vamos a verlo y vale estoy pulsando la e no hace nada No sé si es un error Ah claro muy bien claro bien tengo que mover para que el personaje haga algo Porque si moviendo es igual a true vamos a ver vale Ok a ver este If dónde acaba aquí sin moviendo es igual a true and acción es igual a false vamos a verlo muev el personaje y or acción es igual a false creo que es me está saliendo lo contrario Ah míralo desde cuándo mueve los dos brazos Ah sí sí vale muy bien Vamos a ver Ah claro Okay pulso la tecla a ver Okay vamos a ver si moviendo es igual voy a hacer un condicional más complejo si moviendo es igual a true and acción es igual a false o bien acción es igual a true Okay en ese caso vale Esto va aquí esto este paréntesis obra vale Y ahora quiero decirle que la acción no dure mucho cuidado ble 172 sí esto no sé por qué es incorrecto sí moviendo or acciones igual a true lo da como error en la línea 171 Ah sí porque falta un doble igual vale Y ahí se pone a hacer la acción pero luego no para entonces estado animación más okay y bueno puedo decirle que aquí Acción es igual a false es decir cuando llega al final del bucle para yo creo que más o menos ya okay Ahí lo tenemos cuando hace así hace la acción y luego ya continúa caminando con normalidad Okay Vale con lo cual tenemos Ya por aquí tenemos Ya por aquí pues tanto los props Como debería detectar colisión con los profs Por cierto ya haremos eso eh vamos a trabajar un poco los recogibles porque claro Cuál es la diferencia hasta ahora con los prof y los recogibles ahora mismo ninguna Pero según la mecánica de un juego sí que tiene que haber diferencia Y es que el recogible cuando lo recoges deja de existir Mientras que el prop siempre existe porque técnicamente no lo puedes recoger Así que vamos a programar una vez que tenemos eso Por tanto vamos a verlo lo que vamos a hacer es decirle al sistema lo siguiente Vamos allá ahora esto que voy a hacer es muy delicado porque yoeng un listado de objetos que son enemigos de instancias de clases un listado de props que son props un listado de recogibles que son recogibles Bueno pues lo que voy a hacer Es que cuando me acerque a un recogible el recogible va a desaparecer entonces claro cuidado al desaparecer porque desaparecer básicamente quiere decir eliminar una un elemento de la matriz y si Elo si elimino un elemento de la matriz tengo que tener cuidado con qué pasa con esa matriz entonces Yo vengo por aquí yo vengo por aquí y ahora en cada uno de los elementos en cada uno de los props Perdón en cada uno de los recogibles voy a mirar la distancia del elemento al recogible Y entonces ahora voy a decir lo siguiente me voy al personaje creo que teníamos por aquí la distancia no está en el bucle Ah aquí me voy a los recogibles y digo Pos x menos a raí recogibles Vale y digo si la distancia es menor que 50 console punto log estás cerca del recogible Así que vengo por aquí vale me acerco al recogible y dice estás cerca del recogible y yo ahora salgo y me acerco y tal Bien ahora lo que voy a hacer por tanto es decirle al sistema que si la distancia es menor que 50 me quiero cargar ese recogible me quiero cargar ese recogible en javascript es la función splice es decir splice lo que hace es eliminar un elemento de la matriz entonces vengo por aquí y digo javascript array remove Element me dirá splice vamos a verlo a ra remove ahí splice y me vengo por aquí array spli array recogibles elimino el índice I y ya está vamos a verlo le doy ahí me acerco al elemento y pap vale en este caso el elemento desaparece Por qué ha desaparecido por una razón muy sencilla vamos a ver voy a sacar un Google Drive Y así te lo voy a poder explicar mejor porque el trabajo con matrices es un trabajo bastante teórico verás voy a sacar una hoja de cálculo vale Yo he dicho tengo vamos a darlo por aquí voy a hacer est un poco más grande yo he dicho tengo cinco recogibles y el programa hace vale recogible uno recogible 2s recogible 3 4 y 5 y cada uno tiene su x x su y y su Z y su lo que quieras si yo por ejemplo cojo el 3 y lo elimino No pasa nada es perfecto el programa lo que hace es decir vale Okay pues plap vale Ya no tienes el tres No pasa nada Tienes el 1 2 cu y C pero problema Yo aquí le he dicho que tengo cinco elementos con lo cual cuando llega este de aquí que es el número cinco dice vale Dónde está la x y la y no existe doy error o sea doy error porque estoy buscando la x de algo que no existe entonces la solución es número recogibles menos O sea le tengo que avisar al programa de que si he quitado un elemento de la matriz ahora la longitud de la matriz es menor así que por tanto recargo por aquí le doy a jugar me acerco al recogible y el recogible desaparece y no pasa nada más no pasa nada más por ejemplo la energía la puedo subir es decir por ejemplo energía más igual a 20 no lo sé igual se sale la barra pero bueno voy a dejar que me quiten un poco de energía Ok vale Y ahora vengo por aquí y no sé si has visto que la energía ha subido Vale entonces La idea es que los recogibles pues tienen que hacer algo vengo por aquí y ha subido Por cierto la barra de mi barra de vida no está subiendo conmigo Vamos a verlo personaje pu y por cierto mi barra sube tampoco salta conmigo mi barra Bueno pues esto es por esto menos post Z menos alto personaje tiene que estar ahí y tiene que estar ahí vamos a comprobarlo jugamos vale vamos a ver cómo mi barra ahora salta conmigo y ahí y vamos a ver cómo mi barra sube conmigo también okay Vale muy bien y como podemos comprobar Aquí y ahora recojo e cuidado Vale ha vuelto a fallar Qué raro no sé por qué ha fallado ahí al recoger ese algo tiene que haber hecho mal Creo que es porque era el último puede ser y como era el último me dice que ya no puedo recorrer la matriz puede ser perfectamente que sea por eso sí vale Y ahora lo que quiero es decirle al sistema que bueno Quiero mirar si hay algún prop en esa cuando yo me voy moviendo cuando yo me voy eh digamos pasando por la pantalla quiero decirle al sistema Quiero preguntarle si hay algún prop en el sitio donde yo estoy moviéndome para decirle Bueno si hay un prop no te puedes mover vamos a hacerlo no pasa nada porque en un momento dado y eso si te fijas lo he hecho antes cuando un array se queda sin elementos yo lo que puedo hacer cuando dibujo el array es decir antes de empezar a decir número props pues puedo poner un elemento aquí arriba o recogibles un elemento arriba que diga si recogibles es mayor que Cero en ese caso entra dentro del bcle es decir Hay muchas formas de asegurarnos que el programa no de error en ese tipo de bucles porque ya te digo es muy normal y hay veces que incluso cuando Cojo un recogible por error lo quita dos veces con lo cual el número recogibles puede llegar a ser negativo por ese error entonces hay formas de intentar atrapar esos errores y corregirlos y compensarlos vale Así que esos errores un poco dentro de lo que cabe son los más lo más normal del mundo Entonces ahora lo que voy a hacer es que cuando el personaje se mueve vamos a verlo vale moviendo es igual a true vamos a ver el bucle vamos a ver el bucle sí moviendo es igual a true no Ah Pos x vale muy bien Vamos allá entonces Ahora vengo por aquí Ahora vengo por aquí vale y ahora digo eh HM bar sólido es igual a contexto eh props era contexto props vamos a ver vamos a verlo era contexto mapa props punto get image Data d ma punto flor de pos x paro 50 coma ma. flor de pos y par 50 coma 1,1 punto Data D 3 que es el Alfa y entonces yo digo si sólido es igual a o Eso quiere decir que te puedes mover Eso quiere decir que te puedes mover es decir esto mismo lo voy a aplicar sobre cada uno de los elementos para decirle al personaje que no se va a poder mover si está colisionando con algún prop Así que hago así finalizo recargamos identifier 236 bar se ve que me he cargado Ah mira me lo he cargado también bar y ya recargamos vamos a jugar y vamos a recargar y vamos a ver ahí vaya Me he quedado Atrapado Me he quedado Atrapado Me he quedado Atrapado vale fantástico vamos a ver vamos aquí contra estas sillas y vale antes me había quedado Atrapado vamos contra esas sillas Ah perdón es que no es cero es 255 O sea si es sólido es que es recargamos claro ahí estoy Atrapado voy a eliminar dónde estás goma aquí goma sci sí goma goma goma no sé por qué en fin Vamos a darle propos vale recargamos Okay no Okay Ah Espera a ver si ahí tengo algo todavía vale Ah no Claro si sólido es igual a cero no estaba bien programado si sólido es igual a cero te dejo moverte vale venga vamos a ver si podemos colisionar con las sillas no no Ah mira qué bien Ahí sí que reconoce algún tipo de colisión de alguna forma eso tengo que afinarlo eso voy a tener que afinarlo pero sí que en cierta forma ha reconocido colisión con las sillas y cuando hago así ya no puedo tirar más vale Okay pues eso tengo que verlo eso tengo que analizarlo será un poco para mejorar el código pero básicamente ahí lo tenemos bien entonces ahora lo que voy a hacer Pues bueno Voy a pintar un poco eh algunas algunos niveles más es decir ahora cuando podemos empezar a jugar digamos desde el punto de vista en el que podemos empezar a crear escenarios completamente personalizados con todo esto que tenemos lo único que nos quedaría por ejemplo Pues sería hacer múltiples tipos de props múltiples tipos de recogibles vamos a hacer eso pero ya te digo que eso no va a suponer ningún problema porque como ahora verás ni siquiera hay que repetir el código es un poco de copiar y pegar y ya está esto lo vamos a hacer de forma que me voy a ir al gimp voy a abrir voy a img voy a recogibles voy a poción Vale y Esto va a ser tono saturación pues Quiero una poción verde poción dos Y quiero una poción azul poción 3 esto quiere decir que yo ahora me voy al código me voy a condiciones iniciales me voy a no mapa un recogible un me voy a recogible dos y recogible tres poción dos y poción 3 y ahora en Los recogibles recordamos que teníamos ahí el tipo pues dis punto tipo Por cierto que dirección ya no hace falta dis pun tipo es igual a maz Flor de ma Random multiplicado por dos no por a ver 0 1 y 2 03 aquí Entonces ahora me vengo al bucle y en los recogibles vale voy a decir que si tipo es igual a 1 en ese caso esto siis punto tipo es ig a 2 y es igual a 3 imagen recogible 2 imagen recogible 3 y si todo esto ha ido bien de esta forma pues ya no tenemos un una roja recogible a ver un segund Bueno creo que han desaparecido todas vale vamos a ver y dis punto tipo no es dis punto tipo es array recogibles punto tipo vale tampoco tipo es igual a 1 tipo es igual a 2 vamos a verlo dis pun tipo es math pun flor math Random por vale interesante más punto round Vamos a darle a ver okay mm bucle la cuón es que sigue de Sí entonces imagen recogible a ver si es que no he puesto lo correcto imagen recogible uno yo creo que no está cogiendo el dis punto tipo entonces console pun log puede ser imagen recogible uno correcto tampoco eso acaba de explicar por qué Porque eso lo que harías que serían todos rojos vale hay azul vale correcto el tipo es 0 dos y 3es Qué curioso Nunca es uno voy a recargar vale el tipo es uno ah siempre es el tipo es uno vaya vale Ahora sí voy a decirle flor car casualidad que el tipo ha sido uno ahora vale Y ahora tengo ahí un rojo y de cer c a dos y va de cer0 a dos efectivamente tengo otro rojo que habrá sido de casualidad Ah Me he quedado ahí bloqueado Vale ahora voy a desactivar el Este voy a desactivar la colisión no está aquí bien y ahora voy a empezar a crear un montón de funciones para empezar a pues a externalizar porque si no bucle como has visto se me está haciendo eterno entonces para ello voy a crear un nuevo archivo lo voy a guardar dentro de videojuegos dentro de js Y si ya tenía funciones Pues voy a llamar esto funciones bucle punto js vale vamos a cargar aquí en Index html funciones bucle vamos a ver bien y ahora lo que voy a hacer es algo que hay que hacer con mucho cuidado ahí encima está están ahí separados vale Qué es lo siguiente vamos a ver Okay Ok Vale pues llego aquí y digo corto function colisión personaje terreno pongo el código dentro y ahora me llevo la función y ahora me llevo la función y si recargo Todo debe seguir funcionando correctamente esto que estoy haciendo ves medio pantalla x not muy bien palla x sí me he llevado no colisión personaje terreno sí cuidado porque estoy declarando esas variables ahí dentro como locales aquí vale Ahora vengo por aquí Bueno ahora evidentemente ahora vuelto a funcionar Okay bien Ahora cálculo desfase Pues cojo este código me voy a funciones función cálculo desfase lo pego Me cojo la función a ver un momento vale a ver un momento Vale y Okay venga cálculo desfase me voy a y cálculo desfase recargo Y como te digo el juego tiene que funcionar Exactamente igual la diferencia es que evidentemente pues ahora Esto va digamos aligerando de código vengo por aquí personajes npc corto funciones bucle fun pinta npc Y entonces vengo por aquí y pinta npc Ahora vengo por aquí le digo cojo esto de aquí pintas recogibles fun cuidado ahí fun pinta recogibles cojo el pinta recogibles que al final tiene la misma pinta es decir al final todo lo que estoy sacando de aquí lo estoy poniendo en otro archivo pero sin embargo Ahora vengo aquí props function pinta props Pinta profs y pinta personaje esto Qué es ahí esto es pinta personaje colisión props colisión propus y esto de aquí Qué es Ah pinto el premio muere y ya está Vale pues fun pinto premio y fun muere Entonces si hago esto Ahora el bucle se nos queda así aparte de que pues evidentemente elimino las líneas que no pinten nada Y así pues cuando me meto en el bucle ahora por cierto recargamos para comprobar que todo sigue funcionando correctamente Pues fíjate que podemos entender mejor pues que primero dibuja el terreno luego las colisiones luego calcula el desfase luego pinta los npcs luego pinta los recogibles luego pinta los props luego y En definitiva si yo digo Vale tengo un problema con los npcs Bueno pues ya sé que tengo que ir a buscar una función que se llama Pinta npcs y entonces pues me voy a funciones ble Busco Pinta npcs y ya a partir de ahí pues puedo empezar a buscar puedo meter todas esas funciones dentro de un archivo puedo crear diferentes archivos cada uno con una función esto ya es un poco pues al gusto de cada uno es decir es lo que te decía anteriormente De que lo podríamos haber hecho todo en un único archivo y No tendríamos que ir mareon con múltiples archivos se puede partir en diferentes archivos y si lo partimos en diferentes archivos Pues el límite digamos de Cuántos archivos crear no está establecido sino que el límite es el que nosotros queramos crear vale Bueno pues he estado preparando una serie de assets vamos a verlos Por aquí bien Vamos a mapas y en mapas aparte de que he creado un archivo de gim pues tenemos por aquí vamos a verlo creo que no lo he guardado vale vamos a guardarlo vamos a abrir el K vamos a ver este que he estado haciendo vamos a hacerlo bien entonces en este mapa Por una parte vamos a exportar el terreno Z vamos a llamarlo vamos a ver imágenes mapas vamos a llamarlo mapa un ahí está vale Por otra parte vamos a guardar esto como mapa uno colores terreno o algo así y luego por otra parte tengo un mapa de arquitectura que he creado Así que vamos a llamarlo mapa un arquitectura que son elementos arquitectónicos de los props ahora hablaremos de ello bien Entonces eso quiere decir que ahora sí tengo por aquí el mapa uno tengo por aquí el mapa arquitectura vamos a crear también el mapa de los personajes por lo menos para que aparezcan al principio así que vamos a crearlo por aquí y voy a decir que por ejemplo hago una nueva capa bien y porj aquí en el medio Voy a pintar un píxel rojo a continuación Voy a pintar un pixxel verde y a continuación Voy a pintar un pixxel azul bien así que lo tenemos esto es personajes y vamos a por ello Así que ahora exporto solo esta capa mapa uno personajes no nos olvidamos en ningún caso de guardar el archivo original por capas bien y cerramos el gimp lo tengo en una carpeta llamada vamos a verlo ah a ver lo tenía por aquí js originales quería poner originales y aquí tenemos el mapa y una serie de elementos arquitectónicos que también he creado hablaremos de ellos están aquí en img en arquitectura y he creado pues una serie de bloques de paredes de ventanas de puertas y de todo esto ahora los meteremos dentro del juego Pero antes de ello vamos a arrancar el propio juego vamos a arrancar el propio juego vamos a ver vamos a ir a local Host videojuegos vale le damos a jugar bien en este caso me aparecen los tres personajes es normal No pasa nada porque he creado Pues todo un bloque de escenario lo cual pues hace que están todos a la vez okay No pasa nada por eso bien y ahora eh si bien el terreno si bien la altura del terreno viene definida por un elemento los colores del terreno vienen definidas por otro por cierto también quiero decir que aquí en videojuegos en dónde estás en terrenos en terreno he creado también pues una serie de elementos de colores he cogido el bloque principal y lo he ido cambiando de color estos no estos son los antiguos y lo he ido cambiando de color para Pues digamos que coincidan con el propio color del terreno Entonces ahora teniendo en cuenta que tengo estos dos elementos voy a cargarlos voy a ir a condiciones iniciales y dentro de condiciones iniciales pues vamos allá vamos a ver tengo por una parte mapa uno terreno mapa lo que sea bien pues dónde está prop 1 terreno 9 Vale pues vamos a empezar a nombrar bloques de hecho los voy a poner todos en línea voy a sacar la carpeta y los voy a ir nombrando por orden entonces bloque acera vamos a ocultar esto asfalto jardín pavimento casa y vaya jardín Así que bloque asfalto bloque jardín bloque pavimento casa y bloque vaya jardín entonces bloque acera bloque asfalto bloque jardín bloque pavimento casa y bloque vaya jardín y ahora esto es acera esto es asfalto esto es jardín esto es pavimento casa y esto es valla jardín bien con esto tengo ya las imágenes cargadas ahora por supuesto me hace falta cargar el propio mapa así que vamos a verlo Esto está en mapa uno colores entonces vengo por aquí y voy a llamar a esto mapa colores src es igual a mapa colores mapa un colores y entonces ahora lo que voy a hacer es poner los siguientes elementos voy a decirle al programa voy a indicarle al programa dónde tiene que pintar cada uno de bueno de estos elementos diferentes para ello lo que vamos a hacer es pues bueno indicarle al programa al repasar la imagen vamos a cargarla vamos a por ello vamos a cargarlo dentro de un contexto inicio vamos a verlo y por ejemplo aquí en el inicio vale voy a decir a ver primero en condiciones iniciales el contexto aquí creamos un contexto Canvas Lienzo mapa colores y en las condiciones iniciales contexto mapa colores es igual a Lienzo mapa colores ahora en el inicio por ejemplo voy a decirle contexto mapac colores punto draw image y voy a poner mapa colores Ahí está mapa colores com11 haciendo esto ya tenemos ese mapa Ahí ese contexto Ahí vamos a ver el Index vamos a ver el estilo Vale y Lienzo mapa colores eliminamos todos estos le decimos que lo queremos ver de momento y vamos a ver si lo podemos ver si todo ha ido bien Le damos ahí a jugar cuidado porque ocupa demasiado ahí bien y en principio ahí aparece ya el contexto de color con lo cual Pues ahora lo que tenemos que hacer es que cada vez que el programa pinte un elemento en lugar de pintarlo verde Pues venga aquí y diga Bueno de qué color lo tengo que pintar realmente Es decir de qué color es realidad cada uno de los elementos Pues voy al momento en el cual pinto el terreno vamos a pintar el terreno vamos a pintar el terreno dónde estás terreno vamos a funciones y vamos a hacerlo desde ahí ahora por tanto Busco pinta terreno aquí está dibuja terreno y básicamente pues lo que voy a hacer es cuando voy a image voy a decirle qué es lo que voy a dibujar digamos Con qué bloque voy a dibujar entonces hago esto vamos a ver Ok y ahora vamos a decirle que If contexto mapa colores punto get image Data y Bueno voy a decir lo siguiente incluso bar colección array es igual a contexto mapa colores punto get image Data de X y11 punto Data Y entonces ahora sí digo si array de un es igual a algo and array de 2 es igual a algo and array de TR es igual a algo en ese caso pinta este bloque Bueno pues esto lo pongo por aquí cuidado vale esto como decía lo pongo por aquí esto lo pongo por aquí y ahora lo que tengo que hacer es averiguar Cuáles son los colores de cada uno de los bloques Entonces vamos a por ello vamos a por ello antes lo quiero sangrar bastante vale Y este bloque lo cambio Cuántos bloques de terreno hay de momento hay 1 2 3 4 5 y se pues entonces cojo esto y digo 1 2s 3 4 5 y 6 sangro convenientemente vale Y entonces Vamos allá voy a el gimp por ejemplo para averiguar Cuáles son estos colores y voy a abrir mapa xcf cuidado porque como he renombrado la carpeta y no lo encuentra vamos a ver sistema de archivos aplicaciones mamp ht docs videojuegos Uh originales mapa bien me voy a terreno y Bueno voy a empezar por el asfalto por ejemplo Así que asfalto de 0 a 255 es 42 Así que si esto es 42 Y esto es 42 Y esto es 42 entonces bloque asfalto pinta bloque asfalto vale Ahora hay un error ahí ok perfecto ahora esto es acera 67 66 Qué curioso 66 bloque acera ahora bloque pues por ejemplo pavimento 90 Así que 90 esto es bloque a ver claro cómo lo hemos llamado bloque pavimento y bloque pavimento casa muy bien bloque pavimento ahora bloque pavimento casa 138 Entonces esto es bloque pavimento Vale ahora esto es 605 96 54 65 54 esto es bloque jardín y al parecer Solo me falta bloque vaya jardín que es 111 133 104 Y esto es bloque vaya jardín me acabo de dar cuenta de que los índices de los ar rais los tengo mal Entonces esto es cer0 esto es uno esto es dos esto es cer esto es uno esto es dos 0 1 y 2s 0 1 y dos 0 1 y dos vamos a verlo por aquí y c0 1 y dos y vamos a probarlo Bueno pues a continuación vamos a Bueno lo puedo ya quitar un segundin vamos a otra vez aquí el G cancelamos ahora lo abriremos venimos por aquí y bueno vamos a ver si nos da algún tipo de error Así que vamos a verlo consola le damos a jugar vale Voy a refrescar bien Voy a refrescar del todo porque yo juraría que me ha cogido el anterior Vale y contexto mapa colores get image Data no parece claro get image Data va con mayúsculas en funciones en la 107 get image Data la d con mayúsculas ponemos jugar y bueno si todo va bien sí que parece que está cogiendo los bueno los estos los correctos bien tenemos ya el pavimento tenemos ahí un jardín tenemos una calle tenemos un asfalto vale parece que está todo correcto tenemos ahí el final del escenario Ok Muy bien ahí yo juraría que el terreno no acaba ahí pero bueno no pasa nada vale Ahí tenemos una calle tenemos un personaje persiguiéndonos y ahora a continuación vamos a trabajar la parte de arquitectura del de este proyecto ya que bueno Pues he preparado una capa más con elementos arquitectónicos que a continuación vamos a poner los he dejado en una carpeta como arquitectura Hay un montón de ellos cargarlos va a ser un rato pero vamos a alinear vale pero básicamente voy a empezar cargando uno de ellos por lo menos pero básicamente pues corresponden a los elementos arquitectónicos de la casa Además he preparado dos versiones una de bloque alto y otra de bloque bajo ahora vamos a ver para qué sirven y eso nos permitirá que cuando estemos fuera de una casa veamos la casa cerrada pero cuando nos metamos dentro de una casa veamos por dentro vamos a verlo Entonces nos venimos por aquí nos venimos por aquí voy a condiciones iniciales bien en condiciones iniciales voy a empezar a cargar cosas así que bar bloque arquitectura y cómo lo voy a empezar pues lo voy a empezar por vamos a ver dónde está el bloque más sencillo simple un y simple dos vale simple 1 es igual a New image y bloque arquitectura simple es igual a arquitectura y simple un y ahora de la misma forma Pues voy a poner bloque ura simple dos cuidado con el bar esto no va simple dos bien Así que ahora además dentro de Lienzo mapa colores pues contexto mapa arquitectura Lienzo mapa arquitectura Y entonces ahora en la función de inicio siempre igual contexto mapa arquitectura draw image mapa arquitectura y vamos a verlo así que ahora me voy a estilo Lienzo mapa también arquitectura recargamos jugamos bien mapa en vamos a verlo aquí mapa arquitectura Y esto es porque en condiciones iniciales mapa colores mapa arquitectura mapa un cómo se llama se debe llamar mapa uno arquitectura Así que ahora sí recargo Y si todo va bien ahí tengo ya el mapa de arquitectura y por tanto empiezo a pintar desde el punto de vista en el que en la de funciones pues me vengo aquí en pinta terreno Y es donde voy a empezar a pintar por defecto voy a decir lo siguiente vamos a ver var Ray vale Aquí y ahora donde acaban los ifs digo bar array contexto mapa arquitectura es get image Data x y tal lo que sea bien Y entonces ahora digo si a raide de momento 3 es igual a 255 de momento ahora hablamos de ello contexto arquitectura contexto fondo no contexto fondo Sí ahí también contexto fondo yo juraría que sí es igual a bloque arquitectura bloque ya no sé bloque arquitectura simple uno vamos a verlo recargamos le damos a jugar vale vamos a verlo en principio no está saliendo nada igual es que lo está pintando no anchura dibujo Okay vamos a verlo anchura dibujo voy a decir console.log pintando para comprobar si de momento Es cierto que está cogiendo el dibujo le doy a jugar y pintando sí que 102 elementos me parecen pocos pero bueno sí que 102 elementos los está pintando okay Así que recargo por aquí bloque arquitectura simple vamos a verlo más altura bloque Z es un bloque grande son bloques grandes también lo tengo que decir esto es vamos a verlo anchura dibujo por tres y aquí voy a poner más 500 vamos a ver dónde lo pinta vale porque en alguna parte digo yo que en alguna parte lo estará pintando voy a decirle igual que lo quiero pintar en 700 guardo recargo y bueno en alguna parte deberían aparecer El caso es que 100 me parecen pocos para todo lo que hay ahí pero bueno altura bloque Z bloque arquitectura simple vamos a asegurarnos arquitectura simple 1. png arquitectura 1. png y luego el otro Es simple dos o sea que teóricamente sí que está bien vale pues en funciones voy a ir probando hasta que salga en la pantalla voy a hacer una cosa voy a hacer una cosa voy a comentar todo esto para forzar a que no salga nada forzar a que no pinte el terreno no y a ver si pinta los elementos arquitectónicos ahí está el problema no pinta nada no está pintando nada no está pintando nada bloque arquitectura simple lo está pintando voy a hacer una cosa con text fondo. drw image voy a pintarlo en 0,0 y a ver si así saca Ahí está de hecho lo está pintando de hecho lo está pintando parece que con el tamaño correcto pero sin embargo Entonces porque qué no pinta correctamente el bloque es curioso o sea lo que está pintando es eso okay Y por qué ISO x e ISO y no lo está pintando recargo juego Ah ahora sí aunque me da que igual no lo está pintando en el sitio correcto bien De momento En este caso lo importante es que aunque las paredes no están bien aunque están todas con el mismo giro Pero lo importante es que realmente aparte de que está matando ahí las ahí realmente a la casa se entra más o menos por aquí Ok Este es el pasillo ya hablaremos de delante y detrás pero bien en principio está representando bien por lo menos las paredes no sé por qué antes no ha funcionado Entonces quito esto igual es que no lo había cargado todavía no lo sé Ah interesante Ah muy bien muy bien o sea solo fun si le quito el 700 vale porque no era más 700 yo creo sino que era menos 700 - 700 porque no tengo que levantarlos O sea no tengo que bajarlos sin no subirlos esto ya es otra cosa Y entonces ahora puedo quitar esto puedo quitar el comentario recargo le doy a jugar vale Y esto ya empieza a salir claro ahora evidentemente tengo que cuadrar losos en el sitio hay un error parece vamos a verlo porque el juego se ha detenido Ah no ok No sé cuál es el motivo por el cual de repente han desaparecido los elementos arquitectónicos ha sido curioso bien y ahora los elementos deberían estar cuadrando con esa casa debajo Entonces vamos a verlo Ah claro nivel dos muy bien porque me he metido directamente con vale fantástico vamos a verlo y en principio Ahí está -700 parece demasiado fuerte vamos a poner men 100 con -1 no aparecen vamos a poner -2 ahí empiezan a aparecer - 300 vale llega un momento en el que ya aparecen correctamente no quiero vale aparecen correctamente en el sitio ya tengo una pared digamos Ya tengo la pared principal Bueno pues ahora lo que tengo que hacer es medir correctamente decirle al programa que mira correctamente cuándo pone una pared y cuando la pone la otra y cómo voy a hacer esto Bueno pues eso lo puedo hacer no va a ser fácil pero eso lo puedo hacer diciendo Bueno pues cuando tengas un píxel Mira a ver qué píxeles tienes al lado Entonces si el Pixel que tienes al lado es de tal tipo de tal otro pues en ese caso quiere decir que eres De tal tipo de pared o de tal otro tipo de pared vamos a analizar Cuál es la lógica en el siguiente vídeo y la implementamos Vale pues la lógica es la siguiente si por ejemplo Tengo este píxel de aquí y digo Bueno tengo que mirar todos los de alrededor y decir si el de arriba está ocupado si el de la derecha está ocupado pero el de arriba a la izquierda no está ocupado el de abajo a la derecha no está ocupado Eso quiere decir que eres de tipo tal de tipo l o de tipo Eh pues como te diría yo segmento recto o de tipo segmento vertical o de lo que sea entonces vamos a en primer lugar cargar las imágenes Eso sí porque eso lo tenemos que hacer Sí o sí ya habíamos hemos he empezado a cargar las imágenes por aquí así que bueno vamos a crear una plantilla Y empezamos a cargar bloque arquitectura simple esto es una plantilla esto ahora luego lo cambiaremos vale Y voy a cargar tengo los simples y tengo ls y tengo tes es deciro ls tes y Cruz De hecho tengo Cruz tengo ls tengo ts y ya está Vale pues voy a decir bloque arquitectura x esto es Cruz ahora tengo que agregar las cuatro ls y las cuatro ts Así que l1 esto es l1 dos 3 y 4 2s 3 y 4 2 3 y 4 y dos 3 y 4 Y por último voy a cargar las tes T T T y t bien entonces ahora como digo lo que tengo que hacer es eh mirar digamos Qué tienen los siguientes elementos entonces me voy aquí a funciones me voy donde estoy pintando la arquitectura Y entonces ahora voy a decir eh lo siguiente vamos a ver bar centro okay Y entonces digo bar arriba bar abajo bar derecha y bar izquierda muy bien Esto es arriba es y - 1 abajo es + 1 derecha es x + 1 e izquierda es x - 1 bien entonces yo ahora lo que voy a hacer es decir vamos a ver si centro es 255 vale Okay bien Esto está bien y ahora digo si centro No si arriba de3 es igual a 255 y es cierto que abajo de 3 es igual a 255 y es cierto que izquierda de 3 es igual a 255 y tamb Es cierto que derecha de TR es igual a 255 pues en ese caso tengo que pintar bloque arquitectura x es una x Porque si arriba abajo izquierda derecha tiene solidez es que es una esquina de X ahora voy a hacer lo mismo voy a decir si arriba es sólido abajo es sólido izquierda no es Sólido y derecha no es sólido es bloque arquitectura simple uno igual me equivoco Pero bueno y al revés c 255 es arquitectura simple dos vamos a verlo vamos a evaluarlo le doy a jugar bueno parece que he acertado Por casualidad el videojuego va lento está yendo Lento no pasa nada Ahora nos ocupamos de eso pero Eh sí que parece que por lo menos está yendo bien ay me he puesto contra el objetivo ahora trabajaremos para que no vaya lento pero por lo menos parece que los bloques simples los he acertado de casual idad y estoy buscando un bloque x estoy buscando un bloque x igual no tengo ningún bloque x estoy pensando igual Es cierto que no tengo ningún bloque x Bueno pues casualidad vale por lo menos veo ahí a las paredes Pues voy a hacer las tes y voy a hacer las ls pero en todo caso pues ya vemos como parece que la cosa está marchando correctamente Así que vengo por aquí vamos con las eles vamos con a poner comentarios bloques simples Así que estos son las test son cuatro test y las cuatro test son 2 5 25 2 55 0 255 y cuál me falta el segundo cero 250 255 Vale entonces esto es l1 no tengo ni idea de si voy a acertar ahora es imposible que acierte a Ojo si acierto me voy ya me voy a comprar lotería l4 vamos a recargar le doy a jugar e no las ha puesto no ha puesto ninguna vale bueno esto son las tes Ah ahí estoy viendo Ah claro l es que es T t y t vamos a verlo vale vamos con las tes bien efectivamente Hay una que está mal hay otra que no la ha puesto no sé por qué hay otra ahí que está mal vale Y hay algunas que no poniendo pero evidentemente estaba mal entonces yo creo que puedo saber cuál es cuál vamos a ver si abajo vamos a sacar los bloques vale Este es el de abajo cero abajo cer es t3 abajo cer es t3 Eso quiere decir que arriba cer es t1 arriba cer es t1 vale Y los otros cóm estaban vale también izquierda cero es t4 y el otro es T2 izquierda c Ah momentín no hay ninguna izquierda cero a este cu e izquierda cero es T2 vamos a verlo jugamos Okay parece que ahora está bien parece que ahora está bastante bien y nos faltan las l Así que si ya tenemos las tes pues vamos a por las eles Ok Vale entonces vamos a por las eles es 255 0 cero a ver no no esto no puede ser vale esto es arriba izquierda esto es arriba derecha ahora abajo izquierda y abajo derecha Okay ahora esto es l1 L2 bueno l lo que sea va a salir mal de nuevo le doy ahí a jugar okay Vale Hay una que ha salido bien De casualidad esta de aquí ha salido bien aquella de allá vamos a verla esa ha salido bien también de casualidad lo cual quiere decir hay una t mal pues bueno pues hay una l mal pero las demás están bien y hay una t que está mal vemos como por lo menos está empezando a aparecer lo que quiero vamos a ver otras casas vamos a ver cómo ahí en otras casas Sigue apareciendo bien vale Y siguiente cuestión Por cierto que el pavimento de la casa se suponía que es más clarito el pavimento de la casa se supone que es más clarito vamos a verlo vamos a ver bloque pavimento Ahí está bloque pavimento casa recargamos vemos que el juego se está ralentizando bastante Ahora sí con lo cual a continuación vamos a ver si podemos hacer que el juego vaya más rápido bien Voy a ocultar los Canvas Eso sí porque ya los tengo Así que display bueno y ahora la cuestión es que me está calculando las paredes de Trozos de escenario donde el personaje está lejos Si yo ahora vengo hago una inspección y en la inspección hago un análisis de rendimiento pues probablemente voy a ver que prácticamente estaré consumiendo todo el procesador y no es necesario entonces para ello lo que voy a hacer como digo es pues digamos el trozo de personaje que realmente esté cerca vamos a parar vamos a verlo ahora en un momento lo vamos a ver ya adelanto evidentemente que va a salir poco positivo y ahí lo tenemos prácticamente nos estamos cargando el rendimiento por esto que acabo de hacer por lo de la arquitectura Y esto es porque pues realmente no vale la pena eh calcular digamos cada uno de los bloques es que ahí lo vemos vale solo quiero calcular aquellos que realmente estén cerca y da la impresión de que está calculando Pues todos ahí cuidado da ahí la impresión de que está calculando todos los que haya entonces a continuación ahora a continuación veré si puedo realizar algún tipo de optimización vamos a verlo vale de momento estoy comprobando que puedo navegar ahora pondré Por cierto puertas y ventanas y tal que las tengo í preparadas pero de momento lo importante es ver como pues ya tenemos un escenario por el cual nos podemos mover vamos a ver sí correcto Bueno voy a poner las puertas y las ventanas en este caso la puerta de momento lo que voy a hacer es no poner nada Es decir en el elemento aquí la puerta es de color rojo Así que voy a hacer lo siguiente en funciones en los simples bloques simples voy a decir Pon eso Si arriba es esto vale blo arquitectura simple y voy a decir and centro de cer es igual a dos a cer no a 255 A ver es centro sí Y también es centro que también es cierto que centro de uno es igual a 0 Y es cierto que centro de dos es igual a cer A ver no un segundo Este es el bloque simple Vale entonces esto es puerta con lo cual me copio estos dos a ver momentín okay puerta así que claro realmente esto por aquí vale Y ahora si es cierto esto de aquí no pongas nada de momento okay Y ahora ventanas Vale ahora digo la ventana es de color verde y entonces digo y centro de cer es igual a 0 y centro de un es igual a 255 y centro de 2 es igual a 0 entonces voy a poner bloque H vamos a verlo bloque ventana un y ahora pongo esto mismo aquí a continuación Y esto es bloque arquitectura ventana dos Espero no haberme equivocado puede que sí Ahora lo veremos recargamos le damos a jugar hay un error vamos a ver cuál es al llegar a alguna ventana ha cometido un error bloque arquitectura ventana uno cómo se llama ese bloque Ah no lo he cargado Ah pues no lo he cargado Qué interesante bien pues Hola vale bloque arquitectura ventana uno y ventana dos lo copio lo llamo ventana uno y ventana dos bien y si todo ha ido bien jugamos y Vale y vamos a verlo a ver Bueno vamos a ver creo que ha puesto los dos bloques Y entonces le tengo que decir que cuando se encuentre un bloque de ventana no pinte pared y ahí ha puesto una puerta o sea en la puerta ha puesto una ventana vamos a verlo me voy a funciones y claro le digo donde pinta okay claro vamos a ver tengo que decirle que a continuación no es blanco los bloques simples vale y no es cierto vamos a ver y no es cierto esto no me lo va a dejar poner a ver que el bloque sea blanco a ver y centro de cero centro de un no es igual a o centro de un cer no de dos Perdón no es igual a 255 si todo esto ha ido bien lo pongo también por aquí y lo que estoy diciendo es que solo ponga en el caso de que sea pared vamos a ver vale vamos a verlo veo ahí algo raro está poniendo tes no sé por qué realmente centro de uno y centro de dos no sé por qué los pone los voy a quitar de momento a ver los voy a quitar de momento y ahora en el siguiente bloque de contenido los volveré a poner y analizaremos pues qué es lo que está ocurriendo de momento los tengo pintados dobles Vale pues voy a dejarlos así y así vamos implementando pues más funciones dentro del juego otra cosa que quiero hacer eh Por ejemplo es poner pues la misma lógica para crear las vallas que tiene cada uno de los terrenos con lo cual como nos podemos imaginar Pues procederemos igual que al crear las barreras digamos de los elementos pero en lugar de ser barreras blancas pues serán barreras de color verde pero por lo demás pues tampoco tendrán mucho misterio Bueno tengo por aquí una serie de archivos que pues en un momento dado he preparado vamos a verlos aquí esto no esto es otra cosa Vale videojuegos y vale aquí en arquitectura he creado un juego de sprites que son pues Cruz uno si esta es la cruz Esta es la cruz uno es decir de altura completa si esta es la l pues la l1 es decir el juego de parámetros de altura completa los he intentado nombrar todos como Pues lo mismo con el uno puerta claro puerta Antes no tenía puerta porque no tenía sentido esto es un poco lo de menos simple 1 y simple 2 1 Ahora sí vale Y yo podría por ejemplo ahora venir al editor venir al código y podría cambiar unos por otros pero claro No quiero esto por la sencilla razón vamos a cerrar un poco Esto vale vamos a ver esto a ver vale bueno Vamos allá vamos a sacar el código vamos al archivo Dónde está js aquí lo tenemos bien entonces yo podría venir a condiciones iniciales y podría eliminar digamos los elementos pero no lo quiero porque entonces no vería correctamente dentro de la casa cuando el personaje entrara porque las paredes serían demasiado grandes lo que voy a hacer Es que voy a duplicar todos estos bloques vamos a ver y simple alto alto alto todo Salto y alto también Pongo aquí en el source alto es decir cargo nuevas imágenes y ahora aquí pues pongo simple gu un es decir como se llaman las imágenes realmente y ahora lo que voy a hacer es que cuando yo esté en el o sea cuando los elementos estén cerca de mí cuando estén cerca de la pantalla lo que quiero es que se muestren unos y cuando estén periféricos a la pantalla quiero que se muestren otros cómo lo voy a hacer pues me voy a ir a funciones y vamos con los bloques simples Vamos allá esto es el la puerta la ventana esto es cuál el bloque arquitectura en x bloque n x y entonces voy a decir lo siguiente si vamos a ver si ISO x del desfase si ISO x del desfase Es mayor que anchura navegador por 0.25 o la ISO x es mayor menor que esto por 0.75 o bien la is o y es mayor que altura navegador por 0.25 o la ISO y es menor que altura navegador por 0.75 en ese caso dibújame una cosa en caso contrario dibújame la otra es decir lo que va a hacer en este caso es dibujar la que toca vamos a hacerlo vamos a hacer esto vamos a hacer el els vacío voy a copiar esto por todas partes Así que bloques simples la puerta nada la ventana voy copiándolo y pegándolo en cada uno de ellos la t y la t ahora las eles muy bien Ahora voy a pegar los els no nos olvidemos aquí y aquí este bloque els lo pego aquí lo voy pegando en todos y cada uno de ellos hay que tener mucho cuidado porque las probabilidades de fallo son grandes bien entonces si este código ha ido bien No lo sé vamos a verlo en principio Ahora solo va a pintar los bloques que estén en el centro más o menos en el centro de la pantalla no carga Nada entiendo que debe haber habido algún error vamos a verlo funciones 171 vamos a ver Ah bloque en x me falta un comentario bien Vamos a ver hago esto grande condiciones iniciales línea 82 no puede encontrar vale línea 82 l1 1 Vamos a ver cómo se llama ese elemento arquitectura l1 1 porque dice que no lo puede encontrar l1 1.png en la línea 82 l1-1-0.dll Au vale Bueno aparte de que he cambiado todos y no quería bien Ahora guardo l 82 sigue sin encontrar el source vale porque también he cambiado estos me he venido muy arriba cambiando elementos y he cambiado más de los que debía muy bien ya está vamos a verlo ahora le doy a jugar vale Y bueno en principio me está pintando todos Vale cuando solo quería que me pintaran los del centro de la pantalla voy a recargar todo con fuerza para asegurarme de que está cargando realmente lo que debe y ahora vamos aquí a funciones y Vamos a repasar vamos a ver ah no sí sí anchura navegador vamos a ver si es son las anchura navegador correcto o ISO y es mayor Vale Voy a repasar el código y a ver dónde está el error Claro ya veo lo que está ocurriendo Entonces Con este código que tengo ahora mismo en la pantalla esto es menor esto es mayor esto es menor esto es mayor voy a reestructurar menor Mayor igual a cabo antes copiando y pegando Porque esa estructura siempre da verdadera me está dando a mí y si siempre da verdadera pues nunca ejecuta el efecto que quiero ver en pantalla y es que solo dibuje lo del centro o lo de la periferia guardo recargo por aquí bien sigue dibujando y es curioso porque si sigue dibujando es porque da true y eso me extraña una barbaridad me extraña una barbaridad que de true cuando Si antes daba true es que ahora tiene que dar F así que bueno vamos a ver más desfase x navegador por 025 voy a hacer diferentes pruebas con el If hasta que consigue hasta que consiga el aquel que esté afinado para lo que yo quiero Vale ahora así con esta estructura lógica vamos a verlo ahí vale con esta estructura lógica lo que está ocurriendo es que cuando está alejado ahí lo vemos vale lo que he hecho con esta estructura lógica es decirle que si es cierto una de estas dos cosas y es cierta otra de estas dos cosas en ese caso pinta Así que ahora voy a poner el caso els voy a poner el caso els y luego en el caso true e cuidado cuid no para Vale tengo que copiar este aquí copio este aquí voy copiando a cada uno porque estaba copiando a Ob bestia al primero vale Y ahora en el caso true voy a poner cada uno de los bloques Vamos allá muy bien Esto es bloque arquitectura x a era xa le había puesto una a Sí entonces simple 1 a simple 2a ventana 1a do a t4 t3 T2 eso no puede ser pero bueno ya hablaremos de ello l4 l3 L2 y L2 Tampoco puede ser Okay si todo va bien recargo le doy a jugar y en principio ahora veremos como pues aquellos elementos que están más alejados vamos a verlo aquellos elementos que están más alejados pues los pintag grandes digamos y aquellos elementos que están más cercanos Pues los pinta más pequeños ahí hay hace extraños vale hace un poco un extraño No pasa nada más o menos empieza a funcionar y bueno ahora analizaremos lo que importa es que cuando me acerque al interior de la casa pues las paredes se vayan reconstruyendo como ya digo hace extraños con lo cual tengo que ver un poco tal pero por lo menos ya estamos viendo que cuando estoy dentro de una casa pues quita las paredes y cuando me voy alejando pues ponen las paredes que es un poco el objetivo de todo esto luego otra cosa que quiero otra cosa que quiero es que quiero poner techo V he preparado unos techos Entonces vamos a verlos los techos en este caso los tengo Dentro de este Sprite llamado techo pero lo cierto es que este Sprite voy a abrir el gimp requeriría hacer una nueva capa porque claro Dónde pongo techo pues tengo que especificarlo así que voy a crear una nueva capa la voy a llamar techos y ahora pues voy a empezar a trabajarlo por aquí Así que pincho por aquí voy a sacar el terreno lo pinto de blanco y ahora pues bueno puedo por ejemplo duplicar la capa me la llevo aquí tiramos hacia abajo duplicamos me lo sigo llevando tiramos hacia abajo vaya Dónde está la varita mágica copio y pego me lo llevo muy bien tiro para abajo selecciono copio y pego giro 90 gr técnicamente no hace falta me lo llevo hacia abajo duplico Okay tiro hacia abajo duplico un par de veces vale Y ya está me puedo exportar esto con mapa un techos exporto y me voy al código a ampliarlo así que vengo por aquí y digo lo siguiente vamos a el Index vamos a ver dónde tenemos el Index Y entonces digo lo siguiente Lienzo mapac colores Lienzo mapa techos o techos bueno techos me voy a condiciones iniciales contexto mapa techos Lienzo mapa techos vamos a ver mapa props mapa personajes mapa arquitectura mapa techos mapa un techos si no lo he guardado incorrectamente mapas mapa un techos me voy a contexto mapa techos píntame los techos y ahora siempre que haya algo que pintar en funciones en el terreno vamos a ver bloque acera correcto y ahora digo bar techo es igual a contexto mapa techos get image Data de tal y digo si es cierto que techo de Alfa Es decir de 3 es igual a 255 en ese caso píntame un he técnicamente esto debería hacerlo Después de todas las paredes entonces voy a hacerlo así cuando acaba save cuando acaba sa me vengo aquí y digo Si techo tresal en ese caso dibujo el fondo dibujo bloque techo y ya está vamos a ver si ha funcionado recargamos cuidado porque tengo que hacerlo de ISO qué ha pasado algo ha pasado vamos a verlo bloque techo is not Define muy bien entonces vengo por aquí a condiciones iniciales y bloque techo es bloque techo muy bien recargamos vale técnicamente me pinta todos los techos ahí se ve como ahí se ve como lo del navegador no está funcionando muy allá pero bueno no pasa nada lo que me importa es que lo que quiero es que cuando me acerque quite los techos vale Y le voy a decir al sistema vemos ahí que tengo el techo de la casa le voy a decir al sistema que quiero que eso esté dentro de un condicional Así que si el ISO es esto en ese caso pasa esto recargo y ahora en principio solo va a pintar los techos en aquellas partes del edificio que estén lejanas vemos como ahí tenemos los techos y vemos como poco a poco se van quitando conforme me voy acercando para dejar ver el interior de la casa ya digo que no está funcionando todo lo bien que debería pero por lo menos está empezando a funcionar y ahora a continuación pues ya afinar en la lógica condicional pero por lo menos como digo lo que me importa es que lo que quiero es que cuando me acerque dentro de una casa me deje ver dentro de la casa y cuando me aleje pues ya evidentemente cubra la casa Así que con esto por lo menos tengo para ir empezando 025 y 05 bueno podríamos pensar si es suficiente o no pero vamos de momento tenemos eso y por lo menos Tengo suficiente para ir avanzando ahora lo que quiero ahora lo que voy a hacer es poner diferentes personajes vamos a poner diferentes personajes y para ello lo que haré es utilizar la herramienta que creamos anteriormente de configurar personajes bien pues ahora Bueno me voy a dejar los personajes cubo un poco por ahí sueltos porque lo que quiero es crear una serie de personajes con el configurador anteriormente utilizamos el configurador para poder personalizar nosotros los elementos del personaje pero sin embargo lo que voy a hacer ahora es eh decirle al sistema que quiero que lo haga el propio Sistema o sea voy a hacer una segunda versión del configurador para no machacar la que tengo porque la que tengo Está bien es Para dejarle al usuario que se haga su propio personaje pero yo no quiero eso yo lo que quiero es eh que cree múltiples personajes Así que el configurador lo voy a copiar y pegar voy a llamarlo autoconfigurado y vamos a editar este archivo de hecho en un solo archivo ahí lo tenemos todo y lo voy a llamar autoconfigurado muy bien Nada más empezar vemos como tenía vamos a verlo por aquí tenía un change y en el change lo que hacía era ejecutar realmente la función voy a decir lo siguiente Y es que no quiero que la ejecute en el change quiero que la ejecute en el document punto ready y lo que va a hacer en este caso es que va a crear el personaje vamos a verlo momento a ver console y console pun log funcionando guardo recargo bien funcionando pero no está no ha seleccionado nada Ah y inicio No sí okay vale Y si cambio algo vale vamos a ver por qué bucle en 1000 función inicio voy a hacer console.log Hola y vamos a confirmar si está funcionando o no Hola está funcionando vale Bueno pues entonces voy a crear la función pinta va a hacer todo esto cuidado que me falta un paréntesis y ahora entonces voy a decirle aquí se ve que me he dejado Esto vale esto aquí okay vale Okay esto fuera esto dentro no quiero realmente no me hace falta el bucle así que pinta vamos a verlo en la 102 y me hace falta esto y esto sobra vamos a verlo vale Voy a pintar set Time out function esto en 5 segundos y pinta vamos a dejarle 5 segundos y lo que quiero es que el programa coja automáticamente parámetros y pinte y ahí lo tenemos vale no sé por qué De hecho empieza Ah con el bucle Ok Vale ahora lo que quiero es que el programa digamos cada x segundos vamos a verlo por aquí ahora a los 15 segundos le voy a decir Windows location es igual a window location lo que va a hacer es cargar la página y ahora lo más interesante es que cada vez que carga la página quiero que ponga unos valores aleatorios en los colores vamos a verlo ahora esperamos 10 segundos más y si nos fijamos Y si nos fijamos ahora recarga el personaje espera 5 segundos carga el personaje Lo pone a animar y unos segundos después vuelve bien ya tengo el auto configurador ahora lo que quiero es darle una serie de valores personalizados voy a ver si me deja trabajar con rgbs y esto lo voy a ver aquí value rgb voy a poner 200,0 255 0,0 Voy a ver si el input me deja Aquí está es el problema Se requiere rgb con lo cual voy a tener que convertir voy a tener que convertir a ex decimal Ahí me lo pone negro evidentemente no pasa nada bueno pues fácilmente puedo encontrar por aquí javascript rgb to x y encontraré alguna función a muchas de hecho funciones en internet para vamos a ver component rgb tox pues esta mismo Ah mira directamente Ah falta fantástico aquí Entonces vamos a ver voy a poner estas dos funciones por aquí y entonces ahora lo que voy a hacer es lo siguiente Dónde está inicio muy bien digo bar r es igual bar r qué r pelo es igual a math punto round de ma. Random multiplicado por 255 y hago lo mismo para todos y cada uno de los colores G pelo B pelo Lo mismo para pantalones G pantalones B pantalones r camiseta G camiseta B camiseta piel r piel G piel B piel r cara no la cara siempre va a ser de color negro r pies G pies B pies y la sombra se queda igual vale Muy bien Entonces ahora lo que voy a hacer es decirle al sistema que en el selector color pelo selecciono color pelo punto atributo color creo que es color no punto B y entonces utilizo esta función rgb tux que es r pelo G pelo y b pelo vamos a probarlo recargamos de nuevo en la línea 22 22 Sí vale Ah bueno amarillo Ahora sí vale ahora el personaje va a tener el pelo amarillo ahora recargamos negro vale o azul parece azul De hecho voy a hacerlo un poco más grande Efectivamente es azul así que bueno ahora voy a hacer lo mismo con el resto de colores es decir primer paso lo que queremos es que el programa cree automáticamente personajes aparte de que yo le proporcione al usuario la capacidad de personalizarlo pero lo que quiero es que el propio sistema genere un número prácticamente ilimitado de personajes ahora aplicamos Lo mismo para el resto de elementos color pantalones es r pantalones G pantalones B pantalones color camiseta es r camiseta G camiseta B camiseta color piel r piel G piel B piel y color pies color zapatillas es r pies G pies B pies con esto en la pantalla al menos vamos a tener un número prácticamente ilimitado de personajes ahí lo vemos como el sistema ha generado un personaje que parece más Marciano que otra cosa pero bueno Esta es un poco la gracia de momento este va a parecer más Marciano todavía no pasa nada perfecto y ahora lo que quiero vamos a verlo Vale ahora lo que quiero es que el sistema cuando genera esto cuando genera cada personaje lo guarde Esto va a ser más difícil desde el punto de vista desde que desde javascript no puedo guardar un personaje automáticamente Vale tengo que contar con algún tipo de programación del lado del servidor Así que eso voy a hacer lo que voy a hacer es guardar todo este o sea todo este bloque mediante la tecnología Ajax a un elemento dentro del serv Así que vamos a buscarlo vamos a por ello y vamos a ver p html5 Canvas save to png Ajax php aquí vale Y en este caso vamos a verlo pues mismamente Vale entonces save image esto lo voy a poner por aquí abajo Esto está guardando un elemento Canvas qué Canvas pues Canvas es a ver fusión bar Canvas guardar es igual a document punto fusión de todo Ahí está y por tanto aquí pongo Canvas guardar llamo a test saave php luego tengo que crear ese archivo lo guardo dentro de videojuegos como test.php le pongo ese código que en principio podría lo quiero guardar dentro de img dentro de person y con el nombre personaje y el código utc de hoy el unix la época unix Así que digo date u si todo va bien Vamos a verlo y no da error que puede que sí vale tengo el personaje claro cuidado tengo que ejecutar la función Así que save image Vale y vamos a ver antes de irnos hacemos esto vamos a hacerlo vamos a ver si se guarda igual tengo que decirle que no lo haga tan rápido vamos a verlo me voy a personajes y Bueno tengo ahí un personaje ha vuelto a cargar la pantalla voy a hacer lo siguiente en el código voy a decirle un Time out de 10 segundos para guardar la imagen y así le doy tiempo de sobra vamos a ver test save conso log muy bien vale en principio por aquí debería guardar la imagen algún momento Aquí está OK vale pero es un Warning No es otra cosa y si todo ha ido bien no img vamos a verlo lo guarda en img personajes personaje en principio no eco Ok 24 y voy a ver si 24 es sole eso es vamos a esperar a que recargue y a ver si ahora al recargar pues ya me da el resultado final vamos a ver un segundo voy a recargar vale Ahí está el personaje ahora debe aparecer la petición Ajax vale no está devolviendo nada no está devolviendo nada no está guardando nada vamos a ver si vuelve yo juraría que de hecho no está recargando y correcto vale correcto esto es window pun location es igual a window pun Location esto lo ejecutamos después de 20 vamos a ejecutarlo entonces ahí lo que va a hacer ahora es vale dibujar al personaje ahora el Ajax Vale ahora recargar vuelve a poner personaje vuelve a hacer Ajax vale Y bueno ahora cargará en un momento dado calculo espero Supongo vamos a editar el código php porque aquí seguimos teniendo los mismos personajes el php guarda en img es personaje pero no está guardando así que bueno vamos a verlo vamos a ver vale voy a probar este vale Data URL Canvas que recordemos que es Canvas guardar Script php que es test pun php y vamos a ver y vamos allá post Data vale String replace lo guardamos como img personajes personaje date u y vamos a verlo recargamos vamos a ver el personaje a continuación saldrá Bueno creo que ahora no va a salir el Ajax de hecho cons sola log safed vale Y ahora veremos si es cierto que lo ha guardado recarga y en principio parece que no bueno personajes personaje Vale pues voy a probarlo saved voy a probar editar el código y ahora vemos que puede haber sido y al acabar esta parte de la programación veremos como Pues poco a poco van a ir apareciendo nuevos personajes en la carpeta y por cada una de las veces que el sistema guarde un personaje pues aparecerá un nuevo archivo png que tendremos disponible para utilizar de esta forma más adelante en el videojuego vamos a poder tener tantos personajes como queramos Pero lo bueno es que los personajes nos los va a crear automáticamente y por combinación aleatoria el propio sistema vamos a ver ahí y