trabajar con múltiples procesos tiene sus cosas tiene sus particularidades como que por ejemplo cada proceso es un mundo diferente vamos a guardar este proyecto como index 5 voy a guardar tarea 2 como tarea 5 y así un poco la idea es buscar una consonancia en la numeración de las tareas y con esto voy a demostrar lo siguiente voy a index 5 y por ejemplo por aquí voy a crear una variable bar es igual a 43 por ejemplo entonces si yo he creado una variable lo que voy a hacer a continuación es meterme en la tarea 5 por cierto me voy a meter en la tarea y en la tarea voy a decir con solé punto de ojo edad tu edad es dos puntos más edad si ahora ejecutó esto si ahora ejecutó esta este código vamos a ver los procesos index 5 inspección con solá bien vemos que en este caso buena parte de que he hecho no sé cuántos procesos he hecho 100 voy a hacer no sé qué hacer bueno número de núcleos y así vamos sobre el seguro ponemos lo que ocurre en pantalla es que nos dice que eran is not the file el aris notifight lo cual quiere decir que yo haya declarado una variable aquí no quiere decir en absoluto más bien al contrario que la variable sea visible dentro de la tarea entonces como puedo hacer que la variable sea visible que los datos viajen de una parte a otra pues los tengo que pasar como datos así que a continuación me voy a quedar y digo quiero vamos a ver quiero 2006 donde estamos aquí pues message y lo que voy a hacer es que en lugar de pasar un mensaje que no tiene ningún valor en cuanto a datos que es comienza pues lo que voy a pasar la edad entonces vengo por aquí ahora me voy a tarea 5 js recojo los datos y en lugar de decir con sole punto la edad es lo que sea voy a decir con sole punto los datos a ver qué sale así que recargo por aquí y nos dice en este caso que tenemos unos datos tenemos un dato que es 43 y entonces me dice y entonces me dice puedo pasar por cierto un json puedo pasar cosas tu edad es edad punto no datos punto dato que ahora vengo por aquí y me dice tu edad es 43 esto por supuesto no ha hecho que la variable sea visible dentro del worker porque eso no se puede hacer pero sí que por lo menos lo que ha hecho es pasarle el dato al worker y así el worker puede trabajar con el dato le podemos pasar datos al worker el worker puede trabajar con sus propios datos dentro del worker podemos hacer un poco lo que queramos hay ciertas limitaciones evidentemente eso sí pero en definitiva siempre por eso no podemos pasar de todo no podemos pasar datos gráficos por ejemplo porque el worker no soporta un contexto gráfico ahora lo comprobaremos pero en definitiva hay cosas que sí que podemos hacer vamos a hacer a otra ahora otra demostración dónde vamos a pasar un pequeño json porque qué es lo que ocurriría si quisiéramos pasar pues múltiples datos pues podríamos pasarlos como j son entonces por ejemplo pongo por aquí javascript simple el j son voy a hacer una jota son pequeñito bueno uno pequeñito como éste vale pero no esto evidentemente ahora veremos entonces yo me voy a index 5 y quiere decirle qué edad es igual a 3 y nombre es igual a jose vicente entonces en este caso voy a decir que bajar json es igual voy a hacer un objeto realmente y voy a hacer qué edad vamos a ver edad es 2 puntos 43 un hombre es con su vierte podría haberlo puesto directamente con las variables pero bueno entonces ahora lo que voy a hacer voy a recargar o tengo de momento lo mismo pero lo que voy a hacer en este caso ahora es pasar el jota son entonces en el post message paso en lugar de la edad pasó directamente el jota son en la tarea 5 voy a matar un momento esto quiero sólo los datos así que recargó y si nos fijamos en los datos tenemos aquí en el data tenemos aquí que ha pasado correctamente pues los datos tenemos edad 45 y tenemos nombre josé vicente vemos como han pasado como datos independientes y entonces yo ahora puedo por ejemplo decir lo siguiente puedo decir tu edad es datos puntos de alta apuntó edad y con solo un tono tu nombre es datos data punto nombre así que guardamos y recargamos y nos dice tu edad es 45 tu nombre es josé vicente en definitiva vemos cómo podemos pasar datos es decir los datos no son transparentes de una parte a otra del programa pero las funciones de un mes hate y las funciones de post message soportan el base de datos de una parte a otra y soportan tanto el pase de datos en formato sencillo como en formato de objeto como en definitiva en cualquier otro formato y eso en definitiva como digo nos abre muchísimo las puertas para poder realizar múltiples tipos de cálculos cómo vamos a poder ver cómo vamos a ver a continuación un ejemplo clásico de trabajo con múltiples procesos y con múltiples núcleos es el tratamiento de imágenes más que nada porque para demostrar el uso de procesos siempre tenemos que buscar escenarios complejos tenemos que buscar escenarios que computacionalmente sean complejos y sean intensos y un ejemplo es el tratamiento de imágenes entonces yo voy a abrir el gimp el quimbo cualquier otro programa de edición de imágenes voy a abrir una fotografía vamos a verla vale voy a abrir una fotografía vamos a escritorio no vamos a vaya vamos a volver a los datos vamos a mis fotos más fotos yo vamos a una de éstas por ejemplo está la vamos a recortar ok la quiere rotar vamos a recortar el trozo que me interesa bien y supongamos que quiero realizar una serie de filtros de la serie de operaciones como por ejemplo difuminar como por ejemplo buscar bordes como por ejemplo lo que sea tengamos en cuenta que esta imagen tiene 3500 píxeles x 4 mil 200 píxeles eso quiere decir que esta imagen ahora mismo tres mil 536 x 4.208 tiene 14 millones de píxeles eso quiere decir que si yo ahora por ejemplo hago un software que tenga que realizar operaciones sobre esta imagen va a ser un software que como mínimo sólo con que realice una operación con cada pixel y ya va a tener que realizar 14 casi 15 millones de operaciones entonces por eso digo que el trabajo con imágenes es un trabajo clásico digamos de distribución en múltiples procesadores es un trabajo donde realmente se agradece se aprecia en varios procesadores a nuestra disposición bueno voy a cargar alguna imagen por tanto voy a crear una imagen en la que salga favorecido a ver el momento fotos yo digo lo hizo yo de scarpetta habrá alguna que esté bien por el momento permitidme el momento qué guapo esto ya está apañado pues voy a esa fotografía vamos a ver si quiero rotar voy a prepararla un poco voy a recortarla con un dónde estás recorte no veo el recorte asiste estará por aquí escondido ahí bien en proporción 1 a 1 voy a quedarme con ese trozo de la imagen y ahora lo que voy a hacer es que bueno esta imagen tiene tres mil doscientos ochenta voy a bajarla pero no demasiado entonces voy a aquí perdón a imagen voy a tamaño de la imagen escalar la imagen voy a hacer 2048 un número redondo digamos hablando refiriéndome a potencias de 2 les voy a escalar vale entonces ahora guardo esta imagen la guardó en vamos a verlo en applications la guardo en mano la guardo en hd docs la guardo en procesos y voy a guardarla como pues josé vicente punto jpg estamos hablando de una imagen que al final tiene aquí exportar una imagen que tiene una vez más calculadora 2048 x 2048 tiene 4 millones de píxeles y por tanto 4 millones de operaciones y eso que ahora haré también operaciones que serán más complejas todavía es decir operaciones que involucran a más de un píxel entonces ahora lo que voy a hacer es que voy a crear un archivo llamado index 5 puntos html no index 6 perdón html y en esta en este archivo lo que voy a hacer es crear la estructura básica bien voy a crear un canvas esto va a ser y del lienzo y voy a decir el sistema que wifi es igual a 2.048 height es igual a 2048 estamos hablando de una imagen que ocupa 12 megas sea ese es una imagen grande digamos y entonces digo bar contexto vamos a verlo por aquí momento que mi texto bar contexto es igual el documento del elemento baile y punto get contexto 2 de esto está mal porque debería estar haciéndolo dentro de la etiqueta script así que ahora sí y contextos de y ahora lo que hago es descargar la imagen bar foto es igual a new image y photo src es igual a jose vicente jp bien me espera un segundo set time out podría decirle que también cuando la foto carga out función y esto lo quiero en dos segundos entonces quiero contexto punto draw image y quiero dibujar la foto en 0,0 si esto ha ido bien cargo index 6 y como digo la imagen está aquí cargada voy a quitar momento de esto luego bien iremos a esto voy a hacer menos zoom y observo que básicamente lo que he hecho es pintar la imagen he dibujado la imagen en este lienzo de 2048 x 2048 es decir he pintado una imagen de 2048 x 2048 en un lienzo de 2048 x 2048 hasta aquí no hay mucho misterio pero lo bueno va a venir en lo que vamos a hacer ahora que va a ser básicamente empezar a tratar la imagen a continuación por tanto una vez que hemos dibujado el lienzo lo que voy a hacer es hacer alguna operación con el lienzo entonces yo digo lo siguiente var píxeles es igual a contexto punto get image data y quiero los datos desde 00 hasta 2048 es decir que estoy cogiendo todo el pack de píxeles y entonces ahora lo que voy a hacer ahora lo que va a ocurrir es que voy a empezar a trabajar con la imagen vale voy a empezar a como diría yo hacer cosas con la imagen en este caso tengamos en cuenta que por cierto que voy a poner buenos píxeles ahora voy a hacer un bucle foro para recorrer la imagen tengamos en cuenta que la imagen está compuesta por el array que he creado está compuesto por bloques de cuatro cada bloque de cuatro datos representa un píxel y esos cuatro datos son rojo verde azul y transparencia entonces digo formar y es igual a cero y es menor que píxeles punto data punto link y voy a decir y más igual a 4 porque como digo lo que quiero hacer es ir píxel a píxel este bloque de contenido lo que hace es ir píxel a píxel lo que voy a hacer también evidentemente es como este código ya se va a empezar a complicar es empezar a comentar poco a poco el código entonces vengo por aquí y vigo y digo cargamos el contexto de la imagen en una variable y entonces vengo por aquí voy a comentar creamos un nuevo objeto de tipo imagen tengo por aquí le indicamos cuál es el archivo informático al que corresponde esa imagen por aquí ejecutó una función con cierto retraso para darle tiempo al programa a cargar la imagen bien cuidado con esto porque se nos va y dibujo la imagen en el lienzo y ahora aquí lo que hago realmente es atrapó todos los otros de la imagen en una matriz realmente es un objeto pero bueno más que una colección y ahora recorro esa imagen cada cuatro bloques porque cuatro piezas de contenido representan a un píxel y hasta ahora configurar el bracket para que no salte de línea en cada uno de los elementos pero ahora mismo no lo veo por aquí no pasará para pasar por aquí cerramos por aquí y cerramos atrás vale ahora a continuación para a continuación lo que hago es decir lo siguiente vamos a ver digo píxeles punto data esto es el color rojo es igual a 0 no es igual a 255 menos píxeles punto de atades o sea lo que estoy haciendo es invertirlo ahora veremos y uno y más dos aquí lo que estoy haciendo como digo es invierto el canal rojo de la imagen invierto el canal verde de la imagen y yo aquí invierto el canal azul de la imagen tengamos en cuenta que para esto que para que esto funcionará correctamente debería también el elemento 3 pero no lo estoy cogiendo porque es la transparencia y no quiero invertir la transparencia sólo quiero invertir los colores entonces ahora lo que voy a hacer es volver aquí no aquí vamos a verlo por aquí a mentir vale entonces morentín esto por aquí volvemos a la imagen ahora también lo que podemos hacer es decirle al body con una etiqueta está el decirle al body que robin text align centre más que nada para que wow así más que nada para que me centre la imagen bien ya he invertido los píxeles pero en ningún momento estoy poniendo los píxeles de vuelta en la imagen así que vengo por aquí y digo el contexto punto put email data y le digo que pongo la imagen pongo píxeles en 0,0 recargamos por aquí y esperamos un momento y como podemos comprobar en la pantalla lo que ha hecho el programa es invertir la imagen y sobre todo invierte la imagen tras haber realizado en este caso pues la operación con los píxeles voy a comentar este código y digo por último ponemos la imagen de vuelta dentro del lienzo cuando digo de vuelta quiero decir después de haber procesado los píxeles así que voy a utilizar voy a aprovechar información de proyectos anteriores para ver digamos cuánto es el tiempo que tardó en realizar esta operación para ello puedo reutilizar vamos a ver esto ha sido en index 1 creo recordar vamos a verlo en el tiempo de inicio en index 6 aquí lo pongo técnicamente aquí ahora cálculo el tiempo final en images y por último hago un consuele punto lo del tiempo comenzamos calculó el tiempo de inicio y lo pongo en una variable calculó el tiempo de finalización y lo pongo en otra variable muestro por pantalla la diferencia entre los tiempos de inicio y los tiempos de finalización así es que si todo ha ido bien vamos a poner esto en un lateral aunque eso es un poco de menos pongo por aquí la consola recargo la pantalla y nos dice en este caso que el tiempo requerido para calcular este programa ha sido de 303 milisegundos eso quiere decir que flórez un tercio del segundo algo es algo y ojo que esta es una operación muy sencilla desde el punto de vista en el que sólo incluye a un píxel pero si por ejemplo hago otra operación más compleja vamos a hacerlo ahora a continuación que incluya a más píxeles pues veremos como el tiempo en este caso será mayor voy a programar a continuación un pequeño método de cálculo sobre la imagen que se llama busca bordes lo que va a hacer es buscar los bordes y básicamente pues lo que va a hacer es detectar si hay bordes digamos con respecto a la imagen o si lo que tiene son colores sólidos para ello tendremos que hacer que cada pixel se fije en los píxeles vecinos y esto evidentemente lo que va a hacer es que el programa tarde más y por tanto nos introducirá este problema que tendremos que solucionar mediante un cálculo pues dividido digamos entre diferentes procesadores vamos a por ello bien pues a continuación lo que voy a hacer ahora es decirle al sistema vamos a ver en team voy a decirle al sistema que por cierto vale voy a decirle al sistema que quiero crear una función que básicamente lo que haga es fijarse en los píxeles vecinos entonces esta es la función que recorre píxel a píxel voy a borrar esto si quieres lo voy a guardar como index 7 y así no perdemos ningún ejercicio elimino esto se ha quedado guardado en index 6 ahora mismo estoy en index 7 y píxel a píxel lo que voy a hacer es generar un cuadrado vamos a decir lo siguiente bar anchura y esto lo que va a hacer es pues mirar digamos cuánto aquí realmente lo que voy a hacer calce pensando pierre anchura es igual a por ejemplo 4 y esto es una variable esta variable va a almacenar la anchura del cuadrado de comparación y entonces eso quiere decir que yo ahora voy a otro sub cuadrado entonces ahora vengo y digo lo siguiente bar su cuadrado es igual a contexto punto que image data y necesito averiguar cuál es el pixel digamos así que bueno para este caso lo que puedo hacer vamos a verlo lo que puedo hacer es lo siguiente pero por para x es igual a 0 x es menor a 2048 x + + y ahora digo lo mismo para allí y pues ahora lo que quiero esto es la y ahora lo que quiero es dar su cuadrado es igual a contexto punto get emails dato desde x menos anchura y menos anchura hasta anchura por 2 y anchura por 2 lo que va a hacer es un cuadradito de la imagen esta variable ya no me interesa al mismo menos y entonces ahora lo que quiero hacer es comparar cada uno de los valores cada uno de los valores quiero ver si los píxeles son iguales o son diferentes o como son para ello ahora sí tengo que por bar es igual a cero y es menor que es un cuadrado punto de alta punto links y más y ahora como digo lo que voy a hacer es editar voy a empezar a trabajar con la información de cada uno de los píxeles y lo que tengo que hacer básicamente es mirar cuál es la información del centro con respecto a la información de los bordes esto qué quiere decir bueno pues esto lo que quiere decir es que si yo vengo por aquí voy a decir bar centro es igual al contexto que ti mislata dx y 1 y entonces le digo bar centro rojo es igual a centro tercero bar centro el verde es igual al centro de 1 y bar centro azul es igual al centro ahora como digo lo que voy a tener que hacer es comparar ese píxel con el resto de píxeles que tenemos en la contornada y entonces voy a decir lo siguiente bart borde es igual a folks voy a decir que no hay ningún borde y entonces digo qué centro r voy a hacerlo por rojos en este caso si centro r si el valor absoluto perdón si el valor absoluto del centro r - menos un cuadrado es el rojo es menor o es mayor que 50 en ese caso voy a decir que borde no volver sino borde es igual a otro y por tanto lo que haré en este caso es decirle al sistema que quiero pintar digamos un borde quiero indicar que existen un borde para eso voy a crear otro lienzo será bueno que cree otro lienzo de destino voy a el contexto del cielo del lienzo de destino contexto destino y en su destino y entonces voy a por aquí bar datos destino es igual contexto destino punto getty image dato de 0 a 2.048 2048 y entonces hago lo siguiente borde es igual a folk se va a pasar una cosa si no va a pasar otra y lo que va a pasar es lo siguiente lo que va a pasar es que contexto destino punto vamos a ver punto dónde estás punto no datos destino perdón datos destino punto data haber un segundo claro porque tengo que pintar ok contexto destino punto field style es igual a black phil recta voy a pintar un cuadrado en x y como 11 y entonces en caso contrario voy a poner esto de color white y datos destino contexto destino fiel recto si todo ha ido bien ahora comento este código evidentemente pero si todo ha ido bien lo que va a ocurrir en la pantalla aparte de que voy a bajar esto por el tema de los comentarios lo que va a ocurrir en la pantalla es que el sistema va a buscar bordes vamos a por ello recargo y si no hay ningún error ahora voy a poner dos lienzos y vemos como el programa tarda más y es normal vamos a sacar ahora sí la ventana del historial de la afp ya no podría sacarlo y estamos viendo como pues bueno lo que hace el sistema como podemos ver ahora es que está tardando bastante más en realizar el cálculo y ahora es cuando realmente nos empezamos a plantear que necesitamos pues mejorar este cálculo esto que está ocurriendo es que el sistema pues está tardando una barbaridad en calcular otra cosa que puedo hacer es un poco ahora para el principio hacer que el cálculo sea un poco menos invasivo o que sea menos fuerte porque pues le he puesto antes una anchura he puesto una anchura de 4 pues igual con ponerle una anchura de 1 ya es suficiente ahora tengo que parar este cálculo voy a arrancarlo de nuevo ahora está el otro cálculo también voy a pararlo aunque el cálculo en worker es a veces es difícil de parar pero bueno vamos a dejarlo un momento vamos a dejarlo quieto a que acabe de calcular y ahora veremos a ver qué nos da y vamos a decirle bueno en este caso salir de la página aquí a ver si me deja cerrar ahora recargamos y vamos a ver si habrá sí bien en este caso ya tenemos el resultado que por cierto ha tardado una barbaridad tardado un montón pero bueno no pasa nada ahora iremos a ello de momento lo que estamos viendo bueno me sale todo de negro eso ya me extraña un poquito vamos a repasar el código y yo les digo si board es igual a falls vale entonces más a bs centro r vamos a comprobar que todo esté correcto vamos a decirle mayor que 5 y vamos a volver a calcular el caso es que como digo pues lo que está calculando tarda un montón está calculando un bloque de 9 píxeles seaboard es igual a true seaboard es igual a fault de comprobando que todo esté correcto y parece que sí entonces vamos a por ello anchura vamos a calcular recargo por aquí y lo que debe ocurrir básicamente es que en un momento dado pues debe sacar un lienzo en blanco y negro donde digamos detecte cuál es la variación de píxeles me extraña mucho que no haya habido una diferencia de 50 píxeles en ningún pixel de la imagen pero bueno no pasa nada ahora veremos por ciento si no vas y si lo estoy haciendo correctamente vale estaba pensando si quizás me faltaba el último paso que es poner los píxeles dentro de el otro lienzo pero no en principio no entonces ahora lo que tenemos que hacer básicamente es esperar a que vale le decimos esperar está tomando mucho tiempo una vez más vemos que el algoritmo es ineficiente desde el punto de vista en el que pues no tiene no guarda las informaciones correctas pero no pasa nada no utiliza al cien por ciento la capacidad de proceso que tengo el ordenador pero como digo no pasa nada vamos a hacerle esperar se puede también afinar el proceso pero bueno ahora lo veremos a despejar de nuevo y ahora como digo pues voy a intentar hacer que el proceso sea dentro de lo que cabe dentro de que es ineficiente pero que sea un poco pues más óptimo le vuelvo a decir esperar en definitiva esperamos a que acabe el cálculo y al final con suerte pues tendremos un cuadro blanco y negro le seguimos haciendo esperar bien de momento no pasa nada lo que voy a hacer en este caso es crear un algoritmo de momento un poquito más sencillo y ahora iremos a algo más complejo vamos a ver voy a hacer lo siguiente datos destino nada momento y no recargar esto voy a decir bar pixeles es igual a contexto punto que image data pero como a cero a 2.048 2048 y es igual a 0 y es menor que píxeles punto data punto link y + + y ahora lo que voy a hacer es decirle que píxel a píxel pues quiero fijarme en el píxel vecino en el píxel de al lado entonces digo lo siguiente vamos a ver con texto en fin con texto putin estatal esto es lo que no creo que esto es lo que ha fallado de hecho bien entonces le digo sí con texto destino marc píxeles destino es igual al contexto destino punto de image data de 0,0 a 2048 y digo por tanto si pixeles data de iu que es el color rojo menos píxeles punto data de ti más 4 que es el pixel rojo la derecha y ahora pongo más punto a bs quiero quedarme con el valor absoluto quiero quedarme con el valor positivo esto es menor que 20 en este caso en ese caso contexto destino punto gata es igual a 0 lo mismo aunque voy a hacer la operación para el rojo va a aplicar en el verde y en el azul en el alfa voy a poner 255 por si acaso en caso contrario esta es una búsqueda de bordes de un píxel es muy sencilla pero bueno de momento nos servirá entonces si todo va bien vamos a verlo con texto destino putty maystadt vamos a ver píxeles destino vamos a comprobarlo venimos por aquí recargamos voy a sacar el inspector de código recargo cuidado píxeles es notifight dónde como que píxeles es no diferente en la 45 como que la 45 sin aparente 5 no hay nada contexto pudimos data figel es destino estoy en imex 7 voy a ver si es que no actualizado bien no puedo la propiedad cero de andy find en este caso lo que me está diciendo es que no puede la propiedad cero de un elemento en este caso voy a decir pixeles detallen menos cuatro porque el último pixeles el que está fallando vamos a verlo hay alguien que no está cogiendo efe al menos 8 en la línea 25 es el error que pero el fandi find que es el sexto contexto destino curiosamente contexto destino pixeles destino ese es el problema ok recargamos ahora bien en principio no lo estoy viendo inspeccionamos pienso destino está ahí pero está vacío entonces bueno vamos a ver pixeles destino contexto destino punta data en principio es correcto voy a poner una cosa voy a poner 44 para saber si está operando o no pues efectivamente no está operando y ahora pues bueno podría hacer esto podría hacer con texto de destino no puedo hacer el x y vale pues vamos a verlo pixel el destino es igual al contexto destino punto que te inmediata tal y de tal en principio y más igual a 4 él había puesto y más evidentemente eso no puede ser así que vamos a por ello vale ahora me lo está poniendo todo negro pero si nos fijamos pero si nos fijamos hay una pequeña silueta con lo cual está empezando ya a hacer el la ejecución del programa así que venimos por aquí y vamos a decirle aquí donde pone 44 vamos a poner los otros 35 recargamos vale ahora sí está empezando a buscar bordes ya tenemos el buscar bordes y ahora básicamente pues lo que quiero es volver a generar un programa donde pues vuelva a calcular que en lugar de el píxel de la derecha pues coja más píxeles también voy a hacer un programa sencillo en primer lugar de 3 x 3 píxeles pues va a en el centro arriba abajo izquierda derecha siempre y así pues tendremos un cálculo que por una parte será más extenso y por otra parte será más costoso de calcular bien así que ahora me vengo por aquí y digo vale quiero esto pero lo quiero para cada uno de los píxeles digamos que tenemos a continuación me hacer una cosa voy a decir borde es igual a true y entonces digo esto es borde es igual perdona fox esto no debería haberla borrado en este caso voy a poner borde es igual a false en caso contrario borde es igual a otro y ahora al final sí borde es igual a true en este caso hace algo en caso contrario es otra cosa y entonces algo así y entonces algo así parece que haya hecho lo mismo pero realmente no lo es entonces vuelvo recargo espere un momento y ahí lo tenemos bueno ha invertido los colores pero da igual eso para lo que es este para lo que este proyecto es un poco indiferente así que ahora a continuación vamos a aumentar esto a más píxeles entonces y ahora lo que quiero hacer no es sólo el píxel de la derecha sino quiero varios píxeles entonces para ello ahora voy a la anchura voy a quitar esto y voy a decir voy a ir a ver cómo lo podemos hacer es un cuadrado vamos a verlo es igual primero tengo que sacar la equis un momento voy a hacerlo de tres por tres primero entonces así ya tenemos suficiente como para ilustrar el proceso if más punto a bs píxeles punto data se viene la complicación ahora quiero el píxel de arriba a la izquierda esto es píxeles punto dato y menos 2048 x 4 -4 esto es el píxel de arriba a la izquierda es mayor que 30 por ejemplo ahora pondré una variable llamada umbral a los umbrales igual a 30 de momento en ese caso borde es igual a otro he cogido el píxel de arriba a la izquierda ahora vamos a el píxel de arriba que es este ahora quiero el píxel de arriba a la derecha que es este ahora quiero el píxel de a la izquierda qué es este ahora quiero el pixel de la derecha qué es este ahora quiero el pixel de abajo a la izquierda qué es este ahora quiero el píxel de abajo qué es este que requiere el píxel de abajo a la derecha que es este en lugar de estar validando únicamente contra el píxel vecino de la derecha lo que estoy haciendo es validar contra un pequeño cuadradito digamos de 3 x 3 píxeles que hay en torno a este píxel si esto ha funcionado bien tengamos en cuenta que aquí ya estoy haciendo unas cuantas operaciones más si esto ha funcionado bien y ahora recargo antes eran 317 milisegundos en calcular ahora han sido 415 vemos que el resultado tiene un poco más de calidad vale está tardando medio segundo prácticamente en realizar el cálculo con lo cual ahora lo que queremos ver es si podemos hacer el cálculo todavía más preciso pero todavía también más extenso bien ahora a continuación lo que podemos hacer es bajar un poco el umbral por ejemplo voy a bajarlo a 20 volvemos a refrescar y bueno ahí vemos como van apareciendo más píxeles vamos a pasarlo a bien za igual me estoy pasando un poco vamos a verlo y bueno pues con 10 salen todavía más en definitiva lo que me importa ahora mismo lo que sobre todo me importa es cuánto está tardando el programa en calcular está esta información vienes a derrotar a 1 391 milisegundos que parece que no sea demasiado tiempo es prácticamente 0,4 segundos que para una imagen puede parecer poco pero supongamos imaginemos que yo quisiera aplicar esto a un vídeo y un vídeo va a 25 fotogramas por segundo así que una vez más pues lo que quiero es rebajar los tiempos y en definitiva lo que quiero es utilizar múltiples núcleos entonces lo que voy a hacer es crear múltiples núcleos de procesamiento para este ejercicio y voy a intentar que el programa calculé esto con diferentes núcleos no va a ser un ejercicio sencillo desde el punto de vista de lo que va a tardar en transferirse la información pero vamos a ver por qué vamos a dividir los cálculos y vamos a ver qué incluso es posible que en principio en las primeras iteraciones del ejercicio tarde más dividiendo los cálculos que sin dividirlos porque hay que tener en cuenta lo que va a tardar en dividirlos vamos a comprobarlo y ahora veremos exactamente de qué estoy hablando vamos venir por aquí y cuando la función comienza vamos a ver tengo los píxeles y si tengo los píxeles digamos que pues bueno aquí es cuando puedo empezar a lanzar digamos vamos a probar esto por aquí esto es bueno voy a poner comentarios meto toda la información de los píxeles en una variable meto la información correspondiente al lienzo de destino y ahora lo que hago es que recorro de los píxeles uno a uno y entonces en principio supongo que no hay un borde en el pixel que estoy registrando pero para cada uno para cada una de estas validaciones a ver un segundo que está activando el dictado para cada bar para cada uno de los píxeles compruebo si hay mucha diferencia de color o no la hay y esto es pixel de arriba a la izquierda pixel de arriba a la derecha pixel de la izquierda voy a poner en las preferencias el sonido en el auricular pixel de la derecha pixel de abajo a la izquierda pixel de abajo a la derecha entonces en el caso de que sí que haya un borde como en este caso pinto de negro y en el caso de que no haya un borde en ese caso pinto de blanco y esto es lo que estoy haciendo realmente pongo la componente rojo a 0 pongo la componente verde en cero pongo la componente azul en cero cuidado muy importante pongo la transparencia opaca y ahora qué pongo la componente roja al máximo valor pongo la componente verde al máximo valor pongo la componente azul al máximo valor y la transparencia la sigo poniendo opaca bien ahora puedo llevarme los comentarios a su sitio bien y entonces ahora es cuando vamos a empezar a pasar esto a alguno de los workers vamos a crear workers en primer lugar y ahora veremos qué hacemos a continuación entonces cojo la tarea 5 y js la renombró la guardo como tarea 7 punto está ese y vamos a por ello vamos a decir que número de núcleos es esto de aquí así que justo aquí un número de núcleos ahora creo una raya de trabajadores e y a continuación les digo que su worker estaré a 7 puntos js vamos a enviarles información el problema que tengo ahora es que me gustaría digamos que como diría yo me gustaría que para cada uno de los píxeles le podría enviar la información y le pudiera en definitiva preguntar al programa qué es lo que tiene en los píxeles de alrededor podría enviarle la información de los píxeles yo aquí lo que quiero hacer es en definitiva enviar esta validación por ejemplo y bueno vamos a ver cómo lo podemos hacer vamos a ver cómo lo podemos hacer porque aquí tengo un post message en este caso una vez exactamente qué es lo que envío se me ocurre por ejemplo por poner un ejemplo que si tengo cuatro núcleos pues podría enviar un cuarto de la imagen entonces el programa me devolvería digamos ese cuarto de la imagen y luego al final le imprimiría vamos a probar eso esa es una estrategia hay otra estrategia que consiste en partir la imagen en lo que se llaman baquets los baquets son pues digamos porciones de la imagen vamos incluso si queremos acoger esta estrategia yo quiero yo creo que incluso mejor así que en este caso lo que voy a hacer es que voy a decirle al sistema que quiero trabajar con estos cuadraditos y cada uno de los cuadraditos será lo que envíe al sistema entonces vamos a verlo número de núcleos bueno ahora veremos cómo lo hacemos bien ahora uno de estos cuadraditos vamos a por aquí vamos a decir en surf a baquet bar anchura bacchetta es igual a no ser 32 por ejemplo y voy a decir que por ejemplo voy a algo que esté en 2024 y 2024 como anchura baqueta como anchura va que está claro ahora tengo que reemplazar los parámetros en todos y cada uno de los cálculos no pasa nada y contexto destino y yo creo que esto ya está vamos a verlo recargamos bien json es difícil claro por qué porque esto todavía no lo puedo poner en marcha así que recargo y si todo ha ido bien pues bueno así cuidado vamos a 1024 x 1024 vamos a verlo lo pintamos allí y parece que ahora ha cogido pues ese trozo que tenemos ahí en lugar de 32 pues puede 128 no sé por hacer una prueba market en definitiva es un cuadradito de la imagen como podemos ver ahí el sistema lo que está haciendo es calcular pues un cuadradito fijémonos que ahora el tiempo ha bajado pero tampoco ha bajado tanto porque al final el programa tiene que ponerse en marcha y eso lleva a un coste es curioso vamos a ver qué calculando por baquets pues igual tardamos más que en calcular de otra forma pero bueno no lo sé ahora veremos lo importante en definitiva de esta parte del ejercicio es ser capaces de partir un problema monolítico en varios sub problemas y por tanto una vez que la hemos partido pues podemos empezar a enviar esos sub problemas a cada unidad de cálculo esto quiere decir por tanto que yo ahora podría venir por aquí y voy a hacer este programa de momentos monotarea y voy a hacer lo siguiente vamos a verlo voy a poner todo esto en un bucle así que función bucle voy a crear un temporizador par temporizador y entonces voy a decir lo siguiente voy a decir que esto de aquí y esto de aquí y bueno realmente el trabajo me da igual no voy a poner en el bucle y entonces la función temporizador es igual acepta y mouse quiero ejecutar el bucle e dentro de un segundo y ahora el bucle lo que va a hacer es cargar una equis y una y bucle x y voy a decir esto es la equis 1.204 madre mía esto es la y esto es la equis y esto es la idea entonces ahora vengo por aquí y digo bar anchura es igual a 2048 para altura es igual a 2048 y entonces vengo por aquí y vivo clear time out temporizador es igual a bucle en un segundo por lo que sea se está introduciendo este retraso específicamente y ahora lo que voy a hacer es lo siguiente x más igual a anchura bouquet y ahora digo si x es mayor que 2048 en ese caso x es igual a 0 y es más igual a anchura bucket y eso es lo que va a hacer y es lo que va a hacer y por cierto que voy a decir que sí y es igual seguir y es menor que 2048 pues en este caso por el clicker time out en este caso vuelve al temporizador esto por aquí y esto por aquí abajo vale vamos a ver qué es lo que va a hacer esto si todo va bien y si todo va bien esto lo que va a hacer es ir trabajando con los bucks 11 vamos a ver el value is not type blog vamos a verlo en el 44 porque ahora me da ese error así que muy bien y le dijo que marc x es igual a cero para y es igual a cero para empezar vamos a verlo y si todo va bien a ver get inmediata el valor no es de tipo long en el así porque cuando pasó por aquí cuando pasó por aquí bucle x y ahora le voy a decir bucle x y porque le tengo que pasar los valores en base a los cuales quiero analizar bueno y si nos fijamos y está empezando ya a calcular ahí vemos que poco a poco está empezando ya calcular ahora irá al debajo voy a quitar ese retraso de un segundo voy a poner un milisegundo para que el programa no calculé lo más rápido posible vamos a verlo ahí lo vemos y vemos como estos paquetes lo que están haciendo es calcular cada uno de los trozos de forma independiente hay un pequeño defecto el pequeño defecto es que sale de esas líneas verticales que es el final derecho de cada uno de los paquetes pero en principio me da igual como podemos comprobar lo que está haciendo el programa es pues calcular para cada uno de estos bloques pues lo que corresponda el tiempo como digo es mayor que si calculamos toda la imagen pero las oportunidades de dividir son mayores como nos podemos imaginar ahora a continuación lo tendremos más fácil para enviar cada paquete a un worker diferente aquí tenemos ya por fin finalizado el cálculo bien ahora bueno voy a hacer un poco de como diría yo de teatrillo vale y cuando digo teatrillo lo que quiero decir es que voy a x bueno voy a por para dibujar un poquito los markets entonces para eso aquí donde pongo contexto destino aquí canvas pf un divo y d contiene canvas voy a poner por aquí lienzo destino el lienzo baquets y simplemente lo que voy a hacer ahora vamos a ver es poner el contexto baquets el lienzo markets vale y ahora en cada elemento del bucle y pues lo que voy a hacer es con texto baquets punto clear recto p 0,0 a 2.048 2048 y ahora contexto baquets punto feel style es igual a la red con texto baquets punto strong style es igual a red y por tanto contexto markets punto beijing paz contexto baquets punto en stroke recto de equis cómoda y anchura bakker como anchura baqueta y contexto baquets punto stroke y si todo ha ido bien haciendo esto lo que va a ocurrir es que ahora al recargar vamos a ver lo momento porque ahora tengo ahí como 3 baquets ahora en style le digo que contiene canvas tiene un wifi de 2048 píxeles un hi de 2048 píxeles una posición relativa y por tanto contiene canvas te digo por sitio no absoluto le digo 20 píxeles y tercero píxeles y con eso lo que voy a conseguir es que los cambas estén uno encima del otro y vamos a verlo vamos a ver los elementos contiene canvas show contiene canvas porque tiene esto contiene que ambas posición relativa pues sí está en absoluto vamos a verlo contiene canvas 1 y 2 esto es correcto entonces voy a decirle simplemente cloud left y de esa forma bueno la idea es que flote mal pienso baquets no me está dibujando lo que quiero vamos a verlo contexto va que silenció baquets está por delante por detrás dentro destino lienzo baquets vale y contexto baquets clear recta voy a hacer una cosa el recto no es lo que quiero hacer pero para comprobar que está funcionando eso es lo que eso es lo que quiero es un poco que se vea el cursor vamos a ver no sé por qué no se ve el stroke recto porque se debería haber pero bueno igual con que lo haga así pues ya me vale para que tú visualmente sepas para que tú visualmente puedas comprobar por donde va pues ahora como digo la misión en este caso es devolver la misión es enviar cada uno de estos paquetes a cada uno de los workers que en un principio puede obtener así que vamos a por ello vamos a por ello y llegamos allá y esto es lo que podemos ver el programa está calculando con cada uno de estos markets ahí lo tenemos vale pues vamos allá bien pues ahora si nos vamos al código ahora es cuando el código lo podemos empezar a lanzar bueno en un worker vamos a por los trabajadores y ahora nuestro gran reto consiste en pasar esta información a uno de los workers y que los worker nos devuelva pues verdadero o falso así que vamos allá vamos a ver para cada uno de los trabajadores vamos a ver pero estos son los contexto baquets es nuestra cosa y ahora vengo por aquí y ahora vengo por aquí voy a hacer un worker voy a hacer principio un solo worker trabajador es igual a new worker y ahora lo haremos en matrices index tarea 7 puntos j s y ahora por aquí le digo trabajador punto post meses y vamos a ver que necesito lo que necesito vamos a ver qué variables estoy metiendo los píxeles y estoy metiendo el pixel de destino bueno realmente el pixel de destino casi que es lo que menos me preocupa entonces post message y voy a enviar pues un pequeño json j son es igual pixeles es igual dos puntos a píxeles pixeles no esto es igual a píxeles cómo tx destino es pixeles destino y que más pues la ahí y no qué es lo que necesito pues esto la equis y x es x y es yo creo que yo así que voy a enviar el jota son voy a voltear un momento todo esto y en la tarea de siete meses voy a decir con solé punto nov datos voy a poner esto a un segundo y vamos a recargar el ciclo va bien vale me seis meses muy bien y data es igual a esto de aquí me x bueno hemos pasado de hecho los datos así que ok perfecto y ya está así que vale vamos a por ello estamos pasando el worker en principio todo en principio toda la fenomenal así que ahora vengo por aquí ahora vengo por aquí escapó corto lo pongo aquí en 7 y ahora evidentemente lo que tengo que hacer es intercambiar entonces digo datos vamos a ver tenemos px de estilo datos punto data punto px punto lakes y esto es valentín px correcto px data punto lenguas es dato correcto esto viene aquí ahora hablaremos de anchura umbral y orden aquí por qué aquí con los dos puntos por qué bien vamos a ver que además a pixel destino esto realmente no hace falta voy a decir bar destino es igual a cero y aquí simplemente digo destino cero y voy aquí voy a decir destinos igualados en 255 los destinos según la 1 me da igual vale ya tengo esto me hace falta umbral y anchura baquet entonces vengo por aquí pasó los datos mi umbral es umbral y mi anchura barquet es anchura baqueta entonces esto es datos punto data punto mi anchura baqueta y esto es datos punto data punto umbral si todo ha ido bien si todo ha ido bien le digo después de todo esto le digo post message y básicamente lo que quiero devolver es datos punto data de no me acuerdo de mi x quiero un jota sol j soles el cual a mi x es igual datos punto data x y es datos punto de ata punto me y i ahora resultado es igual a destino le envío el jota son y por tanto por ejemplo por aquí en donde sea realmente donde defino el trabajador le puedo decir que trabajador punto 1 message es igual a la función datos consuele punto log y gatos vamos a ver lo puedo ya quitar este con solo punto lógica que creo que ya sé lo que va a salir parece que tenga aquí como datos punto data punto que punto umbral hay un error es mayor a datos punto data apuntó hembra el umbral umbral y un ok vamos a ver lo recarga vamos a ver si algún error bien trabajador no es trabajador vamos a ver bien nos da un mensaje de momento no hace nada evidentemente nos dice me x mí y nos da un resultado vale en el resultado básicamente lo que nos dice es si da error o no de error esa es otra cuestión y es que yo realmente vamos a ver ahí yo realmente lo que quiero hacer es para cada uno vamos a ver tarea js para cada uno de los datos vamos a verlo vale para cada uno de los datos quiero que me diga si es correcto o no a leche lo que me diga si tiene que poner los datos o no entonces claro que lo que tengo que hacer es para cada uno de estos datos vamos a verlo ahora estoy consiguiendo que para cada uno de ellos me diga si sino si no cual bien lo cual es correcto pero es un poco incompleto porque lo que quiero es que me dé pues unos datos finales entonces vamos a decir lo siguiente vamos a copiar este bloque dónde estás este bloque no está mal ok pixeles destino vale pues no voy a tarea vamos a verlo el siguiente vídeo y ahora le digo ahora sí lo siguiente datos punto data punto x destino punto data y es igual a hacer vuelvo a hacer lo mismo de antes y uno y más 2 y 3 recordemos que tiene que ser y ahora algo así 25 52 55 255 y entonces digo me x me y resultado es igual a datos punto data punto px destino es decir el elemento que sobre escrito vamos a ver lo vamos a ver lo index 7 vamos a hacer esto cada 10 segundos para no saturar el navegador vamos a probarlo vale ahora vamos a por el primero no puedo leer datos de tarea 722 muy bien vamos para siete tareas 722 aquí serían 722 datos punto data px destino es px destino no lo sé vamos a ver el jota son que estoy enviando px de st no es px destino es px de éste guardo recargo bien y vamos a verlo nos da una serie de datos --resultado and i find vale esto vamos a ver porque es andy find px destino punto dato control en los datos vamos a cargarlo vamos a ver que nos da el primero tiene un data que es x destino que es una inmediata que tiene unos datos no sé por qué me dice que el px destino es desconocido porque entonces yo vengo aquí y me dice que el resultado de sandy find vale datos punto data px de st esta es la razón por qué no he cambiado la información aquí ahora sí así que recargo vale y si todo va bien ahora en datos tengo un email data y eso qué quiere decir pues eso es lo que quiere decir es que yo ahora puedo venir de aquí puedo atrapar estos datos y puedo poner los puedo ponerlos donde corresponde y puedo decir qué un mes saints ya no quiero un console sino que quiero contexto destino quiero put emails data píxeles destino no lo sé aver html5 canvas put image data a ver qué parámetros tiene esta función imágenes y hoy imagen x y entonces tengo al código y le digo datos data punto no me acuerdo datos punto data punto resultado en datos punto data punto me x y datos punto data punto me y si todo esto ha ido bien en principio ahora en contexto destino debería estar poniendo una serie de datos vamos a comprobarlo vamos a ver si de suerte recargamos y vamos a verlo de momento está atrapado ahí no sé si es porque efectivamente está recogiendo los datos de momento no aparece nada esto es un poco lo de menos bien entonces vemos que bueno ahí teníamos un poco algo que me temía y es que vemos que el tiempo de transferir la información pues es un tiempo que tiene que ser tenido en cuenta aparte de que no tengo muy claro si lo está haciendo o no pero bueno ahora veremos ahora cuando llegue a la cabeza pues veremos si lo estaba haciendo o no para cuando llegue a esa parte de arriba otra cosa que puedo hacer es bueno a no tardar 10 segundos también sería bueno otra cosa que puedo hacer es lanzar el worker solo cuando haya unos meses es decir este bucle vamos a verlo realmente no quiero bucle no es un temporizador y lo que quiero es decirle al sistema lo siguiente esto de aquí y lo meto en el un meses y le digo un bucle vx y así lo que vamos a hacer es que el sistema lance un nuevo cálculo de baquet no en un temporizador sino cuando realmente sea necesario cuando el mes es libre eso es lo que está tardando en liberar el un meses vale muy bien de momento no tengo nada en la pantalla ok correcto no pasa nada y bueno ahora veremos por qué no porque no tengo nada en la pantalla porque en principio debería empezar a tener la información gráfica allí parece que lo que está fallando es el putt emails data esto es un poco lo de menos dentro de lo que cabe pero simplemente esto es lo que datos punto data punto resultado voy a contexto punto con sol punto los datos vamos a refrescar por aquí datos punto dato punto resultado y punto datos esto es curioso porque no es que no esté funcionando sino que es que está dando todo el rato 255 o sea es blanco esto quiere decir que esto está funcionando pero en apariencia el tarea js es el que no está funcionando es decir siempre da siempre default y esto quiere decir que borde es igual a esto siempre está dando falls datos punto a punto umbral y bueno vamos a verlo vamos a ver datos punto data px punto dato este estudio parece correcto dos puntos de alta puntomio juraba que no esto no es correcto bien así sí sé que es correcto sí en el sur a baquet y atos punto data punto umbral vamos a verlo el jsoc es mi umbral mía en su raqueta mi umbral mi anchura baqueta el umbral y me enteraba que vamos a verlo ahora vamos a recargar ahora esto ya es otra cosa y ahora si tenemos que el cálculo lo hemos dividido en diferentes partes en diferentes zonas bien lo divertido en este caso es que ahora ya no quiero tener un solo baqueta ahora quiero tener 4 baquets y ahora yo creo que es cuando el programa se va a volver realmente interesante ya que ahora es cuando el programa va a empezar a calcular realmente en diferentes núcleos y desde luego lo vamos a poder ver aquí así que vamos a por ello vamos a por ello vamos por aquí vamos a sacar el código bien y entonces ahora en index 7 ahora voy a decir que trabajador es igual al mismo array número trabajadores lo tenía por aquí parece que lo ha borrado vale número trabajadores es igual a navigator punto hardware concurre en fin y entonces digo form bar y es igual a 0 y es menor que número trabajadores y más en ese caso voy a decir trabajador es igual a vayamos se me ha perdido a new worker estaré a 7 punto js y ahora viene lo divertido y entonces voy a hacer lo siguiente para cada uno de los trabajadores trabajador de iu con message y haz esto de aquí esto que va a hacer pues esto lo que va a hacer con suerte como digo es que de repente aparezcan cuatro paquetes y si todo va bien vamos a verlo vamos a comprobarlo el tiempo con nervios o vamos a por cierto querría quitar el consola pero bueno da igual vale trabajador pues message is not a función trabajador dónde estás dos meses aquí bucle claro tengo que decir a qué trabajadores estoy haciendo referencia y entonces voy a decirle el trabajador de iu núcleo de iu y por tanto es el trabajador de y para decirle a qué trabajador le estoy pasando la información yo creo que ya recordemos vamos a ver value no es de tipo lonja en el bucle en 64 es de 4 vale interesante en la línea de 64 vamos a ver porque no sé por qué ha dado aquí un error a ver voy a quitar unas cuantas cosas esto se ha quedado vamos de nuevo en cámara en canvas con textos de el valor no es de tipo long ok con sole punto love es y más x + y género vamos a verlo vale 0 and i find ahí está el problema el y desperté 00 design y es lo que no está definido eso es lo que wow por qué porque la y no está definida y está definida qué interesante consuele punto log voy a lanzar con más y aquí está vamos a verlo abajo éxito el bucle y en los 62 a esto fuera ya esto ahora sí tenía un 7 aunque no tocaba bien ahora no se está ejecutando evidentemente porque no esté ejecutando el bucle recargo y ahora sí todo bien vamos a ver debería estar lanzando no estoy lanzando vamos a ver porque no estoy lanzando vale está haciendo el post message vale voy a lanzar un trabajador de iu punto post message comienza ya que si no creo que no va a comenzar o eso es vamos a arrancarlo muy bien y vamos allá por lo menos vemos que ha lanzado ya cuatro tareas dice que no puede leer los datos de algo que no está definido vamos a verlo cargué js 4 cierto aclaro la nula me sets vamos a ver voy a hacer en tarea 7 que sí datos punto data punto x por ejemplo no es igual a nula en ese caso ejecuta men todo esto vamos a verlo nuevas fueron meses els por estos meses hola pero hay un problema y es que en cuanto se rompe el flujo de datos deja de funcionar a ver quién está lanzando trabajador post message y entonces al final ejecutó el bucle vamos a verlo vamos a ver ahora vale bueno vamos por allí ha causado un error ha hecho algo por ahí no pasa nada vamos a continuar bien voy a lanzar con 438 334 perdón voy a lanzar con 428 0 456 04 34 4 512 esto está bien ahora en cada uno de ellos me ha dado un error por cierto que parece que ha perdido el estilo con texto baquets punto insta él es igual a red vamos a ver si sale de color rojo ok ahora da error y dice en el 69 no puedo leer la propiedad message o fandi farc 69 el 69 no puedo leer la propiedad post message of andino por qué pues porque aquí porque allí en el núcleo no estoy viendo que estoy pasando ahí vamos a quitar los controles en el bucle devuelvo recargo por aquí vamos a ver el bucle de vuelvo qué 000 vale 100 en el bucle devuelvo 428 0 qué es lo que devuelvo en el bucle en mi índice vale mi índice x y mi índice x y en principio es correcto entonces pues meses o fandi find pues meses un trabajador vamos a ver y esto es por qué trabajador tiene que estar aquí en las variables principales bar trabajador porque si no solo existe dentro de esta función recargo vale pues me has hecho fund i find en el bucle 71 trabajador de in en worker principio es correcto desde el punto de vista de que debe estar metiendo lo dentro de un elemento trabajador de y es igual a new yorker trabajador de iu bien no avanzar con 428 0 siempre es cero en el bucle devuelvo un bucle el bucle vuelvo y x y a un 23 el núcleo devuelvo 4 eso es lo que no pero es lo que no está bien y es que teóricamente voy a poner trabajador de 0 vamos a verlo vale hay un problema con esa y el problema ahora mismo es que es ahí estando todo el trabajo y eso no está bien ese 0 ese trabajador pero está comiendo todo el trabajo y eso como digo no está bien así que ahora a continuación pues vamos a ver qué es lo que ocurre y por qué es que es ahí no está funcionando correctamente porque como digo trabajador de dos meses trabajador de ellos está allí de aquí para afirmar índice es igual y aquí voy a poner índice a ver si así recargamos dice post message of and i find con solo punto el ojo el índice del trabajador es más índice recargamos el índice del trabajador es 4 claro no puede ser 4 no puede ser 4 el inicio del trabajador es 3 esto es correcto es 0 1 2 y 3 pero porque el índice luego es 4 y 4 quien está aumentando el valor del índice nadie debería aumentar el valor del índice porque el índice siempre tiene que ser cero uno de los tres y cuatro es normal que se dice que es cuatro pues diga que no existe realmente entonces vamos a ver quién está aumentando el valor del índice esto es bucle bay esto es un bucle vélez y entonces un bucle el problema parece estar aquí el bucle de cero entonces el principio ok el índice es 0 el índice es 0 el índice es 0 vale el problema está ahí es por qué porque hay porque allí no está pasando correctamente el valor un mes y ahí está el problema bar y de trabajador es igual ahí y entonces aquí pongo bucle y de trabajador vamos a verlo ahora y de trabajadores igual ahí ahora parece que sí bueno el índice estrés porque tampoco lo ha hecho porque en principio parece que se ha quedado fijo en el 3 y no puede ser ahora todo el trabajo lo está haciendo el 3 vale y de trabajadores e igual hay hacer una cosa y ahí voy a ponerla allí pero bueno está costando que el programa atrape el inicio del trabajador son diferentes un momento bueno puedo hacer una cosa y es que voy a enviarle ive worker y ya que eso creo sí que parece que lo coge ahora en la tarea voy a decirle qué me y the worker es datos data punto de walker y entonces ahora le digo que esto es vamos a verlo estos datos punto data punto ni de worker vamos a ver si así vale recargamos al principio un principio parece que sí el índice del trabajador es 0 1 2 3 si nos fijamos ahora al historial de la cpu pues ahora prácticamente está ocupando el 100% y ahora tengo que empezar a jugar un poco porque no me ocupa al 100% realmente me está ocupando menos mientras yo por ejemplo podría decirle al sistema que pues en lugar de ocupar digamos esos pues quiero crear más quiere ocupar el doble de lo que acepta mi procesador vamos a verlo entonces digo número trabajadores es igual a hardware con ocurrir si por dos o sea tengo cuatro núcleos pues quiero ocho tareas vamos a ver ahora pondremos las 8 por cierto ahora podemos ver como ahora sí bueno machaca un poquito más el procesador ahí lo tenemos otra cosa que quiero hacer es en html5 hacer un stroke recto asiste por qué estruch nuestro recto y vamos a verlo no quiero crear recto vamos a por ello recargo a dibujar múltiples rectángulos no pasa nada lo que está dibujando rectángulos o se está dibujando rectángulos ahora vamos a ello vamos a ver por qué lo medimos a rectángulos contexto baquets correcto voy a decir fiel recto vale con el rector sí que lo hace y con estructura es curioso a ver si no a una mala le puedo decir contexto baquets punto no hay texto beijing paz x como y contexto punto bikers lento x más anchura baqueta la gente y más anchura baqueta con texto line contexto lento y contexto baquets puntos truco y con eso debería pintar rectángulos tampoco y es lo que me extraña una barbaridad debería estar pintando un rectángulo y no sé hay algo que me estoy perdiendo y no sé ahora mismo qué es tengo el de jim paz tengo el stroke no sé ahora mismo que puede ser lo que está haciendo que se pierda markets con texto baquets y punto estruch style es igual para esto de aquí y bueno ahora cuando quiera pues voy a dibujar me dijo para algo porque el caso es que si le pongo con texto baquets phil recto ya voy a hacer marcos o palabras y hacerlo muy a la bestia es como el green comm sobre a baquet como altura baqueta con una baqueta y ahora a lo bestia contexto baquets punto clear recto x 1 y 1,2 urabá menos 2 como anchura váquez menos 2 lo que hace es crear un rectángulo usuario y luego lo borra yo que sé si no me deja otra opción para no perder tiempo con este tema de los rectángulos y parece que tampoco rectángulo ahí y por qué no me deja x2 y más 2 claro claro grave claro es que estoy pensando que igual el rectángulo que estaba dibujando era muy pequeño ahí lo tenemos vale ahí lo que está haciendo el programa como podemos ver es ir de cuatro en cuatro bloques al ir de cuatro en cuatro bloques pues lo que está haciendo es como podemos ver ahí también y abusar bastante mejor el procesador y por tanto ahora pues da igual realmente qué es lo que use da igual realmente cuántos procesadores tenga porque los puedo aprovechar otra cosa que puedo hacer es analizar digamos como el programa va a ir más rápido si con más anchura de hecho menos anchura de baquetas vamos a verlo esto vamos a decir que por ejemplo el anchura de paquetes 32 por eso entonces recargo y ahora lo que está haciendo es que estará enviando trocitos más pequeños está enviando trocitos más pequeños estaba haciendo el cálculo al final y fijémonos como con cálculos demasiado pequeños el procesador no está usándose al 100% la razón probablemente es porque está perdiendo más tiempo en enviar y recibir la información que en calcularla con lo cual es interesante es importante que pues realicemos este tipo de pruebas para saber cuál es el punto óptimo y eso que en este caso recordemos que lo tengo pues en el doble de tareas de cálculo entonces ahora voy a poner por ejemplo pues voy a poner unos 512 pongo 512 recargo vamos a verlo ahí y ahora con 512 ahora de hecho va a tirar más ahí fijémonos que el procesador sí que lo está realmente utilizando la idea siempre que trabajamos con baquets pues es intentar digamos trabajar con un número óptimo y hasta que no se vuestras pruebas pues no podemos saber cuál es este número último démonos cuenta como ahora sí que puedo hacer digamos él el cálculo vale ahora sí que puedo hacer el cálculo de cuando ha terminado y entonces voy a por ello ya si hacemos diferentes pruebas hacemos análisis de carga vamos a ver vamos a las constantes constante tiempo de inicio es cuando el programa empieza cuando el programa empieza después del time out a tiempo inicio que lo tengo bien ahora y es igual a es mayor que 2048 en ese caso con tiempo final cuidado con tiempo final es igual a esto y entonces con solo punto lo no lo quiero cortar con solé punto log estoy aquí muy bien entonces ahora puedo recargar la consola bueno da igual los controles que por ahí y luego los puedo quitar el tiempo para calcular este programa ha sido 249 realmente no realmente nuevo porque tengo que esperar a que me devuelva el último worker vale bueno otra cosa que puedo hacer es cronometrar pero bueno tardando 18 segundos sí si realmente esto me sirve estoy pensando porque me calcula la diferencia con respecto a cuando empezado con lo cual el último tiempo es el que me puede valer vale pues vamos a por ello vamos a ver tengo cuatro tengo ocho claro pero no puedo partir más ok son 20 segundos entonces ahora anchura baquet 256 recargo y recordemos que la anterior han sido 20 segundos así que ahora empieza a calcular ahora empieza a calcular y bueno el tiempo finalmente el máximo ha sido de 18 segundos o sea que ha estado un poquito por debajo de la anterior curiosamente no me lo esperaba pero vale ahora vamos a darle por ejemplo 25 6 128 64 vamos a verlo pero bien ahí vemos que el procesador no le está usando tanto y vamos a ver por ahí y el tiempo ha sido de 42 evidentemente pero también este es cierto que le puedo decir que trabajadores es igual a esto por 8 y puedo hacer la prueba de tener más trabajadores vamos a verlo vemos como el procesador bueno lo está utilizando pero tampoco mucho así que yo creo que pues parece que hacer los banquetes más pequeños no nos va a dar más eficiencia porque en definitiva pues pierde parece pierde bastante tiempo transfiriendo la información vemos como el último tiempo ha sido de 36 segundos así que yo creo que el mejor tiempo lo hemos conseguido antes cuando hemos conseguido prácticamente 20 segundos hay que tener en cuenta que el programa originalmente hacía esto no sé si sería el índice 6 vamos a verlo el f 6 hacía esto a nuestra selección 90 bares pero vale pues hacía esto en 0,4 segundos ya está tardando 20 segundos o sea que está claro que evidentemente aparentemente lo que está haciendo es perder mogollón de tiempo pero no es tanto así es decir el tiempo que ahora mismo estamos perdiendo en dividir la información es el tiempo que más adelante podemos ganar repartiendo esta información a lo largo de diferentes dispositivos de cálculo entonces siempre hay que seguir optimizando siempre hay que seguir trabajando y en definitiva pues siempre vamos a poder digamos controlar la ejecución de los objetos otra cosa que voy a hacer es que voy a desactivarlos con soles porque tengo miles de con soles y eso quién es que no también hace que se ralentice el trabajo así que vengo por aquí vamos a quitarlos con soles este no muy bien vamos a quitarlos con soles de la tarea si es que los hay vale parece que no vamos a recargar en definitiva únicamente quiero ver pues los con soles del final eso tampoco va a hacer milagros tampoco va a hacer maravillas pero sí que es cierto que el con sol e pues finalmente ralentiza entonces pues tengo que tenerlo en cuenta vamos a verlo finaliza la ejecución y 28 segundos pues bueno algo de tiempo si es que hemos ganado