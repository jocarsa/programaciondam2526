a continuación voy a hablar de bueno de un una de las metodologías que encontramos en javascript que es la metodología Ajax las conexiones asíncronas entre cliente y servidor que a día de hoy Son Pues básicamente la forma estándar de trabajar con muchas aplicaciones web voy a crear un nuevo repositorio llamado Ajax ahora explicaré qué es Ajax añado un readm voy a crear un repositorio Y en este caso lo que voy a hacer Es que voy a clonar el repositorio voy a buscar el repositorio Ajax selecciono Ajax y lo voy a clonar mira ahí mismo en C shamp hdd Ajax ahí así que clono y ahora a continuación vamos a empezar explicando que eh Hay voy a ponerlo aquí en el propio brackets voy a seleccionar htd voy a ir a Ajax y voy a crear la carpeta 002 introducción donde voy a decir explicación donde voy a decir que Ajax quiere decir asíncronos javascript and xml esto quiere decir que el xml o perdón el javascript no se va a cargar de forma eh sincrónica Es decir no se va a cargar en el momento en el que se carga la página sino que se va a poder cargar de forma asincrónica siempre que queramos una vez que la página esté cargada hay muchas formas de hacer Ajax con javascript pero yo voy a explicar a continuación las dos formas que no dependen de ninguna librería externa hay librerías tales como por ejemplo la de jquery que nos permiten hacer Ajax de una forma sencilla con varios métodos pero en esta ocasión lo que voy a hacer es explicar Ajax con javascript puro sin ningún tipo de librería Y probablemente más adelante explicaré Ajax Med an librerías Pero no quiero que dependamos de librerías Así que vamos a empezar creando una carpeta 003 Ajax o voy a poner xml http request este nombre Tan sencillo es el nombre de la primera de las librerías y voy a crear una carpeta 001 objeto o instanciación y aquí a continuación voy a crear archivo llamado Index html en este archivo Index html voy a hacer un doc type voy a hacer un archivo html lo más sencillito posible voy a hacer un Head voy a hacer un Body voy a poner las etiquetas mínimas para que esto sea válido desde el punto de vista de la w3c Así que title y eh aprendiendo Ajax vale una vez que tengo esto ahora dentro del Body voy a poner un Script y en el Script lo que voy a hacer Es que voy a crear un identificador en este caso va a ser una constante porque no va a variar voy a poner const y voy a poner lo siguiente e const petición es igual a xml http request que ocurre que como digo como comento es un objeto predeterminado dentro de El dentro del navegador dentro de javascript de esta forma vamos a ejecutar es interesante que ejecutemos esto a través de shamp a través de un servidor web y no en no de forma completamente local por tanto localhost bar Ajax me voy a xml http request instanci Vale y de momento no tengo nada Es decir Oh bien Ah perdón New esto es igual a New xml http request Ahora sí bien he creado un nuevo objeto y ahora una vez que le he indicado al navegador que voy a hacer una petición asincrónica ahora a continuación voy a ver a dónde hago esa petición A qué URL hago esa petición selecciono hddc me voy a Ajax bien y duplico este proyecto y ahora va a ser ruta claro Cuál es la ruta a la cual voy a hacer la petición Bueno pues la ruta puede ser cualquiera const ruta es igual a algo yo en este caso voy a poner http do bar barra y Bueno voy a poner directamente el archivo voy a poner servidor.php lo que va a hacer en este caso es Buscar un archivo llamado php servidor php que contenga algo de información vale importante en Ajax tiene que existir una parte javascript pero el servidor no tiene por qué estar en el lenguaje php el servidor puede ser lo que yo quiera puede ser php puede ser Java Enterprise puede ser python puede ser Eh asp.net puede ser no dejs puede ser lo que quiera vale en este caso Estoy haciendo de hecho incluso hay una cosa que es que son cgis que se pued pu hacer con c puro vale eh yo en este caso lo voy a hacer con php Pero no quiero que se entienda como que estoy diciendo que Ajax Hay que hacerlo con php no es muy común hacerlo con php pero no es obligatorio hacerlo con php Así que recargo ruta Vale y de momento no tengo nada porque a continuación voy a hacer lo siguiente Esto me lo duplico por aquí ruta y Esto va a ser este archivo va a ser apertura y envío vale así que dentro de apertura y envío la verdad es que aquí la verdad es que aquí petición como es una nueva instancia Pues técnicamente podría hacerlo con mayúsculas no es que se vaya a hundir el mundo Pero bueno por buenas prácticas pues ya que es una instancia de una clase Pues bueno pues lo ponemos en mayúsculas lo que digo por buena costumbre no entonces pongo petición punto Open voy a abrir una petición la voy a abrir con el método get y lo que hago es abrir la ruta que hemos definido anteriormente es decir en la petición abro la ruta y la abro con el método get y ahora a continuación petición Send bien una vez que hago esto Ahora voy a ejecutarlo y me dice que servidor.php is not Found vale porque evidentemente pues no ha sido encontrado con lo cual Eso quiere decir que yo ahora voy a crear un nuevo archivo llamado servidor.php y en servidor.php voy a poner un Script que diga hola mundo desde php con lo cual ahora si recargo veremos que ya no da error porque veremos que efectivamente html se está conectando a php pero se está conectando de forma asíncrona vale no me está incrustando php en html como es muy común hacer sino que html está cargando de forma pura y una vez que ha cargado en ese caso le pide algo de información a php bien Por lo tanto a continuación vamos a devolver algo de texto vamos a dónde estás Vamos a aquí hemos abierto hemos enviado y ahora quiero recibir quiero recepción de datos por tanto una vez que tengo recepción de datos ahora a continuación en el Index html digo petición punto on es decir cuando sea correcto cuando esté correcto en ese caso lo que voy a decir es igual a fun yo prefiero esta sintaxis vamos a ver y voy a decir fun vamos a ver función e y voy a decir console log petición response t tengo text tengo response xml vale Ya hablaremos de ello pero de momento response text Así que si esto funciona correctamente recargo me voy a recepción de datos Y creo que podremos ver que en este caso pues tengo claramente Hola mundo desde php Hola mundo desde php lo que ha hecho en este caso a ver un momento lo que ha hecho en este caso Pues básicamente consiste en conectarse a servidor.php y devolverme algo en pantalla bien Vamos allá vamos a ver Okay aquí tengo una implementación sencilla pero vamos a ver si capturamos algún tipo de error Vale entonces para capturar algún tipo de error lo que voy a hacer es lo siguiente vamos a captura de errores voy a forzar un error también evidentemente y Estado de la conexión 005 estado de la conexión y voy a hacer lo siguiente eh vengo por aquí y digo console log el estado de la conexión es do punos más petición r estate en este caso vamos a verlo el estado de la conexión es dos el estado de la conexión es 3 el estado de la conexión es cu vale vemos como tengo por parte el tipo de conexión y tengo también un momento y tengo también el código de la conexión es petición status recargo y me dice la conexión es 200 el estatus es 200 Eso quiere decir que yo en un momento dado puedo detectar cuando me ha devuelto un 200 que es básicamente que te sirvo la página web correcta Pero qué pasa si vengo al servidor y digo ecoe o sea un error de php evidentemente Pues que recargo Y entonces vamos a ver Bueno me dice conexión 200 vale pero eh vamos a ver pero claro tengo un pars error me gustaría tener un error 500 vamos a ver por ahí vale creo que en este caso no me va a dar un error 500 tal y como tengo configurado el servidor Pero bueno Vale pues voy a hacer un eco por aquí porque creo que en shamp no voy a poder forzar un error servidor dos Mira 404 vale Ahí tengo un error 404 Entonces en ese caso ahora he forzado un 404 no he encontrado vale por lo tanto ahora voy a capturar el error 006 captura del error y voy a hacer lo siguiente vengo por aquí y digo Si petición punto status es igual a 200 en ese caso console log response text pero en caso contrario voy a decir console error o console Warning por ejemplo voy a decir error más petición status de esta forma capturo el error y me dice hola mundo desde php Pero si por lo que sea fuerzo un error no he encontrado me dice error 404 vale Y yo ya a partir de ahí pues evidentemente puedo capturar el error y puedo hacer Pues sí es 404 devuelve en la pantalla no encontrado si es 500 devuelve la pantalla error de servidor si es no sé qué otro es eh servidor saturado vale En definitiva puedo manejar los errores y me puedo adaptar a los diferentes códigos de error que tenga en mi aplicación bien con esto lo que hemos hecho es crear una crear un primer ejercicio en el cual hemos trabajado con una petición y hemos eh hemos recuperado información del servidor pero Cómo podemos enviar información al servidor vamos a ver Vale pues a continuación vamos a ver de qué formas yo puedo realizar una petición vamos a ver vale Voy a duplicar esto de aquí voy a decir 007 envío de información y al procesar el envío de información voy a plegar unas cuantas de estas carpetas bien Ahora a continuación lo que quiero es lo siguiente cuando envío la información Quiero enviar por ejemplo con método get eso es un poco lo que queramos y eh Quiero enviar datos Entonces al enviar los datos voy a hacer lo siguiente bar datos es igual a 4 por ejemplo y ahora vengo por aquí y digo Data no Data es igual a más datos Y yo de esta forma también lo que voy a hacer vamos a ver si lo puedo atrapar Okay quiero calcular el doble me voy a servidor y digo eco el doble es punto get Data multiplicado por 2 vamos a verlo de esta forma y ahora vengo recargo envío de información 404 porque estoy llamando a servidor 2 vale recargo vale me dice undefine array key Data vale vamos a ver qué es lo que está viniendo por la información Ah voy a decir que petición setet request header y en el request header voy a decir que content type coma y voy a decir que es application barra xw form W y URL encode vale con esto hago así recargo vale voy a volcar voy a hacer un bardom de get y vamos a por ello Entonces vamos a ver vale entonces hago así e get no hace falta que tenga esto recargo vale Y dice a raíz de cero Okay Send Data datos es igual a 4 vamos a ver vale entonces Bueno una cosa que puedo hacer es ponerlos en get vale voy a otra estrategia Okay datos es igual a 4 y entonces digo ruta más igual a datos es igual a datos esto tiene que ir antes y eso tiene que ir después datos o Data datos lo que sea o número es igual a datos lo que sea bien hago así recargo vale assign to constant variable luego ruta va a ser un bar entonces hago así bien Tengo un 404 no he encontrado porque aquí me hace falta Esto me hace falta un interrogante bien y ahora sí tengo un número que me devuelve un Stream 4 con lo cual ahora en servidor ya puedo venir aquí y decir eco el doble del número es punto get número multiplicado por dos esto quiere decir que yo ahora vengo y recargo y me dice que el doble del número es 8 porque yo en el código le he pasado cuatro y por tanto lo que hace es enviar mediante get ese dato digamos a esa parte al servidor y el servidor lo multiplica por dos y me lo devuelve importante que nos demos cuenta en este caso de que quién es está multiplicando por dos es el servidor y no es el cliente es decir quien Está realizando la operación es php y no es javascript Sería más fácil hacerlo en javascript sí pero hay veces que queremos que lo haga el servidor porque hay veces que queremos seguridad o protección o conexión con base de datos o muchas otras cosas bien Voy a hacer lo siguiente eh voy a decir nueva ruta esto voy a mantenerlo como const Y esto es nueva ruta es igual a ruta más esto de aquí y yo creo que esto es bastante más seguro bar nueva ruta y nueva ruta esto es bastante yo creo que bastante más limpio bien Ahora voy a hacer que esto sea interactivo porque hasta este punto diremos Bueno pues no entiendo muy bien Para qué me sirve esto en mi vida pero yo ahora voy a hacer que esto sea interactivo envío inter intivo entonces una vez que es interactivo a continuación lo que voy a hacer Vamos a ver Es que aquí en el Index html voy a decir input type text y de campo yid campo Sí vale Y eh Button Calcula yo ahora quiero enviar un parámetro de forma dinámica y por lo tanto ahora a continuación voy a hacer lo siguiente voy a crear vamos a ver document punto query selector voy a seleccionar el buton y voy a decir que onclick es igual a function voy a hacer el texto un poco más pequeño y en el function voy a hacer esto Solo que los datos ya no van a ser el número cuatro a paloseco y petición Send sino que los datos van a ser document punto get Element by ID campo punto value Quiero el valor de ese campo así que atrapo los datos de forma dinámica voy a guardar esto y ahora me voy a la siguiente parte del ejercicio envío interactivo y ahora digo cinco Calcula y me dice hay un error ahí Pero bueno vale envío interactivo línea 23 vale sin petici estatus Okay eso me lo puedo dejar bueno dice que hay un error que realmente no hay un error lo que puedo hacer es decirle que si petición punto ready State es igual a 4 o sea cuando la petición finaliza y así no tengo ese falso error vamos a verlo le digo cco le doy a Calcula y me dice el doble del número es 10 le doy a 12 calcula el doble del número es4 le doy a 45 calcula el doble del número es 90 es decir ya no estoy realizando un envío estático de datos sino que ahora el envío es Dinámico en función de lo que el usuario introduzca Dentro de este campo esto que acabo de hacer es una sencilla demostración que evidentemente más adelante vamos a ampliar con demostraciones prácticas pero de momento implementa la metodología de conexión asincrónica entre el servidor y el cliente php en este caso no es necesario que se cargue de forma sincrónica cuando cargo el documento sino que puedo cargar php de forma asincrónica en el momento que yo quiera Cuando pulso este botón enviando información calculando la información en el servidor y devolviendo la información de vuelta a html a través de javascript teóricamente eh la implementación original de Ajax tal y como he comentado antes en la explicación estaba orientada hacia cargar xml a través de estas peticiones asíncronas sin embargo desde prácticamente el principio de la existencia de Ajax eh el xml se cambiado por Jason ya que Jason es por tanto sería ahag prácticamente Jason es el formato de datos nativo para compartir información dentro de javascript y Eh Pues en 2008 2009 cuando se empezó a poner muy de moda el Ajax pues Jason ya empezaba a reemplazar claramente a xml para la transferencia de datos por esta razón vamos a ver por esta razón voy a crear una nueva un nuevo apartado llamado Ajax con json Y en este apartado llamado Ajax con Jason voy a hacer lo siguiente voy a crear una nueva carpeta voy a duplicar esta carpeta voy a crear un archivo 001 y voy a poner eh carga de Jason y carga de Jason bien Así que puedo venir por aquí servidor de momento lo voy a eliminar y en el Index html quiero eliminar todo esto que he hecho antes no lo quiero ahora petición sí ruta Sí el buton no lo quiero eh on ready Stay change vale nueva ruta nada y lo que voy a hacer en este caso aparte de ahorrar líneas vale voy a cargar la ruta y voy a cargar un archivo llamado datos. Jason en datos. Jason evidentemente Pues voy a cargar voy a crear un nuevo archivo llamado cuidado aquí datos Jason y en este archivo Jason Pues voy a crear algo así como clientes nombre dos punos josé Vicente vamos a ver esto lo pongo bajo coma email @info @ josevicenteabadcoca eh teléfono es Eh pues 1 2 3 4 en número bien ya tengo un json válido Así que ahora a continuación cargo datos. json y lo que quiero es en el petición response text Quiero ver qué aparece De hecho si vengo por aquí vale veré que por la r tengo response text respon type response xml response bien recargo por aquí me voy a Ajax con jas carga de js properties en la línea 10 a ver Ah esto fuera datos fuera no lo quiero no existe bien datos is not Define no quiero parámetros fuera vale hago un Send y como podemos ver pues lo que obtengo es eh En este caso pues un String que corresponde a el jas que tengo dentro de ese archivo lo cual quiere decir que yo ahora lo que puedo hacer Vamos a ver vale lo que puedo hacer es parse js con lo cual vamos a esto digo jas ponerlo como variable bar js es igual a jsps de petición response y ahora hago console log de json vamos a ver jsps vale pars con minúsculas como decía pars con minúsculas recargo y veo aquí y que ya tengo la información en Jason a ver un momento ahí esta p se me ha colado por aquí con lo cual como podemos ver tengo ya la información que se me devuelve en formato js y ahora por ejemplo pues evidentemente puedo decir que quiero el js completo momento que me está dando unos problemas de refresco de pantalla ahora abriré y cerrar el brackets o quiero js nombre y veo que tengo ahí José Vicente y En definitiva puedo acceder al js sin ningún tipo de problema otra cosa que puedo hacer momento voy a cerrar brackets y volverlo a abrir vale otra cosa que puedo hacer es generar un jas de forma dinámica mediante php o mediante cualquier otro lenguaje de programación vale quiero dejar muy claro que eh estoy hablando de php Pero simplemente por mencionar un lenguaje de programación del servidor pero se puede hacer con cualquier lenguaje del servidor Jason desde php Así que ahora en este caso lo que voy a hacer es cargar aquí en Jason desde php voy a cargar datos.php y datos.php eh este datos. json lo voy a eliminar voy a crear un archivo llamado datos.php pero aunque este archivo Será php pero realmente va a gestionar datos de forma dinámica Entonces vamos a verlo a continuación yo ahora vengo por aquí y digo php voy a hacer un eco jas a Bestia y digo switch get cliente y entonces digo en el caso de que me envíes el cliente número uno pues en ese caso eco y voy a poner aquí un jas y luego voy a poner un break esto lo estoy cargando desde php podría venir directamente desde base de datos vale en este caso como digo lo estoy haciendo desde php para que quede más claro y más sencillo y más entendible Case 1 pues ese cliente Case 2 pues quiero Juan que es Juan @ josevicenteabadcoca crear un input type text y de ID cliente y ya está Entonces ahora a continuación digo lo siguiente bar nueva ruta es igual a ruta más interrogante y cliente era cliente no me acuerdo es cliente Sí y cliente es igual a document.get Element byid y cliente punto value con lo cual nueva ruta ejecuto nueva ruta y esto lo voy a hacer document.get Element byid cliente punto change on change cuando esto cambie entonces me vuelves a enviar la petición esto sigue í Atrapado vale cada vez que ID de cliente cambie pues me envías la petición y ya que estamos pues voy a hacer una pequeña tablita no es muy limpio pero bueno voy a hacer un TR dónde voy a poner eh ID de cliente TD y voy a poner ID recibe ID realmente voy a poner nombre de cliente porque el ID da un poco igual porque ya lo tengo arriba recibe nombre Table voy a poner Border es ig a 1 with es igual al 50% un poco para darle un poco de estiloque sea estilo en línea feo pero vale e email de cliente teléfono de cliente este es recibe nombre este es recibe email y este es recibe teléfono vale con lo cual ahora a continuación lo que voy a hacer es lo siguiente vamos a ver Okay ahora a continuación en lugar de decir console.log pues voy a decir document.get Element byid recibe nombre punto innerhtml es igual a json nombre esto lo voy a copiar y en recibe email j. email y en recibe teléfono json teléfono qué es lo que hace esto Bueno pues lo que hace esto es que yo ahora vengo aquí al navegador cargo jas y si yo digo número uno y si todo ha ido bien pues Okay no eh No datos js no es datos js es datos pun php vale recargamos pongo el número uno y me dice pues el mira el número uno es José Vicente cojo el número dos Pues el número dos es Juan cojo el número tres Pues el número tres es Jorge De hecho el número tres aquí Debería ser Jorge y el teléfono lo voy a cambiar y el teléfono lo voy a cambiar así que de hecho no hace falta ni que recargue porque démonos cuenta que como la petición es asincrónica me carga los datos como digo de forma asíncrona entonces qué ocurre con esto Pues que démonos cuenta de que el cliente no está cargando todos los datos el cliente solo carga el formulario y cada vez que yo vengo aquí y realizo una petición lo que hace esa petición es que se está conectando a un Script en php donde este Script en php en este caso tiene una serie de casos pero se podría estar conectando a una base de datos ahora mismo No quiero hacerlo para no complicar más la cuestión pero en la parte de ejercicios prácticos pues ccar entonces la idea Está en que no me está dando un jas estático como lo hacía antes sino que me está dando un jas condicionado a la ejecución de ese Script php Y entonces depende un poco de vale de qué ID le pase me enseñará un ID o me enseñará otro evidentemente donde Aquí he hecho tres casos podría hacer 3 millones de casos y donde aquí estoy poniendo el J son directamente en el archivo php Pues evidentemente podría estar recuperándote de datos mongodb que me da json directamente o bien de una base de datos mysql donde luego lo podría convertir a Jason y puedo hacer un poco lo que quiera con todo esto pero En definitiva pues esta es una demostración más práctica y Más directa y más real de cómo utilizamos eh Ajax para realizar peticiones asíncronas y eh pedirle cosas dinámicamente al servidor hasta el momento hemos estado trabajando con el Ajax puro el Ajax antiguo Pero existe vamos a quitar esto por aquí existe una forma nueva esto es Ajax aquí de establecer comunicación asíncrona entre cliente y servidor con Ajax puro en este caso me estoy refiriendo a trabajar con Ajax puro y esto se hace utilizando la app fch vamos a crear una nueva carpeta 001 fetch inicial y voy a hacer lo siguiente vamos a ver dentro de 001 voy a crear una carpeta llamada conexión Okay esto es Vale y dentro de conexión voy a crear un archivo Index html que va a tener un doct type html una etiqueta Head una etiqueta Body y en el Head voy a poner un title aprendiendo Ajax aprendiendo fch lang es igual a s y en el body voy a hacer lo siguiente vale en el body lo que voy a hacer es decirle al sistema Bueno voy a poner por aquí un Script donde voy a especificar Windows onload es igual a function básicamente para que me ejecute algo únicamente cuando yo lo pida y voy a crear una un nuevo archivo llamado usuarios Jon de momento va a ser una un archivo estático entonces voy a poner nombre es pues jocars usuario voy a crear unos cuantos usuarios Juan Jorge Julia no sé Julián y Jaime Así que una vez que tengo esto dentro del Index html voy a hacer un fetch y al indicar el fch indico especialmente indico directamente el archivo que quiero cargar ese archivo de momento lo estoy cargando de forma estática desde el servidor pero podría estar siendo un archivo que me proporcionara pues php o cualquier otra tecnología Bien voy a hacer esto voy a ir a localhost barx local Host barra Ajax me voy a fetch me voy a fetch me voy a conexión y de momento no tengo nada evidentemente porque tampoco he dicho que tenga que pasar nada en la pantalla ahora bien una vez que tengo Esto me voy a os me voy a shamp me voy a htdoc me voy a Ajax me voy a fetch dentro de fetch ahora no solo Quiero conectarme a un archivo sino que quiero algún tipo de retorno entonces una vez que tengo el retorno ahora lo que voy a hacer es lo siguiente fetch y una vez que tengo el fetch hago voy a poner un poco de sangría punto den y digo response vamos a ver y bueno vamos a los datos vamos a ver y digo punto den response punto den función response y en el response esto lo pongo con sangría voy a hacer return response.js una vez que tengo esto a continuación Quiero recuperar los datos por tanto retorno ahora datos me voy a los datos y en los datos digo otro punto den y digo function datos Ahora sí y digo console.log datos si hago esto y ahora recargo me voy a los datos veo que tengo en principio código nativo de Jason y vamos a verlo porque ahora aquí lo que quiero es esto también lo quiero en el número dos para que lo que me devuelva sean los usuarios vemos como de una forma yo creo más sencilla de lo que ocurre con Ajax Pues con Ajax puro con el Ajax antiguo digamos obtengo en la pantalla los datos de los usuarios voy a hacer una siguiente versión porque qué ocurriría si yo pido usuarios dos Pues que vale me da un error bastante feo me para la ejecución Entonces voy aquí a crear una siguiente versión 004 captura del error y al capturar el error pues el propio método fetch toma un Catch toma una condición Catch donde digo function error es console pun log error así que me voy a esta parte recargo captura del error vale pero en este caso al menos nos dice is not a valid Jason y por tanto no para la ejecución y digamos este código es más seguro en el caso de que pues se produzca alguna situación que Eh pues que digamos merezca atención o merezca solución bien dicho esto eh voy a hacer un ejemplo de fch eh que nos pueda servir al máximo posible y para ello voy a crear una versión 5 del ejercicio donde voy a decir validación de usuarios Así que en el cinco validación de usuarios momentín Yo vengo por aquí y digo Escoge un usuario para tu aplicación y lo que hago en este caso es decir lo siguiente una vez que he traído los usuarios puedo escoger vale puedo elegir y digo vamos a ver Escoge un usuario para tu aplicación type vamos a ver type text yid usuario y por tanto Ahora puedo hacer lo siguiente y es document.get Element by ID usuario pun change K app es igual a function y claro si tengo los datos Ahora puedo hacer lo siguiente bar datos jas es igual a nada y ahora digo datos js es igual a datos de tal forma que ahora con log datos vamos a datos J vamos a asegurarnos de que están llegando los datos quiero usuarios bueno bien quiero a b a ver un segundo eh No me está cogiendo Esto vale documentelement byid usuario ID usuario Ke es igual a function console pun log Ok validación de usuarios vamos a asegurar que estoy en el sitio correcto sí no es que yap es onk app vale venga toco bien y ahora a continuación y a la continuación yo lo que quiero es comprobar si existe un usuario por tanto ahora voy a hacer lo siguiente voy a crear una clase Style la clase Ok tendrá un Border de un pixxel solid Green y la clase Ko tendrá un Border de un Pixel solid red además voy a hacer background rgba 0,255 com. o sea verde semitransparente y esto es background rgba 0 com no 255,0.2 O sea rojo semitransparente de esta forma yo voy a hacer lo siguiente en primer lugar for Let I es igual 0 Y es menor que datos jas son. leng y+ má voy a repasar la lista de usuarios para ver si el usuario existe o no de esta forma diré lo siguiente vamos a ver diré Let existe es igual a false de momento y digo Si datos jas son punto qu punto usuario es igual ais value en ese caso existe es igual a al final del todo si existe es igual a false pues dis ad cl momn un mom vamos a ver cl esto es dis pun classlist ad y koo no perdón Ok al revés dis cl list remove Ko en el caso de que exista en caso contrario al revés remove Ok y ponle co si esto es correcto si esto ha ido bien recargo Pongo aquí algo aect token els por qué Pues porque aquí falta una llave vale pongo es verde verde to es verde tu usuario es OK Pero si pongo hocar en el momento en el que pongo sa Debería vamos a ver elements vamos a ver Class Ok vale no debería ponerlo verde vamos a ver voy a hacer lo siguiente voy a decir que console punto log dis pun value vamos a ver cuál es el value Ah a no está cogiendo el value vale no está cogiendo el value por qué Ah muy bien Vamos a ver console.log dis value a es correcto vale datos J son de usuario igual Esto es así Okay bien digo datos J son de usuario console pun log datos J son de usuario undefine ahí está el problema ahí está el problema vale datos jas Dame datos jas Ah muy bien es datos J son de I punto usuario me faltaba el array muy bien entonces hokar sa y ahí vemos que en el momento en el que cojo uno de los usuarios que previamente existe pues en ese caso me dice que no en ese caso me dice que ese usuario no lo puedo o si pongo heim Pero pongo e pues en ese caso me dice que es de color rojo es decir lo que está ocurriendo en la pantalla básicamente y para entendernos es que pues el sistema está utilizando sj son con usuarios que he cargado para saber si el usuario pues es correcto o no es correcto esto no es muy seguro en el sentido de que eh yo lo que estoy haciendo es digamos recuperar toda la información y se están transmitiendo los nombres de usuario a este lado de la aplicación lo cual insisto como digo pues no es particularmente seguro porque de esta forma el cualquier usuario tendría en su propio ordenador un listado de todos los usuarios de la base de datos Y esto pues no está bien así que para ello voy a realizar un fetch pero en esta ocasión lo que voy a hacer es enviar datos 00 enviar datos selecciono el último ejercicio este va a ser el primero 006 enviar datos Y entonces voy a hacer lo siguiente vamos a ver 001 002 Enviar datos vale Y entonces por aquí voy a hacer lo siguiente vamos a ver vale esto de momento fuera igual luego lo vuelvo a reconstruir Y entonces digo eh quiero cargar comprueba php esto lo pongo aquí y en el comprueba php lo que puedo hacer es decirle eh parámetros en los cuales le voy a enviar información y entonces hago lo siguiente vamos a ver Esto no es window unload sino que esto es document.get Element by ID usuario punto onk app es igual a function es decir cada vez que el usuario pulse una tecla se ejecuta comprueba php y le voy a pasar unos datos Y entonces le voy a decir method es igual a post coma headers va a ser content type es application vamos a ver Jason Bueno voy a hacer un js vale Y en el body voy a hacer lo siguiente json stringify y digo clave dos puntos valor esto es un jas clave dos puntos valor bien Si yo hago esto ahora Esto me debe dar error porque no existe el archivo con prueba.php ahora Existirá vamos a verlo Ok todo Ok vale vamos a verlo vengo aquí atrás enviar datos vale toco una tecla y me dice comprueba php no existe Okay Venga pues no pasa nada Vale pues Ahora a continuación voy a crear el archivo de comprueba voy a escribir un poco el Script más sencillo que pueda Eh php vale Y voy a crear una archivo llamado comprueba php Y en este archivo comprueba php voy a decir de momento bardom post es decir Enséñame todo lo que venga por post vamos a verlo creo que aún así dará error porque lo que voy a devolver no es un jas Ah vale Okay bien eh Me dice unexpected token a en array 0 vale Okay perfecto y se nota V jas entonces voy a venir por aquí voy a venir por aquí y voy a decir eco js gu encode de post Quiero ver todo lo que viene por post y ya que estamos pues lo quiero ver en formato Jason Así que pongo aquí vale Y me dice en este caso que me está devolviendo un array vacío vale vamos a ver un momento vale aquí en el Index en los headers voy a decirle que no es j Okay y vamos a ver HM voy a enviar un form Data forma y de form usuario Y entonces Aquí voy a hacer lo siguiente vamos a ver formulario es igual a document getelement by ID form usuario vale a continuación voy a decir que vamos a ver datos formulario es igual a New form Data del formulario porque entonces en datos formulario lo que hago es que en el body pongo los datos formulario a ver un segundo que compruebe que tengo por aquí abierto Okay Vale hay algo que tengo abierto no sé qué es bueno bien entonces si todo va bien envío vale me devuelve de momento algo vacío headers nada respon J son y datos esto fuera Ok y vamos a ver qué puede estar fallando Vale pues el error era sencillo Simplemente no estaba poniendo aquí un name entonces name usuario y eso qui decir que ya aquí empiezo a poner usuario y atención porque esto es lo que me está devolviendo el servidor es decir si aquí estamos viendo una básicamente lo mismo que estoy poniendo en la pantalla es porque el archivo php el comprueba eh básicamente ahora mismo lo que está haciendo es devolverme lo mismo que yo le estoy enviando que tú me envías un post Pues yo te devuelvo un post Vale ahora bien Ahora lo que puedo hacer ahora lo que puedo hacer es en php mirar a ver si existe ese usuario por tanto hago así y digo 008 php comprueba usuario Así que en comprueba usuario vamos a ver voy a seleccionar esto vale lo que voy a hacer en este caso es parsear el jas y decir lo siguiente a ver vale vengo por aquí y digo archivo es igual a usuarios Jason a continuación digo cadena json es igual a file B get contents de archivo eso lo que va a hacer es con lo cual ya tengo de momento la los usuarios cargados de un archivo Jason esto podría ser cargado de una base de datos pero evidentemente pues lo quiero hacer más sencillo Así que ahora a continuación lo que voy a hacer es lo siguiente vamos a ver vale Ahora quiero parsear for each usuario vamos a ver for each J son as usuario vale Y ahora una vez que tengo este usuario digo si usuario de usuario es igual a qué bueno pues a post usuario Porque por eso he pasado por post usuario en ese caso voy a decir vamos a ver que existe es igual a false existe es igual a true la misma lógica de antes así que al final digo si existe es igual a false en ese caso eco y pongo estado dos puntos si existe Okay en caso contrario estado Ko O sea no devuelvo un usuario devuelvo un Ok o un Ko de tal forma que los usuarios nunca viajan al lado del cliente bien php con prueba usuario php comprueba usuario aquí nos dice que unexpected token is not valid J son vale Ok hay un error me parecer y br estoy comprobando si he cometido algún error si me falta algún punto y coma vamos a bloquear Esto sí vale sx error unexpected ok voy a hacer una cosa vamos a ejecutar con prueba.php Aquí está el error vale No puedo usar un objeto de tipo sdd Class en la línea 9 si usuario es igual a usuario como array muy bien bardum usuario y a ver qué pasa Ok object std Class Vale ahora digo Dame usuario ahí okay pero si pongo usuario me dice esto de aquí lo cual vale vamos a decir que como es un objeto accedo como propiedad usuario Vale ahora sí pues esto lo quito usuario Ahora puedo hacer esto y vuelvo atrás pongo a bien expected property name or in J posi tal te estoy devolviendo un jas una vez más voy a vamos a ver comprueba undefine usuario voy a decir get voy a hacerlo con get y así puedo probarlo usuario es igual a estado Ok vale con lo cual voy a ver si lo que me está pidiendo son comillas simples y ahora aquí comillas dobles estado y estado formate un jas que en principio es correcto vale Aquí voy a poner post estado Ok vale perfecto Ahora sí estado Ok Pero si pongo jarsa me dice estado Ko vale Ahí no me deja fijémonos que me devuelve únicamente el Ok O el Ko ningún momento me devuelve ningún usuario que no sea el que yo he puesto lo cual evidentemente es mucho más seguro y ahora voy a hacer una actualización del estilo 009 actualiza estilo Vale y Al actualizar el estilo vamos a ver Index okay Y ahora hago lo siguiente response J son Vale pues sí si datos punto estado es igual a Ok en ese caso document get Element by ID usuario punto classlist pun ad y es Okay y document Element punto remove al contrario en el caso els copio esto lo pego remove Ok ad Ko y ya está Vale pues vamos a ver vamos a probarlo me voy al 09 actualiza datos unexpected identifier document document vale En qué línea en la 24 document get Element by ID ah no sé por qué dice unexpected a ver en principio documento no actualiza estilo Me parece extraño creo que tiene que ver con los saltos de línea sí efectivamente tiene que ver con los saltos de línea Ahora sí vale porque no estaba saltando correctamente la línea vale Bueno pues a y ahora por ejemplo digo hokar pongo una a y se me pone de color rojo porque el estado es Ko pero pongo un estado de color verde y como podemos comprobar de esta forma Ahora sí pues tenemos una validación de usuario mediante Ajax pero que no la estamos haciendo de forma que obtenemos todos los datos del servidor sino que lo hacemos de una forma más limpia y más elegante es el servidor el que realiza la comprobación y el servidor únicamente nos devuelve Ok oko y el servidor no tiene por qué compartir de forma indiscreta con nosotros pues toda la lista de usuarios a la vez a continuación voy a desarrollar un ejercicio mediante el cual realmente pongamos en valor todo aquello que la programación Ajax nos pueda ofrecer Así que en este caso lo que voy a hacer Es que voy a crear una carpeta llamada 006 ejercicio práctico que va a ser un chat voy a crear un chat mediante javascript y un poquito de php pero sobre todo quien me va a ayudar es javascript así que voy a crear una carpeta 001 eh proyecto y estructura y dentro del proyecto estructura voy a crear un archivo bueno lam cliente html y luego crearé otro archivo llamado servidor.php para un poco dejar claro qué es lo que va a tener cada uno de ellos voy a crear un doc type html voy a crear una etiqueta html voy a crear una etiqueta Head y a continuación voy a crear una etiqueta Body dentro de la etiqueta Head voy a poner un title voy a poner chat y dentro del html voy a poner lang es ig a s y de esta forma tenemos pues una estructura que mínimamente eh cumple con todo aquello que se necesita voy a intentar mantener este chat lo más sencillo posible voy a intentar mantener este proyecto lo más sencillo posible y eh Para ello voy a hacer una cosa eh voy a poner para empezar link rel es igual a alternate no a stylesheet y href es igual a estilo.css y a continuación voy a crear por aquí una etiqueta llamada Script que va a tener un src y chat.js bien Ahora a partir de ahí voy a crear los estilos correspondientes Pero antes de crear el estilo voy a crear lo que sería sera la estructura del chat Entonces vamos a ver voy a poner un Main voy a poner un header en el header voy a poner h1 chat y a continuación dentro del dentro de la etiqueta Main voy a poner en primer lugar un nombre por tanto div ID o login o inicio de sesión inicio y voy a poner un input type text ID usuario y un buton eh Inicia sesión Al que le voy a poner el botón ID envía usuario una vez que tengo esto voy a poner un div ID chat al que le voy a poner por aquí vamos a verlo un div ID contiene mensajes y voy a poner un input type text name ID mensaje y ya Bueno pues a partir de aquí voy a sacar la carpeta donde está Esto vale Y en Ajax en el ejercicio práctico en el proyecto estructura ahora a continuación Vamos a darle un poco de estilo y voy a hacer lo siguiente de hecho más que vamos a hacer Script Mostrar y el Script Mostrar lo que va a hacer es lo siguiente si yo ahora arranco shamp y me voy al proyecto lo tengo ya arrancado vale me voy a Chrome y arranco por aquí y digo localhost bar php oo no me voy a Ajax vale me voy a ejercicio práctico me voy a Script entro en el cliente y Inicia sesión Vale entonces voy a poner aquí la etiqueta meta charset es igual a utf8 Ok vale Y esto dónde lo necesito en la estructura Pues también lo necesito en el escripto vale entonces si yo ahora pongo José Vicente le doy a Iniciar sesión y lo que quiero que ocurra es que desaparezca el inicio de sesión y aparezcan los mensajes por lo tanto aquí en el proyecto Script Mostrar voy a poner chat js y en chat js voy a hacer lo siguiente window onload cuando la ventana cargue voy a hacer una serie de cosas que son las siguientes Entonces cuando sobre el botón envía usuario document.get Element byid envía usuario onclick en ese caso voy a ejecutar una función y la función dirá vamos a ver bar usuario es una variable global bar usuario es nada de momento Así que voy a decir usuario es igual a eh document.get Element by ID vamos a ver get Element by ID usuario punto value para entendernos cuando haga clic sobre el botón de envío del usuario la variable de usuario vale lo que haya en el campo Entonces usuario es igual a document get Element value Eso quiere decir que ya tengo un usuario voy a poner un console.log tu usuario es más usuario se me ha ido la línea de abajo no quiero okay vamos a probarlo Así que pongo José Vicente y le doy a Iniciar sesión 404 estilo No pasa nada y me dice tu usuario es José Vicente Ok entonces a continuación lo que voy a hacer es decirle que quiero ocultar la vamos a ver por cierto por defecto oculto el ch Y entonces document.get Element by ID creo que esto es chat miralo Ahí está chat Style display es igual a Y eso quiere decir que por defecto se oculta el chat pero cuando yo pulse sobre Iniciar sesión quiero que ocurra lo contrario oculto el login y muestro el chat así que document.get Element by ID chat es display block y el inicio lo quiero ocultar el inicio lo quiero ocultar si todo va bien vamos a poner puntos y coma al final Okay si todo va bien pongo José Vicente Y entonces vemos cómo se Inicia sesión y desaparece el login ya tengo el usuario y vamos al chat vale una vez que tengo esto ahora a continuación una vez que tengo la funcionalidad mínima Vamos a darle un poquito de estilo para darle un poquito de estilo 003 estilo y Ahora sí en cliente Voy a crear un nuevo archivo llamado estilo.css en el cual Pues voy a hacer lo siguiente em vamos a ver Body html es background Gray font family serif y ahora voy a hacer lo siguiente header com Main va a ser un Max with de 800 píxeles o igual es demasiado píxeles background White padding 15 píxeles y margin auto vamos a verlo me voy al proyecto número 3 cliente vale Okay í tenemos esto y en el body html Quiero un H del 100% y en el heer Main sobre todo en el Main Quiero un H del 100% vale un poco menos 80% 30% ahí vale bien una vez que tenemos esto ahora a continuación eh voy a hacer lo siguiente en el inicio input quiero indicar que with es 100% vale inicio input coma inicio Button Ok eh inicio es text Aline Center inicio no eh vale Okay aquí lo pongo aquí de aquí quito Esto vale bien y ahora a continuación digo lo siguiente padding top 10 píxeles padding Bot 10 píxeles margin top 20 píxeles Okay vale Y ahí pongo el usuario y inicio sesión pongo José Vicente inicio sesión y ahí aparecerá el chat ahora el chat pues vamos a ver el chat en el chat digo h 100% y ahora mensajes vamos a ver H 80% Border un Pixel solid Grey y eh overflow Y scroll Okay Vale José Vicente chía lo que sea vale eh No qué pasa aquí mensajes contiene mensajes Okay vale Ahí están los mensajes ahí va a estar el chat Así que margin top bottom 10 píxeles Ok y inicio input inicio Button voy a hacer una cosa input y Button todos Okay Vale y ahí lo tenemos bien tenemos como digo una interfaz Un diseño gráfico muy básico para el chat pero básicamente es lo que quiero vale que sea lo más básico posible para que nos centremos en lo que es el propio chat y no nos centremos en la programación y no nos centremos tampoco demasiado en el estilo Bueno pues una vez que tengo esto ahora a continuación es donde cuando yo escriba un mensaje y le de a enter quiero que el mensaje se envíe al servidor para ello vamos a utilizar evidentemente la librería fets y vamos a hacer lo siguiente vamos a ver voy a vamos a ver 004 y capturar mensaje entonces capturar mensaje Qué quiere decir Bueno pues quiere decir que en el chat document.get Element by ID y voy a decirle que esto es mensaje cuando sobre mensaje punto on Ke down on ya es igual a función e y digo que si e punto e k code es igual al Ke code de la tecla enter javascript enter Ke code el Ke code for enter es el 13 en ese caso voy a enviar un mensaje cuando haga cuando pulse una tecla sobre el mensaje si esa tecla es la tecla de enter en ese caso voy a hacer lo siguiente led mensaje es igual a disv vamos a ver si me coge el dis y console log el mensaje que voy a enviar Es más mensaje y Quiero borrar dis value es igual a nada Quiero borrar el valor Eso quiere decir que eso quiere decir que cliente entro vale pongo un mensaje Hola cuidado me lo está borrando s Ke doble ig a 13 vale bien pongo Hola le doy a enter y dice el mensaje que voy a enviar Es Hola luego estoy atrapando el mensaje estoy atrapando el contenido lo estoy poniendo dentro de una variable y a ver momento Vale y un momentín vamos a ver un segundo vale tenía el micro un poco bajo entonces eh en el siguiente ahora a continuación lo que voy a hacer es seleccionar ese mensaje y eh enviarlo pero enviarlo Cómo Pues claro lo voy a enviar mediante Ajax Entonces cómo lo voy a enviar mediante Ajax Bueno pues eh Para ello voy a utilizar la librería fch voy a hacer el número cco proyecto Enviar mensaje y ahora por lo tanto en el chat voy a decir ahora envío el mensaje mediante Ajax y voy a hacer algo lo más sencillo posible fch servidor php Pero además en servidor.php voy a decir mensaje es igual a en code Uri del mensaje y ya está porque no espero ningún retorno sino que ahora veremos ese retorno Cómo se produce realmente bien pues tengo esto por aquí tengo esto por aquí tengo esto por aquí vale Y ahora a continuación Claro evidentemente si ahora intento ejecutar este proyecto pues lo que va a pasar cliente vale inicio sesión mensaje le doy a enter y me dice que servidor not Found vale porque no existe el servidor pero ahora va a existir así que me voy al proyecto Enviar mensaje pues guardar mensaje le doy a guardar mensaje y por lo tanto voy a crear un nuevo archivo llamado Ahora sí servidor.php y voy a hacer una cosa de todas formas Y es que en el chat Ah no voy a hacer esto de momento un momento vale e no guardar mensaje Todavía no porque aquí voy a decir que quiero enviar el mensaje and usuario es igual a más en code Uri de usuario y así envío las dos cosas ok bien Ahora sí voy a duplicar el proyecto 006 Ahora sí Guardar mensaje bien y en Guardar mensaje como decía creo un nuevo archivo llamado servidor php y en servidor.php Pues voy a hacer lo siguiente voy a guardar un vamos a ver quiero guardar un archivo y ese archivo quiero que tenga algo de estructura vamos a ver cómo lo podemos hacer momentín a ver vale Voy a hacer lo siguiente y digo vamos a ver es igual a get usuario mensaje es igual a get mensaje eh fecha apoc es igual a date u que es el momento en el que se está guardando pero eh lo que puedo hacer es poner fecha es igual a date y punto date m punto date d punto date H punto date M no Hi punto date s voy a poner esto un poquito bajo para que se entienda mejor que es una fecha formateada vale Y ahora una vez que tengo esto eh voy a crear un Guardar mensaje en mensajes json vale Y por tanto voy a decir esto voy a decir que archivo es igual a mensajes Jason vale Y entonces eh lo que hago es lo siguiente js es igual a file get contents de archivo vamos a ver y datos js es igual a js de code de js bien con esto por lo tanto ahora a continuación vamos a ver digo lo siguiente vamos a ver nuevo mensaje es igual a array donde voy a crear una array asociativo y en este rrayo asociativo voy a decir que usuario es usuario coma mensaje es mensaje coma apoc es apoc coma fecha es fecha vale con lo cual vamos a verlo voy a crear aquí un array vacío vamos a ver vale Okay y ahora vamos a ver si array Push vamos a ver datos jas en datos js quiero meter el nuevo mensaje Okay y yo creo que ya vale vamos a hacer un bardom de datos J son a ver qué sale Entonces me vengo por aquí proyecto voy a servidor Vale y digo usuario es igual a José Vicente and mensaje es igual a Hola Vale y okay principio en principio eso tiene parece que tiene buena pinta con lo cual si esto es correcto si esto es correcto nuevo Jason es igual a Jason encode de datos Jason voy a poner jas Pretty print para que me lo ponga en un formato legible y ya está y con lo cual ahora digo file putut contents donde al archivo en el archivo escribo el nuevo jas si todo va bien Vamos a verlo Pongo aquí hola Ok y en mensajes vale tengo usuario José Vicente Hola Y si aquí pongo Adiós asios he puesto pues aparece asios vale debería aparecer adiós pero apece asos bien esto quiere decir que lo que está haciendo es cargarme directamente los mensajes en este archivo J Lo cual pues es está bien y ahora voy a comar que todo funciona no pinchando directamente al servidor sino desde el cliente Yo Soy José Vicente le doy a Inicia sesión y digo Hola Y aquí aparece Hola Este es un mensaje desde el cliente y este es un mensaje desde el cliente vemos como cada cosa que estoy guardando cada cosa que envío se guarda en el Jason del eh del servidor vale en principio esto ya empieza a estar muy bien y ahora evidentemente lo que quiero hacer es cargar los mensajes en el cliente por tanto me voy a cargar mensajes en el cliente y para cargar mensajes en el cliente ahora voy a hacer lo siguiente vamos a ver en el chat hago una función llamada bucle donde digo que Bart temporizador es igual a set Time out de ejecutar el bucle dentro de un segundo Clear Time out temporizador esto quiere decir paro el temporizador para a continuación volverlo a arrancar y este bucle Por tanto se va a ejecutar eh cada segundo o cada lo que queramos pero yo creo que un segundo está bien Ahora a continuación voy a hacer lo siguiente vamos a ver ahora a continuación lo que voy a hacer es primero creo un temporizador que llama al bucle y aquí lo que hago es que el bucle se llama así mismo cada segundo se ejecuta Así mismo de esta forma ahora lo que voy a hacer es decir que fch y llamo a un archivo llamado mensajes punj son punto den el punto den lo voy a sacar de aquí lo voy a sacar del fetch ahí está A dónde estás aquí vale Así que punto den y punto den console.log datos vale vamos a por ello vamos a comprobarlo recupero los datos cliente José Vicente vemos como cada segundo está recuperando los mensajes del servidor está ocurriendo desde el principio bien pues si ocurre desde el principio técnicamente no debería ocurrir desde el principio voy a decir que el temporizador debería ocurrir Solo cuando aquí vale Solo cuando inicio sesión Okay recargo vemos que no se inicia el y solo cuando inicio sesión es cuando se empieza a temporizador not Def vale porque aquí arriba bar temporizador Y entonces temporizador is not V ahí José Vicente y ahí empiezan a caer los mensajes qué es lo que quiero hacer ahora Bueno si yoo aquí pongo Hola pues vemos que ahora no aparecerán cu deberí apcer Hola qué tal a ver los mensajes hola y hola qué tal Ah ahora seis vale se había quedado con Ah se había quedado con esto bueno no pasa nada ahora encontraremos una forma de forzar el refresco del js bien La cacha del navegador que a veces pues se queda atrapada con la versión anterior del archivo Vale pues 008 Ahora Mostrar mensajes en el chat y entonces digo lo siguiente en Mostrar mensajes en el chat aquí en el chat ya tengo los datos y por tanto no hace falta ya al console y por tanto digo mensajes document getelement byid contiene mensajes punto iner html es igual a nada Es decir vacío los mensajes anteriores Y ahora a continuación pues for vamos a ver for Let y ig 0 Y es menor que datos. length y+ más y ahora digo document.get Element by ID no cadena es igual a nada y ahora pongo cadena punto igual div Class div mensaje voy a poner voy a usar el truco de los tres puntos o sea de los las tres comillas no me hace mucha ilusión ese truco Pero bueno Ah aparte aquí Ah no perdona a ver Ah no es el acento abierto Ahora sí y dentro del mensaje voy a poner span no di Class usuario div Class fecha div y div Class mensaje di tras lo cual evidentemente voy a encadenar por aquí eh datos punto usuario datos punto fecha y datos punto mensaje bien Vamos a verlo Mostrar cliente José Vicente Ah Sí perdón me falta lo último y documentelement byid in html es más esto igual no me hace falta porque le digo cadena y cadena pues ya va a borrar automáticamente la cadena Así que no hace falta que vacíe José Vicente vale undefine Interesante pero sí que reconoce los mensajes sí vale datos perdón de I me falta seleccionar el elemento de la Ray vamos a verlo okay bien ahí lo tenemos ya Y ahora queremos formatearlo un poco pero nuevo mensaje pongo ahí nuevo mensaje y en principio Ahora cuando quiera ahora dentro de un momento pues cargará el nuevo mensaje vale Lo único es que no me está actualizando el jas vale Y como no me actualiza el js lo que voy a hacer es forzar un refresco con el truco de la fecha entonces digo Ah en el bucle led fecha es igual a New date igual aquí vale nuevo mensaje ya actualizado tardo un poco y entonces voy a decir J son and fecha es igual a fecha getdate javascript get apoc sí Ok in milliseconds Pero dímelo Ah javascript daten vale punto Now si esto va bien José Vicente Inicia sesión fecha pun now is not a function Ah muy bien vale es igual a New Date The Now y esto get utf seconds Okay vamos a verlo ahora jv Now pesados a ver jv vale Y aquí digo Hola le doy a enter ahí lo tenemos bien Hay un problema y es que como vemos se baja abajo del todo entonces voy a hacer un scroll top 009 scroll top y para ello aquí en el chat digo eh esto Qué es aquí no vale contiene mensajes punto scroll top es igual a 1 millones de trillones de billones muchos me voy a scroll top me voy a cliente inicio como jv okay Y si ahora digo qué tal Esto es una prueba pues veremos Cómo vale va apareciendo Esto es una prueba Bueno voy a ponerle un poco de estilo y parece que no pero ya prácticamente hemos acabado Así que le damos un poco de estilo y en el estilo Y en el estilo ahora a continuación voy a decir lo siguiente voy a decir mensaje esto era creo recordar mensaje o globo o no se puede encontrar el nodo Qué susto mensaje Vale mensaje es with 7% background vamos a poner un rgb verde clarito voy a poner un 200,25 5,200 vale un padding de 10 píxeles vamos a verlo Okay Vale bien un margin de Pues no lo sé de 10 píxeles también a ver qué tal okay Ahí están los mensajes vale quién tiene tanto margen mensaje Ah no no Claro tengo Class mensaje dentro de class mensaje esto no está bien a ver Class mensaje y Class mensaje Class texto ahora un poquito mejor bien e en el estilo text Aline es Center y font size es de 10 píxeles vale text Aline Center no text Aline left quería decir OK ahora además quiero un Border radius de 0 píxeles 10 píxeles para que haga un poco efecto bocadillo ahí lo tenemos vale Y en el texto voy a decir pues un padding de 10 píxeles y un font size de 12 de píxeles mismo Iniciar sesión Vale ahora sí Entonces esto es otro mensaje y esto es otro de nuevo Vale y básicamente tenemos ya un chat funcionando lo más divertido es que hasta este momento probablemente puedes pensar que lo que he hecho no vale para nada porque parece un chat en local Pero no es así es un chat realmente funcional vamos a comprobarlo lo que voy a hacer es abrir otra ventana de chat y entonces voy a poner lo siguiente voy a decir que José Vicente va a hablar con Juan iniciamos sesión y José Vicente dice Hola Soy José Vicente y vemos Que a Juan le aparece Hola Soy José Vicente Hola y yo soy Juan y vemos como Juan me dice Hola Yo soy Juan Soy José Vicente y te respondo y yo soy Juan y te respondo a ti Y como podemos ver no tenemos un chat de mentira sino que tenemos un chat de verdad tenemos un chat que podríamos implementar en un servidor además lo hemos hecho directamente con jas sin trabajar siquiera con base de datos Y ya está Vale y ya lo tenemos únicamente pues este eh este chat tendría como defecto podríamos decir que al rato se cargaría mucho los mensajes vale entonces lo que podemos hacer En un momento dado es por ejemplo eliminar los X mensajes antiguos pero eso ya es un tema de php es una mejora que podemos hacer y a futuro Y tal Pero momento como podemos ver pues ya tenemos que este chat está en funcionamiento y lo hemos hecho utilizando tecnologías asincrónicas