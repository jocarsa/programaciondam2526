voy a hacer un ejercicio con ajax lo voy a hacer trabajando con un chat y por eso mira a la atención lo primero que voy a hacer es crear una carpeta chat voy a crear un archivo que va a hacer lo siguiente mirad en primer lugar un archivo vacío index.html y en segundo lugar para demostraros lo que hace realmente ajax voy a crear un archivo llamado calcula punto php importante en este caso además que vamos a trabajar también con jake fuera y por tanto copio la librería de jay query en esa carpeta así que tengo index.html tengo calcula punto php y tengo la librería por tanto ahora me puedo ir al editor de código a recargar muy bien seguro que lo estoy ejecutando cargo calcula punto j s no hace falta que calculé la librería y una cosa muy importante atención ahora es que os deis cuenta que como voy a usar php me he metido en la carpeta de sham no estoy en la carpeta de escritorio y por tanto voy a cargar esa página web voy a cargar ese sitio web desde localhost a chats no desde arrastrar el archivo directamente desde su ubicación hasta el navegador sino que he puesto localhost barra chat ahora dentro de index html voy a poner doc type html godín y dentro del jefe voy a poner en primer lugar un script tal javascript y ahora voy a poner un script que será propiamente el mío así que digo que cuando el documento esté preparado ejecutaré la función de inicio y la función de inicio ahora lo siguiente lo que voy a hacer es decir vive de igual a receptor y voy a decir en receptor me cargas cloud es el método más sencillo para usar ajax en jake query el archivo calcula punto php y calcula php es un archivo escrito con la sintaxis de php por supuesto va a decir eco 33 así de sencillo por tanto si ahora guardó y recargo vamos a ver el momento en que saque en inspeccionar elemento con solá tengo un error y me dice lo siguiente vamos a ver en la línea 7 document ready inicio aclaro esto es porque no he cargado correctamente la librería de jay query muy bien ahora sí que la cargado type text barra javascript ahora sí lo que veremos en la pantalla es decir quiero que veáis en la pantalla cómo he creado un llamado receptor y le he dicho dentro del receptor carga me el resultado de calcular punto php y calcula php es un simple y sencillo script que simplemente dice eco 3 + 3 vamos a apoyarnos en esta base para ahora a continuación crear una pequeña sala de chat una vez vista la base de lo que es realmente ajax voy a hacer lo siguiente voy a hacer un deber y de chat él vive y de chat va a tener un día que a su vez será mensajes y un viva fidel redacta en los mensajes aparecerán los mensajes que la gente va poniendo y en redacta aparece esa parte del chat donde tú puedes escribir lo que vas a decir así que dentro de redacta voy a poner un input type text neymar mi mensaje perdón y de mi mensaje y un botón y b envía mensaje tengo esto por aquí y mensajes pues tendrán los mensajes que haya en la sala así que lo voy a estilizar un poquito para que lo veáis mejor y ahora digo chat tendrá un width de 200 píxeles como mucho un height de 400 píxeles y un border de un pixel solid grade es decir una cosa así ahora lo que serán los mensajes tendrá un width del 100% un hack de 370 píxeles y ya está a bajar un poquito más esto vale y por último bueno envía voy a poner y por último el input tendrá un wish del 60% y el button tendrá un wifi el 40 por ciento un poco para que quepan los 2 voy a decirle 35% para que quepan los dos uno al lado del otro así que yo voy a ir escribiendo aquí cosas y lo que quiero es que a medida que voy escribiendo aquí cosas se almacenen dentro del chat la cuestión del chat es que es una aplicación que es compartida entre varias personas y como es compartida entre varias personas inevitablemente tiene que haber una base de datos bajo que soporte los diferentes mensajes de las diferentes personas así que voy a hacer lo siguiente cuando sobre el botón enviar haga clic ejecutaré la función envía mi mensaje y la función envía mi mensaje ahora lo siguiente la función envía mi mensaje tomara el valor de mi mensaje y lo enviara así que barro mi mensaje es igual a eso de ahí y ahora digo en un elemento llamado ajax que no existe pero que ahora voy a crear punto low guarda mensaje php y mensaje es igual a mi mensaje vamos a verlo me falta únicamente crear por aquí un vacío llamado ajax qué hace realmente envía toma el valor de lo que yo haya dicho y se lo envía a un script llamado guarda mensaje php para que lo guarde en la base de datos que me hace falta por tanto bueno pues como podéis imaginar me hace falta entrar en la base de datos me voy a crear una base de datos que es el código por si queréis ir copiando me voy a crear una nueva base de datos llamada chat cotejamiento tf8 en español me creo una tabla llamada chat va a tener cuatro columnas mirad va a tener el ide es inevitable el utc es el tiempo la ip y el mensaje dejadme momentín que diga y todo esto y marchar y que el primer campo ya sabéis será primario y auto incremental tras lo cual le voy a guardar y únicamente me queda en el chat darle privilegios creando un usuario nuevo con el nombre de chat servidor local y contraseña chat continuó y ahí lo tengo lo que tengo es una base de datos llamada chat que tiene una tabla llamada chat con un usuario llamado chat y una contraseña demanda chat muy sencillo de conectar vale por qué pues porque ahora voy a guardar el mensaje dentro de esa base de datos con el script que voy a desarrollar a continuación el que va a guardar el mensaje es evidentemente el archivo guarda mensaje php el archivo guarda mensaje php existe no lo tendré que crear así que me voy a crear el archivo guarda mensaje php por supuesto lo cargo dentro de aquí y hago lo siguiente atención todos a la pantalla me voy a copiar de la carpeta que use en su momento bueno en sql vamos a index.php y me voy a copiar la conexión a la base de datos por tanto guardo mensaje lo que hace es que se conecta a la base de datos que está en localhost se conecta con el usuario chat con la contraseña chat y con él a la base de datos chat echarse etc 8 no es obligatorio pero es bastante recomendable y ahora base de datos punto query insert into chat values null 234 recordáis que mi tabla tiene cuatro campos verdad bien pues el segundo es el leit el segundo en el que he enviado ese mensaje es la fecha digamos el tercero es la ip desde la cual ha enviado ese mensaje no me acuerdo cómo se mira que los php que type así que de pipe y le digo remote address estés y por último el mensaje fijaos qué mensaje lo estoy enviando con una variable get llamada mensaje así que huguet mensaje os imagináis que funciona la primera estaría muy bien entonces recargo le digo o la envía bien parce error vamos a ver el parce error en php así me sobra está muy bien así que la envío recibió no dice nada si no dice nada me voy al localhost me voy a chat y mira dice con la y de 1 está utilice la ip y 171 soy yo mismo y mensaje hola interesante porque ahora digo adiós envía recargo la tabla y me dice adiós es decir comprobamos que mediante ajax y cuando digo mediante ajax quiere decir que cada vez que le doy a este botón no recargo la página se va a la base de datos acordaos que le acabo de pulsar varias veces mira poniendo mensajes además fijaos cómo van corriendo los segundos es decir ya he hecho una petición a jacques para que a medida que yo voy aquí enviando cosas aquí arriba perdón en la base de datos vayan apareciendo ahora mismo mi chat es un poco ciego porque si yo escribo algo y le doy a enviar se va directamente a la base de datos pero no aparece en la propia ventana de chat así que ahora me voy a ir a la página principal voy a decirle qué mensajes le pongo un borde de un píxel solid black algo así voy a hacerlo un poquito más bonito verdad voy a decirle background murray y margin d 10 píxeles así un poquito más bonito bien y with del 95% el 90% para que hay verdad porque queremos cultivar tonito el ieral épico que el background en lugar de ser gris tan duro que sea rgb 220 420 bien ahora sí me parece amarillento ahora si los mensajes aparezcan allí bien para esto por tanto lo que tengo que hacer es que cuando inicio ejecutó una función llamada carga mensajes y la función carga mensajes va a hacer lo siguiente cargar mensajes dice dentro de aquel elemento que tiene el y de mensajes punto load un archivo php llamado carga mensajes punto php ojo que éste hace referencia a guardar mensaje php pero éste hace referencia a carga mensajes punto php bien en este caso evidentemente y como os podéis imaginar tengo que crear un archivo nuevo llamado carga mensajes php va a hacer lo siguiente me vengo aquí este es un delito me copió una estructura de control de conexión a base de datos mysql a ser posible con una devolución en forma de bucle while voy a comentar y digo select all from chat selecciona me todo lo que haya en chat y ahora digo echo fila mensaje punto br para que cada mensaje baje abajo del todo si todo va bien algo así bien vamos a ver a cuidado tengo que cambiar los datos de conexión en chad efectivamente no me conecto a crm sino que me conecto a cuidado que ahí me he cargado una milla y aquí me cargado otra así que guardo recargo bien y me dice hola adiós adiós es decir aquí puedo enviar mensajes aquí puedo cargar los atención miran reenviar bolita y ocurre una cosa mirando que os voy a decir le voy a enviar se ha enviado la masa de datos pero esto no lo sabe solo si le doy a recargar ahí pone bolita porque no lo sabe por una razón muy sencilla y es que esta función la función carga mensajes se ejecuta una sola vez al principio del código pero no se vuelve a ejecutar otra vez por donde cargan mensajes voy a usar un truco de javascript un truco que atención hay que usar con mucho cuidado que es hacer un bucle infinito cuando estuvimos hablando de los bucles infinitos estuvimos hablando de que son peligrosos cuando están descontrolados pero yo quiero hacer un bucle infinito que esté controlado entonces lo voy a hacer con un set time out una función de time out que se carga a sí misma entonces le digo carga me carga mensajes cada 1000 milisegundos porque si le pusieron número 1 me cargaría esa función 1000 veces cada segundo y eso quiere decir que estaría haciendo mil peticiones por segundo a la base de datos que pasa con una base de datos que pasa con un servidor de base de datos cuando le hago mil peticiones por segundo que se me cuelga que pasa en un hosting comercial cuando hago un ajax en mil peticiones por segundo que me penalizan que me llama la atención porque estoy siendo un mal uso de los recursos estoy abusando por eso le pongo un segundo pero no quiero que me refresque mil veces por segundo con que te vayas a la base de datos y preguntes cada segundo para un chat es suficiente entonces fijaos como guardo y recargo y digo hola dos envío y dentro de un segundo aparece la 2 pero no es porque al pinchar aquí haya enviado este contenido aquí arriba sino que al pinchar aquí lo he enviado a la base de datos y desde la base de datos me viene hasta este elemento de aquí arriba hasta el dif donde se cargan los mensajes sería bastante conveniente por lo menos para identificar a los usuarios que están hablando en el chat que pusiera algún tipo de identificador en este caso como identificador voy a poner la ip es decir 9 21 681 30 chat si yo ahora pongo hola veréis que en la base de datos tengo un campo que me actúa un poco como identificador de usuario así que ahora encarga mensajes le voy a decir que echo fila y p guión mayor que un poco con una flechita como decirme a esta ip ha dicho este mensaje permitirme que no voy a poner un ver porque tanto no me cabe veis cómo voy aguardando eso va actualizando bien y ahora lo que voy a hacer también es con css y decirle que los mensajes tengan un font family de sants sheriff y que tengan un fondo 6 de 8 píxeles para que los elementos en el chat no se vean pequeñitos si queréis luego lo hago un poco más grande pero en definitiva para que me quedan bastantes mensajes igual han pasado un poquito vamos a poner 10 píxeles vamos a poner una cosa así bien y por último en carga mensajes en lugar de poner un ver voy a poner un hr para que cada mensaje esté dividido con un pequeño separador bueno sigamos vamos a ver hay una cosa que no me funcionará ahora hay varias cosas que tengo que arreglar una vez que si pongo hola mundo envió y dice hola mundo y si pongo cómo estás envió y dice cómo estás aparte de que fijaos que se me empieza a salir si hay una cosa que es el scroll pero el scroll me puede dar un poco de problemas vamos a ver voy a poner mensajes overflow el scroll y es que se pone un scroll pero el scroll se me queda siempre ahí arriba bueno ahora vemos cómo arreglar esto no os preocupéis porque tiene solución pero antes quiero solucionar esto de los espacios entonces lo de los espacios es un problema muy típico de ajax y de los chats lo que voy a hacer es usar una función de javascript llamada url encoder y en code en codeur y al revés bien entonces digo 5 de kooning de mi mensaje vamos a verlo ahora hola mundo envió y me aparece hola mundo por tanto simplemente tenéis que poner en collioure y al mensaje para que no os de problema con los espacios y ahora por último nos quedará por solucionar el problema del scroll para que cada vez que escriba un mensaje o cada vez que recargue los mensajes se vaya a la parte de bajo del toro una manera de resolver el problema es en sql decidir qué quiero seleccionar cordero bai etc descendiente es decir que quiero seleccionar los últimos mensajes y que quiero decir limit por ejemplo 10 que sólo quiero seleccionar 10 mensajes de esa manera desaparecerá el scroll y desaparecerá si el scroll y fijaos como sí digo esto es un mensaje le voy a enviar y aparece aquí arriba esto es un mensaje lo único que tendría que hacer ahora sería darle la vuelta a los mensajes para que éstos aparecieran arriba y éstos aparecerán bajo digamos dar la vuelta ahora de momento lo que voy a hacer para lo que se lee de es qué voy a dar la vuelta por aquí voy a hacer un chat invertido donde si yo pongo esto es un texto y le doy aquí a enviar aparece esto es un texto este es un mensaje y así vemos por tanto como tenemos un chat donde a partir de ahí cualquier persona puede entrar en esa dirección y puede empezar a chatear dentro de lo cual pues varias personas pueden participar en una sola aplicación web por último en este proyecto de chat vamos a limpiar un poco el código y mirar a la atención voy a simplemente liberar esta carpeta y voy a crear una carpeta llamada archivos dentro de archivos atención mirada calcula lo voy a eliminar porque ya no me hace falta y voy a lanzar dentro de esa carpeta cargo mensajes guarda mensajes y jquery por tanto ahora está agradable error supongo por tanto ahora lo que voy a hacer es lo siguiente lo dudo archivos de carga mensajes cloud archivos barra guarda mensaje él jquery lo cargo desde archivos jquery bien vamos a verlo ahora además dentro de archivos bien aquí ya ha empezado a dar un error ahí está bien entre archivos voy a poner un archivo nuevo un documento llamado estilo css y un archivo llamado chad punto j s estos dos archivos los voy a cargar vamos a verlos y ahora todo este código lo pongo en chat js y le digo que esto es src archivos chat punto js y este estilo no voy a poner dentro d estilo punto css dónde quitar el style y lo sustituye sustituir por un link rey está el sit h ref es igual a archivos estilo css de esa manera como veréis el proyecto queda mucho más limpio la carpeta queda mucho más limpia porque lo que hay únicamente en el raíz es un archivo index.hr ml y todo lo demás está metido dentro de esa carpeta archivos punto buenos tiempos punto nada luego quizás para ser más puristas tendría que haber hecho una carpeta llamada php otra carpeta llamada j s demanda de estilos pero claro crear una carpeta llamada estilos para guardar un único archivo pues no me parece tampoco muy eficaz por eso prefiero en este caso que este proyecto es pequeño crear una carpeta llamada archivos y guardado todo ahí y cuando el proyecto sea más grande y tenga 50 archivos pst 50 archivos css y 50 archivos js pues ahí ya crear una carpeta específica para cada tipo de archivo antes que nada comprobamos que sigue funcionando bien muy bien alguien me ha pegado por ahí el escroto muy bien así que hola y en este caso hola y vemos como sigue funcionando vemos como tanto de una manera como de otra sigue funcionando correctamente el chat estando ahora el proyecto bastante más organizado a nivel de estructura de archivos y directorios