vale Y en la clase de hoy quiero empezar hablando de algo que nunca me hace especial gracia a hablar es una parte del temario que no me gusta porque yo desearía que no hiciera falta hablar de esto pero hace falta hablar de esto desgraciadamente vale que es técnicas de programación segura o En definitiva Cómo programar previendo que alguien me puede intentar meter información que no toca dentro del sistema esto qué quiere decir Bueno pues vamos a empezar por algo muy sencillo si me voy a proyecto vale a la última parte del proyecto hasta el momento pues alguien por ejemplo Me podría intentar meter por aquí un delete all from usuarios como entrada como usuario y yo no tengo ningú forma hasta el momento evidentemente a partir de ahora la voy a tener no tengo ninguna forma de prever que esto no entre y no se ejecute dentro de la base de datos Está el chiste de Bobby tables Entonces el chiste de Bobby tables vale Es un chiste que a mí no me hace ni gracia Pero bueno Eh vale le llaman una madre del colegio y le dicen bueno llamamos el colegio tenemos algún problema con la informática y entonces dice u ha roto mi hijo algo y el colegio le preguntan realmente has llamado a tu hijo Robert comilla parentesis punto y coma o sea cierra el comando anterior y Drop Table students vale Drop Table students es borra la tabla estudiantes y la madre le dice Oh sí lo llamamos El pequeño Bobby tables y en la escuela Esa es la parte del chiste que no me hace ni gracia en la escuela le dicen Bueno pues hemos perdido las notas de los estudiantes de este año espero que esté usted Feliz y la madre le dice e y espero que ustedes hayan aprendido a sanear sus entradas a la base de datos vale es decir eh En este caso la madre está haciendo que se borren los datos de la base de datos pero la culpa es del colegio no de la madre Vale entonces es un poco el mundo al revés es como si tú fueras por la calle sin meterte con nadie viniera alguien te metiera una y tú fueras a la policía denunciarlo y el policía te dijera bueno culpa tuya por haberte dejado es como eh vamos a ver no es decir Yo no me meto con nadie me tiene por pegar una Vale pues la culpa es del que ha pegado la no del que la recibe pero en informática la culpa es de del que la recibe por eso es por lo que digo que esta parte del temario pues no me gusta a nivel filosófico Aunque Generalmente los alumnos la encontráis muy interesante porque pues Siempre os da bastante Paz el saber que pues estamos poniendo cosas que aseguren la bueno la integridad del sistema vale bien a continuación por lo tanto voy a empezar con un pequeño ejercicio desarrollo Perdón desarrollando una pequeña librería y para ello me voy aquí a w me voy a html me voy a dam me voy a segundo me voy a programación de servicios y procesos técnicas de programación segura dentro de técnicas de programación segura voy a crear una carpeta llamada sanear y dentro de sanear voy a empezar haciendo una demostración voy a crear un Index html y este Index html va a tener el archivo más vale más básico que pueda programar Head Body y aquí dentro de Body voy a hacer un input type text Bueno antes de ello voy a hacer un form action es igual a 001 procesa php method es igual a post vale type es igual a text e name es igual a entrada y un input type submit y forma vale Así que yo vengo por aquí y ahora ejecuto esto lo voy a desarrollar en primer lugar por separado y luego lo desarrollo dentro de crimson servicios y procesos técnicas de programación segura vamos a sanear vale pongo Hola le doy a enviar y no existe de momento el que lo tiene que procesar con lo cual lo voy a crear 001 procesa php Así que en procesa Vale ahora procesa existe pero no tiene nada vale en procesa lo que voy a hacer es php y voy a decir eco post qué pues eco post entrada vale hago así recargo y me está diciendo hola con lo cual si yo ahora vengo aquí y digo delete all from usuarios le doy a enviar y me dice delete all from usuarios es decir esto ha pasado de la parte de cliente a la parte de servidor y en la parte de servidor se está comiendo ese intento de ataque vale pues lo que quiero a continuación Es prever que la parte de servidor no se pueda comer digamos una serie de cosas para ello hay varias herramientas una de ellas son las expresiones regulares también es cierto que en php a partir de php8 creo recordar hay una nueva instrucción llamada includes que eh simplifica las expresiones regulares Vale entonces voy a venir por aquí y no primero chat gpt y voy a decir php como te diría yo php caray check If String contains One Element in an array simplest way vamos a ver a Ray filter Wow bueno vale me vale pues vamos a esto bien Así que ahora 002 filtro en array ahora a continuación Yo hago lo siguiente array es igual voy a decir colección es igual a delete es igual a Drop y es igual a truncate tres palabras que en My sql si no se utilizan correctamente pues pueden ser dañinas String la cadena la entrada es igual a post entrada entonces digo si array filter en la colección es un elemento Y entonces digo que esto es de la entrada el elemento en ese caso positivo en caso contrario negativo esto quiere decir que yo ahora en Index le doy a procesar y Pongo aquí Hola le doy a enviar y dice negativo vale tu cadena no contiene Ninguna palabra peligrosa Vale ahora voy a decir delete all from usuarios envío y dice positivo vale tu cadena contiene una palabra peligrosa como es por ejemplo momento como es por ejemplo delete claro yo podría venir por aquí y decir create o perdon create insert into usuarios lo que sea vale negativo claro negativo porque no he dicho que insert sea una palabra peligrosa la idea el truco está en que aquí dentro vale Yo puedo meter tantas palabras como quiera Ok que en este caso pueden ser palabras reservadas de mysql para evitar ataques de tipo inyección sql o pueden ser palabras de javascript para evitar ataques de tipo xss Cross site scripting que consiste en intentar inyectar o bien javascript o bien php directamente dentro de otra cosa que podría hacer es poner punto y coma vale No me puedes poner un punto y coma en un campo Por qué bueno igual alguien me podría poner un punto y coma depende de la información que use el sistema de información que yo esté creando vale bien Ahora quiero voy a quitar el punto y coma Ahora quiero que esto no solo me coja el post entrada quiero que me coja todo en php 003 cojo request en php hay una variable muy chula que se llama request entonces digo eh colección o entradas vale entradas es igual a request y request es una super variable que lo tiene todo vale todo lo que le entre a php entra por request así que el request es como os digo una super global es una s variable que está muy bien porque centraliza el pillar todo lo que venga Eso quiere decir que yo ahora me voy a Index y por ejemplo meto otro vale otro text llamado entrada dos y entonces con El Cojo request momento renombro lo pongo vale con El Cojo request ahora digo for each momentín eh php for each y vamos a ver aquí está esto es no Eh Esto no vale for each entradas as clave y valor vale Y entonces vengo por aquí y digo eco quieto cuidado Vale y digo eco clave gu valor br Así que vengo por aquí me voy a sanear digo 1 dos le doy a enviar y dice entrada tiene el valor uno y entrada dos tiene el valor dos esto qué quiere decir pues que ahora en lugar de capturar manualmente todas y cada una de las entradas porque cuando tengo una aplicación de tipo empresarial Pues el número de entradas que viene es desconocido vale pueden ser cinco pueden ser 5000 Vete a saber Pues yo lo que voy a hacer a continuación es decir repaso y compruebo fusiono los dos códigos vale por tanto me voy a cojo request no me voy a filtro en array cojo este código me lo pongo por aquí y digo la colección va fuera entrada vamos a ver entrada es igual a valor Y sabes qué también podría hacer la clave esto fuera y por si alguien porque hay gente muy pilla vale entrada es igual a la clave y compruebo si da positivo por cierto voy a decir Die es un comando muy curioso que mata a php hace que php se muera no permitido y el els me sobra vale Y esto me sobra compruebo la entrada compruebo el valor compruebo la clave quería decir compruebo el valor vale Por qué Porque alguien muy Cuqui Me podría poner Drop Table en el name del formulario igual vosotros estáis pensando que nunca se os hubiera ocurrido pero el problema es que hay gente que sí que se le ocurre hacer ese tipo de cosas vale en lugar de ponerme el Drop en el valor del formulario igual Me podrían meter el Drop en el name bien con lo cual yo lo que hago vale Es que para cada una de las entradas tanto para la clave como el valor compruebo que sea cierto que no tengan ninguno de estos elementos y si lo tienen vale Mirad eh voy a poner eco todo Okay vale Y si lo tienen eh voy a nombrar esto Vale renombrar y Index y 04 vengo por aquí y digo hola y me dice todo Ok vale pero en el momento en el que yo ponga delete algo le doy a enviar no permitido y lo que importa no es que ponga no permitido lo que importa es que si os fijáis no ejecuta el todo okay No ejecuta el todo okay Porque cuando yo llamo a una instrucción Die lo que hace es que automáticamente mata la ejecución de php y no continúa a todo esto que hay por aquí con esto por lo tanto ahora que tenemos esta demostración básica vale de cómo sanear entradas Cuando digo básica quiero decir que he intentado que sea lo más sencilla posible pero que a la vez sea funcional ahora a continuación lo que quiero es como siempre encapsular esto dentro de un bloque de código que sea reutilizable y por supuesto utilizarlo en la aplicación que estábamos desarrollando vale para ello por lo tanto pues lo que voy a hacer ahora es meterlo dentro de una función 005 función y aquí lo que podría hacer es Pues aquí mismo vale crear función sanear function sanear esto fuera elco todo que hay fuera vale function sanear puede vale el request con lo cual eh entrada o vale o elemento a sanear la forma de llamarlo aquí Perdón la forma de llamarlo es sanear de request con lo cual Pues comprobamos que sigue siendo correcto renombrar Index Okay Vale hola y hola no dice nada es lo que tiene que ocurrir es como cervero vale es como el perro del infierno es como pasas o no pasas Si pasas no te digo nada pero si no puedes pasar pues te muerdo Vale entonces delete all from usuarios Enviar no permitido vale Si no pasa sí que te doy un mensaje Qué dice el mensaje Pues luego ya lo tendríamos que decidir vale para no darle al atacante más pistas de las debidas porque si le dices no te dejo entrar porque tal Y porque tal la atacante dirá Ah fantástico Pues voy a sabiendo que me has bloqueado por ahí voy a probar por otra parte vale Por eso digo que el tema es no dar más pistas de las que toca como ya os digo y os insisto y os insistiré mil veces esta parte del temar Es que no me gusta nada enseñarla vale porque a mí me gusta crear cosas no tener que protegerme sabiendo que alguien me va a intentar atacar pero es que alguien os va a intentar atacar vale por tanto pues desgraciadamente no solo porque est en el temario sino que además de porque está en el temario pues os tengo que enseñar esto Pues porque os lo tengo que enseñar Vale entonces esto quiere decir que yo ahora a continuación si me voy aquí al rp yo insisto vale si aquí digo delete all from usuarios voy a decir from usuarios tres por si acaso Vale pues le doy a login y el sistema me dirá Mira de hecho ni siquiera me lo ha llegado a enviar vale parece que en el servidor debo tener algún tipo de autenticación voy a decir aquí Hola Okay ahora sí vale parece que el o sea el servidor directamente ni siquiera ha permitido que est tu entrada voy a decirle delete y aquí Hola vale mira parece que alguien voy a decirle insert un momentín os voy a pedir 5 minutos Qué raro aquí no me está dejando insertar nada ahora Probaré aquí os voy a pedir 5 minutos voy un momento al servicio disculpadme pero se ve que me asentado un poco más la comida dadme 5 minutos vengo y continuamos y ahora lo que vamos a hacer obviamente es insertar esta librería que acabamos de hacer Por qué la gente hace eso porque no tengo ni idea de por qué lo hacen vale Yo solo sé que no es que yo no lo haga es que no concibo perder mi tiempo en eso pero dragos yo siempre he pensado eso vale que es o gente con falta de atención o gente con falta de cariño o yo que sé sabes Bueno pues lo que os