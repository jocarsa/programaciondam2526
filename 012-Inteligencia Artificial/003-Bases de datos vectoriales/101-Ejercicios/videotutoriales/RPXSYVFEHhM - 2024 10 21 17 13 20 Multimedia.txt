Vale ahora estoy grabando bien sin ir más lejos en la otra asignatura en sistemas de gestión empresarial estamos trabajando con Apache y es perfecto y no pasa nada Por qué Porque si desarrollo un sistema de gestión empresarial en la cual le digo servidor está decito y solo cuando yo haga clic en clientes solo en ese momento te conectas a la base de datos y me das los clientes me los pintas en pantalla y en cuanto me pintes los clientes en pantalla ya te puedes ir a dormir otra vez en ese caso la arquitectura de Apache que es una arquitectura stateless es decir es una arquitectura sin estados es una arquitectura que está durmiendo y tú la llamas y se despierta y te da lo que quieres y se vuelve a dormir es una arquitectura fantástica vale es la arquitectura que nació en los años 90 y que En definitiva no es que se ha venido usando y se ha quedado defasada es que a día de hoy se sigue utilizando para un montón de cosas pero el problema de la arquitectura Apache es cuando hay a un tipo de programa como el que vamos a desarrollar hoy que son juegos multijugador donde el consumo de gasto de tiempo de recursos de memoria para que cada vez arranque te d y se vuelva a dormir es prohibitivo Es decir yo tengo un juego multijugador voy a tener ahora y yo quiero que constantemente el juego multijugador me esté dando Dónde está la posición del resto de jugadores por tanto eso es incompatible en rendimiento con la arquitectura de Apache Entonces esto que voy a hacer hoy lo podría hacer con Apache técnicamente sí que se puede hacer pero claro si yo por ejemplo le voy a pedir no sé sabes Te voy a decir una cosa y tú creas que voy a exagerar pero te juro que no voy a exagerar yo le voy a hacer como 20 peticiones por segundo al servidor 20 por segundo empieza a multiplicar minutos pues Apache no está diseñado para que yo le haga 20 peticiones por segundo vale Apache está diseñado va a estar quietecito y una vez cada 2 minutos o una vez cada 30 segundos Pues que yo haga clic Dame algo y Apache dice Ah vale pues te lo doy pero cada vez que yo a Apache Le pido algo es lo que te digo Apache se despierta y eso son una serie de milisegundos Apache consume un hilo Y eso es ocupar unos cuantos megas de ram Y entonces Apache Me da las cosas y luego se vuelve a dormir eso que te acabo de decir 20 veces por segundo es una barbaridad o sea 20 veces por segundo Apache se tira más tiempo arrancando y durmiendo que dándote servicio realmente por eso no es que no se pueda Es que no es práctico hacerlo con champ lo que se requiere es otra tecnología que esté constantemente encendida Como por ejemplo o bien python o bien no de js o bien cualquier otro lenguaje que una vez que lo enciendes se queda encendido y se queda constantemente ejecutando y escuchando podría ser c+ má podría ser Java no Java Enterprise sino Java puro y duro vale podría ser cualquier otro programa de estos que arrancan y se quedan arrancados y están constantemente escuchando por eso digo que hoy lo voy a hacer con python habéis visto que el servidor tenía por ahí otro archivo de ejemplo con no dejs es decir se puede hacer Igualmente con no dejs vale más que nada lo suelo hacer con python por su sencillez porque como veis en menos de 30 líneas de código tenemos un servidor de websockets quieras que no es una delicia eso vale entonces para cada cliente conectado añado el mensaje vosotros diréis Pero qué puñetas es un mensaje ahora os cuento que es un mensaje añado el mensaje a la lista de mensajes porque un mensaje es lo que tú quieras Ah verás y en el caso de que haya mensajes en la lista en ese caso castea los mensajes a todos Qué quiere decir castear pues que en este caso lo que hago es Escuchar del cliente pero aquí lo que hago es enviar como los workers por ejemplo vale una cosa es escuchar y luego además lo que hago es enviar bien en el try hemos creado una excepción vale Así que le digo que en el caso de que falle algo vale lánzame la naturaleza del error y Finally y después de todo quita el cliente que se ha desconectado de la cola vale eh desgraciadamente como os decía no por mí sino porque me obliga Google Chrome eh si hago una conexión con websockets tengo que hacer la conexión con un servidor seguro es decir con un servidor ssl por eso estoy obligado hace años no pero ahora sí a usar ssl en la conexión de websockets por seguridad nosotros no vamos a hacer ninguna maldad pero con websocket pues se pueda hacer maldades y le introduzco los certificados de protocolo seguro que he tenido que contratar vale para hacer esto arrancamos el servidor le digo en qué dominio Estoy escuchando le digo en qué puerto Estoy escuchando le digo que he activado el ssl arranco el servidor y arranco el asíncrono y ejecuto en bucle para siempre es decir el Start server momento que te lo digo por aquí está por ahí vale Start server aquí lo que hago es que arranco un servidor y el servidor está constantemente ejecutando esta parte de aquí arriba si os dais cuenta este servidor que os he enseñado hoy aquí este servidor del cual os paso el código es un servidor muy agnóstico es decir el servidor no sabe si está trabajando con juegos con un chat con una aplicación empresarial el servidor no sabe nada el servidor no sabe no se le está pasando ni posición ni escala ni clientes ni facturas ni pedidos este servidor Lo bueno que tiene la obra de arte de este servidor son estas líneas de aquí y es que el servidor Recibe un mensaje y el servidor devuelve mensajes Qué quiere decir esto Bueno pues en esquema me voy a ir a in escape os voy a dibujar un esquema de lo que va a ocurrir a continuación en el código porque si no ahora lo que voy a hacer ahora os parecerá Un lío Okay documento nuevo Vale y Mirad si hago un servidor de sockets quiere decir que estoy trabajando con la arquitectura cliente servidor y ahora es cuando lo Vais a flipar porque lo que hace un servidor de sockets es que yo tengo un servidor Y ahora yo tengo el cliente uno tiene la pieza uno Mira el cliente uno tiene la pieza uno el cliente dos tiene la pieza dos el cliente 3es como os podéis imaginar tiene la pieza tres pues lo que hace un servidor de sockets Es que este es el estado uno voy a guardarlo como esto es segundo multimedia dos eh escenas Y esto es 002 esquema 1.svg vale lo que hace es que a continuación el cliente 1 le envía la información uno al servidor el cliente dos le envía la información dos al servidor el cliente TR le envía la información tres al servidor y a continuación con esta parte de aquí del código que es web shock Send js dooms messages lo que hace el servidor es que coge estos mensajes y se los envía al cliente uno al cliente dos y al cliente tres es decir cada uno de los clientes le dice al servidor Qué está haciendo y luego el servidor le dice a todo el mundo Qué es lo que está haciendo todo el mundo vale es como un sistema compartido de información claro cuando esto por ejemplo se aplica un videojuego pues lo que ocurre en ese caso es que todos los que están jugando al juego están viendo las posiciones de todo el resto de jugadores del juego Vale ahora vamos a hacerlo poco a poco una vez que explicado esto es el que vamos a hacer ahora os voy a explicar el cómo lo vamos a hacer bien me voy a venir por aquí Bueno esto por cierto lo voy a subir me lo voy a subir aquí y f5 me voy a servidor de sock comentado y en el servidor lo he cerrado No vale en el servidor me voy a python 3001 servidor de sockets comentado cliente dos en lugar de tres pues puede ser no te digo que no cliente 2 en lugar de tres sí correcto ahí vale guardo el esquema guardo Vale entonces ahora ya he arrancado el servidor vale el servidor está escuchando Dónde está escuchando pues está escuchando en la web la rl jvs jv soy yo vale jv eh en el puerto 3000 bien a continuación yo ahora vengo me voy a bajar eh A ver ahora me voy a jarsa me voy a el otro servidor no vale me voy a Nueva web me voy a Go me voy a starship De hecho si miráis En mi Instagram tengo eh un vídeo jugando con mi hijo a este juego vale Y html por aquí si os fijáis Pues tengo las clases el estilo vale todo vamos a ir poco a poco evidentemente vale Así que a ver Esto me lo cierro ya esto lo puedo cerrar ya vale yos de momento no y del sí eh Nada Esto bueno no lo dejo abierto vale me voy al segundo me voy a programación multimedia me voy a escenas vale Y en html voy a abrir Esto vale vees que aquí por ejemplo en clases Pues tengo una clase que es la nave espacial que tiene su historia y tiene su tal bien vale nada tengo otra clase que es el proyectil vale que es una clase con métodos con eh con propiedades con todo vale luego tengo por aquí vale Okay venga voy a crear en dam en segundo en multimedia en desarrollo en escenas voy a llamar a esto de momento eh 001 Y eh No 001 no 005 prueba sockets pun html vale en prueba sockets voy a eh doct type html Y Head y Body vale por aquí por el Head voy a decir Script y voy a decir que eh Windows onload es igual a function Es decir me espero a que la ventana haya cargado para hacer cualquier cosa y por aquí vamos a ver en el Index no habrá No eso no en el Index no habrá nada vale Ok Okay pero aquí en js en sockets ahí sí que habrá muy bien vale pues voy a todo esto voy a todo esto y me lo voy a guardar lo voy a pegar aquí vale Y vamos a empezar a quitar cosas vamos a ver okay Y esto fuera y esto fuera y esto super fuera okay fuera vale voy a dejar el cliente de sockets lo más sencillo que pueda vale muy bien creo un socket creo una variable llamada socket y le añado una nueva instancia de la clase websocket obviamente es una clase que preexiste dentro de javascript que de la misma forma que existía workers pues existe websocket el websocket se conecta al siguiente protocolo websocket secure es decir websockets seguros o sea dos ses dos pun bar jvs que es el servidor donde he colocado un servidor de websockets dos puntos en el puerto 3000 una vez más Si yo aquí en idle creo que he cerrado idle vale fantástico si yo en le pongo Puerto 3000 en el servidor Pues en el cliente le pongo Puerto 3000 es decir debe coincidir perfectamente Ahora cuando vamos a creo una nueva conexión de sockets ahora cuando alguien me abre una conexión en ese caso se ha abierto una conexión en el caso de que haya un error intenta decirme vamos a ver intenta decirme dónde está el error y ahora cuando el servidor envíe un mensaje yo digo vamos a ver esto no Esto me sobra aquí uno en ese caso datos es lo que me envíe el servidor pero pásalo a Jason y voy a hacer console.log datos como siempre vale si tengo esto vamos a comprobar si funciona claro para comprobar si funciona una vez más tengo que hacerlo desde un servidor Vale entonces me vengo por aquí a mi disco me voy a crear un nuevo proyecto llamado sockets y le pongo esto es prueba sockets realmente Sería websockets más que sockets Pero bueno le pongo esto y lo llamo de momento lo voy a abrir con Explorer vamos a ver creo que lo voy a abrir con Explorer porque así pues trabajo más cómodo jara.com barg bar Explorer Así que admin y Ah era josé Vicente Vale pues José Vicente login Ok era admin bien mosquito este Hoy está siendo estoy por parar la clase para buscar el mosquito y matarlo porque es que está siendo increíble bueno Vale pues a la Go y me voy a la carpeta de sockets vale prueba sockets y me voy a jocars comom bargo bar sockets bar 005 gu pruebas sots html pruebas sockets html bien le doy aquí le doy ahí y dice websocket connection Open pero vosotros diréis ya pero esto no sé parece falso vale es como un console pun log y ya está Vale pues no os voy a demostrar que esto es verdadero Porque si yo vengo al servidor y paro el servidor y yo ahora recargo aquí recargo en el cliente me dice no ha fallado connection refused connection refus quiere decir que tú me decías que ahí había un servidor Pero ahí no hay un servidor no hay un servidor porque lo he parado la bestia evidentemente vale o sea demostraros que aunque el servidor no diga nada el servidor está funcionando vale el servidor está en marcha bien vuelvo a arrancar el servidor vuelvo a arrancar el cliente dice websocket connection Open no hagáis caso a esto ya sabéis que es la cosa esta del favicon vale horrible entonces a partir de aquí ahora una vez que Eh me he conectado al cliente Perdón al servidor Ahora quiero enviarle algo al servidor para enviarle algo al servidor me vengo aquí a crear un archivo nuevo 006 voy a hacer 006 html ya que si no luego pillar los archivos es difícil Vale y edito y ahora edito y voy a hacerlo incremental ya sabéis así que copio y pego y ahora a continuación y ahora a continuación lo que quiero es enviarle un mensaje al servidor Qué mensaje le envío al servidor pues vamos a verlo eso lo tengo por aquí está Vale y en el servidor J son pun pars vamos a ver no no está aquí lo que quiero eh No un momentín que me voy al bucle me voy al bucle Aquí estás socket Send vale socket Send aquí es Eh Pues no sé Hola Ya poco más vengo por aquí y digo cuando me conecto al servidor voy a decir socket Send socket copio pego y voy a enviarle un jas voy a enviarle eh Bueno js stringify voy a enviarle mensaje es dos puntos Hola Ya está vale un J son sencillito así que vengo por aquí guardo me voy al 006 html recargo y me dice mensaje Hola pero importante Por qué me dice mensaje Hola Pues porque yo aquí lo que he hecho es en primer lugar sockets envío el mensaje Hola y entonces console.log si queréis voy a ponerlo por aquí console.log el servidor me dice console.log hola recargo otra vez el servidor me dice mensaje Hola vale Esto es lo que está ocurriendo de momento con este servidor de sockets en el sentido de que eh el servidor Recibe un mensaje y te devuelve un mensaje pero diréis vale Recibe un mensaje te devuelve un mensaje pero Y qué ocurre Y qué tiene esto de interesante Bueno pues ahora voy a hacer una micro aplicación por tanto me voy a crear un nuevo archivo aquí no voy a crear un nuevo archivo en sockets me lo guardo como 007 html me lo edito copio el código y voy a hacer lo más sencillo que pueda hacer es decir input directamente nada input absolutamente nada y Button y envía por tanto ahora una vez que tengo esto yo digo Windows onload aquí abajo del windows.to onload digo document get no eh query selector Button punto onclick es decir cuando sobre el botón haga click Y entonces voy a decir eh mensaje Let mensaje es igual a document query selector input punto value vale es decir lo más sencillo que puedo cuando hagas clic en el botón coge el value y socket Send js stringify mensaje es igual a mensaje y document query selector input value es igual a nada vale es igual a quieto es igual a vacío bien Qué hace esto yo me voy al 007 yo aquí digo Hola Y al darle a envía Por una parte dice mensaje Hola y el input se vuelve a vaciar vale el input se vacía desde cero y diréis vale Y qué pues que lo bueno lo divertido que tiene esto es que yo ahora me hago una segunda ventana y ahora vosotros os vais a ir conectando Ahora cuando os diga primero voy a probarlo yo pero os diría voy a probarlo local no Esto no es local vale esto es red yo aquí digo Hola le digo envía a ver un momentín vale Ah sí Espérate que tengo que poner un bucle vale aquí me está devolviendo mensaje Hola voy a poner aquí Hola vale aquí me envía mensaje Hola digo yo soy uno y yo soy dos okay Vale muy bien mensaje yo soy dos recargo Hola mensaje Hola y mensaje Hola dos vale me está devolviendo únicamente vamos a ver los mensajes ahora voy a hacer un bucle cierro un momento por aquí ahora voy a hacer un nuevo archivo 008 html y aquí voy a crear un bucle vamos a verlo copio edito vale pego y ahora voy a crear un bucle en el cual Ahí estás aquí fun bucle contex Total no Player Data socket Send vale y socket message momen socket s un momento message el servidor me dice vale un momento que voy a el servidor y voy a ver si me falta aquí Okay Ok bcast messages to all connected clients vale al cliente que los envió Eso es bueno excepto el que envió el mensaje pues incluso podría enviarlo Pero vale If client no es igual a websocket ahí está la novedad Ok Vale pues vamos allá Aquí copio código esto es no esto es 002 servidor de sockets comentado y mejorado me lo paso lo he pegado no lo he pegado lo he pegado creo que no lo he pegado Okay lo pego en el servidor actualizo no esto no aquí lo pego en el servidor Vale ahora lo voy a ejecutar python 3002 vale Vamos allá ahora ejecuto de nuevo y digo Hola le doy a enviar y no recibo nada vale Okay perfecto pero ahora si yo aquí digo Hola le doy a enviar y aquí se recibe Hola y entonces yo digo Uy qué tal envío y aquí recibe Uy qué tal vale la idea Está en que tengo un servidor de tal forma que eh este servidor me permite compartir información entre muchas personas en tiempo real sin tener que encender y Apagar Vale ahora sí ya podéis entrar a esta primera versión os la pongo por aquí por el chat vamos a probarla entre todos chat y aquí vale entrad y empezar a enviar mensajes yo me quedo por aquí me quedo por aquí vale Estoy escuchando Hola soy Albert vale Ahí hay un pequeño problema y es que alber se ha tenido que identificar para que sepamos Quién es vale venga contad más venga a ver alguien que entre Pero fijaos vale de momento ya tengo un mensaje de Albert y este es un servidor que está como ya os digo constantemente encendido de hecho como os decía antes pues tuve que contratar un servidor específicamente para poder enseñar esto perfecto ahora Blanca dice hola pero claro Hay un problema y es que como solo tenemos una casilla de mensaje pues tanto Albert como Blanca han tenido que incluir su nombre en por ejemplo aquí alguien dice a las buenas pero no sé quién es a las buenas vale con lo cual vamos a ampliar un poco la lógica de este ejercicio para que os podáis identificar Así que vengo por aquí y ahora sí en 008 Ahora sí en 008 Yo hago lo siguiente vamos a ver aquí abajo en el input yo voy a poner dos inputs input ID nombre placeholder introduce tu nombre y input ID mensaje placeholder introduce tu mensaje si yo ahora le doy a grabar y ahora aquí digo esto es el mensaje y esto es el mensaje yo ahora vengo y digo Let usuario es igual a document query selector usuario punto value y ahora viene lo mejor yo creo que es lo mejor de la clase de hoy Y es que yo aquí estoy creando un objeto led objeto y el objeto es un J son de tal forma que puedo decir mensaje es mensaje coma usuario es usuario y lo que quiero que veáis es que si yo estoy creando un objeto y le puedo poner dos propiedades le puedo poner las propiedades que absolutamente me dé la gana Vamos a continuar Así que el objeto lo paso por aquí le paso el objeto vale pero quiero que interpreté esa Estructura de datos como una estructura que es ampliable para que tenga lo que os dé la gana bien Así que lo doy a guardar y ahora a continuación Mirad Yo vengo por aquí me voy a cargar el 008 y ahora introduce tu nombre José Vicente introduce tu mensaje Hola Y si yo le doy a enviar yo no lo voy a ver así que me voy a cargar esto en otra pestaña para simular que soy uno de vosotros vale hago así me voy a otra pestaña aquí hago así y me voy a otra pestaña y José Vicente dice hola le doy a enviar e cuidado un momentín Perdón me ha dado un error un segundos eh dónde me ha dado el error en la línea usuario valiu qué pasa tío Por qué usuario me das error vamos a verlo Ah nombre es que no es bueno va usuario Ok grabo recargo aquí recargo también vale eh nombre espera nombre José Vicente e ahí nombre José Vicente mensaje Hola a todos le doy a enviar Y entonces el usuario José Vicente ha dicho Hola a todos vale entrad dentro de es la misma URL de antes pero cambiando el si por un o vale entrad Y enviad algún mensaje y por tanto veremos que ahora con dos inputs pues puedo Añadir O sea si puedo meter dos inputs puedo meter la información que me de la gana es un poco el resultado de la clase de hoy no así que venga Dale venga dadle Okay Hola de nuevo pero ahora tengo un usuario que es Albert vale perfecto alguien más envía algún mensaje mientras vais enviando algún mensaje os diré que esto que hemos hecho hasta el momento lo podríamos haber hecho con Apache Pero vale José Manuel a las buenas de nuevo vale eh Pero esto que vamos a hacer ahora a continuación es lo que nos costaría hacer con Apache daos cuenta de una cosa también Y es que yo lo que he hecho es establecer una conexión constante vale eh Solo me sale el de enviar pues Blanca recarga porque en principio te debe salir todo claro Ah vale Okay pues bueno no El Siete tenía ya un input Pero bueno lo que sea no pasa nada pero sí de solo un botón es de antes sí Bueno pues ahora como os Digo vamos a hacer eh A ver por aquí vale vamos a hacer un juego multijugador lo voy a hacer el juego lo más sencillo que os podáis imaginar para que perfecto Blanca ya ha podido per fenomenal vale para demostrar esta comunicación entre diferentes usuarios voy a crear una especie de pelotitas digamos Vale entonces vamos a ver Yo vengo por aquí introduce tu mensaje Vale pues Ahora en lugar de esto voy a decir eh aquí sockets archivo nuevo 009 html vale Y voy a decir lo siguiente cojo el 008 lo paso al 009 y ahora en lugar de mensaje voy a poner aquí color y ahora Place holder nada selecciona un color el type es color ahora cada uno de vosotros seleccionará un color bien una vez que hago esto Una vez que hago esto ahora a continuación el botón no lo quiero y voy a poner un Canvas en el Canvas eh vamos a ver voy a decir que Canvas nada y voy a decir qu vamos a ver Windows onload led Canvas led Lienzo es igual a document query selector y Canvas Vale ahora vamos a ver eh led contexto lo mismo de siempre vale esto es Lienzo get context 2D o sea esto es lo que hemos hecho varias veces antes de dibujar dentro de un Lienzo ahora eh Lienzo punto with es igual a voy a poner 512 a ver qué pasa Va 1024 vamos a hacerlo más grande 1024 Lienzo pun height es igual a 1024 esto luego se puede cambiar Vale y a continuación ahora viene el tema led posición es igual a o led jugador es igual a Pos x es igual a 256 coma Pos y es igual a 256 coma color de momento voy a poner red luego lo Vais a poder cambiar bien así que yo ahora tengo un jugador este jugador es cada uno de vosotros cada uno de vosotros Ay perdón 256 no 512 cada uno de vosotros va a salir desde el centro Vale y vuestro color de inicio es el rojo Vale pero no os preocupéis porque luego lo Vais a poder personalizar Así que ahora Yo vengo por aquí yo vengo por aquí y digo contexto punto bueno vin p esto es un rollo contexto pun arc es jugador punto po x coma jugador punto po y coma 20 0+ pun pi por 2 y contexto punto fill y eh contexto punto fill Style es igual a jugador pun color vale si esto va bien no lo hagáis ahora todavía vale No entréis hasta que yo os diga Porque ahora mismo no veréis nada vale si esto va bien Dónde está aquí ya pero porque me desaparece aquí Ah que está aquí bien si esto va bien yo ahora pondré un nombre José Vicente escogeré un color pero de momento la bola me aparece de color rojo y no puedo hacer nada más vale no hago nada más Pero yo ahora bueno on click me dice que ya no funciona No pasa nada Eso es cierto on click me dice que ya no funciona me lo voy a quitar Okay Vale pero yo ahora lo que voy a hacer Es que voy a escuchar voy a el escuchador más sencillo que pueda javascript listener was vale Y me voy a crear un escuchador Okay pues este escuchador ah que hay app no voy a solo el de KD vale cojo este escuchador eh lo ejecuto vale compruebo que funciona la tecla wsad Y entonces digo que vamos a ver si pulso la W jugador punto Pos y menos igual a 10 que si no ira muy lento si pulso la a jugador más O sea Pos y más = a 10 Si pulso la s se me ha apagado la pantalla si pulso la s Ah no perdona La a es Pos x men ig a 10 Si pulso la s jugador Pos y más igual a 10 y si pulso la d jugador Pos x más ig a 10 default nada vale Y por último aquí voy a poner función dibuja jugador y en dibuja jugador voy a poner Esto vale Así que dibuja jugador y vamos a probarlo estoy en el 009 ahora cambiaré al 0010 pero si todo va bien contexto is not defined Okay Por qué Pues porque esto vaya lo estoy cargando ahí Vale pues voy a hacer esto fuera y este Script lo voy a pasar bajo del todo ahora vale jugadores No defined cómo que Ah sí led jugador vale venga Si ahora empiezo a mover En principio vale veis como estoy moviendo mi jugador vale Solo estoy moviendo mi jugador si vosotros cargá ahora veréis como solo movéis vuestro jugador otra cosa que voy a hacer es poder cambiar el color voy a hacerlo en un archivo aparte entonces así vais viendo Cómo crece la cosa html me edito este archivo me paso el código del 09 vale Y ahora a continuación digo eh document punto query selector color punto onchange es igual a function Y entonces le digo jugador punto color es igual a dis valu qué es lo que hace esto Pues que si yo ahora me voy a la versión 10 del ejercicio 10 y yo de momento estoy pintando rojo yo ahora selecciono otro color y a partir de ese momento estoy pintando de ese otro color vale la idea es que deberíamos pintar de un color solo pero yo con este juego de momento eso sería algo así como un tron digamos el clásico juego de Tron vale Yo con este juego de momento estoy jugando en monojet que quiero es enviaros la información a todos aquellos que estáis conectados al juego y cada vez que uno de vosotros que esté conectado se mueva quiero que me envíe la información vale Y por tanto que me lo pinte en la pantalla es decir quiero que se pinte en vuestras pantallas lo que yo estoy jugando y quiero que se pinte en mi pantalla lo que vosotros estáis jugando así que para ello Así que para ello voy a crear la versión 11 del ejercicio punto html voy a estar unas cuantas versiones programando y ahora en cuanto tenga algo ya visible os Digo e conectaros la versión tal Bien cojo el código del 10 lo paso al 11 Y entonces digo cada vez que yo pulse una tecla socket Send esto lo tenía yo por aquí vale No tanto ha sido el 8 o el nu o el aquí vale cada vez que yo pulso una tecla sí se dibuja mi jugador pero a continuación jugador lo envío al socket Vale mi jugador completo y esto es lo Guay que tiene en videojuegos trabajar con clases con objetos Vale mi objeto se lo pasas directamente al servidor de sockets esto quiere decir que yo Ahora vengo por aquí estoy en el número 11 vale estoy en el número 11 Aquí también voy a cargar el 11 y entonces yo selecciono un color verde y le doy a la tecla V doble y Hola 11 a ver aquí Debería socket A ver no socket is not defined vale socket is not Define Oye por qué cómo es posible que socket is not Define imposible Espera vale not Def espera vale Sí correcto un segund socket is not defin porque socket debe estar declarado arriba del todo okay Y aquí vale ahora luego os pongo un comentario por aquí que estos son las variables globales vale venga recargamos por aquí recargamos el 11 sacamos la eh consola y ahora hago así y tengo que mientras que el de izquierda se está moviendo le está enviando al de la derecha Dónde está Incluso si cojo y cambio el color le envía al de la derecha el nuevo color que tiene si el de la derecha está recibiendo la información como os podéis imaginar Yo ahora lo que voy a hacer es lo siguiente que voy a pintar a los colegas así que vengo por aquí Espera espera Espera cabrón ahora se acabado el mosquito Ah pues me ha picado sabes me ha picado porque el cabrón estaba lleno de sangre y esa sangre debe ser mía o sea que en fin Vale pues 012 html por lo menos acabó Ya el mosquito vale Y edito el y de hecho yo creo que iba con el culo pesado de la sangre que llevaba o sea aquí ha sido un buen ejemplo de la avaricia rompe el saco Pero bueno vale Y ahora cada vez que yo reciba datos vale Yo ahora vengo y digo a ver el método dibuja jugador podría la x coma la y coma y el color o sea es un método con tres parámetros con lo cual yo ahora vengo por aquí y digo Vale pues esto coge jugador x pun Pos x coma jugador punto Pos y coma jugador punto color o sea tres parámetros para una función Aquí voy a decir que esto es color Aquí voy a decir que esto es x Aquí voy a decir que esto es y ahora aquí digo lo mismo jugador punto dibuja jugador eh Hola Aquí y ahora viene lo bueno Y es que cuando recibo datos los datos son cuidado los datos son un array objeto sí Ah vale Perdón Sí vale Okay entonces dibuja de datos punto Pos x datos. Pos y datos. color vale si esto ha funcionado correctamente a ver un momentín que vea un mensaje vale Okay si esto ha funcionado correctamente Ah blanca si te ríes por lo del mosquito no te rías porque es que te lo juro Mira sabes que te digo voy a enviar una foto vale porque es que creeréis que estoy haciendo el teatro pero os juro que es el mosquito más molesto que me he encontrado en PR mogollón de tiempo y Vais a ver que el cabrón iba lleno de sangre ahí lo tenéis Hala en el grupo está y enviado vale si hacéis zoom podéis a ver o sea podéis ver que había más sangre que mosquito pero bueno en fin Pues el tema dibuja jugador Vale pues yo creo que ya vamos al 12 me voy al 12 vale aquí me voy también al 12 bien y aquí si todo va bien Ahora me cojo un color el que queramos y si lo veis ahí a medida que voy pintando en uno se va pintando en el otro y si aquí cojo otro color voy pintando aquí y se va pintando en el otro vale bien a continuación lo que quiero es que entréis todos en esta dirección una vez que entréis en esta dirección seleccioná un color de momento el nombre no hace falta seleccioná un color y empezáis a pintar Vale y os empezáis a mover yo soy el que soy como magenta simplemente cogéis un color y acordaos con las teclas wsad podéis empezar a recorrer vamos a ver Mira alguien azul hay alguien azul que ha entrado Ok perfecto alguien rojo también ha entrado alguien rojo alguien que no ha cambiado el color Pero bueno y por tanto veis Cómo y alguien ahora alguien negro ha entrado Ah Alguien ha cambiado el color a mitad Ok vale alguien se ha puesto mi mismo color magenta y si os dais cuenta a alguien amarillo por ahí vale si os dais cuenta somos Sí es que alguien se está saliendo del límite somos varios jugadores jugando Ay que me salgo yo también jugando en el mismo tablero Vale ahora haré el radio un poco más pequeño eh si os dais cuenta vale esto a veces va un poquito a golpes Más que nada porque como os digo el servidor que tengo es mínimo el servidor que tengo es un núcleo 10 GB de disco y creo que ti 1 gig de ram vale prácticamente nada pero esto que estamos viendo donde el la actualización es práctica en el mismo instante vale es prácticamente en el mismo momento es lo que hace que un servidor de websockets se diferencie con respecto a lo que es un servidor de tipo Apache vale esto con Apache si el websocket va lento pero va lento por el servidor no por el websocket esto en Apache iría a pedales Vale y cuanta más gente se una pues más a pedales más apedales sería bien vamos a tocar un poquito el juego vamos a ver eh vamos a ver vamos a hacer una siguiente versión claro a partir de aquí como os podéis imaginar podéis implementar un tron un comecocos eh vía multijugador o sea podéis implementar yo solo hoy me estoy preocupando de la lógica del websocket vale no me estoy preocupando ni de meter un Sprite ni de la colisión ni la gravedad ni nada vale todo eso ya lo hemos hecho en ejercicios anteriores y no quiero marear este ejercicio únicamente quiero implementar la comunicación de red para separar un concepto del otro voy a dibujar ahora un poco más pequeño voy a dibujar aquí dos o tres y ahora continuación voy a decir contexto punto fill Style es igual a rgba 255 0 pun 05 a ver qué tal Vale y contexto pun Fil rect de 0 1024 vale de esta forma lo que pretendo conseguir con esta siguiente versión del ejercicio vamos a ver voy a entrar en el 13 Es que hostias Ah claro vale es que haya como una Estela Vale ahora claro como va a saltos el hecho de que vaya a saltos de 10 y me haga como una especie de Estela El caso es que o sea me haga como una especie de línea discontinua El caso es que no me disgusta vale pero bueno voy a cambiarlo un poco Voy a decirle que eh paso y ahora comento el texto o sea comento el código Let paso es igual a 10 Ok el window unload creo que me lo puedo cargar ya porque ya no hace nada Esto vale 013 Vale y ahora led pasos igual a 10 Así que aquí le digo paso y por lo tanto ahora el paso es igual a dos muy bien recargo Vale y vemos cómo va dejando una pequeña Estela vale con lo cual conectaros al 13 y vamos a probar Más que nada porque la Estela irá decreciendo fuertemente en función de los usuarios que haya Así que vale probadlo meteros que alguien se meta estoy en el 13 acordaos ahí vale Claro pero si yo me muevo o sea os tenéis que mover para no desaparecer si vosotros no O sea si vosotros os movéis y yo no desaparezco vale Okay perfecto y ahora pues podemos jugar más aunque se están quedando un poco las estelas vale Pero bueno no pasa nada pero ya no es tan lioso como antes digamos vale Okay Bueno pues voy a comentar el código Y a partir de aquí pues en próximas sesiones también un poco en lo que queda de curso eh le Sacaremos partido a estos websockets de momento hoy lo que quería era hacer un ejercicio donde los websockets estén en funcionamiento y desde luego pues que a ver voy a cerrar por aquí y que veáis qué utilidad pueden tener y como ya os digo uno de los usos principales de los websockets son videojuegos otros son chats otros son transmisión de paquetes de audio y de vídeo o sea un poco el que veáis que tenemos un sistema donde tenemos una arquitectura de cliente servidor el servidor de hecho ha sido muy fácil de programar os lo he pasado en agnóstico daos cuenta que yo he ido modificando el cliente y no he modificado el servidor porque al servidor se le apela el servidor dice Bueno tú me envías paquete Yo te envío paquete tú sabrás que tiene este paquete vale el servidor no juzga el servidor lo único que hace es que recoge paquete envía paquete es el cliente el que transforma ese paquete a algo que tenga un sentido visual vale bien pues vengo por aquí declaro variables globales y digo a ver eh el Lienzo en el que vamos a dibujar ahora creo un contexto para dibujar en 2D defino un jugador inicial defino un jugador inicial y lo defino en un objeto porque ya habéis visto que tiene ventajas tiene o sea para programación de videojuegos la programación orientada de objetos tiene infinidad de ventajas ahora defino el paso de velocidad defino el paso de velocidad del personaje vale Y ahora a continuación esto son las variables globales voy a poner por aquí comentarios vale por aquí okay Y ahora esto es propiedades del Canvas propiedades del Lienzo Y entonces a continuación Obviamente le digo que el Lienzo tiene x pixeles de anchura cambiarlo a lo que queráis y el Lienzo tiene y píxeles de altura Vale ahora Al comenzar el juego dibujo al jugador esto lo podría poner aquí arriba porque técnicamente pues bueno es una propiedad inicial en cierta forma del Lienzo Vale ahora trabajo con sockets Vale y Okay y trabajo con sockets pincho por aquí vale esto ya tiene comentarios de antes y ahora función de dibujo de los personajes claro esto en un juego más extendido Pues el personaje sería una clase más completa jugador sería una clase más completa eh habría un método llamado dibuja vale como en los juegos que hicimos anteriormente en este caso lo hago en una sencilla función porque quiero que sea lo más sencillo posible Vale entonces la función admite tres parámetros eh pongo el color de borrado borro ligeramente el anterior configuro el color de la brocha empiezo a dibujar dibujo un círculo y relleno el círculo de color vale una vez que tengo esto a partir de aquí vamos a ver controles de teclado muy sencillos aquí controles de teclado vengo aquí y digo actualizo la posición del personaje Esto va a ser lo mismo okay Y una vez que he actualizado la posición del personaje dibujo al personaje con su posición actualizada y envío al resto de jugadores mi posición y mi color Y por último simplemente cuando cambio mi color Vale cuando cambio mi color cuando el input de color cambia el color del jugador eh Y pro y punto Vale ahora un momento del jugador Vale ahora en el tiempo que queda de clase vamos a hacer algún tipo de juego que tenga algún tipo de sentido vale voy a hacer un pequeño tron el tron original es un juego de pistas que lo que hace es que no puedes colisionar con las pistas que van dejando otros jugadores Así que para ello Voy a hacerme sockets vale 014 pun html para que veáis que una cosa es la comunicación de red y otra cosa es la lógica del juego editar 013 me lo paso a 014 bien y voy a hacer el tron más sencillo que puedo hacer Vamos a ver eh jugador inicial Pos x es má pun Random multiplicado por 1024 y jugador punto y es maz pun Random por 1024 es decir cada uno de vosotros va a tener eh una esto una posición aleatoria ahora a continuación en el color Mira te voy a quitar el color te voy a quitar el color en la versión 15 te voy a quitar los inputs cada uno va a tener un color aleatorio no lo va a poder cambiar y entonces digo led rojo es igual a math pun round por maz o sea de maz punto Random multiplicado por 255 esto es rojo led verde y azul Vale ahora esto es color rgb y esto rojo verde y azul okay venga y ahora no quiero lo de que me borres el contexto porque voy a hacer un tron Ok vale esto quiere decir que si ahora me voy al 15 Okay 14 vale Yo me muevo y tengo un color aleatorio y una posición aleatoria otra cosa que puedo hacer por cierto es poner un poquito de estilo al Canvas Style vale Body background Black y ahora Canvas background White y margin auto lo cual quiere decir ah no margin auto no me ha funcionado por qué no me ha funcionado margin auto ostras Bueno pues voy a decirle texaline Center Ok vale venga ahí lo tengo recargo vale Y me sale el jugador en cualquier parte Por cierto No nada Por cierto nada vale ahora le pongo la lógica del juego la lógica del juego dice que un momento Ahora sí voy a crear el 0. html Vale y digo vamos a ver un segundin que me voy a concentrar Por qué vale Okay dirección es igual a cer0 Entonces si pulso la W digo jugador punto dirección es igual a 0 si pulso la a jugador dirección es igual a 1 si pulso esto es igual a 2 y esto es igual a 3 y ahora lo que tengo que hacer es lo siguiente If no switch jugador punto dirección y entonces en caso de que sea cer0 va a pasar una cosa en caso de que sea uno va a pasar otra cosa en caso de que sea dos va a pasar otra cosa y en caso de que sea 3 va a pasar otra cosa Vale y digo led Pixel es igual va para Pixel bueno led Pixel Ay lees led Pixel V Pixel es igual a contexto get image Data de jugador pun x coma jugador punto y com 1,1 punto Data de 0 1 2 y 3 o sea El Alfa y ahora en el caso de que sea cero quiere decir que el personaje va hacia arriba jugador x jugador y menos paso multiplicado por 2s es decir el personaje Mira más allá Es decir si el personaje va hacia arriba Pues mira el Pixel de un poco más arriba del personaje ahora en caso de que sea uno es jugador a hacia la izquierda Vale pues esto lo paso a la x en caso de que sea aquí en caso de que sea 2s dos es la s pues jugador y más paso multiplicado por 2 eh Perdona tocado lo que no debía aquí y más paso multiplicado por 2 y en el caso de que sea la B vale jugador x menos paso por dos ahora si sí voy lo sé lo sé un momentín lo pongo en marcha y Ah os lo explico ya sé que no me entendéis un momentín lo sé si pixxel es mayor que cer en ese caso voy a lo acabo de implementar demuestro si funciona y ahora comento el código y os explico qué estoy haciendo exactamente Windows pun window qué Uh u se me acaba de ir la mente chat gpt javascript method Windows tu set URL window location Gracias venga Windows pun location es igual a Windows pun location vale un momento creo que con esto ya está lo pruebo Y ahora os lo explico vamos a ver estoy en la versión 15 Estoy en la versión 15 no Hola No estoy en la 15 porque dice que no existe la 15 ahora vale Aquí estoy con la versión 15 Aquí estoy con la versión ahora la 15 un momento vale dibujo en este otro de aquí dibujo y ahora si este de aquí choca con esto perderá el juego vamos a verlo y a ver no ha perdido qué ha pasado aquí get image un momentín value is not of type long en la 105 get image Data 1 Data 3 Data 3ex Data punto Data de TR pun Data de TR ostras Por qué falla Ah perdón perdón sí sí ya sé por qué falla porque esto a ver jugador pun po x es igual a ma pun round de jugador punto Pos x es decir el pixxel el Pixel no admite decimales V Ok recargo vale y hago una pared y ahora voy a este rojo el rojo se mueve va a chocar contra la otra pared y si todo va bien se reiniciará el juego PC plac no vale Ok y no value is not of type long otra vez a ver un momentín que refresque y refresque voy directamente a buscar la colisión a ver un momento voy a Estoy a punto hacer un console punto log enorme míralo value is not of type long Por qué vamos a ver en la línea 107 en a ver contexto jugador y más paso por dos 1 Qué cosas Vale pues vamos a un momentín voy a lanzar el Pixel console.log pixxel y a ver qué sale míralo que Vale pues vamos a ver led Pixel Vale pues voy a decir Data console.log Pixel not of type long hostias estoy en la Vale pues esto es que me está diciendo lo del long porque nunca debe ser longo debe ser int voy a hacer una cosa voy a poner el math punto round aquí math pun round Es decir me está cogiendo al parecer números decimales y evidentemente no puedo un número o sea no puedo píxeles con decimales por motivos obvios vale a ver ahora no imposible not of type long estoy dudando eh get image Data es long a ver para se in quito aquí el má punto round quito el m punto round x x también lo que voy a hacer es sacar la posición a ver vale posición eh console pun log jugador vale x Por qué no me dice value is not of type long es que me sigue diciendo que es un tipo long pero no lo es voy a bajar esto a líneas diferentes Y por qué me da error en ese Ah okay vale w console píxel es igual a get Data get datata voy a hacer una cosa chat gpt es que no puedo A ver no puedo ver dónde está el error A ver dice que estoy pasando un tipo long pero es que no estoy pasando un tipo long estoy pasando un entero Entonces no sé por qué me dice lo del long Ay Espera que no quiero Oh no quiero el gpt o1 preview quiero el este vale espera valores enteros asegúrate sean enteros utilizando math pun round o pero si es que lo estoy haciendo vale má pun round es que estoy haciendo esto a ver si es que no estoy editando el código correcto ah no sí a ver cierro todo voy a recargar Go sockets a ver qué tontería engancharme con esto porque es la menor parte del ejercicio pero vamos a ver vale Y aquí también voy a vaciar la cache Ok get Data Vale ahora consol de jugador pun x coma jugador menos paso por dos coma y ya está undef Ah aquí está la cosa aquí está la cosa por qué me dice undefine hostias porque es Pos x y Pos x Pos x y Pos y vale Ahí está secreto Okay Vale undefine n Okay vale a ver si ahora De hecho si me choco contra mí mismo plch no undefine n muy bien claro ahora okay Este es el Pixel pun Data esto fuera If Pixel punto Data de TR Es mayor que cero vale vamos a probarlo bien hago así ahí Ah ahí hago así bien teóricamente ahora os explico qué es lo que estoy haciendo esto es por paso por 4 la B esto es Pos x más paso por 4 esto es el 2 la s es Pos + 4 por paso vale esto es el caso un que es la a que es Pos x menos paso por 4 Okay Vale vamos a ver ahora vale Y en teoría si me choco conmigo mismo cataf loncho vale perfecto y si ahora otro jugador se choca conmigo hostias lo que hay aquí si ahora otro jugador se choca conmigo claro vale este jugador viene aquí vale Y ahora a continuación Blanca os explico qué he hecho vale el Por qué he hecho y todo eso veréis yo lo que quiero es que si yo soy este gusanito claro ahora veremos que realmente los gusanitos bueno tenemos que entrar todos a la vez vale eh si yo vengo por aquí lo que quiero es Mira Blanca lo que quiero es mirar si voy dirección hacia abajo Quiero mirar el píxel que está un poco más hacia abajo si voy dirección hacia la derecha Quiero mirar el pixxel que está un poco más hacia la derecha si voy hacia arriba Quiero mirar el p que está un poquito más hacia arriba y si voy hacia la izquierda Quiero mirar el píxel que hay un poquito más hacia la izquierda Entonces por ello voy a comentar el código y ahora lo jugamos todos por ello lo que he tenido que hacer es lo siguiente declaro un píxel ahora me aseguro que las posiciones sean números enteros ahora el console punto log pues ya sabéis vale bien Ahora evalúo cuál es la dirección del personaje y digo en el caso de que vaya hacia arriba Mira el pixxel que está un poco más arriba En el caso de que vaya hacia izquierda en el caso de que vaya abajo y en el caso de que vaya hacia derecha Mira el píxel que está un poco más arriba Mira el píxel que está un poco más a la izquierda Mira el Pixel que está un poco más abajo Mira el Pixel que está un poco más a la derecha y por tanto después de haber mirado ese píxel digo si el píxel no es transparente quiere decir que alguien ha pasado por ahí y ha creado una barrera Y location recarga la página lo que quiere decir que has perdido digamos vale no va a ser un perder muy perder porque al recargar la página vas a desaparecer de todo vale Pero bueno vamos a probarlo Así que conectaros todos estamos en la versión 15 vale eh moveros un poco para ver que estéis y vamos a jugar un poco al Tron le jugar un poco al tron quiere decir que vamos a empezar a pintar recorridos pero no podemos machacar los recorridos de otros Cuando alguien machaque el recorrido de otro lo que hará es que recargar la página vale que perderá bien veo ya a alguien por allí entonces en el tron veo a dos personas más de hecho vale fenomenal en el tron tienes que intentar bloquear a al resto de jugadores Perfecto ahí hago así esto es un tron literalmente eso es y ahora lo intento cerrar pero ya no llego Igual me intenta cerrar a mí o igual no llega No lo sé esto que estamos haciendo es literalmente una partida de Tron vale Ahí y yo entonces intento Buscar ese hueco Ay acabo de morir vale No sé quién es el verde pero el verde sabe cómo se juega esto porque ahí me acaba de encerrar y ya no puedo hacer nada vale y yo Entonces vamos a ver el morado a ver qué pasa con el morado y el verde a ver quién gana entre el morado y el verde porque yo ya he perdido el verde está quieto y mira el morado le está cerrando la aquí vale el morado acaba de cerrar el verde probablemente con lo cual verde ha perdido si yo ahora intento tirar hacia la derecha pues lo que ocurre es que vale Ey Ah sí es que se me recarga el juego vale esto es el tron que acabamos de programar un poco para deciros que pues una vez que tenemos un conjunto de sockets programado pues podemos programar lógica y podemos hacer juegos multijugador con lógica con comportamiento Con condición de vivir condición de morir condición de penaliza energía o lo que sea vale obviamente os recomiendo ver la película tron de Disney de 1982 para que podáis entender mejor cómo funciona este juego Pero bueno ya os digo es o Buscad en YouTube thron game Y así pues veréis un poco Cómo va vale Así que bueno poco más por hoy en esta asignatura Así que voy a parar la grabación