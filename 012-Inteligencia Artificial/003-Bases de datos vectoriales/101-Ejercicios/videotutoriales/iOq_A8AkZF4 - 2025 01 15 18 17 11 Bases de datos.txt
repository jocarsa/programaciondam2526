en primer lugar vamos a eh realizar una primera implementación de este sistema sobre el servidor para comprobar si funciona o no vale antes de ello eh lo que quiero hacer en este caso es crear un archivo de configuración porque ya sabéis que siempre que implementamos sobre el servidor Pues hay una cosa que es la configuración en local y otra cosa que es la configuración en el servidor Vale entonces para ello voy a decir que Eh take this software and load mysql config connection config from a js file por ejemplo a ver esto lo quiero así esto lo quiero así Vamos a darle así Más que nada porque luego igual se queda en la carpeta pública Pero bueno ahora veremos y evidentemente no quiero que est en la carpeta pública Entonces vamos a verlo ahí db config J son muy bien lo cual quiere decir que esto es el archivo y ahora aquí esto es el archivo voy a ir a hedit me voy a ir a marcadores html jocars cistel voy a crear un archivo nuevo db.js no se llamaba Así exactamente el archivo se llama el archivo se llama d config json comprobamos que en el servidor local caray dónde estás aquí comprobamos que en el servidor local sigue funcionando correctamente vale por tanto ejecutamos y sigue funcionando correctamente vale Y ahora a continuación me lo voy a subir a github no quiero subirme ya sabéis la configuración o por lo menos O por lo menos si queréis Mirad me lo voy a guardar como debe config sample y el sample me lo guardo vacío y entonces no me subo el config sino que me subo el sample vale el db config lo ignoro me subo el db config sample a producción y ahora hago lo siguiente Ok Vale ahora en el servidor de producción me voy a la carpeta principal voy a hacer esto grande para que me veáis me voy a la carpeta principal y quiero el editor aquí y quiero clonar el proyecto jarsa fistel clono y ya lo tengo ahora a continuación lo que quiero hacer es instalar algún tipo de php My admin para gestionar de forma más fácil las bases de datos dentro del remoto vale eh Para ello de todas formas lo que puedo hacer de momento es mysql u Root p pongo la contraseña estoy dentro de mysql Así que digo create database cistel use cistel estoy dentro de cistel lo estoy haciendo un poco a mano vale Pero ahora a continuación voy a decir create user fistel user 4 identify by tame un 2 3 vale me lo voy a copiar esto en el logo del servidor que si no luego lo olvidaré esto es día fifel vale Okay ahora le doy todos los permisos a cistel al usuario cistel user You Are Not allowed to create a user with Grant vale exit sudo mysql u Root p pongo la contraseña vale Y ahora lo pongo un momento fistel user a fistel user es decir estoy creando un usuario y le estoy dando privilegios Okay vale Y ahora una vez que he creado la base de datos Y una vez que he creado un usuario con permisos voy a hacer una cosa voy a instalar php my admin para ello Pues bueno puedo hacerlo de varias formas de momento una forma un poco sucia que no me gusta pero bueno es la siguiente voy a ir a php my admin no aquí no voy a ir a php my admin voy a ir a php my admin me lo bajo lo subo me voy a bar me voy a w me voy a html me voy a all blaz y aquí feo sucio vale eh my php ahí lo voy a subir feo sucio lo sé le crearé un subdominio aparte pero de momento lo voy a meter ahí dónde estás opq ahí está vale Okay lo subo al servidor no CD jarsa old l CD my php vale un fip php eh sudo app install un fip vale un fip bien Vamos a verlo me acabo de en esta máquina instalar php my admin Ah venga qué rabia me da cuando hace eso vale esto se llama php admin Ah no aquí está Vale y si ahora me meto Y si ahora me meto en jara.com myphp Pues tengo phpm admin con usuario fistel user 4 con la contraseña tam dam un 2 3 que es la contraseña que le he puesto lo cual quiere decir insisto vale esto es muy guarro lo que hecho es meter un phm admin en medio de old days no Mola pero ya haré un subdominio para ello importo la base de datos a tiempo de hacer subdominio siempre estoy importo la base de datos primero desde aquí exporto aquí importo Okay no sub para exportar vale Ah sí por qué Pues porque el tamaño máximo Son 2,48 cas vale Okay quiero exportar pero solo quiero la estructura Solo quiero a ver Solo quiero la estructura Dónde está eso e me falta aquí una cosa aquí los datos no los quiero vale exporto fistel importo vale Ok entonces ahora a continuación si os fijáis tengo ya la estructura metida dentro del servidor tengo dónde estás aquí no tengo que ahora me meto en el servidor me voy a config me voy a w me voy a html me voy a jocars cistel me voy al db config sample y me lo guardo como deb config y tengo Host local Host user es fistel user password es este database es cistel vale Ahí lo tenemos ahora a continuación Ah este es el de config correcto ahora a continuación me voy a CD jocars cistel python 3 cistel python no está al mys connector ok No pasa nada Pues sud p3 t mysql gu connector lo quiero con Break System packages vale vuelvo a ejecutar fistel OK ahora Qué dice vamos a ver light salmon vale dice authentication plugin catching sh2 password is not supported Okay vale Okay hay un error de logueo vamos a verlo por qué vale vamos a ver esto fuera dis python Script gives this error on ubuntu server a ver si me falta algún método de autenticación Ok Vale pues vamos a alterar esto fistel sql alteramos mi usuario es fistel user mi password es este password okay continúo Necesita el privilegio create user vale Ok si no me deja hacerlo así sudo mysql u Root p ejecuto con superusuario y ya está Vale entonces ahora exit ejecuto python 3 cistel no catching sh2 password vale hay algún problema con el conector de python vamos a ver eso pip instal este sudo pip install este break System packages Ok Muy bien volvemos Ahora sí bien y si ahora entramos en la base de datos ahora sí ya tenemos todos los registros que provienen del servidor y ahora si ya como os podéis imaginar lo que voy a hacer es que cada día a las 2 de la mañana voy a ejecutar o a las 3 de la mañana o a las 4 de la mañana eh ubuntu Chrome Tab execute Script everyday at 3 am e chrom Tab e no Hola cómo que no Chrome Tab e me vengo aquí al final 015 no no okay Vale pues pego no lo quiero A las tres lo quiero a estas tres y quiero python 3 bar W html jarsa fistel bar fistel python esto quiere decir esta es la primera parte del ejercicio que hacemos hoy que eh A partir de ahora cada día me da igual que luego python lo archive y más adelante incluso lo elimine porque cada día me va a ir metiendo la información dentro de la base de datos voy a hacer control o control x y ya está bueno los datos de hoy me los meterá duplicados porque son los datos de ayer Pero bueno no pasa nada al final de la tarde de hoy vaciamos la base de datos Y ya está bien Ahora tengo Ah no no no porque mañana a metrar los de hoy no está bien vale ahora a continuación vamos a ver Ah un momentín vale Por cierto cuánto ocupa la base de datos 16 cas es que no es cierto con lo cual ahora luego cuando actualice la base de datos me dirá cuánto ocupa Pero vale revisar la tabla Okay revisar la tabla Okay actualizar la O sea qué te iba a decir yo optimizar la tabla Ok reparar la tabla Okay ya os digo ahora luego cuando haga un repaso veréis que eso no ocupa 16 cas Ojalá 7,000 registros ocuparán 16 cas bien Ahora a continuación quiero empezar a pedir cosas la depuración de residuos precisamente sirve para que el sistema quite archivos temporales y al quitar archivos temporales Pues porque muchas veces cuando borramos grandes cantidades de datos de may sql en el registro de lo que ocupa la tabla siguen ocupando datos de hecho esto si os acordáis nos pasó con los blobs entonces sirve Exactamente para eso vale Dónde estaba la deora de residuos estaba por aquí dónde lo has visto a la derecha pone cero mira aquí vale Bueno ya te digo no te preocupes dentro de una hora o por ahí actualizará y verás que 7000 registros ocupa en 16 cas es imposible vale tiene que ocupar más por lo menos M es a ver Es raro quiero decir en wordpress suele aparecer residuo para depurar si eliminas artículos y simplemente básicamente haces así con la tabla le das a optimizar la tabla y ya está Entonces si eliminas registros en wordpress si eliminas artículos sí que es normal que tengas residuo que serán igual un mega como mucho o sea tampoco suele ser mucho vale Pero bueno yo que sé pero siempre hay que echarle un vistazo por si acaso vale bien pues a continuación yo lo que quiero ahora es crear una Eh bueno os voy a explicar ahora a continuación un concepto importantísimo en bases de datos que son los procedimientos almacenados pero tranquilos porque aunque es un concepto complejo vosotros tenéis ahora mismo ya los conocimientos como para entender fácilmente ese concepto Mira me voy a apach logs y yo a continuación quiero averiguar las diferentes ips que me han visitado pero con respecto a un virtual Host es decir yo me voy a sql y digo Select all from Apache logs y digo eh Select Mira sabes qué voy a hacer visitas por día Select count uno Espera tengo esto Ah mira vale mysql count visits per Hour using timestamp Field Ok bien vamos a ver Ahí está OK cojo esto sql y digo Time stamp es Time stamp como hora count as núo from apach logs Group by time stamp order by hora Así que yo le doy a continuar y me dice las horas a las cuales me han visitado vale me dice pues el 13 22 el 13 23 a las 01 2 3 4 y todo esto ya sabéis que luego de hecho incluso podemos vaya no me aparece podemos mostrarlo en formato de gráfico vale en formato ahí de gráfico pero claro yo lo que quiero ahora vaya se me ha ido el sql una pena un rollo pero yo ahora lo que quiero No es que me lo haga de todo esto es hora y esto es número de apach log sino quiero que me lo haga por ejemplo we virtual Host es igual a light salmon Así que ejecuto y veo que tengo una serie de visitas o we virtual Host es igual a jarsa Vale y tengo ahí otra serie de visitas Claro si yo quiero hacer esto para cada uno de los virtual hosts pues lo que me voy a encontrar Es que voy a tener que hacer un montón de peticiones diferentes pero sin embargo si esto fuera python o si esto fuera javascript yo diría Bueno cuando me ocurre que tengo que repetir muchas veces un código yo sé porque lo he explicado varias veces en clase y lo hemos utilizado que existe un recurso de encapsulación que se llama función y yo sé que las funciones pueden tener parámetros Así que en este caso podría hacer una donde el parámetro fuera virtual Host la cuestión está en que una de las cosas que os tengo que enseñar es y que tengo os acordáis que la semana pasada me lo dejé rojo pendiente de enseñároslo es el concepto de procedimiento almacenado el procedimiento almacenado en mysql es precisamente el recurso de poder convertir peticiones mysql a algo par a lo que es una función con parámetros dentro de cualquier lenguaje de programación para ello puedo hacer lo siguiente me vengo aquí y digo convert to stored procedure using jarsa as parameter as input parameter y de esta forma y de esta forma el sistema lo que hace es crear un procedimiento almacenado que Insisto que procedimiento en mysql es lo que en otros lenguajes conocéis como función me voy a sql atentos Ah a cistel eh fijaos que cistel solo tiene ahora mismo tablas atentos a ver si no me da error de creación bien Quiero crear un procedimiento llamado visitas por hora in virtual Host name in quiere decir parámetro de entrada Eso quiere decir que en procedimientos almacenados en mysql también existe el concepto de parámetro de salida pero de momento quiero trabajar con parámetro de entrada si creo un parámetro de entrada utilizo el parámetro de entrada el concepto es el mismo que crear funciones dentro de mysql y ahora a continuación le doy a continuar atentos aquí a cistel a ver si tengo permisos para hacer eh procedimientos almacenados le doy a continuar y si todo va bien Voy a refrescar aquí la pantalla aquí antes solo había tablas Pero ahora al refrescar php my admin ahora aparecen procedimientos insisto son funciones almacenadas en mysql Y eso quiere decir que ahora me voy a visitas por hora no os preocupéis por esto vale Y ahora lo que quiero en procedimientos es ejecutar veis que tiene un botón de Play visitas por hora y quiero ejecutar visitas por hora de eh jarsa le doy y me sal el resultado pero ahora quiero ejecutar visitas por hora de sigren no sé si habrá pues no hay ninguna almacenada Ahora quiero ejecutar visitas por hora de no sé qué tengo de til continúo no tengo qué tengo a ver un momentín espérate a ver medium Green Vale pues ahí quiero ejecutar de medium Green le doy a continuar y ahí ya tengo unas cuantas visitas vale por tanto por lo tanto La idea es que los procedimientos almacenados nos permiten encapsular peticiones sql y nos permiten por tanto reutilizar peticiones sql de una forma mucho mejor vale de una forma mucho más sencilla bien Vamos allá Vamos a continuar vamos a repetir este concepto para que podamos utilizarlo Tantas veces como queramos bien tengo visitas por hora Vale ahora a continuación lo que quiero vamos a ver es Eh bueno sacar las diferentes ips por ejemplo momentín espera Ay cachis Bueno pues no se pone vale esto es apach Perdona esto es visitas por hora y esto es j carsa vale hora número hora número no quiero esto lo quiero mejor esto es clave valor Pero esto vale voy a quitar el procedimiento voy a crear un nuevo procedimiento visitas por hora ahí por hora vale Okay ahora creo que sí refresco procedimientos visitas por hora jocar hora Perdón vale caray editar order by clave carsa y ahora sí bien sigamos ahora lo que quiero igual que tenía ayer en sigen vamos a ver qué teníamos ayer Bueno por país vale eso sí que tengo que consultar tabla Okay navegadores bien Vamos a ver sistemas operativos vale me vengo por aquí me voy a editar esto Vale y digo given this apach log create my sql query to count distinct browsers vale esto bien Así que hago esto Select count me voy aquí me voy a cistel me voy a sql me voy a distinct continúo distin no ok No B no want number of visits for each browser okay Todavía no Ah pues sí mira correcto muy bien petal Bot vale Ah petal Bot Bueno pues tendría que diferentes navegadores vale Ok bien entonces browser en as clave y esto es valor pero claro qué ocurre Pues que esto me está mostrando cuidado esto es clave y esto es valor Esto me está mostrando las visitas a todos los virtual hosts Pero yo lo que quiero es las visitas a los virtual Host que yo pueda eh seleccionar entonces Where virtual Host we apach logs virtualhost es igual a o es like jarsa continuar vale Y por tanto ahora a continuación me vengo por aquí y digo create stored procedure from this using hoc carsa as an input parameter bien Así que hago un delimitador me voy a my sql me voy a procedimientos no me voy a sql hago un nuevo procedimiento llamado navegadores le doy a continuar tengo un nuevo procedimiento navegadores y si le digo light salmon Chrome 9 y si le digo jarsa continúo y me saca los navegadores Así que la idea Está en que a partir de aquí yo puedo reutilizar la misma función para todos y cada uno de los virtual hosts insisto una vez más aplicando el concepto de función a sql os voy a decir una cosa yo os estoy enseñando esto porque os lo tengo que enseñar porque está en el temario vale eh aparte además de ello coincide por suerte para mí que el ejercicio que estamos haciendo de crear un sistema de logs Pues mira tú por dónde me da una excusa perfecta para enseñaros procedimientos almacenados la realidad en el día de hoy es que tampoco se usan tanto los procedimientos almacenados Vale ahora bien que sepáis que existen vale que sepáis que pues bueno Ahí están y que mejor para nosotros bien Ahora a continuación lo que voy a hacer es eh generar una vista que me diga todos los virtual Host que yo tengo en el sistema eso no es un procedimiento almacenado eso es un recurso que os enseñé en el primer trimestre que seguro que lo tenéis un poco olvidado que es el concepto de vista sql una vista sql es una petición de tipo Select que tú quieres hacer y te la quieres guardar Así que para guardarla lo que voy a hacer en este caso es que me voy a apach logs y le digo Select distinct virtual Host y ya está Vale y hago así continúo y esto me dice los diferentes virtual Host que hay dentro de mi base de datos los que sea que haya también le puedo decir order by virtual Host ascendiente y me los ordena por orden ascendiente ahora La idea es que yo tengo una petición y esta petición me la quiero guardar Bueno pues si me la guardo me voy aquí abajo y le digo Espérate que te lo digo y le digo crear vista y lo llamo el definidor soy yo vale el ver nombre se llama virtual Host le doy a continuar y veis que se ha añadido un nuevo recurso llamado vistas y aparece virtual Host esto quiere decir que si yo a partir de este momento el día de mañana digamos quiero cóm te diría yo quiero Añadir un nuevo virtual Host en los en Apache no tengo que venir a mysql para declarar un nuevo virtual Host sino que sql lo va a automáticamente porque en todo momento va a ir a pat logs y va a decir sea los que haya Dime los que hay vale Así que muchas veces seguro lo sé pero seguro que vosotros tenéis en mente que una base de datos tiene tablas y ya está y en el 95 por de las veces es así Pero simplemente pues ya que estamos en la asignatura de bases de datos pues quiero deciros que hay más que tablas vale que técnicamente una base de datos mysql puede tener más cosas que tablas ahora a continuación porque diréis vale todo esto es muy bonito pero todo esto para qué sirve o sea esto para qué lo hemos usado Vale pues vamos a intentar hacer una demostración de todo esto para que nos puede servir para hacer una demostración me voy a bajar la tabla a me voy a bajar la base de datos a mi disco duro momentom Okay me lo voy intentar bajar todo a ver si acepta fistel 2 me voy a fistel en local Me la voy a eliminar me voy a importar la que me he bajado de producción 2 megas vale importo a ver si hay suerte a ver si hay suerte a ver si hay suerte a ver si hay suerte y cuando digo a ver Wow increíble vale super guay vale me ha importado procedimientos y me ha importado vistas Así que muy bien y ahora a continuación ya tenemos la pieza dónde estás editor ya tenemos la pieza Número Uno Vale ya la teníamos programada la pieza número uno momento la pieza número uno ha sido python guarda registros en mysql una vez cada día esa ya la teníamos la pieza número dos es python genera gráficas a partir de los registros de la base de datos una vez cada día y la pieza número tres será creamos un panel de control igual que hicimos ayer pero en este caso tirando contra May sql y no directamente contra la carpeta de Apache vale Y esto a su vez Fran Lo que preguntabas ayer en cuanto a la seguridad esto sería una respuesta Aunque al final tocamos los registros de Apache pero no los tocamos directamente bien entonces python genera gráficas Vale pues vamos allá okay venga vamos a ver un segundo no Dónde está hedit aquí Ok python Connect to my sql using this sample J file make a Select query and return Data Ay vaya espera no no y el jas sample es este Okay qué complicación vamos a ver vamos a ir a idle vamos a crear un nuevo archivo voy a pegarlo en hocar cistel Vale Voy a llamarlo gráficas punto python y vamos a ver todo esto madre mía bueno va vale Okay vale diccionarios Perfecto excep no pasa nada función config file es deb config Espera que te lo digo es por qué me ha desaparecido Ah que estoy en remoto Vale pues sí es de config vale Y ahora atención todos y ahora atención todos le digo Select all from virtual Host si yo ahora ejecuto Ok vale vamos a verlo Select all from virtual hosts Cómo se llama esto primero dónde está ese archivo 00 vale vamos a hedit me voy a html me voy a Hola Ahora me voy a hocar cistel me voy a gráficas me voy a db config js es correcto vale comprobamos que la tabla se llama virtual hosts Ok Okay Vale y el error es Okay vamos a ver If Data pero no hay Data Host user password database la base de datos tiene el usuario fistel tiene usuario fistel Vale pues vamos a ver por qué no se conecta espera guardo no nada Select all from apach logs Okay eso sí para No pues ahora no para Vale entonces algo estoy haciendo mal al seleccionar la tabla es virtual hosts Ah espera Ah okay el usuario que ha definido esto no existe vale venga esto ya es otra cosa Bueno voy a eliminar la tabla y ahora en Tablas dig Select distinct virtual Host from apach y ya order by virtual Host ask esto se llama Ok crear vista El definidor soy yo virtual Host definidor cualquiera Okay pero no Okay No tengo muy claro no a ver bueno sql distinct virtual Host no me haces ni caso order by virtual Host ascendiente continuo no orde no Y ahora por qué da error vamos a ver ostras se ha rayado porque me está poniendo virtual Host vale fistel sql se ha rayado vale Ah Qué rollo porque quiero hacerlo con una vista a ver voy a ver qué puedo hacer no vale espera create View virtual Host haz esto no se ha rayado muchísimo esto de hecho os pasó a uno de vosotros no me acuerdo quién en el examen vale Clear Okay venga Ahora sí continúo vale creo la vista esto es virtual Host Okay ahora sí venga ya está muy bien sigamos f5 no para para para Ok bien y ahora from virtual Host f5 OK ahora sí bien print Row virtual Host por tanto f5 me da los logs que sea que haya en el servidor y ahora a continuación para cada uno de estos hosts lo que voy a hacer es ejecutar una petición y devolverla en pantalla es decir vamos a ver fetch Data pues le digo Data 2 es igual a fch Data del config file y el sql es Call es para llamar a un procedimiento daos cuenta que si yo le di por ejemplo a ejecutar navegadores de jarsa cuando continúo Bueno me dice call vale el user como definidor no existe mira lo voy a crear porque así acabamos antes vale lo voy a crear nueva fistel user porque es que si no me va a seguir dando error okay Vale entonces ahora procedimientos ejecuto navegadores dejo carsa y realmente es un call vale o sea call navegadores bien entonces a continuación me copio esto puedo hacer esto es con parámetros anidados vale está bien Es bonito y digo set parámetro es igual ya aquí viene la cuestión parámetro es igual a Row virtual Host Data 2 es igual a esto con lo cual ahora a continuación digo Dónde estás Dónde te has ido Digo e Qué ha pasado espérate setp y ahora aquí me falta un esto vale If Data 2 Eso quiere decir que for Row 2 in dat 2 print Row 2 si esto va bien le doy a f5 noun ok Un momentín incursor vale Access log 1 Data 2 y aquí Uy columnas vale voy a hacer una cosa voy a simplificar la petición es más call navegadores jarsa probamos Ok y ahora lo estoy haciendo en plan no tan bonito pero bueno Okay ahora tenemos para cada uno de los virtual hosts tenemos los navegadores que han vale que han acontecido digamos qué es lo que quiero a continuación bueno pues lo que quiero a continuación es que el sistema me genere gráficas de cada uno de estos navegadores vale de cada uno de estos elementos lo que voy a hacer ahora evidentemente es utilizar la librería mat blot Li para hacer pie charts vale para hacer gráficas de tarta Así que para ello digo with this program sample output is este dónde estás aquí so create MK folder voy a decir os mkd para que el sistema entienda que tiene que importar la librería os MK folder imágenes dos create subfolder If does not exist for each virtual Host create os mkd folder imágenes If not exist vale tres inside folder save p charts for each Data 2 res result set vale Y ya está OK venga Vamos a darle con loal extendemos utilizando python pero al extender la aplicación vamos a verlo ahí al extender la aplicación ahora queremos guardar gráficas de cada uno de los datos extendemos la aplicación f5 y todo va bien Ahora me voy a html me voy a jocars cistel fistel me voy a imágenes me voy a jarsa y dentro de jarsa tengo hok carsa browsers y dentro de cada uno de los elementos dentro de Light salmon tengo light salmon y dentro de medium Green Pues tengo medium seg Green y empiezo a tener y empiezo a tener las gráficas de cada uno de los virtual Host pero por si esto no era suficientemente Guay ahora además Lo bueno es que como tengo otro procedimiento almacenado como tengo otro procedimiento almacenado ahora digo Data 2 es igual a fch Data con cómo he llamado al otro procedimiento almacenado lo he llamado visitas por hora Así que call visitas por hora y esto es visitas por hora Así que ejecuto y a me aparecen me voy a jarsa y me aparecen las visitas por hora voy a ampliar un poquito más esta gráfica voy a ampliar un poquito más esta librería diciendo que a veces queere gráficas de tarta y a veces que re gráficas de barras así que momentín así que digo vale Okay Ok It is perfect Now create another function to create bar charts besid PS and let me Select bu esto realmente básicamente Ok me ha molado pero ahora además de hacer safe p Chart pues Hazme safe bar Chart y así puedo elegir en cada gráfica vale Okay bien Vamos a por ello me lo copio me lo llevo eh Ahora quiero barchart vale Y esto un momentín Espérate Espérate No espérate Ah no vale esto es Data 2 que el programa no tiene por qué saberlo call visitas por hora y esto es visitas por hora bien ejecutamos me voy a cierro Esto me voy a imágenes no lo he hecho yo correctamente esto es safe bar Chart ejecutamos me vengo aquí y ahora sí tengo las visitas por hora y lo tengo ya todo preparado como os podéis imaginar a continuación dado que tengo esta estructura de carpetas de imágenes voy a reutilizar el panel de control que hicimos ayer Es decir para el paso tres para la pieza número tres creación de un panel de control Bueno ayer ya hicimos un panel de control de características similares el programa es sig Green el panel de control es Index php así que me lo voy a pasar de sig Green a cistel Y entonces ahora si me voy a hoka.com bar go No bar localhost bar jocars fistel me voy a jocars me voy a entrar selecciono un local Host y empiezo a ver ahí que tengo ahora ya no es sigen ahora es cel ahora lo apañamos Vale y tengo ahí la información a cada uno de los virtual boxes de los virtual Host perdón pero lo importante de esto lo realmente importante es que ya no lo estoy calculando en tres o sea en la carpeta de apach log en cada momento sino que una vez al día se vuelca sobre mysql y yo lo que estoy haciendo son peticiones a mysql Vale entonces vamos a Pues en este tiempo que nos queda a continuación intentar complementar en la medida de lo posible la aplicación vale Y así la dejamos corriendo mañana la volvemos a revisar a ver cómo ha ido y todo eso vale mañana también la adaptaremos un poco porque pues eh claro solo ha guardado solo habrá guardado los datos de dos días y quiero más datos obviamente bien Vamos a ver cosas más le podemos pedir vamos a ver ap pachel vale distintas ips por ejemplo distintas ips o las páginas más visitadas por ejemplo vale el user agent el sistema operativo vale vamos a pedir el sistema operativo eh A ver dónde se lo he pedido esto perfect Now distinct o sea Now the same but with e operative systems vale Okay Entonces ahora vale vamos a copiar código vamos a venir por ejemplo por aquí estoy en producción sql pego When user agent Ok end as clave count as valor from apel Group by clave order by valor y ahora le digo Where virtual Host like jarsa ejecuto eh No no en absoluto Ah Se me ha vuelto quedar frito cuando le pidáis algo a pH admin y os devuelva algo que no tiene nada que ver nos vamos a application nos vamos a local storage hacemos un Clear recargamos y ya está Le damos a continuar vale la columna virtual Host es virtual Host singular continúo y me dice vale los que he tenido con lo cual ahora vengo por aquí Ahora vengo por aquí copio eh convert to stor procedure taking hoc carsa as an input parameter vale con lo cual hago así me voy a sql hago así esto se llama eh user agents esto se llama sistemas operativos vale mm Okay perfecto recargo sistema operativos lo cual quiere decir que ahora me puedo exportar me lo exporto a sql en local Host me lo importo a ver qué pasa se lo importo a paloseco calculo que me dará error Pero bueno vamos a verlo Ok Proc Ah pero mira pero me lo ha pillado fantástico increíble bien entonces ahora a continuación me voy a esto fuera imágenes lo voy a quitar vale me voy a python y ahora le digo Data 2 es igual a fetch Data con sistemas operativos Y si todo ha ido bien f5 me voy a la carpeta imágenes y ahora dentro de cada uno de los virtual Host e Perdón mal y esto no se llama browsers sino que se llama sistemas operativos vale vamos a verlo Ahora sí sistemas operativos Y tenemos los sistemas operativos que nos han visitado Y si ahora nos vamos al panel de control veremos que tenemos también los sistemas operativos que nos han visitado vale con lo cual Pues ahora de lo que se trata es de que poco a poco vayamos Pues ampliando el sistema de estadísticas para al final poder realizar un seguimiento de todo lo que estamos haciendo vamos a hacer más estadísticas vamos a fijarnos En qué nos da el sistema A ver apacho vamos a ver Mira status code por ejemplo Vale pues sql apach logs y digo status code count status code as clave as valor Group by status code y ya así y Where virtual Host like chucu almilla jocars Ok los códigos de error vale con lo cual Si queremos incluso order by valor desk Ok y ahora copio esto convert into a stored procedure taking jarsa as input value copiamos lo ponemos por ejemplo en producción vale esto es Eh bueno códigos de estado okay okay Vale continuamos ahora tenemos códigos de estado me exporto la base de datos en local me importo la base de datos si todo va bien me importará solo lo que debe importar okay vale códigos de estado si me voy a python me voy aquí col códigos de estado f5 guardo gráficas y tengo los códigos de estado y los tengo ahí vale Y veo que tengo un problema de códigos de estado en la página de jarsa Tengo un problema de gente que intenta atacar ese es el problema vale hago así y ahora para cada uno de los mira aquí también para cada uno de ellos pues puedo ver cómo va la cosa cómo va todo y puedo empezar a hacer peticiones es decir veo que el procedimiento almacenado es un rollo de hacerlo pero si os fijáis a la vez pues una vez que lo tengo hecho para tod o sea todo esto que estoy haciendo son llamadas a procedimientos almacenados O sea que luego realmente lo podemos amortizar vale luego realmente podemos sacarle partido Muy bien pues Ok vale una vez que tenemos esto ahora a continua lo que podemos hacer es empezar a plantarlo sobre el servidor vamos a retocar un par de cositas antes a ver Index vale jarsa vale eh qué te iba a decir yo esto es jarsa fistel vale un momentín esto es cara fistel Okay Vale en el css donde pone sigen voy a poner fistel fistel y yo creo que ya vale con lo cual recargamos aquí abajo no aquí arriba no perdón en el nab Ah background vale Ok en el nav Ahí está Ah mira eh fistel Y cistel Okay Vale ahora sí muy bien y ya está con lo cual ahora como siempre repetimos el proceso de implantación en el servidor de producción lo cual quiere decir que atención Mirad vamos a ver este son los registros de ayer lo que quiero decir con esto es que si creo cistel no aparecerá Hasta mañana como pronto vale Ok venga No pasa nada muy bien a ver espera que estoy pensando en primer lugar me voy a yonos me voy a crear me voy a dominios me voy a subdominio me voy a jarsa me voy a cistel le doy a guardar y en un rato se generará Vale ahora me voy al servidor me voy a crear un nuevo sitio entonces sudano etc apach 2 site available y fistel jara.com vale le voy a poner ahora me voy al servidor me voy a etc me voy a Apache Me voy a s enable por ejemplo Me cojo Black salmon mismo copio pego me voy a cistel jocar.com.mx es jarsa fistel y ya está y el error log importantísimo es fistel error y fistel Access importantísimo Vale pues escribo Salgo ahora habilito le digo a Apache que de alta eh fistel OK ahora recargo Apache no quieto no esto ya lo he hecho copiar pegar okay Y ahora depende un poco de lo que tarde el proveedor es decir bueno espérate Sí además Espera espera es que hay varias cosas que tengo que hacer además me voy a github no quiero la carpeta imágenes vale actualizaciones funcionales Ok subo las últimas novedades del entorno de desarrollo al entorno de producción en el entorno de producción traigo las novedades de github Okay muy bien Ahora ejecuto las gráficas Okay ahora sí me voy a ver si ya está disponible a ver si Suena la flauta cistel jocars comom Oh está disponible bien me voy a jocars jarsa y veo como cistel ya está disponible en el entorno de producción vale veo como la aplicación que hemos desarrollado en la clase de hoy ya está disponible nos queda un detalle por hacer vale recordemos que ahora tengo chrom Tab e ahora tengo que editar el archivo chrom Tab me voy a copiar y voy a pegar vosotros diréis Oye pero ya lo tenías vale Yo diré no O sea no lo tenía ya Esto va se va a ejecutar a las 4 y Esto va a ser gráficas vale Y no lo tenía porque eh Como te diría yo no lo tenía porque una cosa es los logs y meterlos en la base de datos Y otra cosa diferente es el contenido de la base de datos y convertir a gráficas lo podría haber hecho en un mismo archivo Sí pero tampoco está mal si lo hago en dos archivos diferentes vale Así le digo Mira a las 3 de la mañana coge los archivos y los metes en mysql y a las 4 de la mañana coge las gráficas y las es en la carpeta tampoco está mal guardo recargo y ahora sí ya tengo la aplicación configurada y la aplicación preparada para trabajar bien eh Hay una cosa que me gustaría que repasamos antes de entrar en la siguiente clase que es la clase de entornos de desarrollo que es eh Cómo está la aplicación de cadet Blue vale Y ahora en un momento os recuerdo de qué va la aplicación de cadet Blue alguien lo recuerda voy a abrirme bebida si alguien recuerda qué hacía cadet Blue vamos a ver vale voy a usar a ver momentín vale a ver un segundo Ay muy bien fantástico aquí vale apañado alguien recuerda qu hacía cad Blue bien pues Mirad cadet Blue vamos a verla es una aplicación aquí Root bar W html cad Blue vale cadet Blue es una aplicación de python que lo que hace es crear un backup en una tarjeta en una carpeta de destino cadet Blue en este caso lo que está haciendo es que me coge la carpeta de html databases y me la pega en una carpeta de Destino de copia de seguridad esta carpeta de destino técnicamente se está haciendo vamos a verlo esta carpeta de destino está aquí está en Home y está aquí en backups vemos como de hecho cada día a las 2 de la mañana me está haciendo un backup vale está funcionando de forma bastante correcta el backup únicamente incluye de momento la carpeta databases vale lo cual Pues bueno tiene suo aquel ahora mismo la carpeta databases ocupa cada backup ocupa 8 megas vale Claro a mí me gustaría eh guardarme más cosas como qué pues por ejemplo vamos a verlo me gustaría de aquí un momentín me gustaría guardarme toda la carpeta html ahora mismo ocupa Espera que te lo di php my admin será lo más traumático probablemente vale 29 megas ya os digo que lo más traumático va a ser eso vale Ok 300 megas que os Digo ya que es php my admin Pero bueno no pasa nada PH my admin lo meteremos en una carpeta aparte y ya está vamos a hacerlo si queréis porque os Digo ya que tantos archivos es php my admin o sea pero ya vamos a verlo no quiero old l quiero todo menos old l vamos a verlo a ver si hay sorpresas Mira otra cosa que puedo hacer Ah no no lo puedo hacer no lo puedo hacer Bueno no lo puedo hacer o sí no lo sé a ver hago así quiero el rot a ver si me analiza Pero bueno y Ah mira ya está Ah no está Ahora parece que sí vale 80 megas en total No lo sé Pues habría que ver qué hay en esas carpetas Habría que ver quién me está ocupando tanto no sé quién me está ocupando tanto tendría que verlo y esto cómo está esto está procesando pero como es en local o sea como es en remoto tardará Vale pues lo que quiero deciros con esto es que voy a editar un poco cadet blue pero claro lo tengo que editar en local lo tengo que editar en local Vale entonces me voy a editar cadet blue para que no solo me coja una carpeta sino que me coja varias caret Blue Vale y digo vamos a ver source folder Target folder y el problema en este caso está vamos a verlo el timer stamp problema en este caso está en que si llamo a diferentes carpetas me hará diferentes horas y no quiero eso entonces lo que puedo hacer en este caso es decir lo siguiente Time stamp lo genero fuera a esto le paso el Time stamp es igual a ya está a timestamp vale con lo cual create backup de source folder en Target folder con el Time stamp ahora create backup de voy a poner por ejemplo jarsa Light salmon en timestamp Vale y de hecho no solo me quiero guardar incluso eh la carpetas de bar sino que me puedo también guardar volcados de base de datos me puedo también guardar Por ejemplo la carpeta de configuración de Apache entonces digo vamos a ver me voy a ubuntu me voy a etc me voy a Apache Me voy a sites available por ejemplo Ah sí me voy a sites available y le digo Guárdame también los archivos de configuración de Apache por si se me corrompen Vale entonces voy a subir esto a github voy a caded Blue por tanto vale acordaos actualizaciones varias carpetas comit to Main Push origin a continuación en el servidor Cómo va cómo va esto es que va a tardar un buen rato voy a pararlo vale me voy a jarsa cadet Blue voy a decir que quiero traer las últimas novedades del repositorio espérate esto dónde estás Uy aquí git pool origin pongo la clave voy a ejecutarlo manualmente para no esperar a esta noche Así que lsl voy a ejecutar python 3 cadet Blue qué ha pasado vamos a ver file exist carpeta de destino existente Sí claro Okay a ver Ah sí vale Sí pero bueno Pero vale Pero no pasa nada porque okay vale cierro esto un momento Ok corregimos un momento el Script error trying to create folder multiple Times create folder If it does exist vamos a ver podemos pasar el mismo Time stamp global vale Okay venga copio código lo meto aquí en cadet Blue en github actualización mkb Push origin en el servidor Ahora cuando Ok en el servidor me traigo la última novedad vale en el servidor ejecuto cadet Blue y ahora a continuación me voy al servidor me voy aquí voy a Home me voy a backups en backups me voy a este de aquí de las 1850 y en las 1850 veo que tengo la carpeta databases veo que tengo la carpeta jocars light salmon y veo que tengo la carpeta de s available vale con lo cual pues ya tengo eso por ahí y pues nada Y pues eso bien ayer en la clase de ayer con los de segundo hice un software que os voy a enseñar vamos a ver y que nos puede venir bien para echarle un vistazo a cuánto ocupa esa carpeta del servidor por Pues ahora mismo por ejemplo Quiero saber qué carpeta está ocupando más cómo se llamaba ese software no me acuerdo Entonces vamos a verlo me vengo a html no por fecha Espera a ver si me lo apunté que yo creo que sí a ver margareta era Yellow no me suena que lo hiciéramos como Yellow a ver Ah modificación no a ver los que hicimos ayer light Steel Blue no indigo Esto fue esta noche plum sí fue plum vale Ah y además sí que tenía implementado plum en el servidor vamos a comprobarlo y ahora pasaremos a entornos de desarrollo jarsa Ah no plum no lo implanté no vale pues vamos a implantarlo vamos a ver plum está actualizado no vale okay vale primera implantación voy a editar un momento ese archivo me voy a html jocars plum y voy a editar la ruta Wow Okay Vale Voy a editar la ruta para decirle que el archivo va a ser barw html Ok y esto requería un usuario vale Okay perfecto Muy bien pues actualización ruta Vale ahora en dominios creo un nuevo subdominio El dominio es espérate Dónde está crear su dominio El dominio es plum jocar.com.mx vale a continuación voy a dar de alta un sitio y esto está aquí voy a dar de alta un sitio nuevo que es plum okay una vez que hago eso etc Apache sites Me cojo un virtual Host me lo pego aquí y digo plum jocar.com.mx jocars pun plum o sea jocars gu plum es jocars guion plum los logs son plum y plum guardo salgo habilito el sitio Opa habilito el sitio reinicio aache okay Y ahora a esperar a que el proveedor me lo quiera habilitar plum jocars comom forbiden bien interesante Ah sí sí forbiden correcto es correcto vale porque ahora me meto en plum no me meto en jocars plum lsl Vale ahora le digo que quiero python 3 plum python Ok y ya lo ha creado increíble vale Y si todo va bien recargo Hola recargo Ah no perdona lsl el archivo se llama file burst vale eso tengo que cambiarlo Pero bueno file structure Z burst vale entro como jarsa jok carsa Y si todo va bien me ha creado un gráfico de Margarita fantástico no me lo ha creado muy bien okay Muy bien pues vamos a ver qué ha creado vale marcadores vamos a bar vamos a w vamos a html vamos a plum a ver el Jason vale Sí pues sí que debería haberlo creado Sí que aquí está todo Sí vamos a inspeccionar a ver qué errores hay Ah ay venga vale venga a ver voy a editar a ver okay edit Apache Security To allow This vale esto Fran es porque tengo el apache Security totalmente cerrado vamos a ver vale Y me voy a editar lo tengo cerrads imo Esto está en sites available etc apach 2 y esto es s available y es default este no será ses enable no Cuál es será este sí Ese es Vale entonces vamos a ver en Script src vale vamos a permitir también vamos a permitir también esta URL venga va Ay copy link address vale permitimos esta URL vale guardamos reiniciamos Apache como ya os digo lo tengo muy en modo paranoico tengo el servidor para que no se puedan ejecutar cosas que no se deben ejecutar aquí está la respuesta Vale y vamos a ver Avatar Avatar Go archivado Ah Avatar ostras Vale pues mira no había caído yo no había caído yo que efectivamente en Go tengo una carpeta llamada Avatar donde ahí tengo mogollón de avatares Y esa carpeta no puede estar ahí Vale pues vamos a apañar pero si no fuera por este software Pues vete a saber el tiempo que me hubiera tirado para encontrar error O sea que pues está Guay vale un momento este software lo hicimos ayer en segundo evidentemente como veis está disponible en mi github para quien lo quiera usar y el objetivo es pues detectar qué carpetas usan más espacio en un sistema de archivos y pues proceder sobre esa información vale Ya está así que me voy a ejecutar de nuevo ejecuto de nuevo vale recargo el navegador jarsa Ok Vale ahora dice que mide 265 megas que tampoco está mal vale old all Go Ah Dark Violet pero son 10 megas Ah claro el juego de mi hijo vale dam Ya no debería estar ahí salmon s salmon 17 megas por salmon ocupa 17 megas y powder Blue vamos a verlo vamos a ver dam ya no tiene que estar ahí porque d Ya lo he pasado a la otra parte vale Ah salmon como es una red social claro salmon como es una red social mi hijo subió ahí un montón de cosas míralo vale Ok eso es salmon eso es powder Blue Ah documentos Sí vale Sí okay eso es d lo estoy borrando eso es Dark Violet doer Blue dod Blue do Blue qué era doer Blue Ah mapas mentales Uh madre mía vale mapas mentales vale esto es PH my admin eso estaba claro 32 megas all days git ostras esto de que el jit PS 25 megas no Mola nada all l static vale esto es medium se Green y luego Dark Slate Blue vale con lo cual como veréis pues podemos obtener un informe de cuánto ocupa cada una de las carpetas del servidor y por tanto pues En definitiva poder operar mejor sobre esto incluso puedo entrar dentro de carsa all days vale Y como veis de esta forma pues obtenemos un gráfico más detallado acerca de vale vamos a volver ahí acerca de cuánto ocupa cada carpeta bien pues nada lo decía por saberlo para saber la copia de seguridad de cuánto espacio debemos disponer para poder hacerla Vale pues una vez que tenemos esto Una vez que tenemos esto Ahora vamos a pasar a la siguiente atura a la última asignatura de hoy donde hablamos sobre todo del tema de documentación entonces voy a parar un momento