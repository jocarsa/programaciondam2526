y bueno en la clase de hoy voy a empezar comentando pues una cosa que me parece increíble de no de js ayer hicimos un pequeño servidor web y hoy Perdón Ay ahora y hoy voy a empezar creando una nueva carpeta aquí no una nueva carpeta por aquí a ver si me deja en no de js llamada 003 servidor con estados que va a ser os va a aparecer la mayor de las tonterías pero ahora veréis que no lo es ahora veréis que es una cosa importantísima así que voy a crear un primer servidor voy a empezar con el servidor más sencillo que os podáis imaginar por tanto voy a crear un archivo nuevo 001 stados js y ahora a continuación lo que voy a hacer es simplemente por aquí por alguna parte decir led contador es igual a un es decir arranco una variable de javascript llamada contador de hecho podemos poner bar para que la variable sea del más alto nivel tenga la máxima visibilidad y va a empezar valiendo uno así que cada vez que el servidor me dé un mensaje lo que haré es contador más es decir le sumo un valor a la variable voy a decir respuesta punto bueno end el valor de la variable es y voy a poner contador vale directamente aquí y ya está vamos a probarlo me vengo por aquí esto que acabo de hacer parece una tontería de hecho a un nivel técnico es una tontería muy grande pero esa tontería explica uno de los motivos por los cuales no de js en ciertos escenarios de aplicación pues es mucho mejor que Apache por ejemplo Así que abro en una terminal le digo no de js001 est dos bien y ahora a continuación lo que voy a hacer Es que voy a arrancar un navegador me voy a ir al puerto 3000 y en el puerto 3000 voy a hacer algo tan sencillo como decir local Host 2.3000 el valor Ah Espérate que no me lo he cogido como vale Ok venga va no pasa nada y contador venga ya está Vale paro el servidor recargamos el servidor vale el valor de la variable es dos y ahora el valor de la variable es 3 Mira cuatro me sub me sube uno cada vez porque hay dos peticiones el valor de la variable es 6 por tanto es 8 es 10 Y esto qué quiere decir pues esta tontería que acabo de hacer significa que el servidor tiene Estados lo cual quiere decir que el servidor A diferencia de Apache y a diferencia de php tiene memoria el servidor con node al igual que pasa con python no es un servidor tal que cada vez que lo llamamos se despierta ejecuta una tarea y se vuelve a dormir y al dormirlo y al dormir lo Olvida todo sino que el servidor de nodejs es una aplicación que está continuamente corriendo de momento estamos en local más adelante hablaremos de qué ocurre en el servidor de hecho hoy empezaremos a hacer algún tipo de deploy al servidor y En definitiva es una aplicación que para bien o para mal siempre está corriendo Cuando digo para bien o para mal lo que quiero decir es que tal y como os decía ayer pues hay una serie de escenarios en los cuales nos interesa que la aplicación recuerde cosas y hay otros escenarios en los cuales nos puede llegar a interesar que la aplicación no recuerde cosas y lo olvide todo cada vez y vuelva desde el principio vale en este caso en la clase de hoy vale si Sí vamos a ver te cuento efectivamente cuando nosotros queremos publicar algo en un servidor nosotros En un momento dado tenemos la opción de como te diría yo de ejecutar cosas vale claro Cómo podemos ejecutarlas en el caso de no dejs podemos ejecutarlas directamente o de forma mejor configurando un dominio y configurando virtu Host y En definitiva como estás comentando configurando reglas podemos crear podemos utilizar Apache u otro servidor llamado engins lo que pasa es que en este caso si estamos usando Apache pues para qué dejar de usar Apache pues podemos configurar un virtual Host para que nos lleve a una dirección de a una dirección de leches de no de js en lugar de una dirección de php vale yo de momento ahora voy a hacer un ejercicio ahora a continuación lo publicaré sobre el servidor de momento vamos a estar trabajando sin virtual Host pero veremos que apache en combinación con virtual Host y en combinación con una pequeña aplicación que se llama p2m que lo que hace es básicamente lo mismo que apach vale que es ejecutar un no de pero como servicio pues podemos crear esto que os estoy comentando vale podemos servir una aplicación Al mismo nivel que cualquier otra aplicación vamos a ver primero en local y ahora luego hago un deploy al servidor para que podamos interactuar Entre todos vamos a ver escenarios donde esto nos puede interesar Entonces el clásico escenario el clásico caso el clásico ejemplo donde no dejs destaca donde php pincha es precisamente por ejemplo en el caso de la creación de un chat es un elemento es un eh recurso en el cual el servidor debe recordar todo lo que está ocurriendo debe recordar los mensajes de una sala Así que para esto vamos a hacer lo siguiente vamos a empezar haciendo un chat de texto vale Y ahora luego a continuación haremos un chat más bonito para ello vamos a crear por aquí eh carpeta nueva pero quiero crearlo en el raíz vale 004 chat es el clásico ejercicio de Introducción a no dejs llegado ese punto es un buen momento por cierto para introducir el concepto de full stack dentro de nodejs es decir vamos a hacer que nodejs se preocupe de lo que se tiene que preocupar Mira de hecho yo creo que aquí igual en reciente vale aquí y no me falta aquí un trozo Bueno pues vamos a hacer lo siguiente vamos a hacer una aplicación no vamos a utilizar de momento ahora a continuación base de datos y en esta aplicación con css html y javascript en el servidor perd en el cliente lanzaremos información contra un servidor en node js lo que hará este servidor básicamente es que tendrá dos métodos uno que dirá men uno que dirá toma un mensaje y otro que dirá Dame los mensajes Vale entonces este es el esquema de la aplicación que ahora a continuación vamos a desarrollar es por esto que vamos a empezar con esta primera parte vamos a hacerlo lo más sencillo que podamos para centrarnos en la parte de no dejs y centrarnos en que la aplicación sea entendible vale por eso Mirad me voy a crear por aquí vamos a ver me voy a crear por aquí un archivo nuevo llamado Index html y voy a intentar que ese archivo lo tenga todo vale que sea todo el fronto Así que Doc type html Head Body vale dentro del Body voy a empezar haciendo un chat muy básico vale voy a decir div ID mensajes y input type text yid mensaje en singular bien Así que una vez que tengo esto ya ves tú mínimo chat posible imaginable voy a hacer lo siguiente voy a decir que en Style mensajes tiene un Border de un pixxel solid Grey un Wi de 300 píxeles y un High de 400 píxeles y el input tiene eh un with de 300 píxeles y ya vale vamos a probarlo vamos a verlo me voy a local Host me voy a eh No de js 2025 me voy a chat vale Y tengo esto tengo literalmente esto una un div con mensajes y un input donde aquí pondré un mensaje y Se enviará a continuación lo que va a ocurrir es que tengo que programar una parte en la cual javascript sea capaz de recoger el mensaje del dom y mediante un fetch Ya sabéis pues lo que va a hacer es enviarlo a nodejs usando el formato json es decir lo mismo que hemos hecho anteriormente es lo mismo que hemos hecho con php Pero simplemente lo que vamos a hacer es cambiar php por no de js Así que ahora a continuación vale html es lo mismo Exactamente lo mismo me voy aquí a crear un esto voy a crear un Script voy a crear un Script Vale y hago lo siguiente le digo que cuando vamos a ver cuando l entrada es ig a document query selector input Y entonces le digo cuando entrada punto change entonces voy a ejecutar una función en la cual Pues voy a decir console pun log envío mensaje Vale vamos a ver recargo y pulso algo le doy a enter claro No me reconoce el enter cuándo e Por qué no me Por qué no me Por qué no me a ver Ok recargo tricki salgo e entrada change query selector input estoy en el mismo sitio estoy en el sitio correcto sí envío mensaje Vale vamos a ver Ah perdón change no on change caray vale escribo algo le doy a enter envío mensaje Vale cuando envío mensaje lo que voy a decir es led mensaje es igual a dis pun value Vale ahora dis pun Val es igual a nada Es decir envío le doy a enter y se vacía es decir el mensaje es lo que contiene el campo vacío el campo típico de cuando has enviado un mensaje ya lo has enviado pues se vacía el campo para tu siguiente mensaje y ahora y esta es la cuestión y ahora digo fetch a http do bar localhost 2.3000 Por qué 3000 porque nos ha dado por ahí y a continuación lo que hago es enviarle algo de contenido vale le envío un contenido como que por ejemplo le envío un get vale así que por ejemplo para hacerlo lo más sencillo posible vale por ejemplo digo mensaje es igual a eh encode Uri mensaje vale Ya está envío mensaje de momento tenemos esto son cinco líneas de javascript ya está seis líneas de javascript entonces lo que estoy haciendo es que html escribe un mensaje j s recoge ese mensaje se lo envía al servidor y ahora no dejs tiene que recoger ese mensaje Así que ahora a continuación aquí en el chat voy a hacer un archivo nuevo llamado servidor punj en el servidor js voy a lo mismo que he hecho aquí contador fuera eh esto fuera esto es text js vale De hecho no quiero respuesta siquiera A ver espérate Sí vale No quiero respuesta de momento no quiero respuesta de momento res.end nada envío un jas vacío pero voy a poner console log console.log Ok mensaje recibido si esto va bien ahora entro paro entro dentro de esa carpeta 004 no de servidor vale si esto va bien digo Hola perdona recargo digo hola y aquí nos dice mensaje recibido ahí nos dice fail to fetch vale No sé por qué no sé por qué porque no debería haber dado fail to fetch entrada un change porque aquí de hecho dice ok mensaje recibido vale respuesta end vamos a recargar el servidor y vale fail to fetch dice error Vale pero no ha habido error una cosa que puedo hacer es decirle que me coja el corse Pero bueno ahora luego lo haremos esto ya nos pasó en python en el primer trimestre Vale entonces yo ya tengo que conforme voy escribiendo mensajes aunque me dé error pero el servidor está diciendo que recibe los mensajes vale con lo cual ahora a continuación yo lo que quiero es que el servidor no solo me diga Ok mensaje recibido sino que quiero que el servidor me diga qué mensaje ha recibido Vale entonces vengo por aquí me voy un momento a chat gpt y eh voy a poner Esto vale Y voy a poner vamos a ver y voy a poner eh ex no e receive get parameter URL named mensaje Vale con lo cual require url Esto es lo que me hace falta vale Y ahora el parámetro vale venga esto es vale esto es eh URL completa es igual a URL pun pars petición URL Vale y mensaje es igual a URL completa query mensaje Vale obtiene el parámetro mensaje ok mensaje recibido más mensaje vamos a verlo paro el servidor ejecuto recargo por aquí y digo Hola Y aunque de error ahí dice Okay mensaje recibido Hola Y si ahora digo Hola Cómo estás me dice ok mensaje recibido Hola cómo estás vale esto es el cliente y esto es el servidor y los mensajes están llegando desde el cliente hasta el servidor y el cliente es un archivo mínimo y el servidor es un archivo mínimo es decir vamos a intentar hacer que este proyecto sea lo más mínimo posible vale para que con la menor cantidad posible de líneas de código montemos un chat ahora a continuación sabemos que el servidor está recogiendo las los mensajes pero claro lo más divertido sería que el servidor pues eh guarde los mensajes no los pierda para guardar los mensajes sabemos que una cosa que podemos hacer es que el servidor guarde una Ray ayer Estuvimos viendo algo que ya conocíamos por otra parte y es que pues la forma más sencilla de guardar mensajes dentro de javascript de guardar colecciones de datos en javascript es una Ray Así que yo ahora vengo por aquí y digo bar mensajes es igual a array vacío Y entonces digo mensajes pun Push de mensaje o sea a mensajes le añado un mensaje y console pun log mensajes vamos a ver claro ahora mismo no un momentín Sí efectivamente ahora mismo en este estado del desarrollo de la aplicación no hemos creado todavía esta flecha solo hemos programado esta flecha de aquí con lo cual en este momento del código efectivamente claro tenemos que hacer que no de js saque algo por consola Más que nada porque o lo sacamos por consola o no lo vemos vale o sea ahora mismo la información viaja desde aquí hasta aquí pero como no está viajando de vuelta no podemos ver nada en la página web con lo cual de momento temporalmente lo sacamos por consola ahora una vez que tengamos esto Ahora evidentemente implementaremos la flecha de vuelta vale donde pues nodejs devolverá información a javascript en el lado del cliente Entonces yo ahora vengo por aquí console.log mensajes paro el servidor arranco el servidor y digo Hola quieto Hola Y me dice hola y ahora digo Hola Cómo estás Y dice Hola coma Hola cómo estás y digo yo estoy muy bien y dice hola cómo estás Y yo estoy muy bien luego estamos consiguiendo que no dejs tenga memoria A diferencia de Apache y a diferencia de php y no estamos teniendo ni que guardar una base de datos Porque De momento todo esto de aquí se está guardando en la ram se está guardando en la memoria RAM y tenemos un programa en nodejs que está constantemente en ejecución vale que está constantemente trabajando con lo cual de entrada nos ahorramos php nos ahorramos base de datos y trabajamos con un archivo que ahora mismo tiene 14 líneas de código vale otra cosa es que más adelante probablemente Será interesante trabajar con algún tipo de base de datos para que la información no se pierda vale Sí cierto vale Pero para que la información no se pierda por ejemplo en un reinicio de servidor pero de momento no es obligatorio de momento podemos hacerlo sin ello claro ahora Fran es cuando lleó un momento en el cual decimos bueno Espera Ya Quiero recuperar la información vale quiero que me des los mensajes para trabajar con mensajes Ahí es donde Necesito dos urls diferentes ayer Estuvimos viendo que una cosa es Llamar a una url Root barra inicio Vale y otra cosa es la url contacto Bueno pues en este caso una URL es Te envío un mensaje otra URL es Dame los mensajes así que vamos a recuperar parte del Código de ayer vamos a recuperar parte del Código de ayer aquí y voy a decir URL es petición URL esto lo tengo no vale url dición URL Claro pero espérate Bueno vamos a ver const ruta es petición URL Y entonces yo voy a decir si la URL es nada o es envío o envía en ese caso mensajes pun Push query mensaje en el caso de que recibe en ese caso respuesta punto end Eh bueno mensajes realmente mensajes vale Y aquí me falta y aquí me falta esto respuesta right Head Devuélveme el texto en text barra js yo creo que ya yo creo que ya yo creo que ya a ver esto ya no me hace falta y esto ya no me hace falta vale Y así seguimos manteniendo el código lo más limpio posible ahora en el cliente Espera que cierre aquí cosas ahora en el cliente sí que necesito una función led o bar temporizador es igual a set Time out recibe en 1000 la función recibe Clear Time out temporizador y temporizador es igual a se Time out recibe en 1000 esto recordáis que hace un bucle infinito es decir temporizador Llama a recibe y recibe Borra el temporizador y crea un nuevo temporizador que se llama a sí mismo dentro de un segundo luego por lo tanto acabo de hacer una función infinita Y entonces digo fch esto es barra envía y esto es barra recibe y recibe hacemos la clásica petición fetch para que veáis que es siempre lo mismo punto den fun response return response.js es decir lo que voy a recibir lo voy a recibir en json y punto den fun datos console log datos el clásico json vale sí no es una promesa todavía vale tampoco estamos todavía ejecutando el proceso callback sino que es simplemente una petición vale Yo pido y recibo claro el fetch en sí es un promise vale es decir te prometo que algo recibirás pero no es todavía Así que paro recargo y si no da error vamos a verlo recargo digo Hola le doy a enter he momentín vale de momento no ha recibido nada Okay a ver un momentín servidor envía y recibe un segundin envía y mensaje es igual a Esto vale un momentín porque voy a poner un poquito de debug y voy a decir console.log Ok servidor recibe vale Y aquí voy a decir console.log servidor ha recibido y ya está vale Ok vamos a ver servidor bco servidor Okay servidor recibe vale Hola Okay servidor recibe pero este servidor realmente no está recibiendo nada vale es decir entra aquí pero no está entrando aquí y esto es porque le estoy enviando en vía pero con parámetros ese es el problema Vale entonces vamos a esto vamos a venir por aquí with server este servidor de aquí make envía work Y probablemente lo que va a hacer el programa es que me lo va a meter en parámetros post que es lo que se debería hacer Pero bueno vamos a verlo vale código corregido del servidor ruta envía vale J son stringify Okay Vale Venga pues servidor corregido aparte me ha puesto un 404 no lo quería pero bueno es que chat gpt es así vale entonces recargo digo hola Vamos a verlo vale me está diciendo fail to fetch Y yo veis que técnicamente vale servidor recibe Dónde está e e espera recibe Vale y Valentin en stringify mensajes y Ok servidor recibe vale Okay esto muy bien Yo creo que como os digo ya llega el momento de aplicar cors Vale entonces me dice fail to p de toch en el promise May corse vale Y por motivos de permisos vale vamos a Añadir cors Entonces vamos a ver Ok añadimos cor en la ruta vale paramos el servidor arrancamos el servidor Nos vamos aquí vale me devuelve una Ray de mensajes vacíos yo digo Hola luego el mensaje Ya no está vacío digo Hola qué tal luego el mensaje Ya no está vacío Vale ahora sí lo que estoy haciendo Por fin es que he implementado la flecha de te envío mensaje he implementado la flecha de recibe mensaje en este caso ahora a continuación claro yo debería implementar una flecha de que J sol lo pinta en html de momento no lo estoy haciendo en esta versión lo que hace es que js lo mete en la consola pero una vez que ya he comprobado que funciona en la consola pues ya le puedo decir a js Vale ahora píntalo bien pintadito en html Entonces ahora que sé que está funcionando ahí lo estamos viendo pues ya es cuando puedo en el cliente recoger el servidor o sea recoger Perdón los datos y pintarlos correctamente en html Así que para ello voy a hacer lo siguiente vamos a ver entrada eh led mensajes no mensajes Ya lo tenía eso utilizado no o qué No lo tengo utilizado mensajes es igual o led sí mensajes es igual a document query selector mensajes pun text content es igual a nada vacío y ahora datos. for fun dato y Entonces por cada uno de los datos esto es igual que lo que hemos hecho en el trimestre anterior la parte de cliente es igual que lo que hemos hecho el trimestre anterior digo led elemento o led artículo es igual a document create Element article artículo text content es igual a dato y mensajes pun appen Child artículo lo cual quiere decir que si ahora recargo vamos a ver que ahora pone Hola Qué tal Cómo estáis Esto es una prueba Vale y vemos como ya de entrada tenemos un chat así y ahora vamos a estilizarlo un poquito Cuando digo que vamos a estilizarlo un poquito pues lo que quiero decir es que con un poquito de css le puedo decir que Body no html es font family sans shif background rgb 22 Body es eh with 400 pixeles margin auto vamos a ver Esto vale Bueno okay más o menos bien vale Y ahora en el body le digo pading de 20 píxeles y background White algo sencillito vale Ya está es un poco grande ah sí no sí ya Claro porque mensajes claro Es que esto le he puesto Okay 400 pues 300 Vale ahora sí bien y ahora al artile le voy a decir que pues eh padding de 10 píxeles background rgb 200,25 5,200 y Border radius 0 píxeles 10 píxeles lo cual quiere decir que ahora me pinta perdón y margin de 10 píxeles a ver igual es demasiado vale Ok me pinta mensajitos vale esto es un poquito de css voy a hacer una prueba vale voy a hacer un par de pruebas más entonces Bueno ahora también lo que haré es estilizar un poquito el input entonces en el input with 300 Box sizing Border box padding de 10 píxeles vale No lo sé que quede bonito Eh margin top de 20 píxeles vale Así alineados bien y Hola lanzo Hola Y ahí aparece y tengo un mini chat tengo un micro chat ahora a continuación Ah sí un par más de cosas que le voy a meter es que veis que los mensajes se salen vale para que los mensajes No se salgan un poquito de css le digo que en los mensajes overflow y scroll vale y le digo que en los mensajes scrolltop es igual a 10.000 no sé si esto me lo va a pillar Ah mira Sí hola y me lo ha pillado vale una vez que tengo esto tengo una micro aplicación vale luego la vamos a poder hacer crecer todo lo que queráis Pero de entrada lo que quería es demostraros Cómo podemos hacer una aplicación con dos archivos el html el Front tiene el html el SS y el javascript en el mismo archivo es cierto vale Y el servidor es un servidor no de js de te creo un servidor acepto cor te creo dos rutas más un 404 que me ha puesto me lo voy a quitar porque no lo voy a usar vale que me ha puesto chat gpt y arranco el servidor en el puerto 3000 Vale pues a continuación voy a hacer un pequeño deploy vale Cuando digo pequeño deploy quiero decir que lo voy a lanzar a un servidor real pero no le voy a agregar todavía un dominio y un virtual Host y todo esto vale vamos a ejecutarlo a Palo Seco Así que para ejecutarlo a Palo Seco me voy a ver aquí Bueno ahí da igual vale me vengo a fila me voy a vps vale me voy a mi carpeta home por ejemplo vale me voy a crear directorio llamado chat node y en chat node quiero decir debería estar en la carpeta html pero no es obligatorio en el caso de node la carpeta html es para Apache realmente y ahora me vengo aquí me voy a chat e insisto cojo estos dos archivos y los pego vale Ey claro esto es sí no Espera espera esto es el servidor vale eso es el servidor y lo que sí que voy a hacer Va pues Venga pues no voy a irme a la carpeta W ahora veréis por qué quieto W html jarsa old l de momento Go vale Y voy a crear por aquí una carpeta llamada eh chat node vale chat node suelto estos dos okay Y ahora tengo que editar un poquito Ahora tengo que editar un poquito vamos a ver por una parte arranco inicio vale aquí me voy a el servidor voy a editar en caliente no estoy haciendo github ni nada de eso de momento porque es una prueba voy a me voy a Go me voy a chat node y en Index ya no le digo que voy a local Host no le digo que voy a vamos a verlo Cuál es mi IP a ver 217 160 27 289 o sea apunto al servidor real que ahora va a servir esos datos bien en el servidor real sshr @ hocar comom Yes contraseña í updates vale bar w html CD jarsa old l CD Go CD chat node vale Y ahora digo atención y ahora digo vamos a verlo ahora digo node servidor punj Oh vaya no tengo node instalado en el servidor sudo app install node js Yes y vamos a instalar bien Ahora sí no de servidor js local Host Ah sí no pasa nada vale Ahora me voy a esta web me voy a jara.com barg barchat Noe Y si todo va bien vale hay un refused ok Oh vaya vale vamos a ver momentín porque tengo Apache otra vez super mega protegido vale Okay entonces Ah vamos a ver sí pero vale Y si le digo creo que no va a querer a ver Ah Creo que no va a querer vamos a ver sí esto vale flask No claro ahí está el problema uso hps Sí pero no es tan sencillo vale con lo cual voy a hacer lo siguiente con lo cual voy a hacer lo siguiente voy a Modificar el servidor para decirle que si ruta es igual a envía No si ruta es igual a nada en ese caso me vas a cargar la página web dónde me la vas a cargar Bueno pues me la vas a cargar en a ver Oye dónde está html No de js eh web sencilla html vale quiero file System y quiero p vale Y aquí quiero esto y Okay quiero esto es nada y ya está lo cual quiere decir si esto va bien momento ahora os lo digo que paro el servidor esto es paro me voy al servidor no de u Hola no de servidor y ahora aquí en esta ruta en lugar de ir a jocars com me voy a ir a 217 y punto y Puerto 3000 vale vamos a verlo estoy corriendo en el local Host no sé si tengo Puerto abierto creo que sí a ver recibe a ver If config Ah muy bien Fantástico a ver sudo app install net Tools Clear If config Vale y 217 160 vale muy bien Esto me lleva jarsa vale en el servidor Tengo abierto el puerto 3000 yo creo que sí creo que lo abrimos el otro día y esto fuera servidor vps firewall Dónde estaba aquí red políticas de firewall y no tenemos el puerto 3000 vale con lo cual ahora miramos esto vale con lo cual permitir todas Puerto 3000 y esto es node aquí de hecho Tengo varias habrá uno que será node por aquí vale bien eh A ver vale Okay añadimos regla un momento que está configurando momento que está en amarillo un segundo que se ponga verde creo que ya está verde Así que ahora continu acción me vengo por aquí paro y arranco de nuevo vale arranco el servidor me voy a no sé dónde me voye estás 217 Puerto 3000 vale Y ahora sí me da el chat voy a decirle hola me dice hola digo qué tal bueno la l se me ha quedado y esto quiere decir que ya tengo una aplicación funcionando os la paso por aquí por el chat entrad en esa aplicación ya sabéis Que de momento estamos sin dominio estamos sin virtual Host estamos usando el puerto 3000 Alguien ha dicho buenas tardes No sé quién es No pasa nada ahora ampliamos la aplicación vale pero Alguien ha dicho Buenas tardes Hola mundo desde alicante vale Este será Luis Así que la idea Está en que como veis con esto que acabamos de hacer Ya tengo una aplicación funcionando vale Ya tengo un chat funcionando ahora como os digo a lo largo de estas semanas y de estos meses que nos quedan hay una cosa que tenéis que entender y que tenemos que explotar vale tenemos que preocuparnos de explotar y es qué podemos hacer con node que no podamos hacer con php y esto por ejemplo no podemos hacerlo con php tendríamos que usar Vete a saber el que como mínimo bases de datos o archivos de texto intermediarios porque php se despierta Vale y eh Y duerme claro Exacto vale Fran no todo va a ser ventajas para node con php nosotros podemos estar tranquilos con respecto a la memoria porque sabemos que el programa se despierta hace algo usa la ram que tenga que usar que en el caso de php y Apache es una cantidad bastante grande de ram pero da igual porque sabemos que en cuanto acabe lo que hace es que se duerme y libera toda la ram que esta utilizando porque el proceso termina con no de js no podemos ignorar que llegado un momento Pues esta pila de mensajes se puede convertir en gigantesca grande y por tanto la ram se puede desbordar Eso quiere decir que efectivamente Fran nosotros en ese momento nos tenemos que volver un poco más responsables con respecto a la memoria y por ejemplo en este caso vale si yo empezara a poner mensajes y en un momento dado pudiera como te diría yo entre comillas petar la memoria bueno chico no pasa nada vale porque hay que recordar que yo tengo una Ray de mensajes con lo cual si tengo una Ray de mensajes le puedo decir siempre Quítame los 10 primeros mensajes o limita que la rray únicamente tenga los últimos 20 mensajes en la cola y de esa forma yo sé que la pila nunca va a superar 20 mensajes vale o sea hay técnicas En definitiva algunas más fáciles otras menos fáciles o por ejemplo los mensajes de los últimos 5 minutos guárdamelos en la ram y los mensajes anteriores a 5 minutos me los guardas en una base de datos de tal forma que si alguien quiere lo último de lo último está en la ram Y si alguien quiere ver mensajes anteriores pues ya me voy a buscarlos a la base de datos pero sí que Fran En definitiva Pues eso que has dicho es así vale Y es que hay que vigilar un poco más la ram Pero insisto ventajas y desventajas vale o sea por tanto lo último que yo voy a hacer en esto en estos meses que nos quedan va a ser como te diría yo hacer lo mismo que hacemos con php pero con node No eso es una gilipollez vale en lo que me voy a centrar es qué podemos hacer con node que no podíamos hacer antes vale Y hay un montón de cosas que podemos hacer eh chats aplicaciones de tiempo real videoconferencias videojuegos con multijugador en tiempo real hay una barbaridad inmensa de cosas que podemos hacer con no Djs y que explota Lo bueno que tiene no Djs contra Apache vale Así que lo digo porque hay mucha gente diciendo apacha es una me paso a nojs pero claro cuando te pones a ver lo que hacen dic pero es que haces lo mismo que hacías con Apache pero con nojs O sea qué has hecho o sea no estás aprovechando Lo bueno que tiene vale porque al final meter node para meter una web en html estática pues para eso tienes Apache sabes O sea que mi esto mi filosofía con respecto a node es que Mola un montón pero si utilizamos lo que realmente nos da node bien Vamos a aumentar un poquito más esta aplicación y a continuación me vuelvo a node me vuelvo a chat y ahora voy a crear una carpeta me vuelvo aquí me vuelvo a node me vuelvo a node voy a crear una carpeta llamada 005 chat pero mejor así que ahora eh me voy al editor me voy al chat pero mejor me voy a Index y digo vale Bueno ahora lo separaré Por cierto en archivos Y tal Pero ahora digo vale tú quién eres realmente pues me vengo aquí ID persona Place holder dime quién eres Por cierto que sería cuestión de aquí ir metiendo un meta charset es igual a utf8 vale aquí es input no es mensaje Okay Vale y vamos a ver y digo Let usuario Ahí No Fran eso es literalmente lo que vamos a hacer vale Y es que Eh sí yo hasta ahora tengo una Ray que tiene mensajes pero yo quiero tener más yo para cada mensaje Quiero saber primero Quién ha emitido ese mensaje segundo Qué dice el mensaje y tercero en qué momento En qué fecha se ha emitido ese mensaje eso qué es un objeto vale Cuando tenemos una Ray y queremos más probablemente eso es un objeto Así que Let usuario es igual a nada Y entonces digo document query selector persona punto onchange en ese caso digo usuario es igual a dis value lo cual quiere decir que claro ahora Bueno ahora tenemos que ver qué hacemos aquí vale porque puedo decir y and usuario es igual a en code Uri ahora luego haré eso mejor usuario vale le paso el mensaje y le paso el usuario y de hecho ahora verás Fran que la fecha no hace falta ni que la pase en el cliente porque la fecha se puede quedar en el servidor lo cual quiere decir loal quiere decir vamos a ver aquí creo que ya estoy vale Lo cual quiere decir que eh aquí mensajes sigue siendo un array pero en este caso a continuación yo digo mensajes pun Push y digo te paso un objeto mensaje es igual a esto voy a ponerlo así para que lo veáis claro para que veáis la estructura del objeto usuario es igual a URL completa. query usuario Por qué Porque desde el cliente estoy enviando un usuario vale o sea el servidor recibe lo que el cliente le envía y además fecha es igual a lo siguiente perdón digo Let fecha es igual a New Date la misma librería de fechas y fecha es igual a fecha get date de esta forma ahora en el cliente cuandoo recibo cuando recibo voy a machacar un poco esto un segund Inn porfa voy a decir console pun log datos em a ver Esto es el servidor esto ahora luego lo volveré a subir vamos a ver espera chat pero mejor terminal no de servidor vale Ah Espera voy a lo que he hecho antes en el servidor y que estamos old l Go chat node vale Y en el servidor voy a ampliar con esto y voy a decir que si respuesta es igual a Esto vale si respuesta es igual a esto en ese caso Esto vale Qué quiere decir pues eso quiere decir que ya no me hace falta esto fuera ya no me hace falta Esto vale dime quién eres Soy José Vicente dime tu mensaje Hola Vale y recibo un mensaje dónde niño aquí donde Ah en la fecha 29 no fecha no me la ha cogido correctamente el usuario José Vicente me dice hola y si yo digo qué tal entonces tengo una Ray de dos elementos donde el usuario los usuarios me van diciendo cosas Vale entonces efectivamente a partir de aquí ahora mismo Fíjate que Fran no me interesa especialmente ahora mismo vale igual más adelante Sí tener una ID única por mensaje pero por ejemplo la ID única podría ser la fecha vale podría ser el date Now que sería la época unix vale la era unix efectivamente vale con lo cual voy a hacer lo siguiente voy a decir que en el servidor fecha punto get full year má gu má fecha punto get month + un vale porque el month os acordáis que va de 0 a 11 una haber ración Pero mira y fecha get date Vale entonces paro el servidor recargo el servidor Soy José Vicente y Hola vale Y entonces tengo un mensaje que me dice que Hey un gu se me ha olvidado vale que el 01 Okay Vale aquí se me ha olvidado el guion bien una vez que sé que estoy recibiendo ese js ahora es una Ray de objetos Ahora sí pues por ejemplo en el cliente puedo desbloquear todo este código que estaba poniendo aquí y entonces digo a ver Let mensajes es igual a document qu selector mensajes vale entonces artículo create Element article vale Y entonces digo vamos a ver HM Okay Let no sé vale led h6 o sea led cabecera es igual a eh document create Element h6 ahora va quita ahora cabecera punto text content es igual a dato punto que punto fecha más no gu dato punto usuario más comillas o sea el dos puntos bien y ahora le digo artículo pun appen Child cabecera ahora digo led párrafo es igual a document create Element p párrafo text content es igual a dato mensaje artículo pun appen Child párrafo y ya está bien si esto va bien recargo appen Child Ok vale artículo es document create Element article vale cabecera es document cre h6 artículo appen Child cabecera Esto va sin comillas vale Soy José Vicente y digo Hola Cómo estáis vale me lo sigue poniendo mal la fecha ahora veré igual es que no he reiniciado el servidor vale a ver que me asegure del servidor Este no es debe ser este y teóricamente la fecha sí que ahora está bien será que no he reiniciado el servidor Así que soy José Vicente Hola qué tal Vale ahora sí Y entonces ahora a continuación pues es cuando ahora lo que puedo hacer Hola eh No En una hora tienes cambio de clase vale quedamos a las 5 y te cuento vale esta hora Ahora lo que voy a hacer es tocar un poquito el h6 básicamente para decirle que me quite vale el Border con lo cual pues me vengo al cliente y en el cliente le digo h6 y digo padding 0 píxeles margin 0 píxeles font weight no o normal o lo que sea vale simplemente hago esto para que no haya tanto margen en el h6 vale en el párrafo también p pading 0 píxeles margin c píxeles Ok algo así vale Y ya está así que bueno Vamos allá ahora le ponemos ahora le pondremos un poquito de identidad corporativa a este elemento el vamos a ver el usuario persona margin bottom eh 10 píxeles o 20 píxeles o algo así vale algo así una cosa así okay Y ahora por tanto pues José Vicente y Hola Qué tal Cómo estáis y todo eso bien otra cosa que puedo hacer por cierto Fran ahora que has comentado el tema de los ids vale igual en este momento hasta este momento no me interesa tener un ide por mensaje más adelante Seguro que sí vale porque al final me interesa tener ID de todo me interesa tenerlo todo controlado pero lo que quiero es que cada usuario tengáis automáticamente un colorín diferente vale para diferenciar los mensajes de cada persona para ello voy a hacer una función de Hash o una función de contar donde voy a hacer lo siguiente vamos a ver yo voy a contar los caracteres vale que tengo en el nombre Jos Vicente voy a pincharlo Aquí vamos a ver js given String count characters and as number for each and hsl css a ver iba de 0 a 360 no iba de 0 a 360 Sí vale Y eh and return a number in the Range 0360 using modulus vamos a ver Vale pues Okay pues me quedo esta función Insisto que ahora luego eh exportar remos en funciones ahora luego Sacaremos cogeremos este código y lo Sacaremos en funciones pero no lo quiero hacer ahora todavía vale quiero tenerlo todo si es posible en dos archivos esto quiere decir que ahora aquí a los mensajes artículo Style background es igual a hsl y digo 50% eh 50% Y aquí deg y entonces Aquí voy a poner aquí String to mod de dato usuario qué va a hacer eso pues si lo he programado bien si lo he programado bien eso lo que va a hacer Es que a mí me va a dar un color porque josé Vicente la suma de José Vicente da un color es como una especie de Hash y a cada uno de vosotros os va a dar un color diferente yo en mi caso lo que voy a hacer es que también este número lo voy a pasar a 90 vamos a verlo en lightness vale para que el globito sea lo más eh clarito posible y ahora a continuación en cuanto lo suba al servidor Pues veréis que a cada uno de vosotros os va a dar uno diferente vale Qué vamos a hacer a continuación Bueno pues a continuación lo que vamos hacer es lo siguiente vamos a ver ahora voy a subir esto al servidor paro servidor vale chat Noe chat pero mejor lo tiro aquí al servidor Ok sobre escribo ahora edito en el servidor vale Por qué edito Pues porque quieras que no jarsa old l está ahí realmente puede estar en cualquier parte Pero bueno chat Noe en la Index html Pues aquí en lugar voy a decir 219 punto No me acuerdo a ver 217 Perdón 217 punto 160 pun 28.9 Vale y aquí lo mismo eso quiere decir que ahora me voy al servidor no de servidor me voy otra vez al servidor dime quién eres José Vicente Hola chicos ya aparece Hola chicos vale aparece la fecha y aparece el mensaje y aparece un colorín lo que quiero a continuación es que ahora cada uno de vosotros vale e Fran también me parces con el colorín verde y Luis con el mismo colorín o no un momento ostia Pues sí Ah no cambia un poquito Mira Josué Le cambia un poquito más el color vale claro los colores de los nuestros si os fijáis no son exactamente iguales pero hay que joderse son muy parecidos vale Pero bueno no pasa nada si no se puede cambiar vale la idea Está Yo creo que es casualidad Pero bueno en que si ahora vamos escribiendo cada uno de nosotros tendrá un color diferente vale e insisto una vez más en que vale Alguien ha enviado un mensaje sin Haber puesto arriba el usuario una circunstancia que no hemos previsto vale es decir se puede enviar un mensaje anónimo vale Y ahora que Agustín ya ha puesto Agustín ahora se convierte de color verde Lo importante es que ahora todos los mensajes que envíe Agustín serán de color verde y todos los mensajes que envíe Josué serán de color magenta vale porque lo que hace es colorear el mensaje en base a un Hash a un sencillo Hash Vale entonces Y ojo otra cosa que os digo vale pero sí pero es que no tengo a Ray de usuarios tengo a Ray de mensajes para colorear según una Ray de usuarios para eso lo que tendría que hacer sería crear una Ray de usuarios pero sí pero por que no vale se puede hacer aleatoriamente También podría ser válido otra cosa que podría hacer es poner aquí al lado un selector de color para que cada usuario se pueda elegir el color que más le guste vale o sea se pueden hacer un montón de cosas como os digo bien con esto eh como estamos viendo ya tengo un pequeño chat y insisto una vez más eh yo por ejemplo tengo una como os diría yo tengo una ap opción vale que se llama la conocéis hoc carsa All days donde yo por ejemplo Pues podría necesitar tener un chat aquí al lado es decir eh un chat digamos en cualquier parte de la pantalla donde tenga una especie de consola de atención al cliente qué os quiero decir con esto sabéis lo que quiero decir o sea yo entro en hoka.com y es una página web hecha con php y con html y todo esto Bueno pues yo en un momento dado podría hacer que por ejemplo por aquí me saliera un chat y que ese chat estubiera hecho con no dejs vale por tanto lo que quiero transmitiros es la idea y el concepto de que estamos trabajando con no dejs y no estamos trabajando para quitarle terreno a php estamos trabajando precisamente como os digo siempre para combinar tecnologías para sumar tecnologías y para poder cosas para poder hacer cosas que simplemente antes no podíamos hacer vale Bien voy un momentín dadme un segundo esto ahora mismo no lo podemos convertir todavía en un componente de chat vale porque nos faltaría el https Pero vale Ahora más adelante lo haremos voy a hacer un descanso