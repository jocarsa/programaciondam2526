pues antes de empezar con el contenido puro de esta semana que como ya os decía son los workers vamos a profundizar un poco más dentro de nuestro conocimiento de ajax mediante la función completa de ajax y qué quiere decir completa quiere decir que la que teníamos hasta ahora era incompleta si no pasaba sé que es traumático así que dice que sé que es un shock el saber que la de hace un momento no era completa pero no pasa nada lo van a superar exacto es un palo duro pero no pasa nada porque hoy traigo la completa bien pues voy a hacer lo siguiente mirad antes de empezar antes de explicar un poco repasar visualmente ya no tengo el zoom y te será posible donde lo tendré igual lo tengo aquí en la carpeta jose vicente pues tampoco así que dejadme que me descargué el summit que yo juraría que lo tenía pero entonces el gestión de usuario me descargo summit pero descargo descargas lo ejecutó y atención todos los sonidos mirad contra los arts lo que hemos hecho cuando nos conectamos con ajax hasta ahora con la función load y no digo que a partir de ahora no la a-6 sino que yo os recomendaría siempre que podáis a partir de ahora usar la función load porque es infinitamente más sencilla de lo que os voy a enseñar hoy pero sin embargo cuando por lo que sea la función load se os quede pequeña pues en este caso sabes lo que os voy a enseñar hoy bien antes que nada voy a marcar la línea horizontal que separa el cliente del servidor y por tanto lo que vamos a hacer es que sabemos que en el lado del servidor tenemos php y tenemos en la parte de abajo mysql esto es php y esto es mysql en la parte de arriba en la parte del cliente tenemos digamos en esta capa de aquí abajo tenemos javascript luego tenemos html y por último en la capa más superficial tenemos css así que por tanto html y javascript por tanto finalmente sabemos que html y css se llevan muy bien sabemos que html y javascript se llevan también notablemente bien hacemos javascript que al final acaba modificando el html que muchas veces acaba siendo modificado por el css incluso hemos visto alguna vez como javascript incluso puede modificar directamente css mediante la función css no es que se haga todos los días pero bueno está ahí pero sobre todo tenemos aquí una pequeña un pequeño problema y es que la comunicación entre javascript html incluso entre javascript y css se realiza sin ningún problema pero la comunicación entre javascript y php puede ser un poco traumática por tanto para eso y para no ya la como única manera de hacerlo sino para facilitar esa comunicación tenemos ajax donde ajax es un núcleo concentrador que nos permite comunicar en tiempo real a sincrónicamente de la misma manera que jamás quien se comunica con el resto de elementos sencillos sincrónicamente nos permite modificar ciertas cosas nos permite modificar comportamientos nos permite conectar javascript con php y eventualmente por supuesto pues php ya se conecta con mysql con lo cual si php se conecta con mysql pues hi javascript mediante ajax se puede conectar si hace falta finalmente con mysql este esquema de aquí conocido como el stack de stack este sistema de aquí es el más común en cuanto a desarrollo web luego hay que decir que es posible sustituir php por otras tecnologías como sp o como jsp o incluso con tyson y por qué no también con rubí pero finalmente únicamente cambiaría la pieza de php todo el resto tiene que seguir exactamente igual la idea por tanto lo que vamos a hacer hoy es ver algo más completo de lo que hemos visto hasta ahora en cuanto a ajax lo que hemos visto hasta ahora es un método super sencillo llamado load y el método de load hace que javascript llame a un archivo php y ese archivo php le devuelva información en la parte del cliente hoy vamos a ver un método más complejo llamado el método ajax y para ello por tanto voy a hacer lo siguiente me voy a ir al disco duro local ce me voy a ir a casa me voy a la chet de box voy a crear una carpeta llamada ajax completo ni que decir tiene que en el momento en el que uso ajax y por tanto uso php pues tengo que usar el samp no voy a usar hoy ahora mismo mysql pero sí que desde luego necesito apache así que me vengo aquí le digo documento de texto le digo index.hr ml y creo un archivo llamado servidor php los dos los cargo en heavy así que los dos los cargos en head y me copió de cualquier otra carpeta el helio de cuadril jquery y empiezo a escribir así que la primera parte es sencilla simplemente volví traigo el script jquery punto j s y hago un script donde digo cuando el documento está preparado quiero ejecutar una función que ya sabéis que siempre para empezar dice hola así que me voy a localhost digo ajax completo y si dice hola es que se ha cargado correctamente bien hasta aquí bien por tanto ahora voy a hacer lo siguiente mira voy a decir en este caso que este es de i d con tenedor y por si acaso me hiciera falta en algún momento dib y de destino aunque no está muy claro que lo acabe usando pero vale así que una vez que entramos en el reb y vamos a ejecutar la función ajax completo que realmente es el ajax completo según jquery qué es una función compleja pero que a la vez simplifica todavía más lo que es el código atento auténtico de ajax vale por tanto es el método es completo pero siempre desde el punto de vista de jquery vale pues habría de sacar el correo electrónico me voy a sacar el método que os enseñé ayer hasta ahora sin saberlo siempre habíamos trabajado con el método que hay dos métodos para trabajar con ajax que es get y que es lo que es post perdón consulta capacidad métodos de equipos no aquí está así muy bien pues copio este método lo voy a pegar aquí y podemos comprobar por tanto que el método ajax es como el método pero bastante más complejo también os digo por cierto que el método vaya que es un poco particular porque a diferencia del método load no requiere un selector y por tanto es el primer método que vemos creo que en lugar de poner dólar paréntesis dime sobre qué quieres operar por dólar punto ahora verás el tema es que de momento no lo reconoce el tema es que de momento lo que hace simplemente es yo quiero ejecutar ajax y por tanto esta función es de ira es de javascript hasta php no necesito en principio aunque la verdad es que lo podemos hacer no necesito en principio decirle ningún dip o id porque yo no quiero proyectar de momento nada sobre ningún tipo yo simplemente quiero que desde javascript vaya algo de información hasta php esta es la razón por la cual de momento no ponemos ningún tipo de selector y eso equivale a decir en el documento por ahí quiero que envíes una petición a php no no vamos a remover claro una cosa es donde se va a proyectar la información php y otra cosa es el evento que lanza la conexión ajax son dos cosas diferentes entonces en este caso por supuesto lo que estoy haciendo es lanzar una petición a jacques apeló ya pero quiere decir que cuando el documento se carga cuando el documento es de red y se ejecuta la petición ajax pero por supuesto eso podría ir dentro del evento que tú quisieras un clic un mouse enter un change un toque de tecla un lo que quieras por ejemplo en este caso puedo hacer button y b lanza con la leyenda lanza y ahora aquí digo cuando sobre lanza haga clic ejecutó una función que realmente es la petición a jacques con lo cual ahí verás ahora evidentemente sangramos todo para verlo mejor y en este caso lo que hemos hecho es encapsular esa petición ajax dentro de un clic y no pasa nada es decir guardamos recargamos comprobamos que tenemos un lanza y sólo se va a ejecutar lanza cuando realmente pues sólo se la ejecutará ya que quería decir cuando lanza se ha pulsado eso por supuesto que sí bueno pues a continuación vamos a analizar un poco la información que tenemos aquí se le pasan una serie de parámetros atención todos porque hay una serie de comas para separar los parámetros donde en primer lugar a sincrónico es igual a true yo diría siempre deja de esto en verdadero porque si hacemos una precisión ajax es que queremos que sea sincrónica ahora en cuanto a type en cuanto a type ahí sí que hay que decir que tenemos dos métodos donde hasta ahora aunque no lo sabíamos lo que estamos usando es el método get pero sin embargo dices bueno ahora con el método completo tú puedes elegir entre get y post con lo que conocíamos hasta ahora con el método load no podíamos elegir era solo get y ya está la idea está en que con get los parámetros se envían con la url pero como ya hemos visto este fin de semana los parámetros url hay veces que cuando les enviamos demasiada información y el servidor no está configurado para aceptar tanta información pues se pueden colgar pueden decir que no cabe tanta información con el método post cabe más información así que bueno en este caso por ejemplo vamos a empezar a usarlo con una consideración si aquí envió la información desde el lado de javascript con el método get en la parte de php tendré que las variables con el método get si aquí envió información con el método post en el lado del servidor en php tendré que buscar las variables con el método post más allá de eso no hay más problema bien qué es lo que va a ser lo que vas a enviar pues mira lo que voy a enviar en principio son datos de tipo html pueden ser de otros tipos luego si queréis entramos dentro de la documentación el método ajax y veréis que básicamente esto se usa o bien para txt o bien para jason para json que es un método serializado de datos el cual haremos bastante más adelante pero qué bueno que conviene que conozcáis entonces el content time lo que se envía al final es un formulario o intenta ser un formulario y ahora cuál es la url claro lo que preguntabas antes si no le dices a quien estás enviando vale pues a quién se lo estoy enviando se lo estoy enviando a servidor punto php y ahora acordamos que cuando poníamos el método low mirada de atención cuando poníamos el método load voy a ponerlo por aquí como muestra como recuerdo de lo que hacíamos hasta ahora pues claro técnicamente hacíamos un pelín de trampa y es que decíamos mira aquí está el nombre del archivo ajax con el cual quiero trabajar el archivo en el lado del php a continuación pongo una interrogante donde el interrogante se para lo que es el archivo y lo que son sus parámetros y a continuación pongo parámetros con iguales en este caso el parámetro ce es igual a lo que tú me digas aquí el método ajax conceptualmente es igual la única diferencia es que la url está en este parámetro y los datos están en este parámetro es lo mismo pero separado en parámetros diferentes así que digo mi parámetro es igual a la de momento voy a poner hola el parámetro seco al aula otro que ha si no pasa nada andy mi parámetro 2 es igual a dios y así tantos como quieras es decir cuidado creo que sin coma ni nada simplemente lo que hay que hacer es poner el hambre sanz hay que hacer es poner el amper para enlazar parámetros ahora verás entonces a partir de aquí a partir de aquí le digo tres funciones llamadas giffords en voy a cambiarlas a castellano para que entendáis que el nombre de esas funciones puede ser el que queráis entonces antes de enviar éxito y error así que le digo antes de enviar y ejecutó la función antes cuando a perdón a persona persona a ver no me forces no lo puedo cambiar a castellano esto es lo que puedo cambiar no no no es que es lunes por la mañana ya me dio muy positivo queriendo cambiar muchos parámetros antes de enviar esos y sax es función éxito y error bueno problemas me gusta ese nombre al entonces esto son tres funciones que en principio se van a ejecutar por tanto lo que te decía ayer es que tenéis que declarar esas tres funciones fuera del bloque principal fuera del rebe y tenemos que poner el mismo nombre que ya hemos prometido antes de enviar de momento lo que te decía tres vacías el momento ayer eran vacías porque sólo enviamos datos no queríamos recibir nada de vuelta hoy igual sí que queremos recibir entonces function éxito y function problemas he permitido otras funciones aquí tiene estas funciones así que por tanto y yo ahora digo antes de enviar estas funciones son un poco molestas porque decís madre mía si lo que antes hacíamos una línea ahora estamos basando mujeres de líneas sí pero es más completo seguro que habéis visto en muchísimas aplicaciones en muchísimos juegos lo típico de que le das a cargar algo y mientras está cargando hasta que carga aparece un redondel hito que va dando vueltas por esto eso es antes de enviar a leh por tanto digo en contenedor quiero punto html cargando un texto a palo seko llamado cargando pero cargando más adelante lo podemos reemplazar por un gif animado que es el típico keys que va dando vueltas al momento del texto ap/ap lo cargando si hay problemas digo en el contenedor punto html error en la conexión la función problemas es una función que me gusta mucho porque depende de este parámetro que tenéis aquí llamado time out y ese parámetro hace que la función ajax completa sea mucho más poderosa que la función load lo que hace esta función es que intenta conectarse al servidor php e intenta pasarle esos parámetros si no lo consigue lo vuelve a intentar mientras que no lo consiga tenemos aquí este parámetro lo que está haciendo es decir cargando o cargando pero lo más interesante es que si después de cuatro segundos es decir 4.000 milisegundos no lo has conseguido no lo sigas intentando simplemente cancela la petición ajax ir a error eso no lo hace la instrucción loud y por tanto cuando tienes cinco personas en tu servidor atacando con load pues no pasa nada cuando tienes 50 personas atacando a tu servidor con load puede no pasar nada pero cuando tienes cinco mil personas atacando a la vez es decir en el mismo segundo al servidor es importante contar con un mecanismo de defensa que diga mira si en cuatro segundos el señor no ha respondido será porque está ocupado con otras cosas cortará la conexión a la gente porque si no lo haces lo que empezar es cinco mil peticiones que no sólo estarán activas sino que seguirán activas y activas diciendo quiero quiero que hagas target un servidor no ya esté colgado sino que acabe de petar del todo vale por tanto luego ya es de 4000 nosotros lo configuraremos hasta lo que queráis en este caso fijaos que ejecutó vamos a verlo así lanza y en este caso no se ha visto nada de hecho es que la lanza antes de enviar is not y find antes de enviar bien así que recargo y pone cargando claro pone cargando y realmente el servidor punto php ha dado su información pero yo no le he dicho a cargando que tenga que quitarse una cosa con este montaje de servidor local en localhost sería prácticamente imposible que nunca hubiéramos error porque estamos en nuestro propio ordenador la única manera de guerrero y a veces también y así es bajar el time out o cero oye si tardas más de 0 milisegundos es que das del error segundos no me dejas la oportunidad pues es un poco la cuestión entonces guardo recargo y aún así incluso así muchas veces descargando eso quiere decir que la información ha venido antes del 0 min y segundos así que bueno nada simplemente cuando nos vamos a un servidor real pues ya podremos disfrutar del error del problemas y lo que quiero ahora por último dentro de esta función es saber qué es lo que ocurre cuando la función tiene éxito y cuando la función tiene éxito yo le digo en contenedor pongo de momento pongo ajax ejecutado así que lo que ocurre es que pulso lanza habéis visto atención que durante un microsegundo pone cargando mira ha visto pero lo voy a hacer grande veis como no aparece de entrada sino que hace clic plato pero prácticamente no se ve es decir primero ejecuta cargando y cuando ajax devuelve la señal de vale encontrado el archivo php lo ejecutado se ejecuta correctamente pues pone ajax ejecutado claro pero vosotros diréis bueno si haya ex ejecutado esto está muy bien pero realmente no hemos hecho mucho básicamente hemos ido a ajax hemos tocado a ajax y nos hemos vuelto como diciendo vale sí php existe está ahí ahora ph pero me ha hecho nada y como va decir php nada así es que está vacío al era así que hemos hecho una petición ya que es completa pero no ha sido muy interesante desde el punto de vista en que no nos ha podido devolver nada hemos hecho únicamente el camino desde ajax a php y no el camino desde php hasta ajax vamos a hacer ese camino así que mira la atención me voy el archivo servidor punto php y en el ejemplo más sencillo que os puedo enseñar yo digo estoy llamando estoy creando variables php pues digo dólar guión bajo perdona variables de tipo post quería decir pues digo dólar guión bajo post y digo echo por ejemplo la primera variable que has enviado es punto post que post mi parámetro lo veis ahí vamos mi parámetro eco br para pegar un pequeño salto de línea y eco la segunda variable que has enviado es punto dólar post mi parámetro 2 hasta aquí bien pues yo ahora lo que hago es que guardo recargo la balanza y dice haya ex ejecutado pero hay un problema y es que yo realmente aunque habrá php él le haya dado información y esa información esté funcionando correctamente yo no le he dicho a ajax no lo he dicho a javascript que esa información debe volver por tanto para conseguir eso tengo que poner lo siguiente dentro de la función éxito y solo dentro de la función éxito tengo que poner un parámetro por ejemplo datos eso está en castellano quiere decir que puedo poner longaniza entonces yo vengo aquí y digo php me dice más datos esa es la manera en la que no sólo vamos a php y no sólo conseguimos que php ejecute algo sino que además cogemos eso que nos da php y nos lo traemos de vuelta y lo lanzamos en la pantalla así que guardamos y recargamos le digo lanza y me dice php la primera variable que has enviado es hola y la segunda variable que has enviado es adiós sólo por poner datos por tanto no sólo somos capaces de llegar a este ese archivo php y pedirle algo sino que esos datos ese parámetro datos que realmente luego se acaba poniendo aquí transporta los datos de vuelta php dice ah pues mira me has pedido algo pues te lo doy te lo devuelvo para que lo puedas bueno para que puede hacer con ello lo que quieras devolverlo en pantalla procesarlo como variable es lo que tú quieras lo que pasa es que el ejercicio de hoy para hacer lo más sencillo posible pues bueno lo devolvemos en pantalla para demostrar que estamos recuperando algo de datos claro ahora entenderéis porque hasta ahora hemos funcionado con la función load y entenderéis también por qué os sigo recomendando la función load porque lo que hemos hecho aquí habrá a 10 líneas más todas estas de aquí digamos al final unas diez y veinte líneas por ejemplo pues con el audio lo hacíamos en una sola línea por eso mi recomendación sigue siendo siempre que podáis árbol siempre que podáis usar la función load pero si alguna vez queréis algo con más potencia con marcha pues que sepáis que está la función ajax datos en principio es una variable s datos que vuelve es una variable ya a partir de aquí depende de lo que hagas si lo que vuelve es un único valor pues a partir de ahí lo tratas directamente como variable y si vienen varios valores tendrás que desee realizar los que es algo de lo que vamos a hablar hoy también con los workers entonces por ejemplo yo vengo a php y digo mira en lugar de decir todo esto en lugar de decirte este rollo yo digo eco supongamos que te envío un valor es igual cuánto quieres que valga valor no lo sé que vuelva claro que tiene 13 tenemos una variable que se llama valor que tiene 3 el valor 3 por supuesto vamos a ver realmente no exactamente mira en mente un hombre de variable valor a cuánto vale dale 30 bien la idea aquí está en que yo no puedo meter la palabra valor aquí dentro vale aquí pero no pasaba pasada digo prueba es igual a eso sí lo que sí que puedo hacer es darle el valor de valor darle valor cuanto a cuánto equivale habrá prueba sirviendo como datos si es texto números o lo que sea eso es otra cosa pero de momento se envía como datos no no este es mucho más por delante de tamaños gigantescos pero cuando te hablo tamaños de gigantescos también depende en depende del servidor por el tamaño mínimo por servidor son 8 megas y mediante la edición de un archivo y ni se puede subir a lo que quieras por tanto sin problema no lo cambio tanto no lo cambio tanto claro pero esperamos entiende atención mirando a cabo con esto entonces yo ahora vengo y digo atención y digo eco post prueba tecos prueba ya que estamos voy a decirle por 2 así que yo pregunto cuando ejecuta este programa que se devolverá en la pantalla le estoy enviando 30 y en php lo estoy multiplicando por 2 no lo sé vamos a probarlo yo creo que sí pero no estoy seguro del todo qué dirías que parecerá no pueden aparecer dos cosas ese error no creo pero puede aparecer o 30 entonces guarde recargo vamos a ver qué pasa y cph me dice de 60 bien entonces que ha ocurrido que desde javascript yo le envío 30 en el lado del servidor se multiplica por dos me vuelve como 60 y javascript de vuelta dice de m 60 pues tengo 60 en la pantalla ya está pero lo que quiero que veáis es que esos datos realmente es una variable y yo a partir de aquí yo puedo decir datos por dos déjame que ponga esto en un paréntesis aunque por procedencia debería ser correcto pero por si acaso así que qué diríais qué va a pasar ahora bien ahora pueden pasar dos cosas en el mejor de los casos 120 como mucho puede pasar 60 vale entonces vengo aquí la diego lanza y dice php m dice 120 entonces qué es lo que ha ocurrido aquí pues que ese datos que vuelve no es sólo una cadena de texto sino que son datos con los cuales yo puedo hacer lo que quiera puedo hacer operaciones matemáticas puedo lanzarlo directamente en pantalla puedo meter la base de datos puedo hacer lo que quiera la demostración en este caso está en que yo le he enviado 30 en el servidor se han multiplicado por 2 y me la ha devuelto y java escriba ha sido capaz de ese valor multiplicado por 2 y a su vez volverá a multiplicarlo por 2 y funciona perfectamente eso no nos justo esa pregunta bien vamos a ver en principio no puede devolver una raya ahí entra lo que es la serialización entonces la señalización es la idea de introducir múltiples datos dentro de una variable para que luego cuando llegan a la parte del cliente pues hacer un poco de carniceros y empezar a trocear los datos para una vez troceados empezar a usarlos digamos que en el lado del servidor lo que sería es 'una serialización es decir se empaquetan unos datos dentro de una serie y en el lado del cliente tendría que hacerse una de serialización pero no voy a hablar de ello ahora porque voy a hablar de ello en la siguiente parte de la clase que es la parte de web workers esta semana vamos a afrontar una tarea abstracta más o menos compleja pero este fin de semana he preparado un bloque de código para hacer eso que es complejo de la manera más sencilla posible de lo que vamos a hablar ahora es de una característica nueva en html5 que se llama web workers entonces los web workers es la implementación en javascript del concepto que hablábamos al final de la semana pasada que es el paralelismo es la idea de poder usar x núcleos a la vez x núcleos o en definitiva recursos de procesamiento paralelo que haya instalados dentro de nuestro equipo por tanto para ello dejadme que me haga una nueva carpeta dentro del servidor web workers una cosa los web workers que vamos estar trabajando en principio son todo el rato en el lado del cliente no requieren servidor pero aún así por seguridad sólo se pueden ejecutar en un servidor si hace falta en un local host pero no se pueden ejecutar haciendo doble clic en un archivo html vale así que aunque de momento en la clase de hoy sólo vaya a trabajar con html quiero estar trabajando dentro de él localhost dentro del sunp lo digo por si lo probáis en casa y decidir ostras porque funcionaba en clase y no me funciona en casa si hago doble clic al archivo porque no se puede hacer doble clic al archivo hay que hacerlo mediante servidor bien por tanto aquí vuelvo a copiar me voy a copiar esta estructura que ya he hecho esta mañana la pego aquí vacío todo el javascript y voy a hacer lo siguiente vamos a verlo e incluso eliminó todo lo que hay en el body y ya sabéis que digo cuando sobre perdón a esto cuando sobre documentos ejecutó una función que dice ya sabéis lo del temporizador digo bar temporizador es igual a nada ejecutó un set time out donde ejecutó la función loop en por ejemplo un segundo milisegundos y a continuación defino la función loop qué hace un killer time out del temporizador es igual a 7 clear time out para borrar el temporizador para a continuación volver a ejecutar el temporizador en un segundo pues no vamos a poner 10 milisegundos tenemos aquí por tanto un loop tenemos un bucle como los que hasta ahora hemos estado usando y ahora yo digo bar variable es igual a 2 por ejemplo voy a crear un dip y de contenedor y hacemos lo siguiente en contenedor médico variable por igual a 2 + igual 2 la mejor que si no se me va a infinity en un momento con tenedor punto html variable que va a hacer esto pues esto lo que va a hacer es muy sencillo mirar web workers ese es notifam jquery y me falta copiar jquery en la carpeta así que lo copio de ajax completo copio jquery lo pego dentro de web workers lo pego hay dentro y ejecutó y lo que tenemos es una cuenta hacia adelante tenemos una cuenta hacia adelante pero yo digo yo quiero más yo quiero que me lo ejecute es en 0 milisegundos así que recargo y fijaos como la cuenta empieza miro el procesador y digo bueno un 18 un 21 por ciento está siendo usado el procesador de hecho quien lo está usando pues me vengo aquí y digo bueno en la cpu el chrome no parece estar usando demasiado del lo que más está usando es la grabación de disco a le parece que chrome está haciendo algo pero no demasiado vale vamos a hacer que krum haga algo más interesante y es que digo variable por igual a 1.000 y un montón de decimales vamos hacer una operación matemática más compleja le digo por igual para multiplicar y luego decimales así que recargo y tengo algo más complejo en la pantalla vamos a verlo vamos a ver por aquí me voy al procesador veo que el procesador sigue hay bastante veis vamos a ordenarlo así 1 % el procesador no mucho no pasa nada vamos a aumentar más la complejidad todo esto de aquí realmente lo meto en un bucle fort y lo meto en un bucle for y digo por bar a es igual a cero a es menor que diez mil a más es decir cada vez que ejecutas este bucle loop no se ejecuta sobre la instrucción ejecuta 10.000 copias de la instrucción así que guarde y recargo y mira madre mía esto se me va a ir a infinidad e infinidad en un momento u otro en fin y tiene un momento pues veis cómo va golpes que había golpes ya me gusta más así que bueno dejadme que le ponga mirad si no queréis ir tan rápido e infiniti ponerle unos cuantos ceros más a los decimales y ya está así que recargó vamos a ver esto de que vaya lento está muy bien vamos a verlo rendimiento mirada de 29 32% me voy a procesos mirad aquí está he conseguido que google chrome me gasté el 17% del procesador y digo esto va bien esto me gusta pero sabéis qué aquí me he quedado porque ahora le digo guau pues sí con 10.000 iteraciones me gasta el 10 y pico por ciento del procesador con un millón de operaciones me va a gastar todo el procesador porque son 100 veces más pero me doy cuenta de que no recargo por aquí y veo que irá más lento un momento y creo que está calculando voy a hacer una cosa voy a quitarle un cerdito el programa se enfada conmigo este paso es efectivamente pero lo importante es que ahí empieza a aparecer lo x 10 pero aunque lo x 10 mira no pasó del 19 por ciento si estoy en un ordenador de 6 núcleos no pasaré del 15 por ciento más o menos si estoy en un ordenador de cuatro núcleos nos va a ser del 25 por ciento este en ordenador de dos núcleos no pasará del 25% en este caso si tengo seis núcleos cien partidos 6 no pasará del 16 6 % en este caso estoy pasando buena verdad que no sé por qué porque estoy casi al 20 esto saber bueno sí porque tengo varios núcleos de chrome por ahí ejecutándose porque el correo también pillar a algo pero nunca pasaré prácticamente de ese 20 por ciento entonces si miro el rendimiento veréis que yo podré decir bueno para que me he comprado yo un ordenador de seis núcleos que realmente nunca voy a poder usar más de un núcleo y lo que es peor que esto es seguro que como jugadores de juegos os ha pasado alguna vez ahora ya no tanto pero me acuerdo la época entre 2002 y 2006 2008 más o menos que era cuando intel ya md empezaron a sacar los primeros procesadores de varios núcleos el core 2 duo el quad el core 2 quad pero había en muchos juegos que decías otras me gasto una pasta en este juego pero luego cuando lo ejecutó o bien yo me enterado o bien lo he visto en un benchmark por internet que este juego que vale 60 euros solo me usa un núcleo de hecho luego con el tiempo de empezar no salen los juegos que aprovechaban dos núcleos y dices pues tengo un core 2 quad para que quiero dos núcleos yo quiero los cuatro núcleos vale entonces esta problemática no es sólo en javascript es en cualquier lenguaje de programación donde por defecto todos los lenguajes de programación son bueno núcleo ya partir de ahí tenemos que contar cómo vais a ver a continuación con dos cosas lo primero es que haya un soporte por parte de la tecnología por parte del lenguaje de programación para trabajar con multi núcleo y por otra parte que nosotros planificamos nuestra aplicación como multi núcleo el problema del procesamiento paralelo insisto una vez más no es sólo de javascript sino que por ejemplo como os decía el otro día java no resolvió este problema hasta 2012 entonces básicamente esto quiere decir que los lenguajes de programación han tardado años en solucionar el paralelismo en darse cuenta de que los procesadores que se venden en las tiendas ya no eran procesadores de un solo núcleo sino que eran procesadores de multi núcleo en este caso por tanto en 2010 en el momento en el que aparecen los primeros borradores del estándar de html5 aparece un concepto llamado los web workers es una implementación que os va a parecer difícil pero que aún así es más fácil que en otros lenguajes de programación de solucionar la problemática de los múltiples núcleos vamos a hacer hoy un ejercicio bastante abstracto mañana y pasado le daremos más aplicación práctica pero sobre todo aunque hoy va a ser un ejercicio muy abstracto por lo menos quedará demostrado cómo vamos a poder utilizar sin ningún problema múltiples núcleos para ello por tanto dentro de la carpeta de web workers me voy a crear un archivo index 2 punto html lo voy a cargar dentro de edith voy a transferirle el código y os traigo por aquí y os traigo por aquí os traigo por aquí un ejercicio preparado lo más sencillo posible salud que dice lo siguiente un momento que cojo el código workers vale así que vamos a este código vamos a este código no mentiré no miréis todavía cojo una variable cojo estas dos funciones y el nombre para ser sencillo no es tan sencillo no os preocupéis parece mentira efectivamente ahora lo simple claro diréis madre mía es una ilusión vale ahora con este código en la mesa lo que hago es lo siguiente esto me lo voy a cargar es más a ver momento y esto me lo voy a cargar qué hacen esas dos líneas de código esas dos líneas de código lo que hacen es comprobar si es cierto o no que tu navegador tiene soporte para workers ese código estaba muy bien en 2010 pero es que a día de hoy una gran cantidad de navegadores web soportan workers vale por tanto lo primero que voy a hacer es eliminar todo esto lo voy a borrar también todo esto lo voy a hablar también ahí está y todo esto lo voy a hablar también y como veréis por tanto este código se quedará un código bastante sencillo muy bien pues tengo esto por aquí tengo esto por aquí veis cómo os había dicho que ese código verdad vale muy bien muy bien pues ya está qué quería hacer yo ahora si quería ir a una página support web workers browser hay una página web que ahora mismo que no es ese que ahora mismo no me acuerdo vale entonces te dice de cada cosa de html5 te dice que navegadores lo soportan y que navegadores no lo soportan entonces en este caso en el caso de web workers que es lo que vamos a aprender hoy pues te dicen mira internet explorer lo soporta a partir de la versión 10 o también que lo sepáis es que es el nuevo navegador este de chrome de internet de microsoft quería decir los soporte a partir de la versión firefox los aportaba a partir de la versión 43 bueno a chrome soporta hace un montón de versiones safari a partir de la versión 9 ópera a partir de la versión 35 safari el safari de ese no el safari de mac sino el safari de iphone a partir de versión 8.4 opera mini todavía no lo soporta ha visto alguna vez ópera mini yo sí su navegador que mola mucho pero casi nadie lo usa de hecho ya me extraña que ponga ahí 4,7 por ciento pero en fin está muy bien el navegador muy bien vamos a ver el ópera es un navegador y el opera mini es un navegador basado en ópera optimizado para dispositivos android y está muy bien porque es un navegador que ocupa mucho menos que el navegador por defecto de android que creó un para android que es firefox para android o que cualquier otro navegador es un navegador también te digo es muy parco es muy espartano se carga y no tien prácticamente nada pero cuando llega un momento que tu móvil es empezar a antiguo y empieza a ir lento y dices mira quiero navegador que no tenga nada pero quiero navegar no quiero que hasta para cargar el navegador esté como cinco segundos esperando pues opera mini viene bastante bien lo digo porque si lo queréis probar luego también para hacer un navegador mini tiene unas cuantas funciones muy divertidas que es directamente no quiero cargar imágenes entonces pues estás por ahí fuera igual estás en el campo y tienes una conexión a internet 3g horrible que nos den y 3g ni ná sobre todo o un ojo y se es mira quiero leer el periódico pero cada vez que cargo el periódico para leer una noticia me tengo que tragar las imágenes el logotipo el css y tal pues en una función que es no cargar imágenes que te carga el texto a palo seko y aunque este es el medio del campo va bastante deprisa o sea que os digo si podéis probarlo porque es un navegador que está muy bien bueno luego tenemos el chrome perdón el android browser que es el navegador que viene por defecto en android y tenemos el crowd for android vale entonces como veis por tanto si esto lo hubiéramos en 2000 mirasol si lo hubiéramos en 2010 pues evidentemente otro gallo cantaría pero en 2016 todos los navegadores menos ópera mini tiene el soporte para web workers ya sea en pc o ya sea el móvil en tableta o donde queráis vale pues bueno vamos a continuar por tanto vamos a ejecutar este código y ejecutó ahora ojo esto espera voy a llamar a esto ocurra js esto espera que exista dentro de web workers un archivo llamado currante punto j s así que curran js no tiene nada de momento muy bien pues qué hacemos ahora vamos a verlo ni worker si tiene pinta de que está de macy's porque es más déjame sangrar vaya ahora bueno pues esto es hacia adelante vaya el espacio del sandoval están rebeldes ahora sí y este función va aquí vale pues recargo index tos cargo index2 punto html espera que se descuelgue esto va muy bien y ya está esto es lo que tengo no tengo nada ajeno pero tampoco un error qué es lo que quiero vale así que voy a comentar línea a línea qué es lo que hago porque el código este lo que necesito es pero entendáis muy bien por eso en esos tres días con este código voy a ir todo lento que haga falta declaró una variable que ahora se convertirá en un objeto ejecutó una función por tanto la función start worker arranca el worker a continuación asignó una instancia de walker a la variable que la variable es w como puede ser la mano y longanizas o me da igual y ahora digo si el worker te devuelve un mensaje es decir un message con message en castellano atrás os diremos cómo duermen seitz es decir donde haya un mensaje en ese caso lanza me el mensaje en pantalla cuidado hay otro error para eso es un mini error y dice en el documento en aquel y en aquel elemento que tenga el y the result no tengo ningún elemento con líder result devuélveme él en los datos del evento devuélveme lo que el worker te dice claro no tengo ningún elemento llamado resulta tengo contenedor así que pongo aquí contenedor y ya está eso es un worker muy sencillo claro tan sencillo que no hace nada pero recargo aquí sigue sin hacer nada esta es una función para poder pararlo worker cuando queramos para lo y reiniciarlo por si más adelante quiero volver a usarlo es interesante desde el punto de vista que si más adelante tengo que quiero reutilizar un worker no tengo que volver a declararlo sino que ya está ahí definido y está como durmiendo muy bien hasta aquí bien pero ahora lo que voy a hacer es que curran de punto j s haga algo así que currante punto j s parece que estaba estudiando currante punto j s lo que va a hacer simplemente es devolver un mensaje si os fijáis esto que os voy a enseñar hoy es ligeramente parecido a ajax en cuanto a qué llamas un archivo externo es arte muestra no te hace algo y ese algo te lo devuelve y lo lanzas en pantalla a partir de aquí a partir de aquí mirada este elemento ese worker está esperando recibir un mensaje así que currante punto j s tiene que enviar un mensaje cerdo entonces me vengo aquí mentir dejadme que me coja el ejercicio este queso preparado con el workers worker 1 js bueno allá la esto no es así workers eso sí así que digo pues message pérez y el resto del código el resto del código no es importante por ahora pues message hola por tanto si este método worker está esperando recibir un mensaje estoy diciendo cuando alguien te envía un mensaje sácalo por pantalla este archivo este javascript llamado currante punto j s está enviando un mensaje esta post message y el post meses que dice es hola así que guardo y recargo y en este caso todavía puede ser que no tenga nada en pantalla es normal vale a continuación vamos a hacer para tener cosas en pantalla dentro de index estos html vamos a empezar lanzando los workers vamos a empezar diciendo que worker quiero decir siendo que currante tiene que tener un pequeño ciclo este pequeño ciclo es este de aquí por tanto voy a hacer lo siguiente y ahí está así que voy a hacer lo siguiente mira y vamos a analizar un poco esto que tenemos en la pantalla esto que tenemos en la pantalla que es pues creó una función llamada time count ejecutó la función time count y esa función se ejecuta a sí misma que diréis que es esto un buque es un bucle que se ejecuta en 0 milisegundos y que hace algo muy parecido a lo que muestra un ejercicio anterior que es cada vez multiplícate por ese número así que guardo y recargo todavía no tengo nada vale vamos a ver si tengo por aquí todo body contenedor sí fibras pícaro yo declaró una variable llamada i a esa variable le digo que es igual a 2 vamos a escribir de claro una variable llamada ya sabéis ejecuto una función muchas veces y lo multiplicó efe por un cierto valor envió de vuelta el valor de i puedo enviar de vuelta lo que sea y en time out ejecutó esta función tantas veces como pueda exacto el otro está esperando recibir un mensaje este le está enviando un mensaje eso es exactamente por tanto guardo recargo esto todavía no hace nada de hecho ya me extraña que no haga nada pero en fin yo creo de todas formas yo creo de todas formas que debería arrancar por alguna parte el código así que voy a decir estar walker ahí está estamos comiendo esto ya parece bien pues acabar de copiar no se ejecutaba nada porque yo había definido una función había definido una función pero nunca estaba ejecutando la función con lo cual aquí al final ejecutó la función para que todo se ponga en marcha con lo cual comprobamos como el start worker empieza a trabajar y comprobamos como por tanto le digo cuando el worker me da un mensaje como que común es más que más bien es como en wilde exacto no sé nada efectivamente si era el worker se parara pues este vídeo llamadas mensajes pues ya está eso es vamos a ver lo que se establece es algo que hasta ahora no se ha establecido que es como una tubería de comunicación continua con lo cual ahora el archivo index 2 punto html y currante punto j s están continuamente enlazados aunque sean los archivos diferentes que currantes sigue dando información pues éste está como escuchando es un servicio que está escuchando que currante deja de dar información pues dificulta yo sigo escuchando porque un buen diámetro esa información pero si me dices nada pues no hacemos nada en pantalla y ya está no sé si es que y mi ordenador mi procesador es tampoco empezando a hiperventilar pero un poco solo porque si yo vuelvo a la gráfica del procesador bueno veréis que estoy al 56% cincuenta y pico por ciento pero no estoy al 100% así que me voy a procesos y veo que tengo dos procesos de chrome qué curioso y los dos al 19 14% qué son estos procesos de atención todos en la pantalla pues uno de estos procesos es el invento html y el otro proceso es currante punto j s y esto es lo divertido porque lo divertido es que el programa va a crear tantos hilos de procesamiento paralelo como haga falta a continuación vamos a comprobarlo en la pantalla la idea está en que si hemos conseguido esto realmente hemos abierto las puertas del infierno y quiero hacer las puertas del infierno de lo que se va a calentar el procesador ahora cuando hagamos la siguiente parte del ejercicio porque si he creado por aquí voy a maximizar esto si he creado por aquí una nueva instancia de un objeto w qué manía con es que tengo la manía de que se ponga al nivel vale si he creado una instancia de un nuevo worker puedo crear tantas instancias como quiera así que digo var w1 coma w 1 w 2 w 3 w 4 voy a simular que tengo un procesador de cuatro núcleos y en este caso tengo uno de seis pero más adelante hablaremos de la detección automática de dime cómo que 6 no estaban 3 ahora porque ha parado pero acuerde que estaba en el 50 por ciento por lo cual no claro a ver es que realmente un hilo lo que va haciendo es pasar de un núcleo a otro con lo cual aunque es el 50 por ciento está usando como tres al cien por ciento entonces vengo aquí digo w 1 w uno vale todo correcto w 1 w uno pero yo simplemente atención mira de lo que hago en la pantalla voy a marcarlo con el código muy bien arrancó el núcleo número 1 y ahora duplicó todo este código y digo arranco el núcleo número 2 w 2 sí va repartiendo palabras y de hecho siempre reparte es algo que ocurre en la capa del sistema operativo si realmente es otro hilo de proceso técnicamente y ya el sistema operativo ya se apañará para saber a qué núcleo del procesador le asigna ese hilo del proceso así que realmente nosotros más que no estamos usando directamente núcleos de procesador estamos abriendo hilos de procesos paralelos y el sistema operativo asigna hilos a exacto y españa entonces ejecuto currante ahora cuidado porque voy a poner por aquí br y digo contenedor núcleo 1 contenedor n 2 para que cada núcleo vaya a hundir diferente así que digo contenedor n 1 contenedor n 2 vale pues está por aquí también lo que podemos hacer verdad es duplicar también este código w 2 aunque de momento no usamos esta parte pero bueno hoy de momento no paramos un worker hoy de momento es porque estás aquí así que lo que estoy haciendo por tanto dejadme que incluso haga sangría por aquí bien lo que ustedes ven por tanto es que arrancó el núcleo número uno y que vaya corriendo arrancó el núcleo número dos y que vaya corriendo pero el núcleo número dos al haber es que es independiente del núcleo número uno de hecho incluso va a haber ligero desfase por tanto guardo recargo y si os fijáis en la pantalla tengo dos núcleos que van corriendo a la misma vez pero lo interesante de esto es que me voy al procesador y ya no tengo el proceso del 50% tengo el procesador al 60% es decir cada vez que estoy usando más núcleos de procesamiento lo divertido en este caso es que puedo repetir este esquema tantas veces como quiera recordad que para este ejercicio y con esto acabo la parte de teoría de hoy arrancó el número al núcleo número 3 arrancó el núcleo número 4 w 3 w3 contenedor 3 w 4 contenedor 4 y por supuesto porque no aunque hoy no lo usamos insisto pero bueno las terminaciones las definimos también para cada uno de los hilos de proceso bien pues con todo este código que tenéis aquí en la pantalla si ahora guardo a cuidado y también me hace falta esto contenedor número 3 contenedor número 4 si ahora guardo y recargo tengo cuatro números que van corriendo no van a ver pero bueno tengo cuatro núcleos que van corriendo y sobre todo lo más interesante es que si me voy al procesador ya prácticamente tengo el procesador al 100% e insisto que no lo tengo al 100% porque estoy en un ordenador de 6 núcleos ejecutando cuatro tareas estuviera un ordenador de cuatro núcleos ejecución de cuatro tareas sí que lo tendría al 100% que estáis en uno de seis sé qué es lo que puedes hacer es hacer seis tareas y comprobar cómo se os pone al 100% vamos a finalizar la parte teórica de la clase de hoy con un repaso de qué es lo que hace exactamente este bloque de código porque insisto el objetivo de esta semana hoy es comprender qué hace este bloque de código para mañana y pasado sacarle algo de partido cuando digo algo de partido no digo de momento cosas súper mega espectaculares pero por lo menos que os vayáis de fin de semana entendiendo cómo funciona el multi núcleo dentro de html5 y javascript bien que hace este código de aquí en primer lugar lo que hace mira vamos a escucharlo de una manera de la siguiente manera autopista una vez muchos carriles tres carriles esa tiene la medianera será posible que la del norte de valencia a ver esta imagen vale mira lo que estoy haciendo realmente aquí en esta parte del código cada vez en esto aquí sí porque así deja de machacar ahora veréis que el procesador en unos segundos dejará de hiperventilar es cuando yo digo el infierno en vida si es que realmente quería decir eso mira empieza a dejar vale pues lo que hago aquí por tanto es arrancó el núcleo número uno w 1 es que yo arranco un carril w 2 es que yo arranco otro carril w 3 es que arrancó un tercer carril y w 4 es que arrancó un cuarto carril hoy todavía hoy son carriles independientes quiere decir que cuando un coche empieza a circular por ese carril no podrá cambiarse de carril pero lo que sí que tengo es que imaginaos lo que descongestiona el tráfico tener cuatro carriles a la vez aunque la gente no se pueda cambiar de carril tú imagínate que todo el mundo fuera por la autopista en un solo carril pues se montaron unas caravanas que te cagas de grandes lo que estoy haciendo es oye no tienes un carril para enviar la información tienes cuatro carriles a la vez bien hasta aquí vale esto no hace nada más eso lo único que hace es abrir un carril pero no lanza ningún coche así que a partir de aquí esto dice oye hay algún coche en la carretera esto lo que hace es escuchar le dice en el carril uno escucha si hay algún coche no hay ningún coche no ver nada pero cuando haya un coche cuando alguien esté circulando por el carril ejecuta me esta función qué hace la función es bueno en el elemento contenedor n 1 en el html que dice carril n 1 en su primer punto html es decir en el documento búscame un elemento que tiene el iii de contenedor n 1 y en su html interno pone los datos del evento los datos del evento es lo que me está devolviendo ese evento como en el caso anterior de ajax exactamente igual lo que te está doliendo currante por qué pues porque curran te devuelve algo porque currante tiene una palabrita mágica que hace toda la magia llamada post message lo que hace un momento en ajax me preguntabas tiene que haber un eco para que se devuelva algo si pues aquí tiene que haber un post meses para que se devuelva algo por tanto aquí lo que estamos haciendo es cada vez que el worker cada vez que el currante que a la vez que en el carril haya un coche y el coche te diga y estoy aquí pues en ese caso ejecuta una función y la función lo que te dice es dentro de ese html vomita a los datos más adelante haremos operaciones pero hay un momento lo único que muchos vomita los datos esto nos lleva evidentemente a la segunda parte de la parte contratante que es currante punto js porque aquí tú dices vale worker 11 meses cuando el walker uno reciba un mensaje pero quien le envía un mensaje pues si el worker uno es currante punto j s currante punto j ese es el que envía un mensaje y currante punto j s la manera que tiene de comunicarse es con el post message yo aquí lo que hago es realizar las operaciones matemáticas que haga falta pero post meses es envió de vuelta pues message es en esa tubería para que te hagas la idea para que te hagas la idea déjame dibujar un gráfico para que tengas la idea mira esto es a ver si con este gráfico lo podéis ver el mejor esto es index.html y esto es currante punto j s entonces en el momento en el que yo hago un worker se establece como una especie de agujero de gusano sabéis lo de einstein o del agujero de gusano en todo eso entre dos dimensiones así habéis visto la peli está interestelar vale pues un poco más o menos vale es como una tubería que se establece entre index 2 y currante entonces aquí el que está esperando es el en meses y aquí el que está enviando es el post message dejadme que la corte porque si no me cabe todo con lo cual index 2 le dice vale currante te empiezas a ejecutar entonces este o meses es como una oreja es una vez y este post message es como un altavoz es como un megáfono placa este post me dice hay algo y el knesset y usted ya está diciendo algo pues cojo lo que me dijeron message y lo pongo en el html pues sigue diciendo cosas porque está en un bucle infinito pero que te digo otra cosa y ahora él me dice a mí me dice otra cosa para después no pasa nada pues la cojo y la vuelvo poner el html siempre que post message diga algo un message lo recoge y lo devuelve en pantalla por lo importante que tengáis es que esta comunicación es continua es constante en el momento en el que yo declaro un worker se abre esa tubería como un agujero negro y lo que hace como un agujero de gusano y lo que hace es comunicar permanentemente estos dos elementos de tal forma que post message no tiene siempre por qué hablar pero un mes set siempre está escuchando realmente bien es un bucle el único que está en bucles de los meses ah claro exacto en ese caso si tengo dos bucles uno en currante y otro que va a funcionar automáticamente que son meses más que un bucle es un evento pero si al final es un bucle internamente hasta ahí entonces esto que hemos hecho hoy es muy abstracto la única misión del día de hoy es comprobar es que podáis ver como sin sufrir demasiado así que al final es mucho código pero es copia de este bloque de aquí y ese código tampoco es tan difícil pues sin sufrir demasiado podéis ejecutar múltiples núcleos claro hoy es un ejercicio bastante abstracto y aunque mañana y pasado intentaremos sacarle partido hacer algún minijuego con esto pero esto fácilmente podréis ver cómo os va a cambiar bastante la manera de programar porque eso quiere decir que todo aquello que vaya a ser repartido en múltiples núcleos ya no podrá estar dentro de la función principal sino que ésta tendrá que estar aislado tendrá que estar encapsulado en forma de una función externa en sí si os fijáis es a lo que poco a poco es muy empujando sin meteros demasiada presión cuando estuvimos viendo el tema de reactualizar en funciones reflectores amos en funciones las sacamos a archivos externos js pues un poco lo que estaba haciendo es preparar la llegada de este momento para que aún así os supondrá un cambio en la manera de pensar pero la metodología de encapsular y externalizar ya la hemos visto antes la diferencia es que antes hacíamos una especie de script src una llamada y ahora vamos a hacer una tubería continua voy a aprovechar para arrojar un poco de luz sobre los deberes este fin de semana pasado sobre la mezcla de diferentes colores y alfaz dentro de una imagen entonces para ello me voy a hacer una nueva carpeta dentro de la anp hp box me voy a hacer una carpeta llamada mezcla canvas en esta carpeta mezcla canvas me voy a hacer un archivo index html porque quiero aislarlo entonces que pillo así que pero ahora arabia con el montón de código de hecho como se llama mezcla canvas y dentro de index.html de hecho voy a abrir el game web entonces es que no quiero mezclar con todo este código quiero hacer lo siguiente vale y eliminado aquí cosas que elimine muchas cosas eliminó muchas cosas muchísimas cosas no sabes qué terminó casi todo ese código así que digo canvas y d lienzo 1 wifi es igual a 300 height es igual a 300 y ya está y le digo style para hacerlo más sencillo todavía border un píxel solid y hasta un píxel a ver si así que el local host y mezcla canvas vale muy mal por mi parte odio abierto que no debe estar pues igual porque no existirá bien y tengo un canvas por aquí ahora corrijo eso ahora quiero tener un lienzo 2 que estará hola canvas sí ok no debería porque sólo quería estar encima si yo realmente lo pongo bien jim webb no existe pero es que eso me da igual de momento pero lo que sí que quiero tener allí es un segundo canvas inspeccionar lienzo uno así claro que siempre canvas la etiqueta se tiene que cerrar ahora sí y ahora hay 22 canvas ahí pero sobre todo y de esto iba los deberes de este fin de semana porque es algo que necesitaremos a la vuelta de vacaciones es esto y de compuesto me creo un tercer dip que antes de guardar la imagen va a componer la imagen así que divide compuesto déjame que with es igual 300 y height es igual a 300 y voy a meter el mismo estilo más que nada para que se mantenga cierta uniformidad así que guarde recargo y tengo tres de tengo tres dips estos dos son los dips originales y este es el que va a hacer la mezcla de colores bien así que ahora metemos un poquito de código y digo lo siguiente script y digo cuando el documento está ready ejecutó una función qué hace lo siguiente vamos a ver ya sabes que se trae out club o carga realmente en dos segundos para dar el tiempo de sobra y digo function carga y hago así muy bien pues está arreglado tuviera como que arreglado me cargó jim webb punto js y digo tibio mira voy a mover todo esto aquí al final para asegurarme que existe digo contexto 1 es igual a lienzo 1 contexto 2 y contexto c 1 contexto 2 es igual a lienzo 2 es feroz efe y dos muy bien y de final es compuesto si queréis voy a llamarlo se compuesto y es contexto con texto compuesto es igual a fe compuesto con m punto contexto estoy cogiendo los contextos ser dado de alta los contextos para los tres canvas a partir de aquí hago lo siguiente un actor una actriz mel gibson vamos a ver mel gibson imágenes joven o no tan joven este pues este mira este que tiene de cara a ver qué hago con el canvas entonces me voy a sham me voy a hp box me voy a buena mezcla canvas digo mail punto jpg y ahora digo vamos a ver en carga ya sabéis qué para mel es igual a new image y digo male src es igual a mail jpg es decir estamos cargando en una variable la imagen de mel gibson bien aquí vale lo que hago por tanto es decirle en contexto 1 punto draw image y digo cargo mel en 0,0 creo recordar vamos a verlo os acordáis me voy a jim webb y digo draw y make por ahí está la por alguna parte m todo correcto vale pues recargo eso todo ha ido bien dentro de dos segundos aparece una orejita de mel gibson moment in a moment in que lo ponga no ponga más pequeño mezcla canvas mel gibson editó con el gimp no puedo pero prefiero que no porque como esto lo he cargado en una variable ya no es javascript y css nos encargamos directamente de ese escalón le digo a ver claro eso pero si 300 por aquí y ahora en imagen tamaño del lienzo hay 300 y centrar reciben sólo así y sobre escribo y aunque parece que no aunque parece que no será recargo tras dos segundos que tengo ahora en ésta no sé dime ya he dicho del actor pues actor o actriz por aquí así que johnny depp está por ejemplo no sé me lo guardo como depp cargo dentro de gimp le digo imagen escalar la imagen tu a y tú sobre escribo y cómo te puedes imaginar ahora lo que voy a hacer es cargar la imagen por tanto le digo bardem es igual a new image de punto ese roce es igual a jpg y tras dos segundos por tanto no he dibujado un dibujo menor ha dibujado madre mía claro que no entonces no la he dibujado le digo contexto 2 lo image en cero y tengo dos capas en este caso tengo dos capas con cada uno de los personajes bien pues lo que quiero ahora es que a continuación y esta es la parte importante del ejercicio a continuación voy a realizar las siguientes operaciones atrapó los píxeles de la imagen atrapó los píxeles de la imagen 2 los mezclo los devuelvo promediados en una nueva imagen esa nueva imagen es la que luego guardaremos en el disco así que por tanto atrapo los píxeles de la imagen 1 pues ya sabéis que me voy a cualquiera de las librerías que hicimos el otro día funciones filtros por ejemplo aclarar mismo entonces digo vamos a ver por pixel es igual a eso de ahí así que ok y esto de aquí atrapó los píxeles de la imagen esto de aquí muy bien el contexto 1 data es un píxel 1 a 1 píxel 1 de atrapar a separarlo del 2 ahora atrapó los píxeles de contexto 2 y ahí estoy guardando en una mega matriz esa matriz tiene todos los componentes de color con lo cual ahora los mezclo recorriendo los píxeles uno a uno por tanto vengo aquí y digo déjame ver hay tan atrás esto data no puede ser para ser data uno o dos pero no data y digo y ahora empieza la fiesta claro vamos a ver claro esa es la cuestión por qué porque quiero hacer lo siguiente tengo que poner preparo la imagen 3 para el destino bar pixel 3 es igual a contexto 3 33 muy bien y dijo vamos a ver déjame que copié esto y atención digo data vamos a ver data tres de iu es igual a data uno de más data dos de iu y todo esto de momento para hacer una primera prueba antes de trabajar con la opacidad partido por dos veámoslo ahora evidentemente bueno alfa voy a decir de momento 255 siempre y ahora digo esto es y más uno esto es y más dos y más 2 y más dos y por último dos cosas vamos a verlo pues mal asunto entonces a contexto compuesto vale pues muy bien este compuesto muy bien 2las a interesantes en este caso se supone sería distinto pero no tampoco mucho más complejo porque si con una pequeña estructura de control puedo averiguar si claro evidentemente sol solito no se va a hacer aquí nada se hace solo un momento que sigo y sigue la magia y luego por último le digo con texto compuesto así que vamos a ver le digo contexto no me habéis dicho contexto compuesto con texto compuesto punto un momento porque es este contexto 2 eso tiene que ser contexto compuesto bien el contexto compuesto por email data de pixel 3 vamos a ver si funciona la primera imagínate qué funciona la primera sería lo más así que vengo aquí me aseguro venga a ver si no da ningún error voy a la consola vale hola estás pensando no estás pensando 90 vale pixel 3 momento porque por aquí hay algo voy a poner un console punto log hasta aquí llegó es haciendo y hasta aquí llego vale en este caso por tanto hay algo por aquí fue compuesto realmente descompuesto con texto compuesto es igual a fue compuesto muy bien visto muy bien alfa y más 41 y más 3 cada tres nada 3 muy bien ahí vamos a probarlo ahora a ver si es eso así que guarde recargo ya tengo la imagen en una primera composición y la verdad es que no esperaba que quedara así la verdad bien en este caso yo lo que estoy haciendo es darle un valor promediado con el mismo peso entre un elemento y otro es decir ahora mismo los dos pesan lo mismo pero yo a continuación lo que voy a hacer es darle un valor promediado que es la segunda parte de la pregunta según lo que me comentaba y según la opacidad de cada una de las imágenes con lo cual si ahora mismo mel gibson y johnny depp están al cien por ciento de capacidad se han mezclado al 50% pero qué es lo que ocurre si por ejemplo johnny depp tiene el 50 por ciento de opacidad es decir si vengo aquí y digo yo ni detiene para citi el 50 por ciento o 0.2 para que quede claro que tiene mucha menos opacidad un momento y ahí están veis pues ahora lo que quiero es decir vale si este canvas tiene menos opacidad que este canvas tiene que tener mucha menos fuerza que este de aquí es lo que os quiero decir vale entonces lo que voy a hacer es lo siguiente me vengo aquí y ya no voy a partir por dos con esta segunda versión del código de hecho dejadme que me lo deje comentado por si luego lo queréis con esta segunda versión del código lo que voy a hacer es promediar en base a su opacidad así que digo lo siguiente atención sí y claro afectados ahora de las obras vamos a ver digo data de y es igual atención adaptada adata 1 perdón de esos 3 datan 1 x déjame piense por y en c-1 punto css o para vivir es decir el color multiplicado por la fuerza de la opacidad la fuerza de la opacidad de recordar que va de 0 a 1 donde uno es opaco 0 es transparente si lo estoy multiplicando por 1 es que lo estoy dejando como estaba pero en el caso de johnny depp más data 2 puntos trata de los puntos por lienzo 2 css o para city que en el caso de johnny depp recordad que es 0.2 es decir que estoy haciendo estoy machacando este valor por 0.2 para eso es lo que estoy haciendo bien y todo esto ahora luego lo puedo dividir de momento no voy a dividir momento dejadme solo sumarlo todo esto ha sido solo para el canal rojo es para el canal verde y ahora para el canal azul y el alfa se queda como está si todo esto ahora ha ido bien a probarlo recargo y si no ha obtenido ningún error recargo esto es extraño ahora te costó un poco más entonces lo que quiero que veáis es que ahora efectivamente se están multiplicando los dos pero johnny depp es a mucho menos si os fijáis mirad si os fijáis mira ahora le digo o para citi vamos a hacer diferentes pruebas voy a tirar esto a un segundo a ver si es suficiente para que cargan las imágenes esto es igual de fuerza y ahora veréis que se suman los dos se suman los dos ahora no porque ahora no he hecho promedio a de hecho suma al promedio momento ahora digo 0.5 0.5 y vais a ver con el resultado no es igual y está pensando está compilando 0.5 y ahora digo 0.1 y veis como la capa de johnny depp poco a poco va desapareciendo a grace pero tres por tanto este es un principio de cuestión lo que estaba ocurriendo ahí es que simplemente estaban sumando claro al sumar no hago promedio para sumar añado píxeles directamente con lo cual ahí si quieres lo que hago mira es que para esto tengo que hacer un promedio hay partidos que partidos no es justo pero vale partidos y partidos ropa ahora va a ingresar la imagen la va a oscurecer tendría que ser ahí que veis la melena se ve la melena de york y de por ahí vale fijaos que le digo 0.2 y ahora veréis un poco mejor es decir estoy consiguiendo en faltaría el partido 2 a solucionar el partido 2 pero estoy consiguiendo que la mezcla sea variable que la mezcla vaya en función de la opacidad por último en este vídeo voy a deciros los siguientes recursos me diréis bueno pues entonces tengo que multiplicar tengo que sumar divido por 2 1 / 2 que es lo que tengo que hacer mi respuesta es hacer lo que os dé la gana porque si yo me voy al game y me voy al photoshop y me voy a cualquier programa de pintura digital veréis que no hay una sola manera de mezclar la información mirad yo cojo a johnny depp y lo pongo encima de mel gibson y veréis que tenéis aquí unos métodos de fusión de capas donde si yo digo suma os acordáis esto que ha salido hace un momento era la aparición de su mar y yo lo que estoy haciendo ahora es bajar la fuerza de su mar pero yo en lugar de sumar puedo decir no quiero multiplicar y me saldría eso veis lo que ha salido con multiplicar os quedáis con lo que ha salido con multiplicar pues ahora vengo aquí y digo sí pues mira ahora no quiero sumar sino que quiero multiplicar y a ver qué pasa multiplicó guarda y recargo y vais a ver no te duermas y vais a ver sí a ver no si el partido 1 es para que se quede como está pero también sí claro vale pero aún así a por paz y si es que la pacifista 02 aparecerá 2 aumenta el valor bueno vale ahí tengo que ver qué ha pasado porque lo que está haciendo es multiplicar ah no un momento que la parta por 255 un segundo en un segundo hay que parar y fijaos que el resultado que aparece ahí al multiplicar únicamente lo tengo que dividir por 255 para compensar es exactamente el mismo resultado que está saliendo aquí al multiplicar en definitiva lo que os quiero decir es que no hay una sola manera buena de resolver esto porque en cualquier programa de edición fotográfica hay muchos métodos diferentes de mezclar los píxeles de una imagen y me da igual francamente la que uséis porque el ejercicio no va de eso el ejercicio va de que consigáis hacer una manera la que más repetir es que suma multiplicación y división promedio por medio entre 3 era igual en 3 álex el primer objetivo del ejercicio del fin de semana es conseguir esto es que 235 canvas en primer lugar se fusionen en un canvas temporal y una vez que tenemos ese canvas temporal ahora sí es cuando mediante ajax lo que comentábamos del método load se saturaba o no y aumentar el servido de todo eso es el contenido de ese canvas que es digamos el resto de todos los demás y guardarlo al disco duro en primer lugar en formato jpg y en segundo lugar en un formato propio que os inventáis de texto un plano pal bueno vamos por tanto con arrays bidimensionales en javascript que son un poco más complejos de declarar que por ejemplo en php que no hay que hacer nada así que mira por ejemplo voy a arrancar el samp creo que al está abierto no me voy a hacer me voy a shaun wright box voy a hacer a raíz de mención alex y voy a hacer un archivo mira para empezar un pequeño repaso esto ya lo sabíamos que es index php index.php por aquí así que el mundo localhost arrays bibi dimensionales con lo cual ahora digo lo siguiente en primer lugar creó este archivo php y digo agenda os acordáis que creo que hicimos este mismo ejemplo digo agenda de 0 es igual a jorge y vivo por ejemplo agenda de 1 es igual a juan esto es una declaración de matrices unida unidimensionales dentro de php la idea está en que para declarar matrices multidimensionales empezando por las bidimensionales en php pues también es muy sencillo porque simplemente vengo aquí le pongo un índice más y ya está declarada una matriz bidimensional así que digo agenda pero de uno es el teléfono por tanto agenda 1 de 0 es juan y agenda uno de uno es el té de fraude juan y de esa manera tan sencilla se declara un array bidimensional y de esta manera tan sencilla se llama al valor de un array bidimensional así que guardo recargo y si digo quiero recuperar el registro 1 sub matriz número 1 recordamos que empieza en cero pues me dice bueno pues esto equivale al teléfono de juan así que aquí en pantalla tienes el teléfono de juan y no hay mayor problema php es mucho más sencillo en este sentido concretó que en javascript pero ahora como se declara en javascript bueno pues en javascript se declara de la siguiente manera voy a crear un nuevo archivo me lo llevo a otra carpeta mientras estáis copiando le digo guardar como me lo guardo en champ htc box arrays bidimensionales voy a guardar esto como index.hr ml 1 php así que digo html http n l y volví así que digo básicamente script escrito y digo bar agenda es igual a new a red con esto ya puedo decir para igualar el ejemplo que tengo a la izquierda ya puedo decir que agenda de 0 es igual a jorge y agenda de uno es igual a juan la cuestión está y ahora por ejemplo por último digo documento puntos raid agenda de uno por ejemplo recargo esto lo quiero ya la otra ventana que supongo ya lo tenéis copiado así que me voy a index.html y me dice juan es decir de dicho documento puntos write agenda de uno y agenda de uno equivale a juan pero qué ocurre si ahora como te pasaba ayer necesito que agenda de cero no tenga sólo un valor sino que a su vez sea un array vale pues la manera de hacerlo es tan sencilla pero poco amigable como esta agenda de cero es igual a nueva red esa es la cuestión esa es la cuestión tampoco amigable pero vale entonces claro y también le puedo decir agenda de uno es igual animal rey porque hay un elemento que puede ser una variable y otro que puede ser una matriz es decir una matriz dentada y por tanto yo ahora digo agenda cero de cero es igual a jorge solo entonces es cuando puedo usar estas matrices bidimensionales y ajena a 0 de 1 es el teléfono de jorge ahora digo agenda 1 de 0 es igual a juan y agenda uno de uno es igual al teléfono de juan cuidado en este caso fijaos porque si devuelvo esto en la pantalla veréis como si ahora recargo me dice juan coma 53 45 es decir estoy devolviendo la agenda de uno y es que agenda de uno a su vez es una matriz con lo cual lo bueno es que precisamente mira esto curiosamente este bueno con respecto a php yo vengo aquí y en php le digo a agenda número uno la vía php y me dice array to string y el digo bella ya sé que es un array pero caray devuelve lo en pantalla en cambio justo en este comportamiento tendría que hacer vomitar variable o algo así justo en este comportamiento javascript se comporta mejor ya que me dices bueno me has dicho que imprime algo en pantalla lo que me has pedido que te imprima en sí es una matriz bueno pues que imprimo todos los elementos de esa matriz y acompañará esto con ellos vale con lo cual declarar matrices multidimensionales en javascript es peor que declararon sen php pero luego por ejemplo llamarlas es mejor y si ahora vivo agenda uno de uno por ejemplo pues sólo me va a devolver el valor correspondiente área así que este es un poco el truco detrás de la declaración de variables multidimensionales dentro de javascript evidentemente eso se puede repetir está el infinito y más allá puedo decirle agenda 0 de 0 es también una raíz y ahí puedo guardar tridimensionales 4 y dimensionales y lo que queráis recuperamos lo que estábamos trabajando de los workers y en el día de hoy el objetivo es sacarle un poco más de partido a los workers vamos a empezar trabajando con múltiples parámetros dentro de estos workers y a partir de aquí trabajaremos un poquito con serialización una vez que hayamos trabajado con múltiples parámetros ya estaremos en condiciones la segunda parte de la parte teórica de la clase de hoy de crear aunque sea un pequeño juego que os permita saber que os permite tener una idea de para qué nos van a servir los workers en la práctica por tanto de esta manera me voy a ir a vamos a ver me voy a ir a una carpeta que voy a llamar workers 2 como el cartón de la venganza efectivamente y nunca mejor dicho porque me voy a index.html lo cargo en la pantalla y lo que voy a hacer ahora es crear un archivo js llamada llamado workers 2 js me voy prácticamente a copiar el código de ayer vamos a verlo un segundo así que miradme en la pantalla me voy a web workers copio index.html necesito también me acuerdo muy bien y méxico que también jquery me voy a currante y no es que no quiero index tos y me voy a copiar todo este código madre mía como lo comentamos ayer así que me copió todo este código permitirme que ya no lo comenté tanto entonces declaró un worker 1 arrancó un solo núcleo eventualmente terminó que es otra cosa que vamos a hacer hoy el núcleo el vigo start worker así que contenedor núcleo 1 hoy me quedo con este pequeño código lo que va a hacer es que en workers 2 le pongo el contenido de currante y lo ejecutó en workers 2 lo que ha hecho de momento es simplemente copiar y pegar todo el contenido tal cual que hice ayer por tanto ahora me voy a localhost me voy a workers 2 dejadme que para este ejercicio esto es workers 2 para este ejercicio eliminó unos cuantos comentarios porque es que los comentarios me obligan a bajar de línea y me machacan un poco el código como los comentarios los tenéis en el ejercicio de ayer veis así el código queda mucho más claro elimino algún espacio en blanco que no me hace nada vale y ahí lo tengo así que guardo y recargo y si todo ha ido bien y no he tenido ningún error que parece que vamos a ver estar worker porque los dos vale porque llama currante muy bien efectivamente así que workers 2 punto ese recargo vale ya y tengo un núcleo funcionando de momento tengo realmente una tarea que el sistema ya irá repartiendo como sea necesario como el ver necesario entre los núcleos bien la idea por tanto aquí está en que hasta ayer voy a cerrar estos hasta ayer estábamos trabajando con un parámetro técnicamente el worker no le envía perdón a el html no le envía nada al worker sino simplemente lo ejecuta que es otra cosa de la cual hablemos más adelante pero sobre todo lo que me importa hoy es que el worker le devuelve un parámetro mediante post message pero la pregunta es en la siguiente parte de la clase de hoy vamos a hacer que por ejemplo en un pequeño paisaje yo pues haya un worker que controle la posición del sol haya otro worker que controle la posición de los pájaros que van volando por el cielo pero el worker el ciclo el bucle de los pájaros no tiene nada que ver con el núcleo del sol son núcleos diferentes y de hecho parte de la gracia de la clase de hoy es que veáis que los núcleos no tienen por qué ir a la misma velocidad sino que el sol puede ir más lento y los pájaros más rápidos y como tienen bucles diferentes no se tocan entre sí entonces ahora luego volveré a esto entonces la idea es claro pero si yo creo un sol yo voy a necesitar tener una posición xy una posición y del sol esos son dos parámetros no es sólo uno pérez que peor todavía si tengo por ahí los pajarillos volando lo que necesito entonces es tener una matriz de objetos que tienen diferentes condiciones entre ellos entonces la idea por tanto está en que en un momento dado en este ejercicio que vamos a hacer hoy probablemente nosotros tenemos que la información vuelva pero vamos a suponer que tenemos que hacer que la información vuelva y por tanto para ello vamos a ver cómo pasar diferentes parámetros vamos a ver la idea de la serialización así que vamos allá dejadme que otra vez quito unos cuantos comentarios porque es que si no el código se hace eterno bien entonces aquí en worker 2 voy a hacer lo siguiente bar déjame que cambie un poco del código bar x es igual a 2 bar y es igual a 2 en lugar de trabajar con la variable y el trabajo con la variable x y con la y ahora dentro del bucle for me quedo el bucle for le digo x por igual a eso y atención y por igual a eso por igual a otra cosa de hecho mirad voy a poner otra fila de números diferentes para que los números no coinciden exactamente para que veáis que hay una independencia clara entre x y pero claro aquí viene el problema y el problema está en que ayer estaba pasando post message de ahí y estaba claro que post meses de mira de infinity esto y estaba claro que pues seis de iu era un valor un parámetro pero es que ahora tengo dos parámetros que pasar así que la idea de la serialización es la idea de la longaniza es que cuando tengo que pasar varios parámetros los meto dentro de una longaniza es decir los átomos empaquetó dentro de un paquete y luego cuando llegan a la otra parte del vaso comunicante tengo que hacer una de serialización es decir si no se ha metido en una longaniza pues luego tengo que cortar la longaniza la idea por tanto va a ser la siguiente y es que pongo pues me 6x más un separador serializador que queráis yo voy a poner el pipe porque me gusta mucho poner el pipe y recordar que el pipe se pone con al xerez y el número uno puede ser una coma claro en este caso no puede ser un punto porque el punto ya ese gustar ya se está usando para decimales del valor alejarse que no place punto puede ser una barra pero como el pipe no se usa para prácticamente nada por eso con joel pipe porque es un valor que se aseguró que no va estar en los valores con esto por tanto yo creo que estoy haciendo es pasar el valor a la siguiente parte pero ahora mirad recargo por aquí y digo que tengo ahí bar beige el pipe por ahí vale pues lo que tengo ahí con el pipe es que lo que estoy pasando es una longaniza el programa no ve ahí los valores de una cadena y por el medio vino de longaniza pero no ve que sean los valores por tanto si en esta parte dejadme que lo parezca bien si por esta parte le estoy enviando los valores serializados por esta parte de aquí tengo que enviar los valores de serializados así que me voy y digo este es el contenedor de la equis br y este es el contenedor de la y lo que voy a hacer por tanto es ser capaz el elemento y le digo mira vamos a ver documento elemental muy bien vale digo datos es igual a event punto data que es datos bueno debería ser una variable más datos quede claro aquí arriba así que ahora lo que voy a hacer a continuación es trocear esos datos como troceamos esos datos me suena explica es un split personas puede pensar un montón de cosas vale split bien entonces partido es igual a datos pero es igual a datos punto split especificando cuál es el carácter de partida el carácter de partida de partido quiero decir es la garra por tanto ahora digo x es igual a partido de cero porque partido se ha convertido en una matriz y es igual a partido de cero claro vamos a ver qué es datos del chorizo que es partido que al principio parece una variable es datos me lo partes usando este valor perdón a partir de ahora copiar y pegar con lo cual partido automáticamente se convierte en una matriz y por tanto ahora puedo decir contenedor x punto texto html me da igual x y en contenedor y me pones el texto de la variable y si todo esto ha funcionado bien tengo aquí los dos valores independientes de la equis y de la y el lo que quiero que veáis es que son diferentes es decir van a ritmos diferentes lo son exactamente iguales así que me diréis cómo se supone que vamos a ver eso en la pantalla pero bueno creo que con un simple vistazo veréis que los valores no son exactamente iguales tienen una ligera diferencia esta es una de las maneras de hecho la preferida para pasar múltiples datos de un worker a al archivo javascript principal es decir la idea aquí es to pass a los realizados y se realiza dos quiere decir en un objeto realizado en este caso una cadena y luego en la otra parte pues ya los partes y los pones cada uno donde tocan por cierto qué vamos a hacer en el siguiente vídeo tengo por aquí preparada la función con la que quiero parar un núcleo de procesamiento así que en la siguiente parte de este primer ejercicio vamos a ver cómo parar núcleos de procesamiento tengo por aquí precisamente déjame que pare esto porque si no el vídeo se ve un poco loco vale vengo por aquí precisamente un stop worker que me permite en un momento dado poder parar una un núcleo así que en este caso voy a hacer lo siguiente por aquí abajo voy a poner un ver me voy a poner un botón llamado para la tarea así que recargo por aquí este es y de parar por tanto ahora lo que necesito es un pequeño comportamiento que me permita especificar cuándo ocurren las cosas por tanto digo lo siguiente cuando sobre parar haga clic quiero ejecutar la función realmente sí puedo llamarle directamente stop por general así que aguardo y recargo bien efectivamente sin paréntesis porque eso es motivo de gran discusión en jquery y sí sí y te digo porque si te digo por qué en jquery cuando tú haces click o cualquier otro evento tu puedes llamar directamente a una función pero no puedes poner los paréntesis entonces guardo aquí fíjate cómo funciona perfectamente habría que verlo w1 no se termina es parar y ahora veremos por qué nos termina vale pero el caso es que algo así y lo que ocurre es que directamente exacto no funciona ya sea algo que tomar pero no 29 no lo que quiero que veáis es que si no pongo paréntesis funciona pero si intentó poner aquí paréntesis entonces recargo y ahí al menos a mí no me funciona es decir jquery no admite que le pongas paréntesis aquí a la función pero sabes que me da igual en este caso particular me da igual porque realmente digo bueno si la función no tiene parámetros pues no pongo los paréntesis como me dice jquery y ya está pero la pregunta es si que tiene parámetros y si que si por ejemplo aquí pongo y wms pues claro al llamar a la función no puedo poner los parámetros y por tanto no me deja poner event para entonces en este caso la función sea la solución perdón es sencilla pero es un poco puntera y es que tengo que poner como ya hemos hecho muchas otras veces function i y meterlo dentro de una función ya está no tiene más pero no permitir que se puedan poner parámetros las llamadas las funciones porque me ahorraría la función no tiene solución pero no se pueden poner no se puede poner funciones e incluso puedo hacer esto fíjate sin parámetros la función y no pasa nada así que bueno vamos a ver entonces por qué a mí no me funciona así me imagino porque me imagino por qué porque vosotros tenéis el script en la parte de bajo del html entonces guarda y recargo le digo para tarea efectivamente ahí separa vale yo podría haber obtenido bien mirad que podría haberlo tenido ok si por lo que fuera si por lo que fuera le dijera cuando documento puntos red y que para eso justo está esa instrucción en ese caso en cápsulas 32 de aquí y por tanto realmente en jquery el poner el documento punto 9 y fíjate que ahora está arriba y me lo para eso equivale eso se hace para no tener que poner el hamas que tiene la parte de abajo pero ahora así si ponéis el javascript y en la parte de abajo porque así que mejor porque así estáis seguros de que sea como sea lo vais a poder cargar bueno pues la idea por tanto es que mediante este estar word que yo puedo empezar este worker y mediante este botón de parar tarea yo lo que puedo hacer es pararlo incluso porque no puedo crear otro botón que me permita reiniciar la tarea y le digo arrancar con lo cual les digo cuando sobre arrancar haga clic ejecutamos la función start worker y esto me permite por tanto en un momento dado poder parar la tarea y poder arrancar la tarea para tarea arranco tarea y por tanto comprobamos mirad terminator fund i find bien empleado sobre dos veces al mismo botón pero eso me permite por tanto mirar fijaos estoy usando el 44% pues ahora digo para la tarea y fijaos cómo cae el rendimiento lo veis ahora le digo arrancar tarea y vuelve la tarea a arrancar y ahora digo para la tarea y la tarea vuelve a parar y el navegador el procesador quería decir se vuelve a liberar en definitiva por tanto vemos como cuanto más tiempo pasa con no demasiada dificultad más pues tenemos control sobre la ejecución de los hilos y podemos pararlo si podemos arrancar los y podemos hacer lo que queramos con ellos nos quedan muchas cosas más que aprender nos queda comunicación entre hilos esos hilos son independientes nos quedan ser hilos sincrónicos hilos que se sincronizan entre sí nos queda pasar información por de momento vamos a empezar haciendo un ejercicio para que podáis comprobar cuál podría ser un uso fácil de estos procesos dentro de un pequeño juego voy a hacer un pequeño juego con workers realmente va a ser un juego mucho rapero es un juego pensado para demostrar la utilidad de los workers así que voy a crear una carpeta llamada juego workers dentro de la carpeta juego workers mirad voy a como os decía antes voy a hacer un index html y voy a hacer un sol punto javascript voy a hacer un pájaro punto javascript y voy a hacer y no sé qué haré por bajo no algo que se mueva animalitos y vacas por ejemplo algo así vacas punto j s una más vino porque quiero variar pues conejito mira lo de conejitos me ha gustado pues conejitos los conejitos punto j s y con esto así ya de entrada os imaginaréis qué va a hacer cada uno de los archivos javascript en hp box de hecho mirad también me en workers 2 me copió jquery en lo necesito así que juego workers y por tanto ahora empiezo a trabajar con los elementos y dentro de index e.html atención me voy a hacer una serie de canvas vamos a ver esto fuera de momento ahora lo volverá a crear y digo quiero un canvas uno primero que se ha ido fondo otro canvas que sea conejitos no tienen por qué tener el mismo nombre que el archivo javascript pero si lo tienen pues mejor porque así sabemos qué archivo javascript va a ir en cada canvas me voy a hacer un archivo llamado pájaros punto nada iré por cierto no quiere decir que varios archivos jota es en varios núcleos no pueden escribir el mismo canvas tienen que escribir en canvas separados no quiere decir eso pero hoy por sencillez por simplicidad vamos a hacerlo así con esta primera aplicación de unos workers a un juego vamos a hacerlo sencillo así que me hago un pequeño estilo y en ese pequeño estilo le digo todo aquello que sea canvas quiero que tenga un borde de un píxel solid black simplemente para verlo a por cierto en los que ambas no hace falta un width de 300 un height de 300 vamos a infinito así que copio y pego y hago que todos los canvas tengan exactamente la misma vamos a ver la misma dimensión ahí tenemos los cuatro canvas pero claro además de todo esto yo querría que todos los que ambas estén en el mismo sitio por tanto pongo posición absoluta pero píxeles left 0 píxeles así que guarde y recargo y ahora parece que no pero los 4 canvas están ahí metidos dentro de uno para que al final digamos nuestro usuario final sólo vea un canvas no ve a diferentes canvas voy a dibujar me un fondo mira perfecto fantástico maravilloso pues no sé este mismo para qué más bueno es grande y bonito y todo es grande por tanto lo voy a hacer pequeño con el gimp que para eso sabemos el gimp entonces equipo no ht docs juego workers y yo llamo fondo así que de fondo ahora lo que hago es que me lo editó con el gym y bueno lo voy a pasar no voy a pasar a 300 de altura y luego con un poquito de tamaño lienzo lo paso a 300 me quedo con el arbolito le digo redimensionar y lo sobre escribo y ya lo tengo sobre escrito por tanto mirad fijaos empiezo por aquí y le digo en script le digo cuando el documento punto 9 ejecuta una función que dice se time out me ejecutas carga dentro de un segundo y la función carga lo que va a hacer es simplemente dibujar la imagen por tanto ahora digo para fondo es igual a new image y digo fondo punto src es igual a fondo punto jpg con lo cual claro ahora me hace falta el contexto y digo por tanto ce es igual a documento de elemento by heidi y el y de ese fondo para decirle con texto fondo es igual a efe punto get contexto 2 d habré hecho algo mal pues yo creo que sí document.getelementbyid en la y es mayúsculas vale que te contexto finul muy bien qué es esto efe punto que contexto vamos a verlo cualquier otro proyecto pues no sé el perfil a peters por ejemplo get context document.getelementbyid bar es lo único que se me ocurre muy bien a ver y de fondo qué elemento bay sí bueno claro a ver es que no existe realmente es elemento todavía así que pongo el javascript bajo y así me aseguro el correcto funcionamiento bien pues ahora le digo que con texto fondo punto raw image y digo quiero dibujar la imagen de fondo en 00 y si todo va bien en un segundo se me pone la imagen de fondo en el canvas y no tiene mucho más misterio no tiene mucho más misterio desde el punto de vista de que yo realmente madre mía qué espectáculo entonces desde que concierto desde el punto de vista de que yo realmente el fondo no quiero que se dibuje x veces por segundo por eso al fondo ni siquiera le he puesto un archivo javascript sino que digo tú te cargas una vez y ya está el resto de elementos son el que los que se van a cargar poco a lo largo del tiempo a continuación voy a trabajar con un worker que maneje el sol por tanto bueno en primer lugar algo sencillito verdad voy a ir al gym voy a crear una imagen de 32 x 32 es decir una imagen pequeñita ahora le quitaré el fondo y simplemente lo que quiero pues mirad esto realmente me podría servir con un toque de brocha ya lo tendría entonces no tan grande tampoco tan pequeño caray pues digo 30 él le pintó un color amarillo estoy usando la brocha le pintó color amarillo hago un toque más para crecer unos cuantos más y hago un sol también puedo el lápiz también te digo y hago placas y un sol es lo que quiero es tener una imagen digamos ahí me tira de color amarillo un círculo con fondo transparente ahora lo que hago es que me voy a exportar como y esto me lo exportó en fe camps en juego yo me lo guardo como sol punto png los de png es importante para que mantenga la transparencia por tanto yo ahora diría pues mira bar sol es igual a new image y digo solo punto src es igual a sol punto png con lo cual ahora claro cuidado tengo que decir pues bar fe sol es igual a document.getelementbyid sol y le digo contexto sol es igual acceso el punto 2 d con lo cual al final le digo con texto sol punto drouin age es igual a dibujarse el sol en 1010 por ejemplo así que guarde y recargo y tras un segundo pues aparece black el sol o he metido por ahí en la imagen pero claro eso no es lo que realmente quiero así que no ocupe no cambies demasiado porque lo que quiero realmente es que el sol toda la definición del sol esté metida en el worker así que para que esté metido en el worker mirad voy a hacer lo siguiente me abro la persona me abro juego workers aquí me abro el archivo sol punto j s en el archivos o el punto j s voy a hacer lo siguiente en el archivo sólo esté fuera solo el punto j s le digo declaró la imagen del sol declaro la imagen del sol declaro el contexto del sol a todo el pack del sol y por último le digo contexto sol draw email ahora los nombres de los contextos podrían duplicarse porque es tener una estación dependiente pero bueno tampoco es nada costumbre que no se solapen entonces claro si ahora recargo os dejo sólo se hará recargo pues evidentemente el sol no aparece porque no he arrancado el worker tengo que arrancar el worker así que por tanto cuando esto ocurre mirado segundo cuando esto ocurre la verdad es que podría cargar la imagen sabes a ver qué pasa vamos a ver le digo aquí bar worker 1 esto lo pongo aquí para worker 1 y aquí abajo digo 91 bentín hay un segundo start worker ahí estás start worker y lo pongo aquí vamos a verlo con meses nada función event nada vale no perdón ha perdonado he hecho mal al llevarme el sol disculpadme todo esto lo dejo dónde estaba y todo esto kilómetro aquí eso muy bien vamos a ver vamos a verlo creó un worker creo el sol eso está como estaba el sol realmente ahora no se ha quedado nada de código y lo que voy a hacer en este caso realmente cuando el worker devuelva un mensaje dibujo el sol vamos a verlo y ahora en un momento haremos que el worker devuelva algo y en el worker voy a decir post me 6 vamos a verlo ahora vale deberías haber arrancado y si no es para esperar si aparte porque estaba estábamos viendo estaba llamando a otro worker entonces no no a ver en principio debería devolverle algo vamos a ver sobre el punto j s dos meses la verdad que sí que es hola ahora sí bueno sigue sin arrancar pero ahora arrancar vale entonces voy a devolver post message todo está correcto sí vale pues may 6 de hola así que digo con soul punto log d mi mente vamos a ver la consola vale no me dice nada muy bien pues sí señor correcto me sigue sin decir nada pero no pasa nada preocupes porque voy a decir function repite z y más de un bucle básicamente repite 50.000 segundos post message lo pongo aquí dentro y ejecutó repite para que entre el bucle vamos a verlo vale vamos a ver estoy trabajando en juego workers estoy en el punto j s estoy en carga aclaró muy bien fantástico este function porque es estar worker va aquí fuera y tengo que llamar a star worker efectivamente así que guarde y recargo y ahora si tenemos el sol y vamos viendo hola hola mucho bien vamos allá con lo cual de hecho me va dibujando una y otra vez el sol vale con lo cual yo ahora vengo y digo pues mira la posición del sol va a venir definida por lo siguiente bar x es igual a 0 y es igual a cero realmente y la piel así que digo cada vez que pases por aquí x + + a x le sumas un valor así que el post message es x más separador más y aunque no use la y de momento pero quiero que pase a la otra parte así que si todo va bien le digo como antes x es igual a event punto data 12 clip por este carácter del número 0 y eso es lo que he hecho antes pero resumido y es el número uno déjame que ponga x por ejemplo así que aguarda y recargo y fijaos como x va subiendo a lo que he hecho ahí básicamente se realizar recordáis que antes me dan un segundo antes he dicho datos es igual a event punto data partido es igual a 2 punto split y x es igual a partir de cero pues aquí lo que he hecho es todo eso en una única línea es el punto data punto split de cero que es cómo hacer todo lo de antes pero en una sola línea fijaos que hay el sol poco a poco va cambiando así que yo ahora vengo y digo vale pues esto es equis y esto es y claro sí es decir / crees que js quieres vale pues mira un momento muy recargando fijaos como el sol se va moviendo porque vas tirando con un pincel ahora le ponemos un clear exacto pero de momento aunque el que pinta sea el archivo principal lo que quiero es que penséis es que el movimiento del sol está metido en un núcleo en un hilo aparte va a su bola efectivamente hasta ahora tenemos un pequeño sol donde bueno en principio debería verdad borrarse así que cada vez que me envíes algo yo le digo contexto sol punto clear rect y te digo que va desde cero punto cero hasta trescientos 300 así que aguarde y recargo y ahora veréis como el sol se va moviendo de posición y cada vez que se envía pues se guarda pero la idea está en que no está haciendo un clear rect cada equis veces por segundo en este caso serían dos veces por segundo sino que está haciendo un clic recto cuando el worker le pasa información que luego el walker tiene un bucle vale fantástico por él pero solo está enviando información cuando el worker envía información al archivo principal ahora la cosa se ha complicado un poco porque no porque voy a crear primero un conejito votando por ahí abajo y luego x conejitos en una matriz el tema de el conejito me parece bien más que nada por el movimiento parabólico así que lo que voy a hacer es lo siguiente me voy a ir a vamos a ver al archivo conejitos punto j s conejitos js y hago lo siguiente vamos a rabbit por ejemplo rápido hoy mira qué bonito rabbit icon fantástico es increíble entonces cojo este icono dime que tiene transparencia no tiene transparencia a mirar si es creativo bueno me vale me sirve así que y ccoo sí no el primero de todos vale sí venga también así que me guardo la imagen como conejito jpg quería decir la abro en el gimp y dejadme bajarla a 32 por 32 el tamaño que queráis en definitiva pero no porque ahora verás que habrá muchos al final parece que no pero palabras bien entonces en el código principal pues le digo vamos a ver aquí le digo var con egipto es igual a new image así que conejito src es igual a conejito pm g con lo cual le voy a decir de momento simplemente para que lo veáis le voy a decir con texto fondo es igual a no contexto perdona así que digo bar fue conejo es igual a document.getelementbyid conejitos y le digo contexto conejitos es igual a de conejo punto get contexto ahora sí puedo decir en contexto conejitos draw image conejito en 00 y ya lo sabemos creo que lo tenemos ahí lo tenéis bien y guardo y recargo vamos a verlo y aparece un conejito ahí claro allí está un poco alto está en el cielo así que vamos a decirle en este caso que conejito no está en 00 sino que está aquí en 150 y en 270 por ejemplo vamos a verlo a igual está un poco bajo si está un poco bajo vamos a poner 200 150 200 bien ahí está perfecto calidad lo que quiero ahora por tanto es que el conejito por ejemplo primero voy a hacer que vaya corriendo por la pantalla y luego haré que vaya dando saltos por la pantalla pero lo importante lo que quiero que entendáis lo importante de esta parte del ejercicio es que veáis que el conejo se va a poder ejecutar a una tasa de fotogramas por segundo por ejemplo 25 y el sol se va a ejecutar a dos fotogramas por segundo y no pasa nada y es correcto es decir la idea de cuándo el worker me devuelva resultado es que antes de tener workers si yo hacía esto mismo sin workers no era ya que estaba atado a un solo núcleo ese es un problema eso es cierto el otro problema es que digo si el conejito tiene que ir a 25 fotogramas por segundo el juego tiene que ir enfoque a 25 fotogramas por segundo entonces es una tontería preguntarle al sol 25 veces por segundo sol dónde estás porque se va a mover muy lento por tanto no era solo que estábamos atrapados en un solo núcleo sino que estábamos haciendo preguntas a los elementos del juego que realmente sobraban que podíamos hacer queríamos hacer muchas menos preguntas pero no podíamos ahora sí que podemos la idea no es solo ejecutar múltiples hilos de procesado la idea es que cada hilo de procesado puede ir a su ritmo porque es independiente del resto de hilos vamos allá para ello por tanto le digo arranco el núcleo número 2 el núcleo número uno es el sol el núcleo número dos es el conejo y digo w 2 es igual a new worker conejito punto j s conejitos punto js worker 2 m 6 bueno si realmente contexto conejito punto correcto y digo x es igual a ibn data lo que sea esto es igual inclina estas hay también muy bien entonces contexto conejitos draw image y dibujo el conejito en x 6 y el consuelo luego ya me lo puedo ahorrar porque ya veo que funciona claro qué hago ahora pues lo que hago ahora es que todo el código de sol lo pongo en conejitos y le digo a atención x es igual a 300 y es igual a 200 habíamos dicho y la función repite lo que hace es que y menos de perdón x menos el sol va a la derecha el conejito más a la izquierda así que simplemente he copiado el código hecho dos pequeñas modificaciones con lo cual ahora lo que voy a hacer es lo siguiente lo que voy a hacer es en index.html vamos a verlo quiero estar worker a conejitos se refresca cada 50 milisegundos es importante se refresca 20 veces por segundo y creo que ya no no sí es correcto así que si todo ha ido bien no lo guardo y recargo y fijaos que el conejito se va deslizando por la pantalla pero lo que quiero que veáis es que el conejito va a 20 fotogramas por segundo pero el sol va a dos fotogramas por segundo y no pasa nada porque ahora cada uno de los workers es independiente y además lo que pasa es que este juego ahora mismo es muy ligero y no se nota nada pero además internamente aunque no note ninguna diferencia porque ya os digo de momento este juego no consume prácticamente cpu pero cada uno de los elementos va en un hilo diferente cada uno del sol y el conejito va en un hilo diferente ahí no se verá nada porque chrome en este caso ya te digo tiene unos cuantos hilos de proceso mirando un segundo cierro y a ver si se cierran hilos y los cerrados cada vez que se quedan y los abiertos pero con nada veis cómo tengo un 0 0 vale pues habrá ejecutó de nuevo el juego fijaos que no se ve mucho como uno está al 1% el otro está a uno y el resto se quedan quietos esperando a más kilos pero la idea es que uno de estos es el sol y otro es el conejito y no pasa nada y van a distintas alturas antes de ponernos a hacer que el conejito salte vamos a lo que sería una parte a ver compleja este ejercicio que sería hacer una matriz de conejitos así que ay pues vive no no vamos a ver te cuento pueden ser las dos cosas pueden ser más workers o dentro del mismo worker una matriz y eso vosotros mismos tenéis que decidirlo depende como sea el juego si yo digo pues bueno realmente lo que quiero es tener un sol tener unos como tendría yo un grupo de conejitos y tener unos pájaros que digo es que realmente tengo tres núcleos más otros núcleos que destinaría para otras cosas pues realmente puedo meter a todos los conejitos en un núcleo ya está porque depende lo que voy a hacer digo es que igual tengo 10 conejitos un solo núcleo me da perfectamente para calcularlos pero claro imagínate por imaginarnos que tengo 100 núcleos de procesamiento y meto a mil conejitos en un núcleo tengo 100 núcleos de procesamiento imaginaos que tengo un procesador de 100 núcleos y meto a los 100 conejitos a los 1000 conejitos en un núcleo estoy perdiendo tiempo estoy perdiendo recursos ahí en este caso no tendría que hacer tantos workers como conejitos es exactamente eso es porque el sistema lo que va haciendo es organizar repartir los workers entre los núcleos de procesos reales vamos a ver tu reparte es un worker y lo que hace es que a ese worker se le asigna un hilo de procesamiento pero ese hilo de procesamiento el sistema operativo lo puede cambiar de núcleo tantas veces como quiera y nosotros tengo que decir que en javascript no podemos ejercer control sobre eso por ser javascript un lenguaje de tan alto nivel encapsulado dentro de un navegador que trabajáramos no te digo ya en temas más fino ence al más bajo nivel prácticamente que pudieras humanamente ahí sí que podríamos controlar el cero yo quiero este núcleo y no te vayas de este núcleo vale pero en javascript lo gestione sistema operativo vive de núcleo pero es que da igual es decir muy probablemente el claro no no si soy 6 y los va a mover de núcleo y no pasa nada te cuento ten en cuenta que todo esto si quieres es gracias a la capacidad de gestión multi núcleo de windows o de mac o de linux o de android el sistema operativo que sea entonces eso por ejemplo en los años donde empezaron a salir los primeros procesadores multinúcleo eso era un problema porque como salieron los primeros procesadores multinúcleo para pc y en los sistemas operativos ya no estaban muy preparados así que notaba que cuando un sistema el sistema tenía que cambiar un proceso de núcleo se podía quedar un segundo descolgado pero quince años después de eso tranquilo que no lo vas a notar para que los temas operativos ya son bastante eficientes en ese tipo de cosas como para que no lo notes vale entonces yo me acuerdo en aquel momento en 2001 2002 que yo por ejemplo igual estaba trabajando no te digo en vender porque en aquellos años de vender no hacia prácticamente nada pero entre el estudio y a la vez usaban os acordáis del winamp para escuchar música en el pc entonces me acuerdo que exacto me acuerdo que igual estaba con windows xp apeló sin service pack 1 y de repente estaba entre el estudio coge un objeto lo rota va hacia órbita y el williams se paraba esto es a para la música entonces soltaba el objeto y la música continuaba y yo que entonces volvía a rotar el objeto y la música paraba porque el sistema operativo todavía no gestionaba bien múltiples núcleos multitarea múltiples tareas eso me pasa a mí y al resto del mundo a todo el mundo igual pasaban cosas peores con lo cual como te puedes imaginar el windows xp service pack 1 sp1 lo primero que hizo es corregir eso y mágicamente estaba service pack 1 y a partir de ahí y apoyo descuida de música y trabajando programas de diseño y todo a la vez y no pasaba nada mientras eran actividades mucho al equipo evidentemente cuando me tienes algo muy cañero la música se paraba pero no porque el programa del sistema nativo no supiera gestionar núcleo sino porque no daba de sí al expreso ya era otro problema al global por esto digo que 15 años después no pasa solucionado el puede rotar ya sea música a la vez es un personaje que parece que no pero ella trabajaba siempre con música puesta con lo cual el rotar un objeto y en poder escuchar música era importante para mí claro bien pues vamos allá con matrices bueno pues si empezamos a trabajar con salinización tenemos que empezar a trabajar con matrices también si por tierra no hay movimiento bien entonces nos vamos a conejitos y dentro de conejitos yo realmente no quiero solo una equis una y quiero una serie de elementos quiero una matriz así que mirad madre mía esto se va a complicar en conejitos digo bar x es igual a new wave y es igual a mi rey y por tanto ahora digo lo siguiente ya sabéis que x cuántos conejitos vamos a perder con diez algo sencillo for bar claro formar y es igual a cero y es menor que once y más realmente es tendría que ser igual a uno y esto es menor o igual que 10 y así lo tenemos más claro el código y digo x de y es igual a lo que queráis a más random a ver espero menos más punto random bueno ahora lo cambiamos y digo y day es igual a 200 más punto random por 20 un ambiente esto define las posiciones iniciales de los conejitos así que yo ahora vengo aquí y digo x cuidado ahí fort ve es igual a cero es menor que x lento ve más le digo x debe menos vive me ha gustado correcto de hecho entonces tiene que ser menor o igual creo bueno voy a dejarlo en menor a ver qué pasa momento vale así que ahora vengo a abrir ahí viene la complicación porque ahora tengo que formatear ahora tengo que se realizar una longaniza así que digo exacto claro longaniza es igual a nada o sea arrancó una longaniza al inicio la longaniza claro y digo por lo mismo me encantan los foros los esfuerzos nuestros amigos sí pero déjame un segundo importante claro y luego ya lo sabes más eficiente y le digo longaniza más igual o sea le encadenó un separador no al final le digo esto es x bebé más un separador más y bebé más un separador no voy a poner otro separador el separador va a ser esta barra exacto parejas de efectivamente bueno eso es un embutido realmente es un conjunto de localidades anteriores efectivamente bien pues ahora lo que quiero es evidentemente la longaniza la meto en el post message así que bueno si lo voy a repetir cada signo cada a cada medio segundo así que si todo va bien me vengo aquí a index.html dejadme que me lo separe para poder copiar y ahora si le digo bueno esto no vale ya está normalidad y le digo con sol event punto data para ver qué viene pero quiero ver que viene así que por tanto ahora guardo y recargo me voy a la consola y en la consola viene en primer momento me dice longaniza no está definido pero a partir de ahí que me estás diciendo por aquí a con sólo el punto 2 x vale esto fuera long and insights notifight qué interesante al organiza el organiza es que no eslogan hizo es longaniza ahora sí así que guardo y recargo y mirad lo que me devuelve longaniza fijaos cómo me devuelve las posiciones en x y en y de cada uno de los 10 conejitos bien con lo cual este es el dato serializado ahora lo tengo que desee realizar ahora lo tengo que partir para poder usarlo dentro del archivo index html tranquilos que acabamos esto y por hoy ya está entonces me vengo aquí y de se realizó calma y nadie pensando pájaros los grandes abandonados entonces le digo contexto conejitos esos sitios dejó como antes contexto conejitos clear recta para la claro digo empreser y alisado es igual a event punto data punto split en qué carácter en esa idea y recordáis que la barra es el que separa parejas vale y ahora digo componentes realmente no realmente esto me da igual vale y ahora digo four marte es igual a 1 va a hacer t es menor qué de serializado punto leen temas más se va a recorrer cada uno de los valores pues le digo no hay nada seguro aquí hasta que no se compruebe que funciona al contexto conejitos punto drogba y digo quiero dibujar el conejito en espera quentin en de serializado punto split por el vertical de 0 así sea sin anestesia y ahora esto es lo mismo eso se supone que es la equis ahora veremos si es cierto o no y ya está vamos a verlo no ven team creo que ya a ver si funciona primera imagen es que cuando la primera así que guarde recargo si tiene pinta de hambre verá a multi conejos efectivamente vamos a repartir nos un poco más por el entorno así que con egipto claros están en 590 y 99 esto es 300 más 100% a ver momento ah no es que claro es 200 es que están bajo de la pantalla y efectivamente el saco y ahora efectivamente los verdes más rápidos pakapaka pagaré los conejos tal pero es que esperar pero que espera porque le digo por qué le digo esto menos igual a más random por dos es decir lo que quiero es que ahora cada uno de los conejos tenga una velocidad diferente es una carrera de conejos efectivamente entonces lo que quiero que veáis ahí al final es que los conejos están metidos dentro de un núcleo de procesamiento y el sol está metido dentro del tronco del procesamiento y los pájaros tendrán otro núcleo de procesamiento diferente la idea por tanto ahora mirad es que tengamos cuidado porque tanto en sol como en conejitos estamos usando un bucle un poco descontrolado y si usamos un bucle un poco descontrolado aunque lo hagamos en un worker se puede colgar el navegador por tanto esto simplemente requiere que digamos bar temporizador como ya sabemos hacer es igual a nada así que se time out temporizador es igual acepta y out repite no sé en un segundo algo así lo que queráis o en 50 milisegundos me da igual y ahora digo clear time out de temporizador y temporizador es igual a refresca el temporizador es el mismo bucle que teníamos pero estamos reiniciando los cronómetros cada vez que pasamos por el bucle por tanto eso quiero que lo pongáis tanto en sólo el punto js como en conejitos punto j s función repite para que estando en un bucle no se os pueda colgar todo el navegador porque uno de los cielos de proceso se haya colgado así que bueno el ejemplo que expuse ayer pues el bucle estaba a lo bestia pero la idea es que lo pongamos bien puesto con una declaración de temporizador con un borrar temporizador con un volver a arrancar temporizador para asegurarnos que el juego funcione correctamente vamos a verlo así si esto fuera sólo puede haber un 7mo y lo tenemos hasta ahora con los workers hemos trabajado con la comunicación en una dirección si queréis la dirección más importante pero en una sola dirección hasta ahora nosotros hemos sido capaces desde el archivo html principal de arrancar un worker de hacer que ese worker funcionará y de que por supuesto ese worker nos pudiera devolver datos pero hasta ahora no hemos sido capaces de conseguir arrancar un worker y pasarle datos de inicio hasta ahora lo único que podíamos hacer era arrancar un worker pero los datos estaban en ese worker de inicio lo que queremos hoy por tanto es establecer una comunicación bidireccional en primer lugar tanto tal que el worker le podamos enviar información de inicio del archivo principal y por supuesto el walker nos pueda dar información de vuelta así que para ello bueno en primer lugar por supuesto voy a arrancar el samp me voy a crear una nueva carpeta dentro de sant dentro de ht docs me voy a crear una carpeta llamada en este caso pues workers con comunicación de workers y dentro de workers com voy a hacer un archivo index html y voy a hacer por supuesto un archivo llamado worker js y voy a copiar la juego workers por ejemplo voy a copiar el archivo a ver workers com aquí el archivo jquery js tras lo cual pues bueno el cargo en el editor los archivos el index punto html y el walker punto j s y en el navegador pongo localhost y barra workers com que evidentemente ahora me da nada en la pantalla pero recargo y compruebo cómo me dice hola bien pues creamos un pequeño archivo html que tiene un jefe y que tiene un móvil porque yo antes había puesto a volar pero ahora lo es borrado así que si quieres pongo aquí si hay escritura en el indec se haya refrescado para ver que salía así que script y digo src es igual a jquery js y al final del body vamos a poner otro script así que digo aquí vive y de contenedor mismo algo sencillo para recibir datos y aquí un script dónde va a ocurrir todo por tanto aquí arriba digo document punto 9 función inicio y bueno arriba del script digo bar w1 de momento ahora el worker 1 es igual a new worker este código básicamente es igual o muy parecido al quisiéramos ayer por ejemplo pues workers 2 me voy a index html y digo bar aquí bar w 1 y pues bueno vamos a ver digo w 1 es igual a new worker voy a meter lo hay llamó a worker punto j s es decir llamo al archivo correcto que estoy usando hoy la idea por tanto es que dentro de worker js voy a hacer lo siguiente a ver moment in y voy a decirle por mes hecho aquí está digo con meses le digo en contenedor esto fuera le digo text event punto data es decir esto básicamente arrancó un worker que es este archivo worker de aquí y le dice cuando el worker 1 tv un mensaje que devuelve un mensaje pues pone el mensaje del evento en el contenedor ya está mira a ver qué te dice y por lo que te diga lo pones en el contenedor de la misma manera dejadme que ponga el worker aquí para que podáis seguir copiando de la misma manera para que voy ahí de la misma manera en worker punto j s simplemente para hacer el ejercicio lo más sencillo que sea posible pues voy a decir post message y te voy a decir hola qué pasa que has arrancado un worker y él worker te tiene que devolver algo pues lo cual quiere decir hola ya está lo más sencillo que sea posible pongo un poco para atrás guardamos y ya está nuestro walker dice simplemente eso hola ahora por tanto lo que quiero es ejecutar esto y ver un poco qué ocurre así que me voy aquí aclaró pone hola digo hola desde el worker o sea que nos confundamos con él o la de antes y éste hola afuera así que vengo aquí y pone hola desde el worker entonces lo que estaba ocurriendo aquí es que fíjate como estoy arrancando un worker que está en worker js y le estoy diciendo cuando el worker tiene un mensaje simplemente en el contenedor pone el texto del mensaje tal cual venga así que lo único que dice el worker es simplemente porque no calcula es la devuelve un mensaje que dice hola desde el worker esto es lo que teníamos hasta ahora somos capaces de arrancar un worker y de recibir información de ese hilo de esa tarea pero lo que vamos a aprender ahora es a ser capaces también a enviar información en la otra dirección decirle oye worker arranca pero no te inventes la información arranca con esta información de partida que yo te voy a dar la buena noticia es que para establecer una comunicación bidireccional no tenemos que hacer mucho más es decir no tenemos que aprender mucho más con respecto a lo que ya sabemos así que simplemente cuando worker envía un mensaje dice post message por qué porque a quién le puede enviar un mensaje el worker pues de momento a nadie más que al archivo principal que le ha llamado pero sin embargo en index.html no puedo decir directamente post message por qué pues porque yo ahora mismo tengo un núcleo de procesamiento pero si tengo 6 tendría que decirle a qué tarea le estoy enviando ese mensaje así que esto va a ser muy sencillo w 1 punto post message si tengo el worker w 1 pues le digo a ese worker concreto y no a cualquier otro le quiero enviar un mensaje y el mensaje que le voy a enviar es esta sabes que le voy a decir juan por tanto ahora en el worker principal voy a crear un post message pero lo voy a meter en un mes hecho cuando el worker reciba un mensaje que tiene un evento entonces va a decir todo esto de aquí hola y bent punto data coma te saludo desde el worker ella no tiene mucho más la única diferencia lo único que tenéis que aprender que tampoco es tanto es que en post message no hace falta poner a quien te refieres con ese post meses porque sólo te puede referir de momento al archivo principal y el message por cierto en message creo que va con la m mayúscula espera que te lo digo no funciona bien por qué lazio que es la sintaxis déjame si es mayúscula la sintaxis que se va a hacer entonces y ojalá hubiera participado yo en el desarrollo pero que en post message la m es mayúscula en una mezcla tura cam el case pero sin embargo la función es todo minúscula cuando la lógica debería decir que si en pocos meses la m es mayúscula pues en un mes es la m debería ser mayúscula pero yo que sé la lógica dice que estaría bien que fuera así pero resulta que no entonces si ejecutó este código mira recargo vamos a verlo bien vamos a ver qué dice el error un momentín que dice el error dice unexpected toquen en el worker en la línea 1 en message event déjame que mire la chuleta que tengo preparada ah caray si es una función con message es igual a function y ven probado ahora así que recargo y ahora sí después de poner esa función dice hola juan te saludo desde el worker la cuestión es que el worker no sabe a quién tiene que saludar por tanto el worker lo que hace es recibir información del archivo principal gracias a esa función en message y por tanto lo que hace es decir vale pues cojo lo que tú me has enviado que es juan le añado texto de saludo y te lo devuelvo el archivo principal por tanto con este ejercicio tan tonto y tan sencillo ya somos capaces de enviarle información al worker y recibir información del worker para que nos puede servir esto pues por ejemplo ayer con los ejercicios el ejercicio del sol y los conejitos teníamos que realmente el walker de los conejitos iba a su rollo es decir le gusta ir de los conejitos definía a los conejos del principio hasta el final pero si yo quiero crear un worker en el cual le digo no conejo no existe entonces yo te voy a pasar un conejo y te va a pasar la posición inicial de ese conejo esto es simplemente para solá con la posición de calcula es una posición me la devuelve y ya está y se acaba el worker hay claro que es un worker que requiere que tú le des la información inicial no que se la inventé desde el principio vale por tanto veréis que hoy de momento somos de este ejercicio abstracto pero no tardaremos mucho en encontrarle mucha utilidad a la información bidireccional a un worker poder enviarle y poder recibir curiosamente vamos a ver voy al archivo index.html y vamos a ver cómo que javascript detecte el número de núcleos que hay disponibles en este ordenador es más sencillo de lo que en un principio puede parecer y esto es muy importante porque no es algo que cabría esperar de javascript por ejemplo si yo trabajo con temas más yo sé que no tengo un intermediario entre el programa y la máquina entre el programa del sistema operativo cuando yo trabajo en temas más yo cómo ejecutó un programa hecho en temas más pero con pilot lo compiló era un archivo exe y ese archivo excel se comunica directamente con el sistema operativo y le puede preguntar al sistema operativo cuantos núcleos tienes al que ocurre en java cuando yo hago un programa en java en principio de normal hago un archivo exe no qué hago no en java puro es un punto hard y un punto hard es una cosa que se llama un byte code no es un archivo exe que se ejecuta directamente contra el sistema operativo sino contra que se ejecuta un archivo jar contra la máquina virtual dejaba la famosa máquina virtual dejaba que te dicen siempre la tienes desactualizada la quieres actualizar pues esa máquina virtual de java existe precisamente como colchón como base para ejecutar programas hechos en java con lo cual java no tiene un acceso tan profundo al sistema operativo como tiene un ejecutable compilado en temas más pero tiene un acceso bastante bajo vale por se suele decir que desde ese punto de vista java es un lenguaje de más alto nivel que temas más porque realiza esa abstracción bien pues javascript no se ejecuta directamente contra el sistema operativo que intermediario nos hace falta para poder ejecutar un programa en javascript el chrome nos hace falta un navegador web que tenga la capacidad de interpretar javascript el chrome y prácticamente a día de hoy cualquier otro navegador moderno entonces lo que no en principio es de esperar pero sí que ocurre es que los navegadores me dan la función aquí está copia de esta línea de código de decir el navigator punto hardware concurre en sí que es la cantidad de núcleos que tengo en el sistema y saber la cantidad de núcleos que tengo en el sistema me puede venir bien para en un momento dado poder saber cuántos núcleos puedo dar cuantas tareas puedo lanzar quin un procesador de 6 para que voy a lanzar 4 núcleos para que voy a lanzar 4 tareas podrán ser 6 pero tengo un procesador de 2 para que le envió 8 tareas y sé que lo voy a saturar entonces la idea está en que ahora guardo recargo y a mí me da el número 6 así que si me da el número 6 ahora me vengo al administrador de tareas me voy a rendimiento y compruebo como efectivamente tengo seis núcleos en el sistema es decir ejecutar está este código y comprobaréis que lo que os dice es cuántos núcleos pero instalados dentro del sistema para que vamos a hacer esto bueno pues esto lo vamos a hacer para en un momento dado poder por ejemplo arrancar tantas tareas como núcleos tenga tu sistema operativo vamos a por ello vamos a usar esta información para hacer lo siguiente voy a decir aquí arriba bar número de núcleos o número núcleos es igual a cero de momento pero cuando entro aquí dentro digo número núcleos es igual a navigator punto hardware concurren sí estoy metiendo esa información dentro de una variable que a continuación voy a usar así que ahora lo que comentábamos ayer de las matrices aunque hoy no haremos bidimensionales pero si lo que te decía de en lugar de crear variable con número crear matriz que para eso existe pues hago lo siguiente for y es igual a cero bueno realmente pone 6 por tanto técnicamente empieza en 1 vale x y es igual a 1 y es menor o igual que número núcleos y más es decir para cada uno de los núcleos que tienes en el sistema operativo pues voy a decir lo siguiente voy a decir worker de y por cierto la w es igual al niño barra y hay que declararlo como array así que worker de y cuando es workers va a haber y yo que sé depende del ordenador va a haber unos workers u otros el sistema se va a adaptar así que digo worker day es igual a new worker déjame que ponga todo esto aquí dentro worker de 2 meses worker de un mes age y digo dos meses así que en worker jota ese momento lo pongo aquí para que podáis seguir copiando de los dos a la vez y digo hola núcleo el punto data yo te saludo los que van a morir te saludan lo que estoy haciendo por tanto es que hasta ahora he abierto un número conocido y definido de núcleos pero lo que estoy haciendo ahora en este ejercicio es abrir un número variable de núcleos un número dinámico de tareas estas tareas dependerán de cuantos núcleos tengas en el sistema operativo aparte un poco para hacer la gracia por poder localizarlo tengo o la núcleo event punto datos a cada mensaje te va a decir a qué núcleo va destinado realmente ya que nuclea ha estrenado no a sus mentiras para decir qué número de tarea es probaron porque al núcleo el que va eso ya lo gestión al sistema operativo si todo ha ido bien lo estoy tirando todo al contenedor también te digo pero en fin que se va a hacer momento vamos a hacerlo así que guardó y recargo no es si habéis visto mirad entonces si habéis visto que hace acepta acá placa vale por qué pues porque estoy diciendo punto text voy a decir a p y bueno a mí no sé por qué pero bueno no pasa nada pero mira lo hago ahora y déjame quitarlo déjame que ponga un br y dice hola núcleo número 1 el núcleo número 3 o la núcleo número 5 o la núcleo número 2 pero lo divertido es que yo puedo ejecutar este código en el teléfono móvil por ejemplo y digo cuál es mi ip ipconfig 19 21 681 26 1 21 681 26 me voy a abrir esa dirección con el teléfono móvil vamos a verlo 1 681 26 barra workers com y en el teléfono fijaos mirad me dice hola núcleo 31 42 porque en el teléfono sólo tengo cuatro núcleos mientras que en el equipo tengo 6 veis por tanto como tenemos un programa que va a dime qué va a crear tantos workers va a crear tantos hilos como procesadores como hilos de procesamiento tengas en el sistema operativo y esto está muy bien porque puedes balancear la carga del sistema pero ahora no haríamos por ejemplo fíjate no haríamos que te diría yo pues como ayer que hacemos sol y conejos tampoco haría un conejo en cada worker pero igual haría para que diez conejos entonces sería iría enviando y ojo eso es muy importante también porque si le digo por ejemplo más de diez conejos pues puedes tener un juego donde la cantidad de elementos en pantalla vaya directamente proporcional a la potencia de tu dispositivo quiero decir imaginaros por ejemplo un juego como el master of castells que ahora mismo tú dices vale es que como diría yo pues yo te envío 100 malos y puede ser que empecé vaya muy rápido y el móvil vaya muy lento pero puedes hacer 10 malos y puede ocurrir que en el móvil vaya muy rápido pero en el pct sobre rendimiento pues con esto por ejemplo tú puedes detectar los recursos que hay en el sistema y hacer que el número de enemigos o la lógica o lo que tú quieras de tu juego se adapte a los recursos reales que tiene la máquina vamos a aplicar esto que acabamos de aprender y sobre todo lo de enviar información y todo eso el ejercicio que estábamos haciendo ayer que era juego workers quiero recordar localhost barra juego workers teníamos por aquí los conejos para que te pego vale entonces lo que voy a hacer es lo siguiente vamos a verlo voy a abrir el código voy a abrir el código me voy a ir a workers juego a juego workers perdón y abro index y abro pájaros realmente así que digo lo siguiente continuamos donde lo dejamos ayer y creo que quiero crear un pajarito vamos a ver que hay con el pajarito mira este de aquí a ver este si tiene transparencia fantástico mira como bajaron así podemos ver hay con guardo imagen me lo guardo en la carpeta ht box y me lo guardo en la carpeta workers me lo guardo como pajarito y lo abro con el gimp evidentemente ya lo sabéis para hacerlo más pequeño porque tengo un canvas relativamente pequeño así que mira está a 512 por 512 pues ya sabéis que ayer lo bajaba a 32 por 32 un icono pequeño de un pájaro suficiente para trabajar le digo sobre escribir y recargo por aquí por tanto vengo y digo bar con texto pájaro es igual a document.getelementbyid de pájaros y vivo con textos pájaros es igual a hace pájaro punto get con textos de hasta ahí pues igual luego arriba en la declaración de las imágenes digo bar pájaro es igual a new image así que pájaro punto src es igual a pájaro pajarito creo que era pajarito punto png esto quiere decir que estoy declarando el contexto de ese canvas y estoy también declarando la imagen para que el programa la pueda usar bueno pues a continuación lo que voy a hacer simplemente va a ser vamos a ver en el documento red y aquí está arranco carga start worker y digo arranco tantos núcleos como haga falta para los pájaros cuidado tantos núcleos como haga falta para los pájaros no porque sé que un núcleo me lo estoy gastando aunque poco pero vale me lo estoy gastando en el sol y otro menos que ha gastado unos conejitos así que digo bar número núcleos es igual a 0 de momento las condiciones iniciales porque aquí abajo digo número núcleos es igual a navigator punto hardware concurre en fe pero sabes que navigator punto hardware concurrence y -2 porque quiero que me digas el número de núcleos pero te quito 2 porque 2 ya se supone que los estoy usando para el sol y para los conejos así que digo arriba igual que antes bar w es igual a new array te digo la w es una nueva matriz y por tanto digo y es igual a 1 y es menor o igual a número núcleos y más pero eso es un poco raro digo w es igual a new worker déjame que no realmente está aquí así que digo ni un worker y ejecutó pájaros punto j s qué voy a hacer pax de pájaros es lo que estoy haciendo cuántos pares de pájaros pues si tengo seis núcleos y me estoy gastando dos pues cuatro packs de pájaros si ejecutó esto de mismo en el móvil y tengo cuatro núcleos pues solo podría hacer dos packs de pájaros muy bien packs de pájaros y si mira aquí bar w es igual a nuevo rey en condiciones iniciales y ahora digo worker day punto seitz pues ejecutó un function event que dirá algo voy a decir con soul punto log algo es decir algo así que si ahora vengo a los pájaros en los pájaros de momento sólo voy a decir post message hola nada más los meses hola si todo esto ha ido bien vamos a comprobarlo cuántas veces recibiré ahora en la consola la palabra algo pues debería recibirla cuatro veces por los cuatro núcleos que tengo disponibles así que guardo y recargo y fijaos que mirad lo que tengo aquí abajo me dice que algo se ha repetido cuatro veces porque sé que tengo un núcleo reservado para el sol otro núcleo reservado para los conejos y por tanto me quedan cuatro núcleos que todavía no sé nada con ellos pero ahora ese mensaje me dice cuatro núcleos disponibles pues tengo cuatro núcleos para los pájaros que van volando por la pantalla y por tanto ese algo variará dependiendo de en qué dispositivo ejecutemos este juego pues ahora dentro de pájaros punto j s lo que quiero es hacer lo siguiente mirad le digo bar x es igual a miwa rey un poco parecido a los conejos miradme copiar un poco el código me voy a ir a conejitos punto js ahí va mero y copiar así que me copió esto por aquí mirad estos pájaros punto j s y ya está lo que he hecho es duplicar el código de conejitos js a pájaros js y ahora digo lo siguiente x es igual a no sé 200 menos estoy aquí esto una persona perdona esto es pero más exactamente lo que esto es la x es 0 + 300 la y es 50 menos esto de aquí por 150 es decir con esto quiero pájaros en la mitad superior de la pantalla ahora en la función repite digo x debe vale x debe es más igual a más random por 2 - 1 y bebe es lo mismo con lo cual creamos una longaniza pasamos la longaniza y ya está como esto que reid copiarlo verdad me lo voy a poner en la otra pantalla aquí tenéis los pájaros a la derecha y ahora a la izquierda voy a trabajar con los elementos así que digo con texto conejitos pues no con texto pájaros clear rect para laboral de serializado es igual a punto data lo que sea y digo en contexto pájaros por lo mismo contexto pájaros drogba lo que sea quiero dibujar el pájaro es pájaro pajarito es pájaro vamos a verlo voy a ver si funciona dame un segundo y ahora os lo pongo para que lo copié jce algún segundo bien vamos a verte es notifight te es notifight donde bien de hecho aquí este foro es que esto me lo ve me lo he quitado pero me falta un foro y luego aparte usarte dos veces va a declarar te dos veces no está bien bueno pues ahora voy a declarar y no y aunque ya lo estoy usando h y aquí pongo la h y aquí pongo la h y ahora insisto os pongo el código para que lo podáis copiar pero vengo por aquí para comprobar que va bien te is not the fine en la línea 82 ahí van dos pájaros mira toma pájaros pero lo importante un momento week como si son un poco eléctrico es prácticamente ahora veremos de hecho en los pájaros y así los de mar y mirando un segundo de los pájaros voy a decirle que repite en 250 para que vayan más lentos así entonces quiero que veáis ahora que el sol va a 500 los pájaros a 250 y los conejos a 50 hacen un poco lo que quieren de vez en cuando y también lo importante que quiero que veáis es que si miro el procesador probablemente estoy haciendo un uso bastante machacante del procesador estoy al treinta y pico por ciento no estará al 100% porque no todos los recursos están usando el procesador por ejemplo el sol está usando un núcleo pero no lo usa para prácticamente nada si no sé a veces ocurre no sé por qué tengo que mirarlo entonces mira de los núcleos no sabéis cuenta cómo hay un núcleo al 10% otro al 4% y otro al 1% yo diría que este núcleo de aquí son los pájaros este núcleo de este proceso de aquí son los conejos y este proceso de ahí es el sol abre por tanto la idea no de vender más procesos por hombre está por ahí pero la idea es que veáis como el sistema está empezando si ya te digo el área no sé por qué hay que ver eso sí y luego ha empezado ahí también te digo que voy a cerrar esta ventana incógnito voy a abrir una nueva sigue ocurriendo pues ahora veremos porque ahora parece que aguantan pero seguro que de un momento a otro empiezan a hacer el mismo espasmo pero vale hasta que averigüemos el porqué de ese espasmo de momento lo importante y os pongo el código para que lo podáis copiar lo importante es ver cómo tenemos packs de pájaros padres de pájaros dependiendo evidentemente si ya sé por qué es el área porque es la guía y la razón es que cada uno de los cuatro núcleos está dibujando en el mismo contexto con lo cual están peleando por el contexto todo el mundo al entonces por eso tendríamos que ver cómo solucionarlo pero de momento vale ahí lo tenemos