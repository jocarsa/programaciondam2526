eh voy a entrar un momento en Google Drive recordamos que en programación de servicios y procesos Pues el objetivo del final de la asignatura consiste en vamos a ver en eh proteger las aplicaciones y los datos evidentemente Yo casi os diría más los datos que las aplicaciones a ver un momento que abra el chat vale Hola vale eh más los datos que aplicaciones Pero bueno al final Como las aplicaciones son las que gestionan los datos pues también hay que proteger las aplicaciones y eh aplicando criterios de atención seguridad en el acceso en el almacenamiento y en la transmisión de información bien pues con esta premisa por parte de los resultados de aprendizaje voy a enseñaros algo que os comenté a vosotros al ver el fin de semana que veríamos esta semana os voy a enseñar algo que no es que os vaya a parecer alarmante es que lo que os voy a enseñar es 100% real veréis voy a entrar al servidor sobre el cual ayer estuvimos trabajando este servidor como recordaréis ayer en el archivo de log a ver un momento vale ese archivo digo este servidor se instaló literalmente el día 8 de enero de 2025 a las vale servidor reinstalado y esto quiere decir que estando hoy a día 14 el servidor no hace ni una semana que está instalado el servidor no tiene nada Es decir el servidor tiene una serie de chorri aplicaciones vale que más adelante contendrá cosas por ejemplo hoy sin ir más lejos esta tarde tendría que instalar so ese servidor una aplicación importante con datos críticos vale con datos sensibles pero ahora mismo hasta el momento no tiene nada importante es más lo que tiene instalado hasta el momento es lo siguiente lo que tiene instalado es hokar cadet Blue que es una aplicación para copia de seguridad hokar crimson que es una aplicación sobre la cual no hace falta que Us hable jarsa Dark Slate Blue que es el mini panel de control para los alumnos de primero el superc controlador de primero jarsa Dark tur voice que este lo hice ayer por anoche que es un software para teleprompter me lo pidió una amiga hace tiempo que lo tenía que haber programado con lo cual dije Espérate que lo acabo de programar y lo publico Forest Green que es una aplicación de chat lo visteis ayer salmon que es una aplicación de calendario como Google calendar vale pero medio un purpel que no me acuerdo que es esto la verdad Ah sí medium parel lo hicimos la semana pasada en entornos con primero con c+ Plus medium se Green qué esta para qué es Ah sí medium Green es la aplicación que os hace el calendario de lo de los vídeos old lce que es el proyecto de lenguaje de marcas de los alumnos de primero y tomato que es la aplicación de monitorización del servidor o sea en este servidor no hay nada ahora mismo no hay nada importante cuando yo entro en jocars comom realmente estoy entrando en hok carsa Old L por lo tanto a continuación lo que vamos a ver es que si yo me voy a ww No si yo me voy a bar y me voy a log es una carpeta que usa Linux para guardar los registros de lo que sea me voy a log tengo una serie de registros de Apache tengo también mysql ya hablaremos de ello vale hay un error pun log ahora luego hablamos de esto no debería haber muchos errores pero bueno me voy a Apache 2 y en Apache 2 veo que en cada uno de los virtual Host que cree por ejemplo vamos a recordarlo me voy a etc me voy a ap2 me voy a sites available me voy a por ejemplo crimson Y ayer os acordáis espa que anoche estaba programando y me puse esto a un tamaño menor Vale entonces Os acordáis que ayer cuando creamos el Virtual Host para crimson lo que hicimos fue indicar que todos aquellos errores que hayan y todos los logs que hayan se vayan aquí al crimson Access y al crimson error log Vale pues de la misma forma cada virtual Host que he creado cada aplicación que está instalada tiene su propio log de error para luego poder diferenciar unos logs de otros podría ser común pero lo he hecho por separado por tanto como os decía me voy a bar me voy a w no perdona me voy a log me voy a Apache y voy a entrar a los logs de eh de old lay Más que nada porque old lay es la aplicación a la cual entra el tráfico por defecto vale por ejemplo para entrar en crimson tú tienes que saber que existe un subdominio crimson por tanto si voy a crimson Access log pues veré que bueno espérate hay unas cuantas cosas vale vamos a ver por aquí vamos a ver por aquí 13 de enero 1543 vale Este soy yo 1838 vale Ok de hecho Mirad python requests Este soy yo haciendo la prueba de carga vale o sea que todo controlado de momento en crimson vale Ok pero aquí hay un problema y es que solo por entrar Vale Fíjate que a las 22 ya no era yo de repente encuentro iin sh cg Bin php unit útil eval std in.php unit vendor php unit eval std in.php o sea solo en la aplicación crimson que metimos ayer y de repente ya hay una serie de intentos de ataque insisto ayer por la noche y vamos a ver durante esta madrugada bueno las 7 de la mañana 6 de la mañana pues php unit es decir hay Bots que de forma masiva están intentando reventar o Buscar vulnerabilidades para el Software que hemos creado están intentando probar diferentes urls a ver si Suena la campana y hay alguna de estas eh urls donde realmente esté un archivo y puedan explotar las vulnerabilidades de ese archivo en este caso pues hay una serie de frameworks que en este caso yo no estoy usando Albert Esa es la cuestión vale Esa es la cuestión vamos a ver Y eso por qué Pues porque van probando es decir hay Bots que se dedican a que si Ay perdón editor de texto si hay una web llamada jocars comom y esa web saben que existe pues cuesta nada hacer un Bot y cuando digo cuesta nada quiero decir que yo mismo os podría enseñar ahora mismo en 5 minutos a hacer un Bot de ese tipo que dijera Bueno vamos a probar si existe a pun jarsa no existe b pun jarsa cocarsa d pun jarsa e pun jarsa hasta aquí al final acaban encontrando por pura combinación de Fuerza bruta que existe un crimson carsa.com es así de sencillo vale e insisto si os hacéis una idea de que al final esto es un una lista una Ray de las letras de la A la z y esto es un bucle for que me puede combinar esto de 0 a 10 elementos Es decir de 0 a 10 combinaciones de letras de la a y la z como os digo literalmente en 5 minutos podemos programar un Bot con la librería request de python que se dedique a probar subdominios hasta encontrar subdominios operativos y en cuanto encuentre subdominios en cuanto haya subdominios que den Ok en ese caso empiezo a lanzar una serie de ataques para ver si cuela para ver si cuela alguno de los ataques insisto ahora mismo o sea por tanto cuando hay una parte del temario que dice que tenemos que proteger las aplicaciones es que o sea Albert Esto es lo que os digo Siempre vale que no lo sé vale dragos Yo pienso eso mismo que es que la gente se aburre mucho o yo no sé a la gente Qué le pasa por la cabeza yo no sé la gente lo que os decía ayer no qué traumas tiene qué taras mentales tiene yo tengo mis taras mentales como todo el mundo las tiene pero a mí no se me ocurre pero cuando te digo que no se me ocurre quiero decir que cuando yo estoy en casa y tengo un rato libre Pues sí como poder yo me podría poner a intentar reventar páginas web pero es que no se me ocurre el sentido de que digo para qué O sea para qué hacer eso qué gano con eso qué voy a ganar con eso aparte de perder el tiempo y decir perder el tiempo quiero decir malgastar el tiempo en algo que realmente ni me va ni me viene por eso te digo que no sé si esas personas las han maltratado cuando eran pequeños no sé si ahora ellos propagan esa ira en forma de no Albert no escucha No te rías te lo digo en serio vale Te lo digo en serio En el sentido de que intento empatizar e intento comprender a una persona que dedica su tiempo libre a eso porque dices qué traumas tiene que tener esa persona para decidir que lo que quiere hacer con su vida es intentar reventar servidores de Ah No lo sé igual dragos se cayeron de la cama y se pegaron un golpe fuerte en la cabeza no tengo ni idea vale pero yo solo sé que es un mundo que a mí no me gusta pero sin embargo de la misma forma que os digo que no me gusta o sea ni obviamente ni me gusta atacar ni tampoco me gusta que me ataquen pero en este caso no tenemos más remedio que atendiendo a los logs de registro no es ya que yo venga hace unas cuantas semanas y en una clase os diga chicos cuidado porque os van a atacar Y eso se queda en una clase no O sea Es que ayer publicamos una aplicación en un servidor real y hoy 4 horas después nos encontramos con intentos de ataque a esa aplicación Entonces qué ocurre Pues claro Albert yo digo lo mismo vale Y es que eh en este mundo Pues hay eh Hay personas que aportan vale Hay personas que crean cosas nuevas hay personas que ni crean ni destruyen vale Okay y hay personas que directamente encuentran placer en destruir lo que otros han creado y es lo que os digo siempre y os repito siempre que no me preguntéis por qué lo hacen porque no lo sé ni lo entiendo ni se me ocurre Más allá de pensar que todos tenemos traumas y esos traumas definen nuestro comportamiento y hay veces que hay comportamientos de cualquiera de nosotros que visto desde fuera parece extraño pero si analizas los traumas que tiene esa persona pues dices Bueno pues tiene explicación Vale pues yo solo me encuentro esa explicación Entonces de más que aficionados desconozco Quién hace esto si es aficionado o profesional o tal pues eh entiendo que son personas insisto aficionados o profesionales que se dedican a intentar atacar de forma masiva porque al final cuando programas un Bot te da igual que ese Bot ataque a 10 servidores que ataque a 10,000 servidores con lo cual dices Mira para atacar a 10 vamos a por 10,000 y a ver si cuela a ver si es una flauta si en el caso de que reventar mi servidor que parece que de momento no ha pasado ahora mismo no hay información de valor con lo cual no me pueden robar nada pero la va a ver así que la idea es esta la idea es que antes de que haya información de valor en el servidor pues hay que tomar una serie de medidas para que esto no ocurra pero ojo En este caso mira dragos si puedo pillar la IP no sol lo que puedo es que está aquí es que la IP está aquí vale sin embargo eh vamos a ver por una parte me voy a ir aquí voy a copiar una de las ips me voy a info Sniper acordaos que teníamos Y tenemos una librería de que convierte IP a país con ese kulite ahora luego lo usamos vale me vengo por aquí le doy a consultar y dice que este atacante me está atacando desde Singapur O sea que sí puedo pillar la IP pero a ver en primer lugar puede tener VPN en segundo lugar dado que hacer un spoofing de ip es relativamente sencillo probablemente no será esta la IP Real de la persona quizás en el caso de que sea una IP real quizás sea un equipo zombie o sea un equipo infectado por otra persona que está en otra ubicación con lo cual saber las ips es algo que ahora veremos en un momento de hecho lo vamos a analizar para ver de qué país nos están eh atacando pero tampoco me vale Y en el caso de que realmente fuera una IP de Singapur teniendo en cuenta que Singapur es que no es ya que no está en nuestro país no es ya que no está en nuestro en nuestra Unión Europea es que no está ni siquiera en nuestro continente o sea Singapur está como casi a la otra parte del mundo literalmente con lo cual si yo ahora voy a la guardia civil y le digo Oye mira es que me han intentado atacar de Singapur en cuanto yo a la guardia civil le diga Singapur me dirá pues apágate porque como te puedes imaginar la guardia civil o la Policía Nacional no tiene ningún poder para actuar contra alguien de Singapur Vale entonces Albert efectivamente la conclusión desgraciadamente Lo siento mucho Per la conclusión es esa vale Y no es ya lo bueno para mí no es bueno vale Para mí el tener que reforzar me y protegerme no es algo bueno pero es lo único que podemos hacer vale entonces sí correcto eh correcto dragos ahí hay una cuestión y es que o sea con el tema de la gente de las empresas de la India o de otros países que llaman con el tema de que instálate este software accedo a tu ordenador y te arreglo el ordenad y tal y cual vale Yo ahí soy muy crítico porque eso aquí en España pasa a menor escala vale a menor escala pero pasa igualmente y yo siempre pienso que a ver esas llamadas están pasando por una centralita Española y hay una empresa española que se llama telefónica que donde el gobierno tiene una mano importante metida dentro telefónica y se supone que nuestro gobierno no nos protege se supone pero en la realidad parece que no tanto en Estados Unidos pasa igual Es decir para que alguien de la India llame a un ciudadano estadounidense eso tiene que pasar por una centralita estadounidense la cuestión no es si hay scamers en la India estafando a gente en Estados Unidos la cuestión está en que hay un gobierno que tiene los medios tecnológicos totalmente a su disposición para decir sí pues cortamos todas las llamadas que vengan de estas centralitas pero no lo están haciendo con lo cual ahí hay un tema vale entonces además de esto no sí espera el tema dragos no es que te llame un Bot a ti el tema está en que vosotros sabéis que yo estoy separado estoy viviendo con mi madre y mi tía está jubilada y recibe llamadas de ese tipo todos los días cl mi tía se parte el culo de risa porque es que está jubilado quiero decir era funcionaria de Justicia está jubilada con lo cual cuando descarga el teléfono y se encuentra un Bot ofreciendo una oferta de empleo mi tía Dice es que ni siquiera saben A quién están llamando o sea ni siquiera filtran por edad sabes bien luego Albert hay otra cuestión que es el tema de has comentado el tema de guerra tecnológica bueno es que estamos en una situación de a ver de una situación de lo que podría ser una preguerra es decir estamos en una situación de una tensión política vale una tensión geopolítica eh Hay una situación en la que ahora mismo hay una guerra cercana a nosotros y hay una situación en la que el digamos el estamento político jurídico al que pertenecemos que es la Unión Europea tiene un posicionamiento con respecto a esa guerra vale es un posicionamiento en contra de un país concreto que en este caso eso se llama Rusia con lo cual Eh Pues hay intereses en un momento dado por parte de otros países para eh En un momento dado pues poder ejercer una guerra donde parte de esa guerra se libra de forma electrónica contra intereses que estén dentro de la Unión Europea evidentemente van a conseguir mucho más reventando a otros organismos que revent dándome a mí pero al final de Cara a digamos Rusia yo soy yo cuento como una empresa española con lo cual de Cara a eh realizar una parte de guerra tecnológica pues podrían intentar de la misma forma que intentar tirar abajo mi servidor tirar abajo otros muchos servidores de otras muchas empresas en mi caso no ganarían nada pero vale Yo tengo aplicaciones donde en este caso ahora mismo nadie está usando esas aplicaciones porque las estoy lanzando Pero y si en un momento dado dentro de un año Imagínate que hay un montón de gente que está usando mis aplicaciones a nivel empresarial y por tanto eso ayuda a que funcione la economía y un ataque hace que caiga el servidor pues Vale no es el caso de hoy pero podría serlo el día de mañana vale Así que eso de la guerra tecnológica que comentáis pues no es moco de pavo vale no lo digáis de broma porque puede ser hay parte de los ataques que pueden venir por ese por esa vía pero En definitiva ojo os estoy enseñando los de crimson pero espérate ahora me voy a los de old blaz old lce es la página principal vale que es una página que está en construcción de hecho o sea saber más y comprar no bueno comprar sí que funciona pero no lleva ninguna parte vale o sea lo estoy montando en este momento no están ni las imágenes el logo falla Vale entonces ahora te cuento dragos porque estoy poniendo algunas aplicaciones en marcha light salmon es la que ahora mismo está empezando a funcionar que es un calendario de momento las estoy usando yo vale para usarlas y ponerlas a prueba y comprobar que funcionan y cuando ya haya comprobado que van muy bien pues ya entonces lanzarlas más en plan público vale también tengo una aplicación que se llama til que para mí es la Joya de la corona ahora luego os hablaré de esa aplicación pero la idea no es ahora mismo aplicación en uso No ahora mismo solo la uso yo pero en estos meses las quiero lanzar para que sí que haya usuarios de verdad Vale entonces Mirad me voy a old lce en Old lce una cosa que veo espérate eh Uy dónde estás jarsa all days Es que tengo un Access log y lo que hace el sistema es que con los Access logs más antiguos los cipea vale los mete en un CP No pasa nada porque ese gzip se puede luego abrir vale Lo cual quiere decir que abro el log Y tengo desde el 14 de enero vale a las 016 hasta el 14 de enero a las 1421 que parece que ha sido el último acceso Vale tengo el Access log que es desde hoy a las 02 hasta hoy Perdona no ayer a las 02 hasta ayer a las con lo cual de la misma forma Pues tengo por aquí el resto de registros como veis llegan hasta cinco como veis llegan hasta cinco tranquilos porque en un momento dado se puede configurar Apache para que no llegue hasta 5 sino que me guarde más días aparte acordaos que tengo una aplicación que se llama cadet Blue que me hace copias de seguridad con lo cual me puedo hacer una copia de seguridad de los registros de acceso al servidor vale Bueno pues me voy a cadet Blue Perdona me voy a cadet Blue me voy a old L y solo de hoy vale 14 de enero desde las 016 cursos intranet mensajería es igual a sí categoría Ok cursos productos vale admin esto no existe Pero qué cabrones O sea 404 pero admin es el tipo nombre el típico nombre que tú pondrías a un panel de control about php Flower php f35 ojo wp admin Claro porque yo podría tener un wordpress no lo tengo en este caso pero podría tenerlo wordpress content con.php a.php simple php ellos van probando probando probando y el log de ayer son 3862 registros e insisto yo miro aquí y por eso antes de hablar en las horas de clase de hoy de Cómo solucionar esto de cómo solucionar este problema que por supuesto vamos a ver medios de cómo solucionarlo Pero lo primero que quiero que veáis es que hay un problema y hay un problema muy grande y es que la gran mayoría de los eh de los Mira ves page 3 bueno no esto parece que es correcto Sí eso es correcto vale la gran mayoría de los accesos a una web concreta pues son las los accesos a partir de Bots que pueden ser Bots que se dedican a indexar pero otros Bots que se dedican como veíais por aquí arriba vale hit recoger es hit Ah no perdona hit es correcto esto es correcto vale hit recoger esto es correcto vale Pero esto no es correcto Plus ad js esto tengo que hablar con una persona que lleva basta web esto de hit porque esto de hit sí que es mío esto de hit sí que es una aplicación mía vale está apuntando una carpeta incorrecta pero es una aplicación mía Pero esto no vale alpax php fits php radio.php dropdown php default.php system.php ellos van intentando tienen nombres de archivos que pueden tener e cómo te diría yo que pueden tener vulnerabilidades e intentan explotar esas vulnerabilidades claro qué ocurre Pues que si os dais cuenta yo en clases anteriores en semanas anteriores incluso antes de Navidad os he estado enseñando estrategias para que si te pingue si te tocan un archivo php que tú has hecho pues medidas de seguridad para atrapar pero si os fijáis Claro si me pingue a archivos php que yo no he hecho o que no están Cómo puedo yo proceder contra esto no puedo vale con lo cual lo que vamos a hacer es que vamos a echar un paso atrás vamos a bajar un paso atrás y además no iba a decir el lugar no Además de establecer medidas de seguridad en los archivos php también vamos a establecer medidas de seguridad con respecto para empezar a los logs valiosísimos logs que nos da Apache qué ocurre Pues que si vosotros entráis en vuestro shamp vosotros en la carpeta de Apache tenéis unos logs pero no valen para nada porque los logs de vuestro Apache sois vosotros entrando no va a haber nada malicioso no va a haber nada sospechoso en el momento en el que montáis un servidor real Ahí es donde la cosa se va a liar parda de la práctica que voy a hacer a continuación esa práctica requiere que tengáis un servidor montado y unos logs reales para aquellos de vosotros que a la hora de hacer esta práctica No tengáis un servidor real montado no hay ningún problema vosotros me lo decís y yo cojo los logs de mi servidor os los paso y trabajáis sobre esos logs vale o sea que tranquilos por eso vale porque no es obligatorio que os monté un servidor real bien pues vamos allá y elegido un color eh css3 colors vale elegid un color vamos a arrancar un proyecto nuevo Así que coged un color Ay bor Mola aquí perfecto vamos a por ello bien pues repositorios voy a crear el proyecto hokar ivory vale público bien ok claro teóricamente proyecto que trata de seguridad informática no Debería ser público pero bueno da igual vale Así que aquí en local me voy a iori vale vamos a ver no puedo sí espérate Vale jarsa ivory y Ok jarsa ior bien una cosa que también voy a hacer es que me voy a descargar ese archivo Entonces ese bar eh log sí Apache y old Slate Blue old Slate Perdón old l Ah ojo hemos visto el Access no hemos visto el error esa es otra que haí hay otros ataques vale el dónde estás error vale aquí hay otros ataques en fin ahora vamos a ello bien me voy a copiar el Access log me lo voy a pegar en mi ordenador personal Así que otras ubicaciones ubuntu bar eh log Apache 2 y lo voy a dejar ahí en este caso este es Okay no permiten vale Bueno okay venga a ver voy a crear una carpeta log voy a abrir en un terminal y voy a decir sudo CP jarsa old Slate Access barra bar barlog barra apach 2 y bar jocars Old l no gu access.log contraseña y ya está no contraseña incorrecta vamos a ver venga va Okay ya está bien pues ahora me voy a idle dentro de idle voy a no voy a crear un archivo nuevo voy a guardarlo dentro de la carpeta ivory ah jokar iory I ahí vale Y blog o I bien y aquí lo que voy a hacer es que pues voy a recorrer una carpeta y voy a abrir un archivo Así que le digo archivo es igual a Open y abro bar no bar log apach 2 y aquí muy bien y jar mira qué bien vale fantástico y digo Ah perdón y lo abro en modo r a continuación Si miro el archivo me daré cuenta de que el archivo Realmente es como una especie de csv Solo que el separador no es Perdón no es una coma sino que es un guion vale Okay no pasa nada Pues por lo tanto dónde estás aquí ahora digo eh líneas es igual a archivo readlines y for línea in líneas Oh mira sabes que print líneas de cero líneas f5 permission denied vale permission dened porque en este caso vamos a ver dam no l jocars ivory vale abro en terminal y por tanto voy a decir sudo python 3 Eh i.php vale con lo cual lo ejecuto como sudo e arivo no es argivo es archivo Así que y archivo re Lines Lo ejecuto como sudo y tengo el primer elemento tengo la primera línea ahora a continuación lo que quiero es sacar únicamente la IP Así que vengo y digo ip es igual a líneas de cero punto split de la coma del guion Perdona y quiero el elemento cer Quiero el primer elemento Así que print IP f5 Perdón f5 no aquí y me dice que la ip es esta de aquí cuidado porque eh tiene un espacio al final vale parece que no pero tiene un espacio al final con lo cual IP limpia es igual a IP pun replace de esto con nada así que print IP limpia que no aquí no bien y tengo la IP pero ahora la IP no tiene un espacio al final Okay pues una vez que tengo esto lo que puedo hacer es guardar las ips en una estructura de datos una estructura de datos en la cual en este caso voy a utilizar un diccionario en el cual yo pueda contabilizar Cuántas ips hay es decir ahora quiero muchas ips por tanto digo for línea in líneas o así esto es línea con lo cual le doy a aquí a ejecutar y empiezan a caer ips por aquí vale tengo un listado con las ips que me han visitado o me han atacado más como queráis llamarlo ahora a continuación no solo quiero las ips sino que quiero un listado O sea quiero eh un cuente vale quiero contar Cuántas hay para contar Cuántas hay bueno Iba a hacerlo voy a hacerlo manualmente venga Entonces no esto sigue siendo ivory y digo diccionario es igual a diccionario vale un diccionario de python diccionario vacío Y entonces vamos a ver un momenti Okay Ok vale IP y les digo sí diccionario de IP limpia is nul en ese caso es nul por qué me lo dices por qué me lo pones negro Ah know Perdón en python es know bien nul es javascript entonces digo diccionario limpia es igual a una visita vale Si no existía me lo pones ahora y si existía diccionario limpia más igual a 1 si ya me había visitado una vez pues ahora me ha visitado una vez más aquí Cuidado con la sangría ahora al final print diccionario vamos a verlo vamos a ver si ha funcionado esto de meter esto sin convertirlo a String bueno tendré que convertirlo a String un momentín no va a funcionar Creo vale error porque me dice que key error no es válido vale Pero ahora lo convierto a str lo convierto a str que yo creo que ya debería ser str vale ejecuto e IP limpia is known qu error hostias IP limpia no esto quiero comprobar si existe vale vamos a verlo error quiero comprobar si la IP existe realmente Ah vale Ok IP strip bueno Vale pues strip en lugar de Place me dice que use strip vale pueso strip Ok hay ningún problema esto fuera y esto fuera vale Y ahora Ah perdón muy bien IP limpia not in diccionario vale Si no está IP limpia en diccionario Ok pues me vale pues vamos allá Clear ejecuto y me da un diccionario de las visitas que tiene cada una de las ips y me dice este caso vale que esta IP una visita esta IP otra visita esta IP otra visita vale vamos a ver a continuación acabo de vomitar el diccionario de ips directamente a Palo Seco pero ahora mismo No veo nada Como no veo nada lo que quiero es ordenar esto de mayor a menor digo base a esto y digo Ok Now order dictionary eh taking values diccionario IP limpia and reorder dictionary or no and render results desk como si fuera un sql no vale esto es lo que quiero vale Okay Esto es lo que quiero Esto es lo que quiero esto si queréis lo puedo bajar a ver dict sorted vale para ver bien los parámetros que tiene Esto va aquí y Esto va aquí vale f5 no ejecuto eh no perdona sudo No esto fuera esto ya lo tengo aquí Clear ejecuto y me dice que la IP 62 42 104 183 me ha hecho 1172 hits esta ip de aquí me ha hecho 3 9 hits esta ip de aquí me ha hecho 273 esta igual soy yo Ah no no soy yo porque estoy cogiendo old L y ayer la prueba de carga la hicimos sobre crimson vale con lo cual no puedo ser yo okay bien pues tenemos esto por aquí de momento claro Ahora quiero saber cada uno de estos ataques por ejemplo a qué países corresponde para saber a qué países corresponde tengo por aquí por el servidor un archivo sqlite lo tengo creo en el raíz principal en el raíz principal lo tengo en Old lce y tengo este no log aculite Uh dónde tengo dónde lo tengo Back No sé dónde lo tengo pero lo tenía por aquí igual está en crimson no geol que geol ulite tiene cero por qué Pues no lo sé pero me voy a html me voy a jocars all days geol ulite son cero bytes no sé por qué Porque si me voy a dam y me voy a primero y me voy a lenguajes y me voy a tres y me voy a proyectos y me voy a old l Cojo un proyecto intermedio me voy a Front geoloc ese kulite Zero bytes Pues mira vamos a ver en alguna parte lo debo tener completo proyectos geoloc cero H aquí vale Y tengo versiones no sé por qué pero tengo versiones de Ah Ya sé por qué vale Ok me lo copio me lo pego en hokar ivory entonces este jarsa ivory Y este geol kulite tiene no Albert por supuesto o sea evidentemente como te puedes imaginar el hecho de ahora estar intentando averiguar jug A qué país corresponde cada IP no es por capricho no es por estadística sino que es por que a continuación Igual digo Mira si detecto que me están fundiendo como antes de Singapur pues bloqueo Singapur no espero a nadie de Singapur O sea no tengo previsto dar servicios de empresa a Singapur por tanto para qué aceptar conexiones desde Singapur vale No hay forma de detectar VPN también te digo que yo lo que puedo hacer es todo el tráfico que no de España filtrado O sea descartado si alguien se conecta con una VPN y la IP cuenta como Estados Unidos Pues no que yo sepa no se puede detectar que yo sepa vale recordad no soy un experto en ciberseguridad igual sí que hay forma pero yo desde Apache no lo puedo saber Entonces ya te digo O sea si por ejemplo detecto que alguien se me conectan desde Rusia bloqueo Rusia si alguien en un momento dado se conecta una VPN que te da una IP rusa pues tío pues de la VPN o sea visítame con tu IP española pero no me puedo arriesgar vale bien entonces eh vamos a ver un momentín porque sí yo que sé o sea se podría Sí claro correcto Sí Ahora verás ahora un momen vamos a verlo a ver si nos damos una sorpresa metas a ver Probablemente sí sorpresa en cuanto a de qué países vienen los ataques a ver un momentín un momentín eh qué te iba a decir yo ahora quiero aquí me voy a ir Hola aquí me voy a ir a html no me voy a ir a dam me voy a ir a Primero me voy a ir a old L A lenguajes tres proyectos old l me voy aquí vale Y ahora me voy a Back me voy no dónde estás log Aquí está Vale país Okay vale entonces ahora voy a crear una conversación nueva Quiero el oer mini y digo eh get this python program then add to that program the logic on this php Script que es este to Connect to existing site database and transform resulting dictionary stating countries instead of IP vale es scrip HP es un scp HP que se conecta a una base de datos circul tú le das una IP y te devuelve el país Vale entonces vamos a ver cojo esto lo pongo dentro de ivory base de datos es Ok y la base de datos es geoloc sqlite está en la misma carpeta está en la misma carpeta sí está en la misma carpeta bien pues si todo ha ido bien yo ahora f5 Perdón f5 no Clear iory vale se estará conectando a la base de datos Okay vale unknown 3820 Estados Unidos 49 es decir tiene un Rango de ips que hace que estén dentro del Rango desconocido es decir dentro del Rango que también te digo que me extraña un poco me extraña un poco porque algunas debería dar desde España Ah a ver algunas debería dar desde España con lo cual igual no está funcionando todo lo bien que debería a ver okay Y okay porque aparte de esa base de datos Está en correcto funcionamiento porque la he puesto en funcionamiento en otro software O sea que en principio no debería fallar vamos a ver vale vamos a ver si te lo digo porque hay visitas de yo mismo desde ayer en ayer que no deberían ser unkown hay que no aquí unable to Open Eso quiere decir que la base de datos Está abierta Eso quiere decir que se ha quedado abierta voy a hacer una cosa voy a copiarla y pegarla geol 2 vale Y hay un close pregunto Close de database Sí que hay un close vale geolog ejecuto no algo pasa porque le dicho geolog 2 geolog 3 okay No Okay Vale y no espera pero pero 3 unable to open Ah espera Caray que no está en log está en geoloc vale venga vamos a ver Estados Unidos 49 unknown 163 no esto hay que depurarlo más todavía voy a probar una cosa a ver si me puedo saltar la base de datos python get country from IP porque igual hay alguna librería de python no quiero external Api geol IP database Esto es lo que me he bajado vale in mmdb espérate a ver igual eso funciona mejor databases and web Services vale mmdb ya pero dónde está databases sí pero a ver mmdb Okay country esto es de qué fecha vale Ok Muy bien me voy a html no me voy a escritorio Ok me lo pego en ivory quito por tanto el geoloc me vengo aquí y entonces digo okay perfect so update this code to use that mmdb database okay vamos allá Vale tengo tengo tengo dónde estás aquí no aquí geolite to country mmdb geolite to country mdb es el mismo nombre si Ok pues ejecutamos Ah sí sudo Bueno pip 3 install Geo ip2 Ok vale ejecuto No module name vale sudo no sudo pip 3 install goo ip2 break System packages Ok ejecuto de nuevo como sudo vale esto ya es otra cosa esto ya es otra cosa primero ha ido mucho más rápido segundo el resultado Ahora sí tiene mucha más calidad problema vale problema un montón de ataques vienen desde España Pero no pasa nada qui decir No pasa nada desde el punto de vista en el que el filtrado por país es solo un tipo de filtrado a partir de aquí eh o sea vamos a ver ahora los registros que vienen de España A qué páginas han accedido y por tanto Pues aplicamos un segundo filtro y es que creamos una colección de archivos php que no se puedan Llamar a los que no se puedan llamar y cuando alguien los llame bloqueamos la IP y ya está O sea que un tipo de filtro es por país otro tipo de filtro es blacklist Es decir aunque seas de España como detecte que intentas pingue una serie de archivos sospechosos te bloqueo la IP y ya está Vale sin embargo fijaos que aún así pues tela o sea Irlanda 529 Estados Unidos 286 Finlandia 273 vale Y ya os digo que la gran mayoría de estos serán ataques bien pues de momento lo dejamos aquí vale de momento lo que vamos a hacer en este caso es eh Por lo menos quedarnos con la lista de países y ahora luego al acabar lenguaje de marcas con los de primero cuando vuelva con vosotros pues listamos por ejemplo Cuál es el tráfico de cada uno de estos países y veo tráfico sospechoso desde aquí o desde aquí pues bloqueamos por país y asunto resuelto vale de la misma forma que pues vamos a adoptar otras medidas para por ejemplo conectar los logs de Apache con el firewall de Linux y decir a cuando detecte que ciertas ips tienen un tráfico sospechoso las añado al fw day Linux actualizo el firewall de Linux y a volar vale o el de Apache también puedo hacer blacklist directamente desde Apache Así que paramos de momento paro la grabación