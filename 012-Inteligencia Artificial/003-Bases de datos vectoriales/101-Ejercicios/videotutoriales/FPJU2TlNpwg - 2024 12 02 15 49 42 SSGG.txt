por ejemplo eh yo en este caso como estáis viendo estoy creando eh estoy trabajando con una sola base de datos vale Por qué Pues porque e me vendría muy bien que en mysql tuviera algo así como sabes grupos de tablas o carpetas de tablas o sub tablas pero no lo tiene vale Yo soy de la vieja escuela y yo soy de una época en la que cuando creab una aplicación Pues a una aplicación se le asociaba a una base de datos pero técnicamente a día de hoy por qué no alguno de vosotros podría decir Oye y por qué no creamos una base de datos para cada departamento y luego dentro de la aplicación Podemos intercambiar información de base de datos a base de datos vale eso técnicamente se puede hacer Entonces qué ocurre Pues que esa sería una solución que vosotros podríais proponer vale con esto quiero deciros que hay ejemplos muchos de cómo se puede modificar la lógica que yo estoy implementando para implementar otra lógica diferente de tal forma que por ejemplo en una base de datos diferente por cada departamento la información estaría mucho más compartimentada pero luego quizás en el superc controlador del lado del servidor pues tendríamos que hacer aquí en el servidor tendríamos que hacer diferentes instancias de una conexión de B pero también te digo que sabes qué ocurre pues que no hay ningún problema porque para eso hemos hecho un objeto y si hemos hecho un objeto es que podría hacer conexión un es igual a New conexión de B conexión dos es igual a New conexión de b y podemos hacer tantas conexiones como nos dé la gana ahora mismo nuestro nuestra conexión de B está fijada al local Host crimson pero vosotros sabéis que en un constructor yo puedo pasarle parámetros de construcción con lo cual cada instancia de la base de datos podría apuntar a una base de datos diferente vale Y por tanto desde un solo concentrador modificando un poquito el código podríamos apuntar a diferentes bases de datos de forma simultánea Insisto que no voy a implementar esa solución pero podría implementarse yo creo que tirar a varias bases de datos a la vez Pues podría causarnos al final un poco de conflicto Pero todo es sopesar ventajas y desventajas vale al final bueno de momento como os digo lo hago en una voy a implementar esta solución que estaba implementando antes simplemente quería Pues daros un poco de luz acerca de que no deis por hecho que esta forma en la que yo lo estoy haciendo es la única forma de hacerlo vale bien entonces vengo por aquí y digo claro cuando yo seleccione una tabla pues quiero que tú me devuelvas las tablas que yo debo seleccionar cómo lo hago Bueno pues para ello me voy al vamos a ver aquí esto fuera me voy al proyecto y en el proyecto 109 cargo solo las tablas que me corresponden y ent ejemplo en el servidor en la conexión a la base de datos puedo crear un nuevo método veis tenía por aquí selecciona tabla vale Esto no es selecciona tabla esto es listado tablas o algo así listado tablas Ahí está Vale tengo un listado tablas pues eh puedo crear otro Mira voy a copiar y pegar esto creo otro método lo bueno como veis de trabajar con un objeto y con métodos de objeto es que extender los métodos es muy limpio vale listado tablas aplicación y aquí dentro cojo como parámetro aplicación y entonces digo Select Table names vamos a ver Table names as Table in vale esto s pero Table name as tables vale Esto sí que lo quiero Por tanto dis base de datos vale Table comment as comentario también quiero esto vamos a ver voy a hacer lo siguiente eh Aquí voy a fusionar estas dos peticiones merch esto with esto a ver qué me da no A ver con un join Select vale tables in tú crees A ver pues no lo sé vamos a hacer una petición nueva para no perder la anterior Okay Vale dis base de datos es eh crimson dis base de datos es crimson Okay Wow Vale pues Mola pedidos esta la guardamos Vale pues fantástico pues me quedó eso Entonces eh Vamos allá Pues vamos a esta petición vamos a pegarla aquí hasta dónde la pego yo creo que hasta aquí okay parece correcto no parece correcto Sí parece correcto esto me sobra y esto me sobra vale no no quieto Okay y yo creo que ya y yo creo que ya Entonces si esto me devuelve lo correcto me voy al concentrador y aquí donde pone no cuidado aquí donde pone listado tablas no sé dónde está listado tablas esto lista tablas es lista tablas ahí vale Ok copio Esto me creo una nueva ruta lista tablas aplicación listado tablas aplicación y get cuidado y get aplicación vale es decir cuando desde el cliente se me llame a lista tablas aplicación y se llame a una aplicación ejecutar el método listado tablas aplicación y el método listado tablas aplicación Pues ejecuta esta consulta y devuelve un Jason como de costumbre vale con lo cual si todo va bien me voy al cliente e aquí me voy al cliente me voy al superc controlador me voy a comportamiento vale Y por aquí listado tablas vale Pues en lugar de listado tablas yo digo lista tablas aplicación Qué aplicación and aplicación es igual a local storage get item aplicación me tirado yo muy a las bravas igual ahora lo divido en dos líneas vamos a probarlo me voy a la versión última me voy a la versión 109 me voy a cliente me voy al escritorio vamos a probarlo a ver si funciona No creo pero sacamos por aquí la consola ventas vale Ok error muy bien Por qué not J vale local storage get item esto ser correcto vamos a ver login si esto es set item esto es get item Ah ostras crimson aplicación Espera que el monitor se me ha apagado vale crimson aplicación recargamos primero crimson aplicación vamos a ver aplicación crimson aplicación es ventas vale Okay ahora a ver qué dice el error yo digo aplicación Let aplicación es igual a local storage get item aplicación console.log la aplicación es más aplicación y ahora aplicación es decir antes de da un error pues vamos a ver dónde está el error vamos a ver si coge correctamente la aplicación vale recargo la aplicación es nul Aquí está el error Vale entonces por qué no lo sé porque debería cogerla correctamente Entonces yo me voy a application y veo que tengo un crimson Ah crimson el error está ahí vale pues me voy a login y veo que en login se ve que he puesto Espera que te lo digo eh local storage esa vale crimson usuario Ah Sí perdón en el comportamiento del escritorio he puesto crimson vale es crimson Okay venga volvemos recargo ventas vale crimson aplicación ventas Vale ahora me dice la aplicación es ventas vale ese error está solucionado ahora me sigue dando un error muy bien Vamos a ver qué error me da para saber qué error me da ya sabéis que si siempre el mismo mecanismo que consiste en que donde me está diciendo jas pues pongo punto text a ver qué me está diciendo el servidor y el servidor me dice esto fatal error you have an error in your sql near crimson vale vale hay un error en sql Okay hay un error en sql vamos a ver qué dice sql me voy al servidor me voy al Index y no perdona me voy a conexión de b y en aquí en public function listado tablas digo eco query recargo vale el query es este de aquí está el problema tables in crimson ese crimson se me ha quedado fuera ese crimson se me ha quedado fuera este crimson aquí está se me ha quedado fuera vale eh esto de quía ir aquí Ok y yo creo que ya vale vamos a probarlo Ok el servidor dice ok vale bien pues entonces si el servidor dice ok le quito el punto text recupero jas console log datos lo vuelvo a activar y recargamos vale todavía no Ah cuidado Perdón y aquí quito el looc query Okay venga vale Y ya está en principio parece que funciona entonces eh vengo por aquí vale vuelvo atrás por cierto no tengo forma de Volver atrás más que el botón de atrás vale esto también tendríamos que solucionarlo bien me voy a facturación y en facturación veo pedidos vale recordad que en ventas veo Ah pedidos también vale Ok pedidos y Ah a ver un momentín pedidos Y qué veo en contabilidad Siempre veo pedidos vale Ok hay algo que no está bien vale Muy bien pues vamos a ver eh comportamiento la aplicaciones ventas clientes y pedidos A ver vamos a ver si estoy en ventas Ah la aplicación es ventas Vale y la aplicación es facturación Vale y la aplicación es contabilidad vale Y veo clientes y pedidos vale Okay pues algo pasa vamos a ver si la aplicación es ventas aplicaciones vale esto son aplicaciones okay nada y aplicaciones de talle de pedido vale Ok aquí no me cuadra que vea pedido siempre Claro Por qué Pues porque siempre me está dando facturación vale Okay entonces ahí está el error aquí cambio facturación por la aplicación correspondiente Okay Vale ahora sí entonces en ventas veo a los clientes en facturación veo a los pedidos en contabilidad veo a los productos y a los pedidos Vale y de esta forma yo lo que estoy haciendo es posibilitar que en el panel de control yo pueda asociar Qué entidades pertenecen a ventas es decir no le muestres a alguien algo que no quiere ver bien como os digo esta es una forma de solucionarlo vale habrían 1000 formas diferentes de solucionarlo y ahora a continuación en esta siguiente parte de la clase vamos a hablar también de permisos Vale ahora mismo yo tengo usuarios que pueden ver O sea que usuarios que pueden entrar en la aplicación y usuarios que no pueden entrar en la aplicación vale pero claro técnicamente en la realidad aquí debería tener algo como que por ejemplo si yo entro como superadministrador Pues yo lo pueda ver todo ahora si yo entro como ventas Pues igual debería ha ventas y facturación quizá pero contabilidad en principio no vale o si yo entro como ventas no debería ver recursos humanos Pero si yo entro como recursos humanos debería haber recursos humanos pero no ventas vale Así que a continuación de hecho ahora mismo Nadie puede ver eh o sea hay ciertas tablas Que nadie las puede ver vale Si no las doy de alta vamos a hablar de permisos insisto una vez más vale insisto al igual que lo he hecho aquí en el que Cuáles serían los permisos por ejemplo voy a sacar un editor de textos aquí vale o Aquí Cuál serían los permisos por ejemplo para un centro de formación Pues sería en el nivel más bajo invitado a continuación si habláramos de un moodle por ejemplo ya que este sistema de gestión empresarial podría ser un moodle hablaríamos de estudiante e a continuación hablaríamos de profesor quizás a continuación hablaríamos de tutor por encima de tutor podríamos hablar de jefe de estudios quizás por encima de jefe de estudios hablaríamos de dirección Generalmente desde el punto de vista del acceso a los datos por encima de dirección está secretaría y luego pues por ejemplo por aquí arriba hablaríamos del ador que lo ve todo en la aplicación pero claro qué ocurre que este sistema de permisos pues Vale para un centro de formación pero no para una empresa que fabrica mesas Así que una vez más os he puesto un ejemplo de algo concreto pero ahora a continuación recordad que estamos desarrollando una aplicación tal que luego esta aplicación entre comillas con el menor esfuerzo posible Debería ser implementable en cualquier escenario por tanto si yo implemento un sistema de permisos donde ponga estudiante cuando luego lo intenté aplicar en una fábrica de mesas pues veré que el sistema de permisos no me vale para nada vale entonces a partir de aquí tengo que crear pues departamentos vale Y tengo que decir quién ve el qué si yo creo departamentos luego a partir de ahí pues cada usuario podrá ver una serie de cosas de esta forma vamos a verlo e me voy a aquí me voy a tablas y de la misma forma que tengo aplicaciones voy a tener departamentos y diréis una aplicación no es un departamento No porque luego hay departamentos que deben poder acceder a varias aplicaciones vale Así que eh dónde estás aquí creo departamentos número de columnas cuatro Vale y identificador siempre 255 índice autoincremental vale Y ahora qué digo pues ahora digo el nombre del departamento y ya está Vale y ya está y la descripción es un texto vale Okay y ya está claro a continuación lo que tengo que hacer es determinar cada usuario A quién pertenece esto qué quiere decir Bueno pues que yo a continuación voy a insertar el departamento de ventas Esta es la descripción del departamento de ventas y cuando yo cargo una tabla tablas aplicaciones yo aquí puedo definir Quién ve el Qué vale un momentín aplicaciones nombre tabla clientes no ahora voy a crear una nueva tabla llamada departamentos aplicaciones ahora luego sacamos el gráfico sql identificador entero 255 y digo departamentos eh nombre vale nombre a aplicaciones nombre entero clave foránea esto es departamentos aplicaciones a e A qué a departamentos Así que aplicaciones no perdona departamentos tabla departamento y departamentos aplicaciones y departament aplicaciones Perdón aplicaciones y ya está eso quiere decir que ahora en departamentos o aplicaciones es decir qué aplicaciones puede ver cada departamento le doy a insertar y le digo el departamento de ventas puede ver ventas con lo cual Ok identificador incorrect Por qué por qué buen departamento es aplicaciones ostras se llama aplicacion es aplicaciones se ve que se me ha ido una s aplicaciones vale Y ahora por qué me ha dado error a ver no departamentos tiene Ok Ah oh departamentos no es una clave primaria autoincremental Ah sí lo sí no me lo ponía departamentos vale aplicaciones vale Por qué no me funcionas a ver inserto ventas tiene que ver ventas insert in departamento aplicaciones valius Ah espera departamentos aplicaciones estructura esto es el problema vale a ver estructura esto fuera vale añado una al comienzo de la tabla se llama identificador es entero primario Vale ahora yo creo que sí entonces inserto en ventas Quiero ver ventas Okay ahora sí vale con lo cual ahora vale Hasta el momento cuando entra un usuario lo ve todo por ejemplo eh voy a crear un nuevo usuario voy a crear un usuario llamado ventas con contraseña ventas y e nombre ventas apellidos ventas vale luego tenemos el usuario llamado facturación con contraseña facturación y nombre facturación Vale qué ocurre Pues que si yo ahora en crimson Ahora cuando cierre sesión que es otra cosa que tenemos que implementar si yo entro en ventas login entro correctamente Pero yo lo estoy viendo todo vale con lo cual ahora teóricamente según este de datos que he asociado si entro como ventas si entro según el departamento de ventas debería haberlo todo el problema ahora es este usuario A qué departamento pertenece pues no lo sabemos Vale entonces o sea porque no pertenece a ninguno por ello lo que tengo que hacer es alterar la estructura de esa tabla y decir departamentos nombre es decir A qué departamento perce este usuario vale el usuario ventas pertenece al Ay no he creado Perdón la relación usuarios a departamentos el usuario departamentos corresponde a un departamento qué pasa pues que no hay nadie todavía vale Okay referencia departamento Okay departamentos uno usuarios ahí está uno estaba haciendo referencia a una casilla que no existe vale departamentos usuarios departamentos vale columna departamentos y ya vale entonces ahora los tres usuarios pertenecen a ventas eso qué quiere decir pues eso quiere decir que yo ahora mismo en el momento en el que estoy entrando en ventas debería mostrarse únicamente las aplicaciones que corresponden a ventas no todas las aplicaciones de dónde vienen estas aplicaciones pues vienen de que el servidor yo le pido un momentín Espera que te lo digo Bueno vamos a verlo aquí eh escritorio comportamiento tabla aplicaciones Ah perdón vale Sí pues vamos a ver y espera tabla aplicaciones Vale pues yo ahora vengo aquí y tabla aplicaciones Vale me da todas las tablas Okay Venga pues ahora digo Select all from aplicaciones pero no me des todas vamos a ver esta consulta sql va a tener su movida left join usuarios on usuarios punto usuario es igual a ventas por ejemplo no we esto es un we vale on claro aplicaciones espérate no puedo todavía juntar con usuarios tengo que saber a qué departamento pertenece ese usuario mira V a hacerlo al revés Select all from usuarios no es queé sí correcto Vale qué aplicaciones V ese usuario Vale ahora left join departamentos on usuarios punto departamentos es igual a departamentos punto identificador ahora qué aplicaciones ve ese departamento left join departamentos aplicaciones on departamentos aplicaciones punto departamentos nombre es igual a departamentos pun identificador vale left join aplicaciones on departamentos aplicaciones punto aplicaciones nombre es igual a aplicaciones pun identificador Vale ahora sí we aplicaciones no we usuarios punto usuario es igual a ventas y ahora selecciono lo que quiero qué es lo que quiero pues las aplicaciones nombre si esto es cierto le doy a continuar y me dice que el usuario ventas puede ver la aplicación ventas vale que es lo correcto es decir en aquí en departamentos o aplicaciones pues hemos visto como ventas puede ver la aplicación ventas ahora haremos diferentes casos vale Ahora hay que probarlo para comprobar que funciona bien De momento lo que quiero es implementar esto entonces Donde antes ía una tabla donde antes la aplicación era ver una tabla Pues ahora no puede ser ver una tabla entonces para ello vale 110 aplicaciones por usuario Insisto que ahora comprobaremos que todo funciona correctamente y vamos a ver el servidor me voy a conexión deb y bueno básicamente voy a algo así me cojo este método se llama listado aplicaciones usuario vale es el usuario lo que entra como permiso o se algo que entra como parámetro Me cojo el sql me lo copio me lo pego el usuario es usuario y yo creo que todo esto me lo puedo dejar tal cual esto no sé por qué existe Ah sí sí porque lo convierto a jas Sí vale con lo cual listado aplicaciones usuario ahora en el Index me tengo que crear una nueva ruta Case listado aplicaciones usuario con el get usuario Y por último en la parte frontal en la parte frontal en la parte de escritorio tengo que llamar a operación listado aplicaciones usuario and usuario es igual led usuario es igual local storage get item crimson usuario and usuario es igual a usuario vamos a verlo vamos a ver si es cierto vamos a ver si va bien vale aplicaciones por usuario cliente me voy a ventas a ver si no da ningún error entras correctamente en principio y vale solo veo ventas si yo intento entrar como jarsa dónde entro Bueno pues en jarsa también veré ventas vale porque a jocsa lo he añadido al departamento de ventas pero voy a Añadir más departamentos por ejemplo si entro a facturación vale si entro a facturación pincho y vamos a ver como facturación también va a ventas y ahí lo tenemos pero yo no quiero esto yo lo que quiero a ver que cierre cosas yo lo que quiero es que haya un departamento o Hola haya un departamento voy a refrescar Esto vale hay un departamento llamado facturación inserto facturación Y esta es la descripción del departamento de facturación Vale ahora tengo departamentos o aplicaciones Vale pues tengo que inserto Y entonces al departamento de facturación le toca la aplicación de facturación continúo y la aplicación de facturación pues ya sabemos que es esto de aquí vale Y en facturación por cierto vamos a ver en facturación está pedidos ya lo teníamos configurado antes muy bien Eso quiere decir que si entro en ventas login y veo ventas vale Okay He veo ventas pero si entro en facturación entro correctamente a veo ventas vale a ver qué pasa veo ventas por qué pues yo sospecho que es porque en el sql no el sql sí que recuerdo que lo había cambiado correctamente usuari es igual a usuario vale vamos a hacer ec query e usuarios igual voy a hacer una cosa me copio todo esto me lo pego en esql Ah Espérate Perdón es que claro al usuario facturación no le cambiado el departamento Vale entonces al usuario facturación pertenece al departamento de facturación Vale ahora sí vamos a ver tiro para atrás facturación le doy a login Y si todo ha ido bien Vale pues Ahora el departamento de facturación ve facturación o quien sea por ejemplo facturación también quiero que vea ventas pues no pasa nada vamos a hacerlo le decimos que vamos a ver aplicaciones por departamento Okay departamento de aplicaciones Vale pues inserto y digo mira el departamento de facturación también debe ver ventas y Ok continúo vale me vuelvo atrás y digo ventas login y Okay y veo solo ventas pero me voy a facturación y en las aplicaciones veo tanto facturación como ventas y por lo tanto como vemos lo que acabo de hacer es implementar un sistema de permisos de tal forma que creo departamentos creo aplicaciones por departamento y puedo asociar usuarios a departamentos de forma que cuando entra un usuario solo va a ver lo que le interese ver vale estamos creando por departamentos Claro que luego en las empresas Pues igual te dicen no pero es que este usuario concreto lo tiene que ver todo o es que este usuario concreto puede ver esto y esto otro vale como ya os digo da igual todo lo abstracto que programemos porque luego siempre cuando llega una empresa te pondrá cosas que te obligarán a modificar la lógica de tu aplicación por eso como ya os digo Aunque os resulte difícil a veces de seguir las cosas que hago en clase pero el objetivo es que te pida lo que te pida un cliente tu aplicación esté programada de la forma suficientemente abstracta como para que puedas aplicarlo al cliente vale porque si tu aplicación está programada de forma demasiado concreta pues simplemente la casuística y la lógica de negocio de tu aplicación no cuadra con la lógica de negocio vale o sea la idea es que esta aplicación como os digo y Esto hace que sea difícil ahora pero para que luego sea fácil la lógica de esta aplicación es que esta aplicación sea como plastelina que no tenga una forma totalmente definida pero que tenga una forma tal que luego lo puedas adaptar sobre prácticamente cualquier caso vale con esto como os digo en la clase de hoy pues hemos implementado dos cosas muy importantes que es tanto aplicaciones como permisos y luego por supuesto vale me voy a ventas y ventas solo verá clientes y facturación solo verá pedidos o lo que sea es decir ve esto porque lo hemos decidido pero luego cada aplicación y cada usuario Verá lo que nosotros configuremos ahora como os digo pues una forma de personalizar esto es que cada uno de vosotros cojáis y digáis Oye pues yo voy a implementar o sea insisto cada uno de vosotros el negocio que mejor conozca evidentemente no os voy a obligar a implementar negocios que no conocéis porque vale porque estaríais en desventaja pero seguro que cada uno de vosotros conoce al menos algún tipo de negocio o tiene algún conocido o algún Familiar o algún amigo que al cual le puedas preguntar Oye dime cómo funciona tu negocio que necesito replicarlo en un sistema de gestión empresarial vale bien eh esto ha sido la parte fuerte de la clase de hoy de hecho ha sido bastante fuerte vamos a implementar alguna chorradas que nos queda por implementar que nos quedan muchas chorradas Como por ejemplo cerrar sesión o sea yo cada vez estoy viniendo aquí tiro para atrás vuelvo al login espérate Esta no es una forma muy de cerrar sesión vale Porque técnicamente mi sesión está totalmente abierta pues teóricamente lo que tengo que hacer es eliminar el usuario vale Yo voy a hacer una cosa Por cierto vamos a duplicar el proyecto y copio pego y 111 cerrar sesión vale cerrar sesión yo pregunto no sé si lo hicimos ya pero si me voy a cliente me voy a jocars jarsa que jok carsa ahora mismo es del departamento de ventas vale porque lo hemos dejado así bien si yo ahora en application si yo me cargo el usuario crimson usuario y yo recargo de hecho me cargo todo el crimson vale Y yo perdón y yo recargo mal esto no tendría que estar ocurriendo vale estoy dentro de la aplicación tengo que programar algo para que el sistema detecte si me he intentado colar y si me he intentado colar me tiene que echar vale cómo lo puedo hacer Bueno pues de forma muy sencilla si yo estoy en la aplicación si yo estoy en la aplicación y estoy en escritorio y aquí en comportamiento le digo Let usuario Mira así vale Ok mira aquí mismo ya lo tenía aquí y digo If usuario es igual a undefine en ese caso window pun location es igual a dos puntos barra y ya es decir salte de aquí no Tienes usuario No tienes permiso para estar aquí vale recargo y veis que me he salido vale veis escritorio no me deja Bueno un momentín correcto vale yo de momento Beatriz lo que estoy haciendo es implementar una medida de seguridad muy básica muy de niños que es eh si no existe salte pero claro si no existe salte Eso quiere decir que cualquier persona me puede localizar esto de aquí vale me puede esto de aquí crims usuario y decir ah que quieres crimson usuario pues te pongo crimson usuario te pongo Vale entonces La pregunta es cualquier persona me lo puede trucar vale bien la respuesta a eso podría ser lo comentar que es el concepto genérico de token El token básicamente es una llave de tal forma que en primer lugar nos aseguramos de si tenemos llave y si tenemos llave en ese caso podemos pasar claro yo aquí por ejemplo cuando hago un login cuando hago dónde estás aquí un login en el momento en el cual estoy haciendo un local storage set item yo lo que podría hacer es local storage Perdón punto set item y voy a poner directamente token vale o crimson token y cuál sería el token que pondría Pues aquí viene el problema vale aquí viene problema porque eh En este caso lo que ocurre es que haga lo que haga ponga lo que ponga aquí me cualquier persona me lo puede atrapar Vale entonces cuando yo defino un token pues no es correcto por ejemplo que lo ponga en el lado del US del cliente el token Debería ser calculado debería provenir y debería también ser validado en el lado del servidor para ello cuando realizo vamos a ver Buscar tabla usuarios Vale entonces en Buscar me voy a buscar y en el servidor cuando conexión de B cuando ejecuto Buscar Aquí está Vale tabla datos aquí por ejemplo podría poner lo siguiente eh retorno es igual Epa retorno es igual a voy a crear una objeto a ver un momento espera porque quiero aquí fila Es que este fila no Ah sí tú nada vale token es atención un momento Beatriz voy a poner date u es el número de segundos que han pasado desde el día 1 de enero 1970 a lo cual tú Beatriz dirás menuda de token porque cualquier persona te lo puede averiguar vale pero de momento lo que quiero es lanzar un token y a ver qué pasa estoy todavía aquí cerrar sesión vale cliente yo pongo vamos a la consola yo pongo jarsa vale con lo cual me voy a login y tengo un token vale tengo aparte de todo esto tengo un token Ahí está Vale y ahora eh usuario incorrecto me estás contando como que Cómo que usuario incorrecto pero si me has dicho correcto Hola a ver Eh Esto del token creo que no ha hecho mucha gracia vamos a ver okay login Ah error al entrar Vale lo del token no le ha volado un momento ventas error a entrar muy bien pues vengo por aquí y entonces aquí Okay vale y aquí antes de asignar esto le digo fila token es igual a date vale vamos a probarlo jarsa le doy a login vale Uh file to execute set item espera fila token es igual a day to esto no le ha molado nada Ay qué rollo porque no sé por qué no la ha molado a ver file to execute sí míralo y por qué no entras a ver momento a ver ventas login error vale esto fuera login Ahora sí pero no a ver Ah Espérate Espérate Esto me lo he dejado así a mitad sabes o qué Vale ahora claro me he dejado eso a mitad y Con razón no funciona vale ventas login Okay acceso correcto y compruebo que tengo un token vale y entro si tengo un token Ahora sí puedo desbloquear eso que me había dejado a mitad que me estaba causando el error local storage set item es igual a Data de cer punto token vale con lo cual ahora a continuación yo por ejemplo puedo decir Vale pues si tengo un token momento tiro para atrás vale me voy a hok carsa login 5 segundos me voy a application y tengo un crimson token que es esto de aquí pero como decía hace un momento Como le decía Beatriz pues esto es una de token porque cualquier persona que lo vea dirá esto es un apoc vale con lo cual de Cara a validar el token simplemente me construyo un apoc y ya está Pero y si y no voy a profundizar mucho porque esto es lo que estábamos tocando hace un par de semanas en acceso a datos vale Y eso corresponde más a acceso a datos Y si digo base 64 en code date u o si uso la librería que tenemos vale la librería de codifica porque para eso la tengo Pues yo entonces vengo por aquí tiro para atrás Me voy a ventas le doy a login Ah espérate y el crimson token técnicamente ahora es un apoc pero es un apoc codificado en un base 64 insisto Es una codificación muy flojita pero el concepto es ese el concepto es el de la codificación vale de esta forma eh tenemos ya una forma de asegurar que nadie se nos pueda colar Por cierto he escrito el token ahora tendría que comprobar el token vale no me da tiempo hacerlo en la clase de hoy pero sí que quiero hacer el cerrar sesión Vale entonces para cerrar sesión un momento para cerrar sesión voy a hacer lo siguiente un momento ahora 112 cerrar sesión manual en incape hace Mira no está aquí hace unas semanas en interfaces estuvimos haciendo segundo eh sistemas vale proyecto Okay abriendo vale cerrar sesión manual me voy a eu cliente me voy a img No aquí aplica no esa voy a superc controlador así me voy a img y icono vamos a verlo Vale pues Ahora voy a crear el icono cerrar sesión hago así color de trazo es blanco relleno ninguno voy a ver no esto no la página no me soluciona Ahora sí vale entonces ahora hago un botón así hago un botón así vale esto Qué es Ay claro esto Debería ser crimson vale otra cosa que puedo hacer es esto a esto le quito esto vaya no vale pues otra cosa que puedo hacer es partirlo Okay eso sí que lo puedo hacer y ahora dibujo un icono clásico icono de cerrar Power y esto lo guardo como icono cerrar o icono sesión iconos.svg vale Y conoses svg esto quiere decir que ahora aquí me voy a cerrar sesión manual vale me voy a ver un momento aquí me voy a cliente ventas entro vale Y ahora aquí en ventas técnicamente en escritorio en img Ahí es donde debería estar la imagen de cerrar sesión cliente escritorio y superc controlador imagen y icono sesión debería ir aquí ha funcionado creo que no cliente superc controlador img icono sesión escritorio img Bueno luego también debería estar en el otro pero vale bien y ahora en escritorio en html en aquí heer vale bueno o aquí img src img icono sesión svg y de cerrar sesión Okay Vale ahora este icono en el estilo cerrar sesión es eh Pos absolute top 10 píxeles right 10 píxeles okay quizás un poquito más pequeñito with 50 píxeles Okay algo así vale Y ahora lo que tengo que hacer es programar qué es lo que ocurre cuando pulso Ese botón Entonces cuando pulso Ese botón en el comportamiento por aquí por ejemplo le digo document query selector cuando sobre cerrar sesión punto onclick es igual a function y en el function voy a decir local storage punto set item crimson usuario es nada no delete item locar storage crimson token y window location es igual a esto de Aquí vamos a verlo yo he entrado como ventas login y entro vale Y soy el usuario vamos a ver momento y local Host crimson usuario ventas pero yo ahora cierro sesión Y si todo va bien error delete item vale Ok será nul local storage delete item Ah remove item vale remove item Venga pues recargo quieto esto no recargo pincho salgo pero ahora supongamos que me quiero volver a meter en el escritorio y no me deja porque he cerrado sesión vale no me deja porque en application ya no hay un crimson usuario hay un crimson aplicación pero hay un crimson usuario si ahora entro en ventas y en ventas login vale Y solo entonces entro en ventas Así que un poco a poco vale la idea es ir implementando mecanismos de eh de seguridad vamos a ver Beatriz si me da tiempo en los 10 minutos que quedan a implementar token a implementar validación de token entonces Yo vengo por aquí y digo vale me salgo pero soy un usuario muy Pillo y digo mira me creo un crimson usuario es igual a ventas vale Por qué Porque soy se puede hacer Así es decir fijaos que lo acabo de hacer yo y no soy nada hacker O sea que si yo puedo hacer esto se puede hacer mucho más lo cual quiere decir que yo me voy a escritorio eh Perdona crimson a usaurio Perdón usuario es que soy un hacker disléxico sabes una PC que tengo usuario Ahora sí bien Así que me voy a escritorio Vale y entro en escritorio O sea me acabo de colar vale acabo de eh acabo de colarme dentro de la aplicación ahora bien yo tengo antes he creado un token Vale entonces me vengo por aquí 113 validar token Y entonces al validar token yo de hecho incluso podría crearme un crimson token es igual a trucu pero claro ahora trucu no va a valer bien entonces y ahora vengo por aquí y cierro Esto me voy aquí a proyecto me voy a validar token lo voy a poner en línea pero ya sabéis que tiene pinta de que luego va a ser lo típico que modularizar me voy a escritorio me voy a comportamiento y digo vamos a ver Let token es igual a local storage get item crimson token en primer lugar si no existe sal de aquí es decir he trucado vamos a verlo vale he trucado el usuario pero no he trucado el token vale con lo cual Okay Vale ahora voy a trucar el token crimson token es igual a trucu Vale y vlido y entro pero ahora no solo voy a comprobar si tengo token sino voy a comprobar si el token es correcto así que me voy a fetch me voy a fch y digo en servidor voy a comprobar o comprueba token y token es igual a token ya está Vale ahora punto den vale punto den Espera que ahora qué es comprueba token pues comprueba token me vengo aquí en index Y entonces digo en caso de comprueba token voy a hacer lo siguiente vamos a ver If voy a decir de momento voy a decir de momento eco resultado a ver que no lo escriba al revés resultado es okay vale vamos a verlo eh console punto log Data Ok recargo no eh J son response vale Por qué internal server error me he dejado un punto y coma No sí me he dejado un punto y coma vale como siempre OK eh nombre ventas expert name or vale Ok a ver creo que lo he formateado el revés Okay no Non White space posición eh Cómo vale un momento esto es text a ver qué Vuelve aquí Warning Oh por qué 26 me estás contando Ah break caray break qué rabia vale Es que a veces comet unos errores más tontos vamos a ver ahora resultado Okay bien con lo cual yo vengo y digo If Data punto resultado Okay es igual a Okay en ese caso nada en caso contrario Windows location es igual a Windows location pero de momento me ha dicho Okay vale de momento me dice ok así que me quedo ahora voy a validar el token y voy a decir lo siguiente vamos a ver sí esto aquí nada aquí vale Okay sí base 64 de code de get token Por qué get token Pues porque te estoy enviando un parámetro llamado token vale como si se llama kaca como se llame si vas 64 token menos date u valor absoluto es menor que 3600 vale en ese caso resultado ok En caso contrario resultado Ko es decir si te dan un token y además ese token dura menos de una hora es de hace menos de una hora en ese caso pasas si no muerto qué ocurre que en este caso el no es que sea de menos de una hora es que no es ni siquiera un número son letras vale vamos a verlo el token en application vale Son mín token son letras V con lo cual si todo va bien Vamos a verlo recargo Ok aquí qué me dice el token me dirá que directamente error vale un momento punto text Uy Ah sí vale Okay eso ya sí pero no espera un segund antes de irte escritorio vale eh Y Okay y console.log Data falta el error al suor oper types String menos String O sea no puedes hacer Esto vale no puedes hacer esto no puedes a un String restarle otra cosa Vale y entonces digo vamos a ver menos esto Ah perdón esto es mayor que o sea menor que perdón pero da igual porque va dar va a seguir dando error Ok entonces a ver si esto and un mín php check If String is not a number is numeric vale perfecto ahí Esto es lo que quiero en no is numeric token vale Ah no is numeric token OK Vamos a verlo recargo String men String lnea 25 no tengo que ponerlo aquí If is numeric token en ese caso pasamos a esta fase vale els resultado Ko vale vamos a verlo Ahora sí resultado Ko vale Y si resultado Ko en ese caso como resultado koo y aquí te vas a jas vale Te vas aquí es decir escritorio Vale Me estás intentando dar un token Eh simulado vale un token falso ahora bien yo entro en ventas me voy a login ahora el token es válido con lo cual si todo va bien vaya aado c otra vez momentín no debería a ver escritorio el token da Ko Por qué momentín el token Ah porque no he guardado muy bien fantástico token Ko If is numeric get token vale Okay a ver ko2 sko 2 hostias eco get token y punto texto Ah vale Claro Perdón esto es va 64 de code el resultado Ok Vale ahora sí Ko esto aquí y esto aquí vale volvemos cierro sesión me voy a ventas me voy a ventas login si todo va bien entro vale con lo cual cierro sesión y ahora intento simular un crimson usuario ventas y recargo me intento colar escritorio y no voy a poder porque no estoy simulando un token Y si intento simular un crimson token Qué le pongo y Yo qué sé porque es que solo el servidor conoce la forma vale con lo cual sigo me sigue devolviendo el escritorio es decir solo el servidor conoce el algoritmo mediante el cual se está codificando y descodificando el token que insisto una vez más ahora mismo es un algoritmo muy básico pero en un futuro pues puede ser un algoritmo Eh pues más elaborado o incluso la librería del codificador que utilizamos el otro día que hicimos el otro día vale bien pues con esto finaliza por hoy la clase de sistemas de gestión empresarial acordaros que vamos a ver editor de texto aquí vale acordaos que de qué forma podéis personalizar vale personalizar la aplicación aunque esto os lo enviaré luego por correo pues uno implementar eh diferentes tipologías de empresa en eh en la metodología que hemos cubierto hoy completar departamentos aplicaciones tablas etc vale eso es lo que comentamos el otro día el objetivo número uno que cada uno os hagáis una aplicación completamente diferente Ahora reescribir el código vale es decir ir más allá Pues ir más allá consiste en implementar un sistema diferente al mío No necesariamente mejor Y ahora os cuento Qué quiere decir eso de aplicar aplicaciones a perfiles y de implementar niveles de usuario os voy a contar una cosa con respecto a lo que preguntaba Albert el otro día que era esta parte de aquí de el reto digamos supremo vale que es o sea rescribir el código desde cero y cambiarlo eh Cuando implementándose y Oye si tomáis un camino alternativo pues quizás puede ocurrir que ya puestos lo hacéis mejor ya os digo que siempre que haces algo la primera vez es difícil que además siendo la primera vez lo hagas bien vale No es eso lo que pretendo sino que lo que pretendo es que mentalmente investigué otros caminos no solo que sigáis mi camino vale sino que la persona que elija esta alternativa directamente haga un camino diferente con que ese camino no acabe en punto muerto ya me vale con que ese camino realmente implemente una solución alternativa ya me vale que sea mejor que la que he expuesto yo Pues bueno ojalá que sí pero si no pasa nada vale Ya habrá tiempo para ello bien pues con esto como os digo finaliza esta primera sesión de sistemas de gestión empresarial y vámonos a aplicaciones multimedia donde pues hoy continuamos con el tema de desarrollo de aplicaciones móviles Así que vamos allá bien guardo esto en personalizar aplicación vale paro por aquí cierro código paro grabación