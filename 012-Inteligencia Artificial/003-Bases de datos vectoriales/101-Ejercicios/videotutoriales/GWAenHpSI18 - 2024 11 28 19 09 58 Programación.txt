vale vamos a comentar un poquito el código antes de continuar vale vamos a ver qué es lo que ha ocurrido aquí Así que lo que ha ocurrido aquí es lo siguiente primero incluyo los mensajes de error a continuación eh traigo la conexión a la base de datos ahora arranco Esta es la cuestión vale arranco una petición Y entonces para cada uno de los campos del formulario es decir for each campos de formulario si ahí pone for each intento poner para cada uno para que haya una coincidencia vale para que haya una correspondencia digo si el campo es el identificador Pon nul pero si es cualquier otro tipo de campo en ese caso Ponme el tipo de c o sea Ponme el valor del campo mediante este Comando le quito la última coma a la cadena Cierro la petición en sql cuidado aquí Cierro la petición sql digo la petición vale lanzo la petición para verla y lo que importa realmente Es que ejecuto la petición y un pequeñito doc String un mini doc String este inserta los campos en el formulario perdón los campos que vienen del formulario vale inserta Y por último voy a hacer una redirección voy a poner por aquí html redirect aquí con la etiqueta meta y esta de aquí vale y la etiqueta meta lo que hace es redirigir y dentro de 5 segundos redirige a la página index.php Perdón escritorio php vamos a verlo vamos a ver si esto es cierto Por cierto ahora hablaremos de qué es lo que ocurre con el con las imágenes vale Así que momento de momento vengo por aquí me voy a destacados vale inserto un nuevo elemento y digo ahora hablamos de identificador Mira vamos a hacerlo ahora en el formulario Campos del formulario yo digo a ver fila Field vale eco esto entonces digo si fila Fil es igual a identificador en ese caso eco disaed vale Y esto lo que hace es que el campo identificador está deshabilitado no lo puedo tocar bien Hola texto Hola envío vale qué ha pasado aquí colum count does match dos 3 cu y 5 Yo diría que sí que es un match a ver momento en destacados vale en destacados es 1 2 3 4 y 5 1 2 3 4 y 5 AH cuidado cuidado Ah vale porque no me en nul no me está enviando el nul muy bien entonces Ok Else vale Y entonces voy a poner eco type text y eco type hidden vale Vamos allá está oculto y Okay Vale título hola hola envío vale Y ahora dentro de 5 segundos debería volver Okay ha vuelto en destacados veo Hola y ahora a continuación me voy a la página principal recargo y veo que hay un destacado llamado Hola vale Aquí está no tiene imagen Todavía ahora haremos que tenga imagen pero ya está bien Vamos a como os decía parar un momento vamos a tirar un poco hacia atrás vamos a bueno deploy Vale bien y incluso vamos a arquitectura mejor en la arquitectura Nosotros sabemos que tenemos por una parte la aplicación vista y por otra parte eh yo casi en este caso lo que voy a hacer es dibujar el esquema de elberg Entonces vamos a ver porque con el esquema de liberg se entiende mucho mejor esto de aquí propiedades del documento voy a poner 600 por 600 vale para tener un Lienzo más grande en el que dibujar y entonces voy a hacer lo siguiente en un iberg sabéis que Eh Pues siempre hay mucho más en la parte de abajo que en la parte de arriba el esquema de liberg hace lo siguiente dibujo liberg eh voy a ponerme un poquito artístico vale es para que entendáis lo que va a ocurrir ahora esto es el horizonte vale Aquí voy a pintar esto de color azul cielo y voy a hacer un degradado que está dónde estás cubo de pintura ahora que está ahí vale esto representa el cielo Okay Vale ahora a continuación voy a hacer otro rectángulo y esto representa la profundidades marinas Voy a pintar de azul super mega azul Vale y de hecho en este caso incluso Espérate un momento porque voy a hacer un degradado pero este degradado no irá a transparente sino que irá a azul muy oscuro vale las profundidades marinas bien Este es el Titanic o sea esto es el iberg con el que chocó el Titanic y ahora en este iberg Voy a pintar transparencia ahí un poco para decir que la profundidad del iceberg es incluso desconocida bien cuando nosotros hacemos una aplicación lo que va a ocurrir es que por una parte a ver momento por una parte nosotros desarrollamos una un proyecto y el proyecto lo publicamos en html en css y en javascript eso es la parte visible de iberg y luego sabemos que hacemos una petición jas Jason se va por la puerta es decir Jason es el límite donde podemos ver sabemos dónde va pero no sabemos qué es lo que hay a la otra parte porque la otra parte es el servidor donde el servidor pues no sabemos exactamente qué es lo que está haciendo porque no lo podemos saber porque es que no se supone que lo tengamos que saber vale a partir de aquí a partir de aquí nosotros vamos a tener un panel de administración ese panel de administración no va a ser visible al público no cualquier persona debe tener acceso al panel de administración ahora mismo la diferencia entre la parte frontal y la parte del panel de control pues simplemente Es que yo vengo por aquí y o pongo admin o pongo Front vale pero luego cuando hagamos un deploy evidentemente no debe ser tan accesible así que la idea Está en que yo en el cliente Perdona yo en el de hecho Ahí pone cliente no debería poner cliente debería poner admin no sé por qué puso cliente vale aquí debe poner admin cuando yo entro a la aplicación como administrador yo entro por la parte de debajo del Ice ver la gente no me puede ver vale el panel de administración no es algo Público con lo cual yo lo que hago es que en el panel de administración vengo por aquí y creo una pelotita vale esta pelotita es una pieza de información que lo que acabo de hacer es que llega aquí y se aloja en la base de datos vale eso es lo que acabo de hacer mediante este panel de control en el cual tengo un formulario de inserción y ahora una vez que el dato se ha insertado dentro de la base de datos cuando en el cliente cuando en el Front alguien dice quiero cargar la página principal Pues esa pelotita hace titic t tic alguien me la pide yo la devuelvo como jas javascript la recoge html la pone en la estructura y css la presenta en pantalla vale Este es el esquema de lo que estamos haciendo este es el esquema de este proyecto y este es el esquema de lo que va a ser vuestro proyecto del curso y de final de curso de primero vale Y luego ya sabéis que lo iremos complementando no es que se irá complicando vale pero iremos añadiendo matices pero básicamente Este es el esquema luego obviamente en segundo curso en una mega asignatura que hay que se llama sistemas de gestión empresarial pues ahí cogemos el panel de administración y lo hacemos a lo Ob bestia vale o sea el objetivo de este primer curso es hacer un mini panel de control para que toda esta estructura y toda esta arquitectura sea mínimamente funcional pero será un panel de control obviamente recortado vale aparte este curso lo hacemos mediante php en bebido mientras que en segundo curso hacemos un panel de administración de tipo full stack vale pero el objetivo de este curso es que entendamos esta estructura que estoy poniendo en la pantalla y que En definitiva entendamos Que cualquier proyecto que queráis hacer No es que se tiene que amoldar a esta arquitectura porque que si lo digo utilizando el verbo tener parece que os estoy obligando parece que os estoy imponiendo parece que vale que no os estoy dando libertad no es al contrario vale o sea este esquema os da libertad infinita o sea este esquema no está para limitar sino está para posibilitar vale está para articular solución para que cualquier dentro de un orden vale cualquier aplicación que digáis vale Es que esto la gente lo va a usar Y luego tiene que haber un panel de control donde alguien gestione un administrador gestione la aplicación Esta es la arquitectura bueno Esta es una propuesta de arquitectura vale pero una propuesta que yo creo que es lógica que yo creo que es razonablemente sencilla dentro de un orden y que os permite pues eh trabajar con comodidad vale Y luego como ya os digo en segundo Vale pues en segundo curso hay por aquí momento que lo dibuje vale hay por aquí pues una cosa que se llama erp o crm vale tiene hay varios varias formas de llamarlo Entonces vamos bajándolo un poco eh okay Vale entonces lo voy a pintar de a poner un poquito de trazo bueno no tiene mucho trazo no Vale y eh Y ahora lo pinto de blanco vale y le pongo transparencia Y sí vale o sea no quiero que tenga pinta de rojo infierno porque más bajo no es te ahogas vale simplemente bajar más lo que quiere decir es que son aplicaciones que no ve el público final sino que vemos Nosotros Solo nosotros que somos los buceadores Y aparte quiero poner esto aquí de modo transparente para deciros que al igual que con iceberg la parte que está abajo muchas veces puede ser mucho más grande que la parte que está arriba por qué Pues porque donde vosotros veis una página frontal de Apple por detrás muy probablemente hay un sistema de gestión de stock un sistema de gestión de compras un sistema de gestión de empleados un sistema de gestión de almacén un sistema de gestión de un hbo de cosas vale Y ese software es muchísimo más grande que una web vale Y ese software es lo que os digo que es la base del iceberg hoy ahora este curso en primero nos dedicamos a pues una web vista Pero también un poquito de panel de control y como os digo sobre todo si o bien si habláis con los de segundo o bien si os metéis en mi github vale porque aunque sois de primero tenéis acceso al github de segundo Pues si cotorrea un poco por la asignatura de sistemas de gestión empresarial pues podréis ver no lo que está estamos haciendo y podréis ver lo que os digo bien Vamos a continuar Pero antes de continuar Pues quería eh quería dejar claro este esquema vale voy a poner aquí arquitectura iberg no cuidado no esto no arquitectura yever svg vale Ok bien y nada y vamos a continuar vale sobre todo si más o menos poco a poco pues vamos teniendo Clara Cuál es la estructura eh algo que me mata bastante es que no estamos pudiendo ser capaces de eh recuperar la imagen vale insertar la imagen vamos a insertar la imagen Entonces cierro por aquí Más que nada porque así que el proyecto quede bonito al acabar la tarde de hoy y al acabar la semana de hoy Eh Esto es insertar imagen entonces para insertar imagen hay que tener en cuenta lo siguiente vale inserto imagen me voy a admin y una cosa que puedo hacer vale No es una solución muy buena no es una solución muy Pro la que os voy a la que os voy a poner pero hoy no me interesa que sea super mega Pro me interesa que funcione vale Y tenemos todo el curso por delante para hacerlo Pro bueno tenemos todo el curso tenemos dos teros de curso Pero bueno tenemos un trozo de curso por delante así que me voy a Campos formulario Y entonces digo vamos a ver si fila fi es igual a identificador type hidden vale el If fila includes includes php includes momento no no quiero esto php check If String includes Ah creo que es contains another creo que es contains no includes momentín porque había el str pero estaba también el contain el includes que más nuevo y es mejor vale str post Y str contains esto es Vale entonces si str contains fila Field e incluye imagen vale incluye imagen en ese caso eco type file vamos a verlo vale o sea si la fila es identificador está escondido si la fila contiene la palabra imagen es de tipo archivo y en caso contrario es de tipo texto ya os digo que no es una solución super hiper mega Pro pero hoy lo que quiero es que funcione Así que insertar imagen me voy a administrador inicio sesión vamos al escritorio me voy a destacados voy a Añadir un destacado y veo que de momento ha funcionado vale título texto enlace comprar y como ha detectado que pone imagen qué ha pasado aquí ahora como ha detectado que ha puesto imagen pues me permite cargar una imagen Ok una imagen yo vendría por aquí y pues mira voy a abrir el Blender que tenía antes Y voy a hacer una captura y cargamos eso como imagen un momento escritorio 3D no eh vuelve Blender cargo el último Ok vale imprimir pantalla capturo y ya está Vale cierro bien Así que a continuación Así que a continuación aquí me voy a imágenes momento que está cargando me voy a imágenes me voy a capturas y cargo la última un momento Vale y cargo la última pero ahora fijémonos que si le doy a enviar pues me dice captura desde Taca t ta pero no se va a guardar realmente Esto me voy a destacar dos y dice captura pero esto no es la imagen vale es decir si yo me vengo aquí y recargo me dice dos pero no hay una imagen y no hay una imagen porque realmente ahí vale en este article el background ni siquiera ha podido cargar correctamente Vale entonces para ello a continuación yo lo que tengo que hacer es ser capaz de cargar la imagen en la base de datos entonces voy a un poco de chat gpt tamb os lo digo para esto vengo aquí y insertar imagen y ahora 052 y introducir imagen en base de datos vale vamos a por ello vale vamos a ver Epa va qué rabia me da cuando pasa eso introducir imagen vale Inc Campos formulario vale eh espera insertar vale a ver qué tal a ver si puedo hacerlo de un tirón vale If Ah If Element is file insert as blob a ver qué pasa vamos a ver ya Sí eso sanea no es lo que quiero Ahora no Esto no es lo que quiero ahora Esto sanea vale bueno va vamos a tirarlo todo a ver insertar Vale y Campos nul y si es un archivo OK Vamos a ver qué pasa vamos a ver qué pasa voy a esto es el 52 admin entro vamos destacados nuevo formulario título a selecciono archivo cojo la última imagen que tengo en capturas Vale y vamos a enviar a ver qué pasa le doy a enviar vale Y me dice vamos a ver eh nul título texto comprar imágenes Val Ah título texto Ah nul no no Esto no es correcto esto no es correcto no vale eh No quiero ni los Campos en el insert ni el saneado deja Mi código como estaba y solo implementa lo de los archivos como blobo lo digo porque los consejos que me ha dado son buenos pero se ha equivocado en una cosa Vale con lo cual como no quiero ahora liar la cosa en el sentido de que me ha cogido que el nombre de campo es nul y el nombre de campo no es nul el nombre de campo es identificador el valor es nul Vale entonces en este caso hay un trozo que no me ha acertado vale con lo cual yo le digo no O sea céntrate en lo que toca vale céntrate en esto y más adelante ya hablaremos de saneamiento y todo eso vale a ver qué pasa bien me vengo por aquí me vuelvo vale a selecciono archivo Okay cojo el último okay A las vale Este envío no me cuadra mucho esto no me cuadra mucho esto porque yo entonces me voy aquí me voy a destacados y es un Blow de 37 bytes no vamos a ver vale petición es igual files clave not working make that If post name includes o era includes no era contain imagen then insert content as blob vamos a ver Ay vamos a ver vale aquí Esto es lo que quiero Esto es lo que quiero este Cacho es lo que quiero Ah cuidado Es que además hay una cosa que me falta además hay una cosa que me falta que es decirle en el formulario aquí vale action es igual a esto method es igual a post y en type es igual a multipart a ver y and Give Me multipart tag for form aquí en type multipart from Data lo cual quiere decir que el formulario es capaz de enviar imágenes vale vamos a por ello ahora destacados envío selecciono archivo A ver si ya va vale vus nul vale parece que no se está ejecutando correctamente Por qué clave imagen files clave vale porque creo que aquí no he recargado vamos a verlo enviamos no A ver qué pasa aquí petición file content escaped vale voy a hacer una cosa cuando esto pasa voy a hacer un voy a hacer un arrum Y esto es lo que está ocurriendo título texto enlace comprar y ya está Vale y no me está enviando la imagen Entonces no me está enviando la imagen por qué Pues no lo sé vamos a verlo vamos a inspeccionar input type file name imagen placeholder vale Entonces vamos a ver vamos a pedirle insertar dis not working imagen ignor for this form momento ahí y for Uh esto de que se cierra dos veces el formulario no Mola nada pero bueno ahora veremos Por qué se cierra dos veces el formulario vale tu formulario incluye en type Okay vale Okay no creo que sea ese el problema No creo que se es el problema ya pero a ver aquí think that Problem is imagen is not on post array a ver qué me dice eso vale Ok es el problema vale solución Okay puedes recorrer ambos arris por separado y combinar la lógica Esto es lo que tengo vale no veo a ver el If str post clave imagen no es false Maybe this eh Still checks If imagen is in post array vale separar no me hace mucha gracia separar pero vale Okay pues vamos allá vale insert in tu tabla a ver petición insert in tu tabla y vamos allá selecciono archivo envío y no eh A ver pues me voy a dejar esto de momento sin hacer vale más que nada por no liarnos ahora con el tema de la imagen y lo resolvemos otro día vale pero voy a hacer otra prueba Por ejemplo yo aquí arriba tengo e tengo una serie de categorías Vale Voy a insertar una nueva categoría para comprobar que las categorías por ejemplo sí que funcionan y ya os digo Y si queréis ahora luego nos quedamos probando lo de la imagen y no lo dejamos hasta que no lo consigamos pero por lo menos para que veamos algo que funcione bien y no de error Vale entonces si hago así me voy al panel de control Ok vale me voy a categorías y en categorías voy a crear una nueva categoría llamada prueba Así que le doy a enviar Ok y 5 segundos después en principio vuelvo con lo cual ahora en categorías veo que está a prueba y si ahora recargo la página oficial pues veo que ahí pone prueba vale un poco lo que me interesa es eso vale comprobar que confirmar que comprobéis que realmente cuando yo meto algo en el panel de control Pues realmente se acaba metiendo correctamente en el sitio vale bien y ahora una vez que hemos realizado esa comprobación vamos al tema de la imagen porque bueno porque tiene que salir entonces a ver Esto es un blog files vale files as clave valor entonces bardum post y bardum files y a ver qué pasa y así por lo menos pues lo dejamos un poco funcionando a ver vale me vengo aquí me voy a destacados me voy a subir a inserto una imagen inserto vale qué es lo que ocurre vamos a ver y Aquí el problema está en que la consulta sql está ignorando el file vale vamos a ver tengo arr de1 imagen array de6 captura el full path y todo esto de aquí y todo es OK vale error es nada no hay nada si esto es cierto por la consulta sql es insert into destacados y no me mete la imagen Pues ahí está el error Así que vamos a ver for files as clave archivo Okay Vale els eco la condición no es correcta Okay y aquí voy a poner un br eco br y eco br es decir cuando algo no funciona Pues debamos recargamos vale la condición no es correcta ahí está el problema Por qué la condición no es correcta Pues no lo sé qué ocurre si str post clave imagen no es fals Vale pues vamos a bardum eh archivo vale el archivo es este de aquí pero la condición no es correcta archivo error es igual a upload r Ok Ah a ver Vale pues vamos a separar If strp no If Es que esto no es correcto archivo error es nada vamos a hacer esto plch y plch recargo vale p cannot be empty Okay probemos error p can notempty Yo me estoy imaginando Dónde está el error a ver una ruta vacía el archivo no fue subido correctamente vale en type multipart for Data vamos a asegurarnos de que el formulario vamos asegurarnos de que el formulario tiene multipart form Data en type multipart form Data vale Okay eso es correcto vale file uploads on no creo que sea eso vale vamos a poner esto voy a decir si archivo error Tac atac atrás vamos a ver qué nos dice el error Más que nada porque está dando un error no veo el Por qué igual es un error de carpeta temporal vamos a ver Ah error en la subida del archivo código de error un fantástico me encanta cuando dice código de error 1 es como vale el tamaño del archivo exde el límite permitido Vale entonces ajusta php ini y vamos a ver el post Max si el archivo este que estoy subiendo el archivo este que estoy subiendo ocupa capturas de pantalla ocupa eh No ocupa 2,3 megas vale vamos a editar el php edit php.ini on ubuntu se da la carpeta etc creo Entonces vamos a ver vale y digo CD etc CD php ls CD 8.3 ls CD Apache 2 ls y sudo Nano php.ini no sé si me dejará editarlo a mano creo que no vamos a verlo otras ubicaciones equipo etc php creo que no me voy a dejar php en Windows sí que os dejará php 83 apach php.ini vale parece que sí que me deja Bueno pues mejor bien Vamos a ver el post Max size Max input Time vamos a ver Max execution de 30 no Max input Time no a ver maximum size of post 8 megas es que es de 8 megas vale maximum Au Espérate sí que hay un problema ahí vale Y es que vemos que el upload Max file size es de 2 megas y por tanto mi captura de pantalla supera eso así que hago así hago 20 megas le doy a guardar pongo contraseña de administrador y ahora a continuación lo que tengo que hacer es reiniciar Apache sudo Service Apache 2 restart en vuestro caso en el panel de control del cham pues simplemente y este Comando tan sencillo Aparentemente lo que hace es que cuando lo ejecuto me voy a phpinfo.php y me sale todo esto vale Y me sale eh una página con la configuración actual de php entonces eh upload vamos a ver el upload de cuánto lo tengo vale Max file upload son 20 archivos pero upload Max file size Ahora son 20 megas vale antes eran eh antes eran 2 megas Ahora son 20 megas vamos a ver si ahora me deja ya subir la imagen okay Entonces accedo al sistema vamos al escritorio me voy a destacados y ahora a continuación me voy a crear a a selecciono una captura de pantalla a ver si no me da error ayer no espera 1751 de qué estamos hablando aquí esto bien a ver si hay suerte vale r tambor le doy a enviar parece que sí okay fantástico vale fantástico me lo estaba metiendo directamente en la base de datos espero Okay está en madre mía vale Perfecto entonces si todo ha ido bien Ahora en 5 segundos me lleva el escritorio si me voy ahora ya super redoble de tambor vale me voy a destacados y me ha puesto ahí correctamente la imagen Ahora sí Y eso quiere decir que me voy aquí a apple y recargo y veo que en uno de los destacados pues me pone correctamente la imagen vale lo que quiere decir que Eh pues que ya tengo la posibilidad de Subir imágenes a los destacados y por tanto Eso quiere decir que puedo subir imágenes a lo que quiera lo cual quiere decir que yo ahora por ejemplo me voy al panel de control me voy a los héroes y voy a crear un nuevo héroe y esto se va a llamar héroe 3 héroe 3 subo la misma captura para no complicarme Okay le doy a enviar va a tardar un poquito más que nada por el eco vale el eco lo que está haciendo es vomitar todos los datos binarios en la pantalla Pues ahora luego quitaré el eco y vale Y ya está ahora 5 segundos de espera okay Y ahora en Los Héroes vemos que aparece un tercer héroe y ahora en la página recargamos y vemos que aparece un tercer héroe vale con lo cual pues ahora sí ya estamos empezando a tener un panel de control donde nos aseguramos de que todo aquello que vayamos poniendo todo aquello que desde el panel de control vayamos añadiendo pues se irá añadiendo a la página principal vale Ya os digo que insisto y lo dije ayer estamos en la página principal vale o sea nos quedan las páginas de cada una de las categorías nos queda la tienda online nos queda una barbaridad de trabajo por delante pero por lo menos lo que tenemos ya en la pantalla es que tenemos un panel de control vemos como este panel de control realmente Es cierto que alimenta el contenido de la página web Y eso quiere decir por tanto que ahora esto ya pues va a ir creciendo y creciendo bien sabéis Que bueno voy a parar y voy a arrancar una nueva grabación y así entramos dentro de proyecto interdisciplinar