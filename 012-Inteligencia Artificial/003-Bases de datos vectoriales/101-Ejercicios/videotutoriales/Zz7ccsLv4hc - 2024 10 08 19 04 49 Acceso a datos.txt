vamos a hacer acceso a datos el otro día básicamente en acceso a datos Pues nos quedamos creando el superc controlador de php de hecho estamos viendo como dentro de nada en sistemas de gestión empresarial lo vamos a necesitar Así que a continuación Pues yo vengo por aquí nos vamos a segundo nos vamos a acceso a datos nos vamos a manejo de conectores nos vamos a desfase objeto relacional no a ver protocolos aquí vale un poco de estilo un poco de estilo un poco de estilo espera Ah no esto es un instalador espera Cómo un instalador Ah vale Sí aquí hicimos un instalador madre mía qué Guay Vale pues vamos a ver comentarios vale formulario de instalación Ah no esto es datos as dato formulario de instalación Campos aplican excepción espera no esto Dónde estaba Ahora sí perfecto Ahora sí esto es la clase que nos quedamos haciendo el otro día entonces tenía una selección a tabla vale que hacía o sea lo que hacía es devolvernos todo lo que hay en una tabla sabemos por ejemplo que en nuestro sistema de gestión empresarial vamos a tener que hacer un listado tablas también vamos a hablar un poco hoy de la encriptación Así que en este caso vamos a ver ec conexión selecciona tabla de empleados Vamos a repasar esto sacamos el navegador me voy aquí a trabajo me voy a local Host me voy a dam me voy a segundo me voy a acceso a datos me voy a manejo de conectores me voy a establecimiento de conexiones aquí métodos para próximos días lo tenía codificado vale os acordáis que lo tenía codificado con lo cual voy a descodificar vamos a ver disc codifica vale no lo quiero codificado Okay bien por ejemplo como ya os digo si vamos a verlo establecimiento vamos a guardar esto aquí en sentencias de descripción esto es 028 listado de tablas vale Y pues digo public function listado tablas y ya porque no hace falta nada más entonces que utilizamos el otro día en el sistema de gestión empresarial pues utilizamos un show table creo o vamos a verlo Ah dam segundo sistemas de gestión empresarial instalación y configuración vamos a ver no Esto está aquí en proyecto nos vamos a autoridades nos vamos a servidor nos vamos a lista de tablas y en lista de tablas hicimos un show tables Pues mira directamente Vale pues vengo por aquí y digo listado tablas Mira sabes que te digo voy a hacer esto literalmente catapum esto copio pego y digo query es igual a show tables Claro si hago esto vosotros me diréis a ver si estos dos métodos comparten prácticamente el mismo código Pues igual habría que hacerlo otra cosa o sea igual ha habría que hacerle un método abstracto o un método del cual hereden o algo así vale pues sí probablemente Pero bueno de momento vamos a hacer esto así que yo ahora vengo a continuación listado de tablas y digo eco conexión listado tablas ec conexión lado tablas voy a quitar un momento el seleccionar tabla así que me voy a la siguiente carpeta esta página no funciona Ok a ver show tables for each as clave valor public function listado tablas vale vamos a ver por yo tenía por aquí el inet pero no me está haciendo mucho caso okay error 500 es un error de php y vamos a ver en qué consiste el error listado tablas Ah sí No un momento machaco Esto vale qué ocurre listado tablas Okay listado tablas vale no saca nada muy bien si tengo un error y veo que el ini el error ini no me está funcionando pues saco aquí y vamos a ir poco a poco query Oye query en qué momento ha perdido el dólar Pues no lo sé pero parece que ahí puede estar el error vale Y ahora eco conexión listado tablas Okay entonces tables in acceso a datos pues clientes empleados y pedidos de la misma forma ec conexión selecciona tablas y en este caso me da empleados voy a hacer un voy a hacer un eco br con mucho dolor del corazón vale eco br y así pues quieras que no saltamos vale Ahí una vez que tenemos el selector porque sabemos que en nuestro sistema de gestión vamos a tener que seleccionar y una vez que tenemos nuestras tablas Pues ahora a continuación inserta actualiza y elimina vale vamos a realizar vamos a rellenar cada uno de los métodos y ahora luego ponemos los comentarios que haga falta vamos a dejar espacio para comentarios porque aquí va a haber tela de comentarios esta clase como os podréis imaginar Pues nos va a costar un poquito de formatear pero se va a convertir en una clase Sagrada es decir el desarrollo este que vamos a hacer pues se va a convertir en la base en la estructura de lo que luego habrá por bajo del sistema de gestión empresarial Así que luego lo vamos a utilizar constantemente esta clase que estamos creando es algo así como esa piececita que está en el centro del coche que nadie sabe que existe Pero como se joda esa piececita deja de funcionar el coche Vale pues esta clase Será algo parecido bien entonces a continuación Pues tengo por ejemplo inserta tabla Vale Voy a ir a 029 insertar en tabla y yo ahora a continuación qué es lo que tengo que insertar Bueno pues Por una parte tengo que insertar eh tabla y a tengo que insertar valores qué van a ser los valores pues va a ser una Ray eh con índices vale es decir una Ray alfanumérico eso qué quiere decir pues que por ejemplo yo puedo venir por aquí y decir valores es igual a para que nos hagamos a la idea una Ray donde Digo e vamos a ver esa ahora digo valores de 1 vale esto es a lo que me refiero valores de 1 es igual a 1 coma punto y coma valores de dos es igual a 2 que es lo que en python sería un diccionario pero aquí es una Ray con índices alfanuméricos Vale entonces una vez que tenemos esto Una vez que tenemos esto Ahora me vuelvo por aquí arriba y le digo query vale query insert into tabla coma Campos vales valores a continuación vengo por aquí y voy a decirle que Eco return query De momento este método no hace mucho no hace nada vale pero yo ahora vengo por aquí y digo vale paro esto y digo eco conexión inserta tabla y digo en la tabla clientes quiero los siguientes datos vale quiero insertar e nombre es m José viicente venga va José Vicente un momento porque esta sintaxis me está chirriando un poquito entonces chat gpt php create e named array bueno arrat y Ah pues sí no me no estaba equivocado vale Okay nombre es igual a José Vicente eh apellidos es igual a carratalá Sánchez vale que es lo que como os digo en javascript es un jas y en python es un diccionario vale pues aquí se hace con arr nombrados bien Si yo hago así Ok vale Mirad ahora recargo esta página no funciona punto y coma por aquí eh todo es no punto y coma por aquí vale recargo sigue sin funcionar cli nombre a ver dónde está el error vale otra cosa que puedo hacer aquí pues el error está aquí eco conexión inserta tabla en clientes nombre es igual a esto vamos a ver nombre es igual a esto apellidos Ah perdón aquí esto vale insert into clientes Campos values valores Pues yo aquí donde pone Campos lo que tengo que hacer es cambiarlo por los campos y donde pone valores lo que tengo que hacer es cambiarlo por los valores así que a continuación vengo por aquí voy a poner vale Aquí voy a poner los valores y digo campos es igual a nada y datos es igual a nada entonces digo for each valores as clave valor V en php el for se escribe así no sé si arriba teníamos Mira teníamos for por arriba Entonces a continuación digo punto igual Perdona s Campos punto igual a clave datos punto igual a valor y entonces ahora a continuación aquí Perdón le pongo una coma aquí le pongo una coma Y entonces digo Campos y datos bien hago así vamos a verlo vamos a probarlo recargo no funciona OK Vamos a ver por qué no funciona a ver qué me he dejado pues me he dejado dos puntos y coma aquí es fatal eh est un rato trabajando con javascript y con python y luego cambiar a php y como no pongas un punto y coma no funciona nada pero en fin Vale pues vengo por aquí cuidado puesto una q por accidente recargo vale insert into cli nombre coma apellidos vales José Vicente coma Carr de las Anis vale hay que poner comillas pero poco a poco la cosa Va funcionando Así que ahora pongo comillas en el valor pongo comillas vale José Vicente carrat sanchis hay que quitar la última coma del final tanto de los campos como de los datos Porque si no dará error y entonces yo vengo aquí y digo php remove Last character from String subst o rtam vamos al clásico substr Vale entonces digo esto de aquí digo campos es igual a substr de Campos y datos es igual a substr de datos recargo de nuevo ahora sí esto ya tiene una pinta fantástica y lo que quiere decir esto por lo tanto es que ahora a continuación vamos a verlo momentín okay Ahora a continuación un momento Espera que te lo digo Vale ahora a continuación Pues ejecuto el resultado en la conexión ejecuto el resultado y digo return cero de momento vale porque no devuelvo nada Es decir no tengo por qué devolver nada al final si todo esto ha ido bien si quieres vamos aquí a poner esto hacia abajo insert into tablas Campos valius datos vale Y así está más claro Okay y vamos allá Así que ahora si recargo No pasa nada return cero vale literalmente cero y ahora Lo probamos eh De hecho ya lo estoy ejecutando voy a poner nombre de prueba apellidos de prueba me voy a local Host me voy a php admin bueno ejecuto perdón una vez me voy a eh crimson Me voy a crimson me voy a clientes y en clientes vamos a ver en clientes dónde me la está insertando ah en acceso a datos Perdón en acceso a datos me voy a acceso a datos me voy a clientes y ahí sí nombre de prueba y apellidos de prueba vale con lo cual comprobamos que ya tenemos un método super chulo para insertar en la tabla pero cuando nosotros lo llamemos simplemente tenemos que hacer esto simplemente es en qué tabla quieres meter Y qué datos quieres meter y el programa ya se ocupará de formatear todo el resto una vez que tenemos esto pues ya nos queda poco ahora hablaremos de la codificación pero Eh Pues bueno básicamente lo que vamos a hacer ahora Bueno vamos a comentar esto y ahora nos vamos al siguiente método de actualización y eliminación y tal vale Este es el método de inserción de nuevos registros creo un String para guardar los campos creo un String para guardar los datos Y ahora para cada uno de los datos añado el nombre del campo al String añado el dato al String le quito la última coma al String le quito la última coma al String Y preparo la petición a la base de datos preparo la petición de y ejecuto la petición y como es una devolución Pues bueno puedo hacer return cero luego más adelante lo que puedo hacer es meter esto en un try except o en un try Catch Y decirle si es Okay return 1 si hay un error return 0 o Devuélveme un jas con el error para que yo pueda saber qué ha pasado y todo esto Vale ahora a continuación vemos como la clase quieras que no se está haciendo larga pero da igual porque lo que importa es que sea Clara y tenga todo lo que tiene que tener aparte ni siquiera estoy poniendo comentarios aquí porque inserto tabla quio decir que es legible quiero decir con que leas el título Ya sabe lo que va a hacer iba a poner un título de estos de aquí largo pero es que no hace falta Vale pues actualiza tabla va a ser muy parecido entonces 030 eh método de actualizar en tabla Y entonces digo vamos aquí va a ser igual Mira me lo voy a copiar todo pero claro yo que vosotros me diréis ya pero si te lo copias todo es que no está bien porque entonces debería haber un método abstracto que tuviera todo eso vale Sí no digo que no posible mejora para el futuro pero sí bien Vamos a ver eh campos es igual a esto datos es igual a esto eh valores es igual a Esto vale Y entonces ahora digo Bueno le quito la coma y digo update tabla claro eh Ah no Espérate actualiza tabla tiene un tercer valor que es el id qué ID Estoy actualizando entonces aquí lo que voy a hacer es lo siguiente Eh Pues mira update tabla set y aquí este Esto me lo voy a cargar Esto me lo voy a meter aquí abajo vale query es esto fuera esto aquí query punto igual y ahora for each valores clave value clave valor y digo query punto igual a clave es igual a valor coma Vale ahora sí que necesito cargarme esto query es igual a query -1 query es igual a esto y antes de hacer esto voy a eco query antes de lanzarlo a la base de datos vamos a ver vale otra cosa que os digo otra cosa que os digo es que necesito el we entonces digo we identificador es igual a algo lo que pasa es que este superc controlador está asumiendo que siempre hay un campo llamado identificador y si no se llama identificador ya hablaremos de ello de momento vamos a asumirlo pero claro y si meto esto en una base de datos Y he decidido que la clave primaria No se llama identificador podría ocurrir vale Pero no pasa nada porque el la clase puede hacer una petición a la base de datos Y decirle dime quién es tu clave primaria vale con lo cual ahora vengo por aquí y voy a actualizar entonces actualiza tabla en clientes voy a poner esto aquí abajo para que lo veáis mejor en clientes quiero decir que el nombre es Juanito el apellidos es menganito donde el ID es uno Por qué uno pues yo que sé vale Jorge García o mira el cuatro donde el ID es 4 tengo la tabla tengo los datos tengo el ID y ejecuto vamos a probarlo no bien campus un momentín y no nul vale a ver Campos Ah Uh No espérate Esto me lo tengo que cargar vale a ver vale update clientes set nombre es igual a Juanito apellidos es igual a meito we identificador es igual a y esto Qué es no no no pero es que hay un espacio No ya no es 40 Ah Perdona r returno cero claro Okay Vale entonces identificador es igual a 4 aquí voy a poner un pequeño espacio y ya está Vale con lo cual ahora sí actualizo Ahora sí el eco query lo quito ejecuto el result contra la base de datos vamos a probarlo Opa tienes un error we identificador es igual a 4 claro cómo se llama No identificador espera un momentom moment espera un moment eco query Ah aquí no le ha quitado la última coma ves por eso dice que es cerca del we Por qué pues query es igual a substream query de -1 Ah de os2 porque como le he puesto espacio y coma Vale ahora y entonces ahora me vengo aquí y donde antes ponía nombre de prueba Pues ahora pone Juanito menganito y tenemos nuestro método creado en el superc controlador para actualizar en la base de datos vale Y ahora a continuación ahora quitaré espacios de sobra todo eso esto es empiezo a formatear la query de actualización vale para cada uno de los datos encadenar ahora le quito los dos últimos caracteres y eh preparo la petición de inserción ec query solo para sacarla ejecuto la petición y devuelvo nada bien perfecto y ahora ya pues evidentemente nos queda el función eliminar tabla el función eliminar tabla va a ser el método más sencillo de todos Porque yo vengo por aquí eh vamos a ver eliminar vale Y al eliminar vamos a ver momento vale hago la query y básicamente la query es delete from tabla we identificador es igual a ID y ya está Vale y result query connection el delete no suele tener mucho más misterio con lo cual Pues voy a hacer un elimina tabla donde a clientes le voy a quitar el id4 vengo por aquí ejecuto eliminar me voy a recargar la base de datos y veo que el cuatro Ya no existe vale con esto finalizamos la creación de nuestro super controlador para la base de datos y ahora pues evidentemente hay 1000 cosas que podemos hacer vale vamos a ver y el temario había un tema de Procedimientos que os comenté el otro día vamos a ver Ok y Ok esto el próximo día lo probaremos dentro de sistemas de gestión empresarial Muy bien pues voy a abrir por aquí me voy a ir a Drive me voy a ir a acceso a datos vale Y en el tema en el que estábamos trabajando aquí operaciones no no el tema dos manejo de conectores vale establecimiento ejecución de sencilla descripción ejecución de sentencias de modificación de datos ejecución de consultas manipulación del resultado técnicamente o sea nosotros hacemos ejecución de consultas le pasamos Jason a Palo Seco al cliente y el próximo día en sistemas de gestión empresarial ya manipulamos el resultado Vale ahora vamos a hablar de Procedimientos almacenados en la base de datos y de parámetros que podemos pasar a la base de datos Esto es algo que os expliqué el año pasado os pareció horrible Me parece fantástico que os parezca horrible pero claro pero hay que vale hay que trabajarlo más Entonces vamos a ver yo eh suelo decir que para mí los procedimientos almacenados son como ir más allá de las vistas vamos a ver por qué vamos a ver por qué Yo vengo por aquí a clientes y yo por ejemplo puedo hacer una vista voy a insertar de hecho me voy a ir a la base de datos de empresa creo que ahí teníamos más clientes teníamos crimson clientes Ah pues no me los cargué el otro día puede ser me suena que sí no me acuerdo por qué me los cargué pero me los cargué Vale pues voy a ir a clientes a vale Voy a ir a chat gpt para esta estructura inserta con sql insert 20 clientes ficticios y si todo va bien Ahora me dará los sqls de inserción vale bien entonces yo por ejemplo con una vista ahora Lo veréis eh puedo insertar cosas vale puedo Perdona puedo filtrar cosas puedo visualizar cosas el problema está en que las vistas no me permiten parametrizar lo cual me puede causar en ciertos momentos Pues problemas es decir mira un momento un segundo que insertamos 20 clientes a ver de dónde me los inserta y a ver cómo vamos y yo creo que ya vale vamos a insertar vamos a sql inserto en clientes inserto aquí y ahí lo tenemos me voy a clientes ya tengo unos cuantos clientes por aquí bien Ahora a continuación yo por ejemplo Quiero buscar clientes que empiecen por Ju vale veo varios juans por ahí así que me vengo a sql y digo Select from clientes Where nombre like almilla Ju Así que vengo por aquí y Tengo estos clientes además en este caso pongamos que yo no quiero los el nombre y apellidos por separado yo por algún motivo concreto Quiero concat nombre coma espacio coma apellidos coma bueno as nombre completo coma email coma dirección coma población vale por ejemplo Imagínate que quiero esto continúo y me pone nombre completo email dirección y población con lo cual si a mí este filtrado me ha servido para algo y yo no quiero tener que repetir la consulta cada vez yo puedo crear una vista Así que para crear una vista Yo vengo por aquí y digo create View m selección clientes as esto de aquí con lo cual si todo ha ido bien copio continúo Hola Okay Eh selección clientes Ah perdona Es que esto va sin comillas vale contin continuo y resulta que entonces aparece una sección llamada vistas O tengo selección clientes pero esto es una porque esto Solo me vale si yo quiero seleccionar clientes que tengan Ju Pero qué pasa si quiero seleccionar clientes como por ejemplo Carlos que esto por ahí que tengan car pues tengo que hacerme otra vista Y eso quiere decir que me tendría que hacer infinitas vistas Cuando esto ocurre en programación nosotros utilizamos una función porque a la función le podemos meter parámetros y la misma función la podemos reutilizar como queramos por tanto lo los procedimientos almacenados en mysql son un rollo porque la sintaxis es un poco rollo Pero lo bueno que tienen es que admiten parámetros y se comportan como funciones de esta forma yo ahora vengo por aquí y digo me voy a chat gpt vale Y digo create my sql procedure without parameter para meters vale no no Perdona que no que no y esto vale el create view fuera no quiero create View Quiero crear un procedimiento es que no existe el concepto de crear procedimiento vista programa dirá No o creas una vista o creas un procedimiento vale Ok Y entonces ocurre esto y es que yo gestiono un program o sea un delimitador el delimitador básicamente es dónde empiezas Y dónde acabas y la sintaxis que importa Perdón la sintaxis que importa es esta es proceder le doy un nombre El que quiera begin y end y dentro del begin y el end pongo mi petición vale voy a pegarlo me voy a sql creo procedimiento delimiter y delimiter simplemente para que el programa sepa dónde empieza dónde acaba begin y end es para que sepas dónde empieza tu código y dónde acaba tu código sql y aquí es donde pones tu código Cómo se va a llamar el procedimiento Eh pues selecciona clientes selecciona accidentes malo por ejemplo Así que vengo por aquí copio por si acaso porque a veces da error vengo por aquí le doy a continuar continúo y entonces si me fijo por aquí me voy a rutinas y dentro de rutinas que es un botón que nunca habíamos tocado rutinas no sé por qué puñetas lo llama rutinas porque debería llamarse pero bueno sí hicimos lo que pasa es que lo hicimos rápidamente y no entró para examen porque decíais que aquello era una y no lo entendía y dije vale No pasa nada lo entreg en las prácticas lo quito del examen y ya el año que viene sabes Vale entonces yo ejecuto tengo una ejecución le doy a ejecutar y me saca los clientes de hecho la sintaxis Ahora la vamos a probar desde php Es simplemente esta que tengo aquí call selecciona clientes malo con lo cual con eso mysql ya sabe que tiene que llamar a una subrutina antes de hacer el seleccionar clientes Bueno vamos a probar que esto funciona entonces me voy al selector de textos y bueno me voy a eliminar todo esto me voy a crear un nuevo archivo me lo voy a pegar en eh aquí procedimientos almacenados y 001 llamada al procedimiento malo punto php y entonces pues como siempre me voy aquí a php docs Ay mysqli Select e fetch array Este vale entonces me cojo el clásico no Este no es no a ver este sí que es vale Y eh No con asoc este de aquí vale venga okay Así que vengo por aquí Me conecto a local Host Me conecto a crimson Me conecto a crimson Me conecto a crimson vale el ordi no me hace falta Ok y le digo call dónde estás aquí pinch Punch venga quita aquí y le digo call selecciona clientes Malo como lo he metido sin espacios le puedo quitar los akutes estos vale Y ahora Row Pues le voy a decir directamente B dump Row Simplemente porque quiero verlo no me hace falta formatearlo solo quiero ver que vale My sql Free está Guay pero no me hace falta y ya está así que me voy por aquí me voy por aquí me voy por aquí no sé dónde voy aquí me voy a procedimientos me voy a llamar a procedimiento esta página no funciona vale Por qué no funciona bardum Row vamos a ver por qué no funciona ya falla ahí local Host crimson Ah mysql no tío Qué haces May sqli mal rollo object oriented no Dónde está aquí procedural Style Sí pero no r de verdad no hay un ejemplo con Wild venga ahora sí ya ha costado vale vamos a ver esto fuera esto es crimson esto es llamo al procedimiento voy Uy sí no sé por qué vale llamo a seleccionar clientes malo le quito el acento no sé por qué Aquí no lo he puesto Vale query y aquí lo que voy a hacer es un bomp del Row Ok vale ejecuto Ok y sale Esto vale esto es literalmente lo que le hemos pedido donde si te fijas incluso Juan García Martínez y todo esto vale claro esto lo que nos permite es que si os dais cuenta hemos metido toda la complejidad del procedimiento en mysql en un paquete vale Lo cual quiere decir que momentín lo cual quiere decir aquí que yo desde php el código que escribo es mínimo pero el resultado que obtengo es máximo y digamos que esto a lo largo del tiempo Pues siempre ha suscitado debate porque el debate es bueno es que en alguna parte hay que poner la petición entonces la cuestión es Dónde pongo la petición en php o en mysql y hay argumentos a favor y en contra por eso es una eterna discusión O sea no la vamos a resolver Hoy entonces hay un criterio que dice que sql es sql y sql no es php por tanto el lenguaje sql debería venir lo mínimo posible dentro de php y por tanto si el lenguaje sql es de la base de datos debería quedarse en la base de datos pero sin embargo yo os digo que ese es un criterio pero también os puedo decir que hay otros criterios que invitan a poner el código sql aquí dentro de php vale hoy de momento La idea es enseñaros procedimientos para que sepáis que existen y ahora a continuación y ahora a continuación lo que voy a hacer es crear otro procedimiento y voy a decirle eh Now set Who as parameter y de la misma forma que conocemos que hay funciones en cualquier lenguaje de programación pues también hay aquí lo tenemos también hay parámetros en las funciones lo cual quiere decir que yo ahora vengo aquí al delimitador me voy a sql y digo eh delimitador esto como no me acuerdo cómo se llamaba era no me acuerdo era selecciona clientes bueno con el parámetro llamado eh letras o cadena o como quieras llamarlo pero que esté en español le pongo aquí cadena le pongo aquí cadena y ya está Vale y si te das cuenta es una función en la cual estoy metiendo un campo de entrada llamado cadena para luego utilizar el campo cadena dentro de la petición sql Así que copio por aquí le doy a continuar me voy a la base de datos me voy a rutinas y selecciona client es bueno pero al darle a ejecutar me dice vale Dime el parámetro no es como antes que se ejecutaba directamente y yo quiero car como Carlos Así que le doy a continuar y me dice Pues mira Tienes toda esta gente Mira Carmen también empieza con car hay que joderse entonces a continuación digo vale Ahora quiero otro Ahora quiero seleccionar clientes Bueno ahora quiero Host continúo y me dice Pues mira José Vicente y José Rodríguez Martínez tienen Jos en el nombre esto qué quiere decir pues esto quiere decir que ahora a continuación me puedo ir a php y digo 002 llamada al procedimiento Bueno y con esto a continuación y con esto a continuación mysqli crimson vale selecciona clientes malo Ok Vale y selecciona clientes bueno con el parámetro car Y si ahora recargo fijaos que me salen Carlos López Sánchez Carlos García Martínez Carmen López Díaz Carmen Rodríguez G y así vale ahora esto ya es Guay esto ya nos permite hacer cosas interesantes Pero además de poder hacer llamadas a funciones que realmente al final por dentro son selecciones con parámetros Que vuelvo a insistir que no es moco de pavo Pero además podemos hacer cosas que las vistas no hacen y es que las vistas tal y como casi su propio nombre indica vista vale se mira pero no se toca están limitadas a Select pero con una vista no puedo hacer insert delete o update pero con procedimientos almacenados Sí que puedo hacer Tanto insert como delete como update vamos a ver me voy a intar algún procedimiento almacenado Yo vengo por aquí me voy a clientes vamos a ver los clientes vale vamos a ver vale mira por ejemplo yo sé que HM por ejemplo España no lo quiero como el nombre España lo quiero con el código es pero yo sé que de vez en cuando me meten datos en la base datos Me los van a meter mal yo quiero realizar una operación de saneamiento eso quiere decir que yo ahora a continuación puedo venir por aquí me puedo crear un procedimiento y voy a crear un procedimiento de tal forma sql crear procedimiento eh espana es vale donde le digo clientes set país es igual a es país es igual a España es decir no me los cambies todos camb solo el que toca vale hago así ejecuto continúo Ok no se ha actualizado nada porque yo no lo he ejecutado y lo que he hecho aclarar el procedimiento Así que ahora yo me puedo ir a la base de datos me puedo ir a rutinas me puedo ir a ejecutar la rutina espana SS Claro tú imagínate en php phps ejecuto espana SS y ya está ya est la base datos lo que tiene que hacer vale pero yo ahora vengo por aquí le doy a ejecutar y ya está ahora a continuación dice cero filas afectadas esto no me cuadra mucho vamos a verlo me voy a clientes Sí que me lo ha he Aunque decía cero columnas afectadas pero me lo ha hecho me voy a clientes y me los ha puesto todos correctamente con es pero yo ahora vengo por aquí me voy a chat gpt y digo ahora 20 más le voy a insertar 20 clientes más pero claro chat gpt no sabe que el país tiene que ser es me va a poner 20 clientes más con España con lo cual diré me cago en la mar Ya tengo la base de datos mal Ya tengo la base de datos con media base de datos es y media base de datos España qué es lo que voy a hacer ejecutar el procedimiento vale con lo cual el procedimiento lo podemos llamar si queréis así eh Pues una utilidad para llamarla periódicamente vale que de hecho ahora a continuación vamos a hablar de eventos en mysql y bueno vamos a discutir un poco pues cuándo Llamar a estos eventos vale Vamos allá vamos a ver Okay creo que ya vale copio código me voy aquí a sql pego el código ejecuto el código y ahora tengo Mirad ahora tengo 20 clientes que están bien y 20 clientes que están mal pero no pasa nada porque yo ahora a continuación me voy a rutina me voy a ejecutar la rutina España SS me voy a clientes y ya están todos bien vale con lo cual los procedimientos No digo que se utilicen todos los días pero desde luego conocerlos Es una herramienta muy poderosa para poder automatizar una base de datos Y para poder ser más productivo Vale ahora siguiente cuestión aparte de los disparadores vale vamos a ver por aquí en la base de datos momento dej Déjame ver también el temario vale procedimientos parámetros transacciones y programas vale Ok próximo día veremos transacciones entonces hoy lo que quiero ver a continuación son los eventos vale el tema de los eventos me he ido a la base de datos me he ido a eventos os lo voy a explicar con las pinzas cogidas por una razón muy sencilla los eventos en mysql únicamente están disponibles si tú tienes acceso a un nivel administrativo a la base de datos Y al servidor en este caso como yo tengo la base de datos instalada en mi ordenador tengo todo mysql abierto para mí Generalmente cuando trabajáis con una base de datos de un servidor compartido de un plan de alojamiento compartido te deshabilitan los eventos porque los eventos afectan al cron es decir afectan a la planificación de tareas y claro los administradores de un servidor compartido que pueden haber miles de bases de datos no quieren que se les descontrole y que cada administrador empiece a hacer sus eventos y que al final haya un mar Magnum de eventos que sea incontrolable vale por eso Si queréis ahora os cuento una solución eh los eventos en mysql en la práctica se acaban implementando directamente mediante Chrome Tab de Linux vale con lo cual os enseño eventos en mysql y ahora hablamos del chrom Tab Así que yo vengo por aquí a eventos veis que lo tengo encendido vale se puede Apagar Oh vaya acceso negado Qué curioso Bien fíjate que lo normal sería lo contrario que no me dejara encenderlo Pero vale lo que sea bien voy a crear un nuevo evento y digo nombre del evento vale nombre del evento es actualizar país estado enable tipo de evento recurring vale ejecutar cada minute cada One minute inicio sabes el lunes final el domingo el sábado cuando sea Ok si te das cuenta está de madre Porque te permite elegir todo y ahora al definir lo que hago es que me voy a disparadores Perdona disparadores rutinas Dónde est dónde está col Bueno lo tengo por aquí col espana es momento col espana es preservar completar no definidor no comentario Se ejecuta el procedimiento cada minuto definidor espana vale Yo creo que ya le doy a continuar madre mía Qué nervios le doy a continuar Ah un definidor Ah vale el definidor es crimson qué he hecho espera crimson @localhost Okay venga Vale pues Acabo de crear un evento que actualiza los países cada minuto con lo cual ahora le digo 20 más voy a insertar 20 clientes más en la base de datos pero ahora en lugar de llamarlos yo directamente lo que voy a hacer es dejar que pase un minuto y al dejar que pase un minuto el sistema automáticamente cada minuto digo cada minuto para verlo aquí en clase evidentemente no es que haya que hacerlo cada minuto Claro porque igual así está saturando el servidor es como igual no necesitas que cada minuto se te actualicen los clientes una vez al día por la noche y ya está o una vez a la semana Depende de lo que estés actualizando recordad que con procedimientos se puede insertar se puede actualizar se puede eliminar se puede seleccionar se puede hacer de todo hacer lo que te dé la gana o sea como si quieres con un procedimiento crear una tabla temporal volcar datos calcular datos recuperar datos y eliminar la tabla temporal o sea se puede hacer de todo una barbaridad No digo que todos los días haga falta eso vale pero la cuestión es que si lo queréis está ahí vale bien copio código me voy a local Host me voy a sql eh Uh Sí guardar creo que está guardado no sé vale ejecuto continúo Y ya está Mira hay un evento por ahí vale ha aparecido eventos que antes no estaba y me voy a clientes me voy a clientes y veo que de momento los del final ponen España Pero si yo ahora espero un minuto voy a esperar un minuto esto no hace falta que lo pulse solo para verlo vale Okay venga Si yo me voy a clientes y espero un minuto Espero que esté activado O sea que esté desactivado y me estoo Aquí comiendo los mocos recargo Oh lo has visto ya están todos en es en cuanto ha llegado al siguiente minuto Pam se colocan todos automáticamente y aparte Esto empezó teóricamente lunes pasado y acabará este domingo vale esta herramienta como veis pues y más incluso combinada con los procedimientos almacenados Pues nos da muchísima más potencia sobre my sq vale mysql se puede ir gestionando el solito Si lo programamos correctamente y puede ser bastante autónomo digamos en la gestión de los datos ahora como os decía pues esto en la vida real pues no están de aplicación porque la gran mayoría de servidores no te permiten eh ese tipo de trabajo vale dicho lo cual eh No ya esta asignatura pero la asignatura de procesos y servicios nosotros de momento En este principio de la asignatura nos estamos centrando mucho en los procesos pero también aquí gestión de servicios en Red técnicas de programación segura esta asignatura también va de creación de servicios y Qué es un servicio Pues un servicio es algo que se ejecuta de forma Autónoma y generalmente ciega en un servidor Así que yo por ejemplo vengo por aquí y voy a hacer lo sigiente siguiente veréis Yo vengo por aquí y ahora aquí digo 002 Hola mundo php Entonces Bueno me voy a sacar un terminal Perdón Aquí voy a hacer eco Hola mundo y yo vengo por aquí y digo php hola Bueno e php eh entrada php no se encuentra vale muy bien me voy abajo me voy abajo me voy a par me voy a w me voy a html me voy a dam me voy a segundo me voy a eh acceso a datos me voy a 002 manejo de conectores me voy a 007 bien y a continuación voy a decir php y eh Cómo se llama esto 003 no es 003 vale php 003 Hola mundo y me dice hola mundo por si no lo habéis visto bien Hola mundo desde la línea de comandos y te pongo un contrabarra n en lugar de un br y lo ejecuto y me dice hola mundo desde la línea de comandos esto qué quiere decir pues esto quiere decir que el 99% del uso de php es a través de un navegador web pero sin embargo también debéis ser conscientes de que en php existe el concepto de ejecutar php desde una línea de comandos si php lo puedo ejecutar desde una línea de comandos yo puedo llamar a SP php desde una cosa de Linux que se llama el Chrome Tab Es simplemente que programas se Ejecutan directamente o sea por parte del sistema cada x minutos o cada x segundos o cada x horas esto qué quiere decir Claro Por qué os digo Linux Pues en este caso os estoy diciendo Linux Más que nada porque vosotros podéis desarrollar en el sistema operativo que os d la real gana pero cuando implement vuestra aplicación en un servidor Qué sistema operativo va a tener ese servidor pues 95 por de probabilidades que va a tener Linux Vale entonces a continuación lo que voy a hacer es lo siguiente vamos a ver ahora voy a la base de datos y voy a en eventos voy a eliminar el evento vale ya hemos visto cómo funciona ya hemos visto la sintaxis elimino el evento voy a buscar ahora 20 más y voy a meter 20 clientes mal pero meto 20 clientes mal y el problema está en que ahora me acabo de cargar el evento que los ponía bien con lo cual voy a llamar al procedimiento que los pone bien pero desde el Chrome Tab de Linux y no desde el evento de mysql Por qué Pues porque en un Hosting compartido Es altamente probable que tengáis los eventos de may sql desactivados pero generalmente te suelen permitir hacer crome Tab de Linux hab habrá proveedores que igual no vale pero la mayoría sí Uy en este caso ahora lo veréis pues este equipo es mi equipo de desarrollo pero a la vez estoy simulando como que es el servidor vale porque en este caso tiene Linux vale copio código me voy a la base de datos me voy a sql lo pego continúo y ahora si me voy a Tengo una serie de 20 clientes al final que están mal Tengo un procedimiento que los podría poner bien pero alguien tiene que ejecutar ese procedimiento el evento ya no va a ser entonces a continuación Yo hago lo siguiente vamos a ver digo Linux create Chrome Tab execute bar w doble y ahora es donde aquí la cosa se complica html dam acceso a datos y aquí la cosa se complica mucho eh vamos a ver esto Mirad esto de aquí no llamada al procedimiento bueno no espera esa Espera va vale Esto me lo voy a poner Aquí voy a poner para cron vale Aquí voy a decir espana es OK vale Y ya entonces ahora Esto está Mirad en bar dam para cron.php execute each minute vale como veis lo he puesto en una ruta que sea razonablemente fácil de localizar Vale entonces abrimos el Chrome Tab para editar vale Quiero el Nano Sí el uno Ok Vale y a continuación meto la siguiente línea vale la siguiente línea esto era año mes hora minuto segundo o algo así vale y le digo Qué programa quiero utilizar y qué archivo quiero ejecutar para ello momento Which php user Bin php correcto la ruta es correcta vale me voy al final del archivo me voy al final del archivo me voy al final del archivo y pego vale vamos a ver okay vale Mirad atención hago así compruebo que los clientes siguen estando mal vale siguen estando mal van a seguir estando mal Ok yo ahora a continuación guardo control o salgo control x y ya está no hay ningún parámetro más de flush nada de eso y ahora me espero un minuto y al esperar un minuto momento al esperar un minuto al esperar un minuto Ahora vengo por aquí y me voy abajo y ya todos los clientes son es por qué Pues porque Linux cada minuto está ejecutando este archivo Chrome Tab que habéis visto y cada minuto ejecuta php de línea de comandos y ejecuta este archivo llamado paracone php vale lo voy a borrar Más que nada porque ahora me va a volver a hacer lo mismo cada minuto de todos los días que tenga encendido el ordenador con cual pues evidentemente no lo quiero no quiero que me lo haga siempre control o control x vale Y salgo no osis cuenta del valor que tiene esto que os acabo de enseñar Sí s Sí cualquier proveedor sí sí ya lo sé pero esto trabaja con una interfaz que los administradores sí que pueden controlar y lo otro tendrían que entrar a cada base de datos mysql para ver qué disparadores hay o sea claro hay por cada sistema operativo pero eventos hay eventos por cada base de datos con lo cual es mucho más difícil de controlar Claro a ver decía que no os hacéis a la idea del valor que tiene esto que os acabo de enseñar por varias cuestiones hemos comentado hace un momento hace unos segundos el tema de eventos o cron vale pero yo con un evento mysql únicamente puedo meter un programa escrito en mysql en sql pero yo con un Chrome Tab pued puedo ejecutar lo que absolutamente me dé la gana es decir con un Chrome Tab yo puedo ejecutar php en línea de comandos puedo ejecutar python puedo ejecutar c puedo ejecutar lo que me dé la gana y ese archivo sea php python nodejs C Java lo que tú quieras lo que tú quieras que soporte el servidor evidentemente vale entonces vamos a hacer literalmente eso que acabas de decir que es una copia de seguridad yo aquí puedo hacer un evento y el evento puede hacer insert delete update lo que tú quieras pero un evento no puede hacer una copia de seguridad porque un evento está encerrado dentro de mysql vale con lo cual si esto que os he enseñado es importante lo que os voy a enseñar ahora es muchísimo más importante todavía Vale entonces Mirad eh existe una utilidad instalada mysql doom vale instalada en cualquier servidor Linux que se llama mysql doom de hecho que sepas esto creo que el año pasado estaba en los vídeos que os pasé que en el shamp en la carpeta de mysql hay un mysql doom.exe por si queréis hacer el mysql doom dentro de un Windows Insisto que de hecho creo recordar que el año pasado eh os enseñé Cómo hacer un mysql doom desde Windows vale desde el Sam pero es que eso no tiene ningún valor por el sentido de que al final vuestra base de datos va a estar en un servidor en la nube y ese servidor tendrá Linux por tanto hacer una copia de seguridad con un sql dump en tu ordenador da igual porque es tu ordenador te metes en admin te lo haces lo que importa es que una vez que subas tu base de datos a producción ahí tengas vale bien entonces a continuación voy a hacer lo siguiente Mirad voy a decir Okay voy a decir eh vamos a ver vale create php file to Es que esto igual no hace falta pero bueno php file mysql doom that database save to bar w html backups por ejemplo Me la voy a inventar and prepend year month the Our minute Second to file name vale Okay bien okay Vale me copio Esto me lo pego en bar para Chrome 2 me lo pego ahí lo que está haciendo es conectarse a la base de datos Llamar a la carpeta que por cierto tiene que existir en mi caso no existe todavía html nueva carpeta backups vale crea un Time stamp es decir una fecha lo mete antes de la archivo ejecuta El Comando mysql damp con el user el password el Host y la base de datos a dónde lo voy a sacar y ejecuto bien si yo ahora en primer lugar antes de hacer nada antes de hacer el chome porque son cosas diferentes vale una cosa es el Script php y otra cosa es el cron si yo ahora vengo por aquí ls nod no CD bar cdw CD html CD dam No sí CD dam ls Vale y digo php para cron 2 le doy a enter OK Vamos a ver acceso denegado Oh me cago en la mar bueno dice qu raro dice proceso creado o sea archivo creado correctamente no creo que sea cierto pero backups me ha creado uno pero son 14k vamos a ver qué tiene si lo abrimos con el editor Ah pues sí pues que lo ha hecho sí míralo aplicaciones clientes Mira todos los clientes Ahí Ah pues sí que lo ha hecho pues el error se ve que no es correcto vale Pero yo a continuación o sea ves que he hecho un backup ahora lo vuelvo a ejecutar hago otro backup lo vuelvo a ejecutar hago otro backup pero a continuación yo lo que quiero es editar el Chrome Tab es decir ya tengo un archivo que hace un backup pero ahora quiero que me lo haga automáticamente el sistema Así que vengo por aquí edito el Chrome Tab me voy a la última línea me voy Dónde está scont Tab me voy a copiar esta línea y la pego el Ay leches aquí no venga Va Ahí es para chome 2 no quería esto quería bueno sabes qué esto me lo puedo cargar no eso no me lo puedo cargar esto vale control o para guardar control x para salir y ahora voy a esperar yo simplemente espero ahora de momento hay tres archivos y probablemente Ahora cuando pase un minuto Pues mira ahora hay cuatro pero yo estoy con los brazos cruzados yo no estoy haciendo nada y ahora voy a esperar un minuto más y dentro de un minuto habrán cinco archivos evidentemente obviamente como siempre digo no correcto Ah vale no lo sabía sí correcto es la mejor solución Sí ya que eso nunca se sabe desgraciadamente sí pues eh Muchas gracias por decirme eso porque cuando os metáis en una empresa de programadores vosotros sois los responsables de hacer esto que acabamos de hacer vosotros sois los que sabéis mira una quinta copia de seguridad eh vosotros sois los que sabéis que esto existe el Chrome Tab y que se puede hacer una copia de seguridad y de que no es tan difícil es un archivo php y es un cont de Linux sabes pero muchas veces es que se te ocurra que tienes que hacer una copia de seguridad y cuando eso ocurra porque vivimos en un mundo en el que a ver vivimos en un mundo que tiene un porqué que tiene una razón de ser pero en el que tú por ejemplo vas por la calle y alguien Random llega y te mete una Y eso es un delito o falta vale Pero tú puedes ir a la policía y puedes decir Oye un tío por la calle me ha metido una Y eso no debe ser así vale Y ese tío pues puede tener una penalización si tiene antecedentes puede ir a la cárcel ese tío puede sufrir consecuencias porque hay una legislación que te protege ahora tú tienes un servidor con una base de datos y llega alguien y te revienta el servidor y tú es como que te jodes o sea es como que es culpa tuya haberlo protegido correcto Sí que consiguieran entrar sabes Entonces el problema está porque esto me ha pasado con anterioridad en aos anteriores en que ese tipo de ataques muchas veces no es solo que no provienen de España sino que no provienen de países de la Unión Europea con lo cual tú vas Cuando digo Tú vas puedes ser tú Universidad de Valencia o quien sea tú vas a la guardia civil y dices Oiga me ha pasado esto y la guardia civil en cuanto detecte que la cosa viene de Rusia por ejemplo la guardia civil te va a decir pues se siente porque no tengo herramientas para correcto pero otra cosa es lo que lo real sabes Entonces te digo Rusia te digo China y te digo un montono de países efectivamente vale otra cosa es que tú al final detectes que ese tío es de valencia si detectas que el tío es de valencia te lo fundes ahora si el tío es de lejos pues es imposible no solo para detectarlo es que aunque lo detectes Aunque digas Mira el tío vive en la calle tal de vladivostok vale fantástico lo has detectado pero te da igual no puedes ir a por él sabes con lo cual claro incluso fíjate Incluso te digo si el tío es de Estados Unidos porque pues de aquí a Estados Unidos tú Envía una petición de Mira tengo un tío que me ha atacado y claro la policía de Estados Unidos va a decir espérate tú quién eres España eso Dónde está España eso no está en África Vale entonces ya te digo es un problema muy gordo con lo cual Pues de las Bueno voy a parar el chome Tab porque si no va a estar aquí hasta el infinito hacendo copi seguridad y me va a petar el ordenador Vale entonces Chrome Tab y borro el Chrome tab y ya está Vale y así lo guardo lo cierro y ya está y ya se parado la copia de seguridad eh a lo largo de estos meses y con esto prácticamente acaba la clase de hoy a lo largo de estos meses vamos a ver que el Chrome Tab nos abre un montón de posibilidades Porque yo por ejemplo en este caso hoy estoy usando el Chrome Tab para gestión de base de datos pero yo puedo usar el Chrome Tab para entrar en la carpeta y Búscame el archivo tal o entra en la carpeta de publicación y archivar todo lo que sea más antiguo de no sé cuántos o sabes o gestionar sistema operativo y eliminar usuarios que ya no estén en uso o sea el chrom Tab se puede utilizar para activar servicios de tal forma que tú como usuario humano No tienes por qué estar gestionando el servidor Exacto sino que lo va haciendo hombre evidentemente como usuar humano pues te debes pasar de vez en cuando y tienes que ir viendo qué es lo que está ocurriendo Vale pero no tienes que estar cada 5 minutos pendiente de a ver qué está haciendo el servidor entonces eh Como ya os digo hasta aquí por hoy el próximo día veremos transacciones entonces bueno Y aparte de que en la próxima clase de sistemas de gestión empresarial aplicaremos el superc controlador que hemos hecho al sistema de gestión empresarial pero como os decía estaremos trabajando con transacciones las transacciones una vez más son como peticiones más complejas a la base de datos de tal forma que hay veces donde Por ejemplo tú le dices en una base de datos inserta a inserta b inserta c y por ejemplo c falla con lo cual dices Bueno c ha fallado No pasa nada Pues tira para atrás pero claro es como no a y b ya han sido insertados y es como si c me da error a y b ya han sido insertados con lo cual me quedo en un estado inestable porque tengo media petición que sí y media petición que no vale entonces la semana que viene veremos que las transacciones dentro de sql a veces son un poco por culeras pero vienen muy bien porque yo puedo crear una transacción de la misma forma que hoy he hecho un procedimiento y decirle intenta hacer a intenta hacer B intenta hacer c te sale Okay ejecútalo no te sale c Okay pues no hagas ni a ni B vale pero tírame para atrás el contenido entonces como ya os digo pues las transacciones no se hacen todos los días también os digo que por ejemplo hay una teoría que dice que cualquier Select o cualquier insert o cualquier lo que sea tendría que ser una transacción porque el insert ASUME que todo va a ocurrir bien pero el insert no tiene un método de saber si ha ido mal pero la transacción sí que tiene ese método para que te hagas la idea podríamos decir en cierta forma no es exactamente eso pero que la transacción es como el try Catch de sql vale Y es que pues primero Inténtalo y si no te sale bien atrapa el error y yo te digo qué hacemos en ese caso Ok Vale pues nada más continuamos el lunes Bueno mañana es fiesta pero no os coge a vosotros porque tengo clase con primero y nada el lunes continuaremos con sistemas de gestión empresarial y tal cual nos lo hemos dejado aquí en acceso a datos el superc controlador el lunes lo meteremos en sistemas y así como os decía el otro día vamos conectando asignaturas Vale pues bueno ya habéis visto hoy en el grup que tengo el YouTube petado con lo cual pues