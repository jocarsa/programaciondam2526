vale entramos en acceso a datos y vamos a ver eh sinceramente Qué estábamos haciendo un acceso a datos la semana pasada estábamos con conectores pero aparte de conectores no me acuerdo exactamente dónde nos quedamos por qué me suena eventos y me suena procedimientos No lo sé vamos a ver un segundo y eh acceso a datos vale vamos a ver no esto era crimson vale pero crimson Okay no vale No esto es el conector de base de datos esto lo tenemos cl perfecto vale esto ya lo estamos trabajando en sistemas de gestión empresarial con lo cual vamos a echar un vistazo a planificación vamos a ver qué te iba a decir yo acceso a datos Vale entonces no no aquí vale transacciones procedimientos vale Okay perfecto eh A mí me suena a mí me suena decirme si estoy equivocado que la semana pasada estuvimos hablando de Procedimientos almacenados eh y os comenté que en el primer curso hablamos un poco de Procedimientos almacenados pero no entro en el examen Pero ahora sí que yo juraría vamos a verlo e local Host phpm admin que el otro día hicimos algún procedimiento almacenado vale crimson me voy a crimson procedimientos y selecciona clientes buenos y selecciona clientes malos yo creo recordar que estuvimos trabajando con esto la semana pasada vale Ok decidme algo cuando podáis para saber si es correcto O me estoy volviendo loco o qué vale desarrollo de programas Ok perfecto Vale pues sí no pregunto ya en primero porque lo primero lo tengo más claro pero yo creo recordar pregunto que el otro día hicimos esto hicimos un proceso de o sea hicimos procedimientos almacenados dentro de vale Okay vale perfecto vale Venga pues a continuación déjame echarle un vistazo a la planificación y a la programaciones dam y vamos a empezar en acceso a datos herramientas de mapeo que viene Ah muy bien manejo de conectores teníamos ahí cinco semanas brutales Vale pues vamos a empezar Ya mapeo de objeto relacional perfecto lo de clientes buenos y clientes malos vamos a verlo aquí Vale pues un momentín porque concatena a nombre completo Ah no vale Sí el malo aquí vale el malo lo que hacía era que creaba una creaba un procedimiento almacenado sin parámetros mientras que selecciona clientes buenos lo que hacía Es que seleccionaba aquí con algún tipo de cadena es decir si yo me voy a procedimientos y yo digo selecciona clientes bueno ejecuto esto Ah vale perdón el malo ejecuto y me devuelve todos los clientes que debían tener Ju por ejemplo debe ser Ju porque ahí veo que pone Ju en cambio selecciona clientes Bueno es un procedimiento almacenado que tiene parámetro con lo cual si ahora vengo aquí digo mira Host le digo Aquí a continuar y me he selecciona todos los Host vale por eso lo de bueno y malo entre comillas era que malo era un procedimiento almacenado que no tiene parámetro y por tanto es como una función sin parámetros mientras que bueno Era que tenía parámetros vale Okay correcto Venga pues eh Como os decía vamos a arrancar un tema que es el mapeo objeto relacional y os cuento un poco de qué va la cosa Mirad nada tranquila nosotros tenemos eh a ver voy a cerrar por aquí nosotros tenemos la idea digamos de la programación orientada objetos en cualquier lenguaje de los que hayamos trabajado esto no depende de ningún lenguaje sino que es un concepto Eso quiere decir que Mirad yo ahora me vengo por aquí me voy a ir a idle voy a hacerlo con python Pero insisto se puede hacer con cualquiera se puede hacer con javascript también vale No quiero hacerlo con javascript porque estamos hablando de un mapeo Y eso quiere decir que al final quiero meter objetos en la base de datos vale eso quiere decir que javascript no accede directamente a la base de datos tendría que pasar por medio de php que también es un ejercicio muy interesante Por cierto y voy a hacerlo en python como primera demostración entonces me voy a me voy aquí me voy a bar me voy a w me voy a html me voy a dam me voy a segundo me voy a acceso a datos no me voy a acceso a datos me voy a mapeo objeto relacional y vo voy al concepto Mira fantástico bien y hago 001 defino una clase y ya está bien Ahora digo Class persona y en Class persona yo digo Death init self y yo vengo aquí y digo Vale pues self pun nombre es igual a nada self punto Si quieres mira coma nuevo nombre coma nuevos apellidos coma nueva edad vale el típico ejemplo que pongo siempre así que ahora digo self nombre es igual a nuevo nombre self pun apellidos es igual a nuevos apellidos y self edad es igual a Nueva edad Vale hasta aquí ninguna ningún misterio AB esto por aquí voy abr esto por aquí que se vea bien que son parámetros qué rabia me da cuando python hace eso y ya está Vale entonces yo ahora vengo por aquí y digo persona un es igual a persona y en persona digo José Vicente coma carrat 46 Vale ejecuto y vale persona takes no arguments persona text No arguments creo que no es esto no persona text No arguments espérate Tex no arguments Death init voy a ponerme esto aquí pero no creo que sea eso Espera vale definit self punto nombre qué estoy haciendo mal no sé qué estoy haciendo mal a ver pero algo estoy haciendo mal error init Ah tres guiones bajos hay que fastidiarse eh y tres guiones bajos venga f5 vale con lo cual ahora yo por ejemplo puedo decir print persona 1 vale Y dice que es una persona y ahora a continuación digo persona dos es igual a persona donde tengo a Juan coma García coma que tiene 50 años Vale y puedo crear tantas personas como quiera no hay ningún problema por esto vale estamos creando clases y de hecho tal y como os he comentado Pues en muchas ocasiones Como por ejemplo en el caso de los videojuegos pues viene muy bien trabajar con clases y con programación orientado a objetos Pero hay un problema y es que yo ahora vengo por aquí me voy a ir a una base de datos llamada Por ejemplo acceso a datos crimson no voy a creo que tenía una llamada acceso a datos vale Y por ejemplo yo ahora a continuación digo vale Cómo guardo esto es decir esto que tengo a la izquierda es un modelo basado en objetos es decir la información está almacenada en clases y las clases se convierten en objetos pero yo en un momento dado tengo que persistir esta información tengo que guardar esta información concreta vale con lo cual Mi pregunta es cómo cojo esto de aquí y lo guardo o sea un modelo basado en objetos y lo en un modelo relacional En qué consiste la palabra mapeo el mapeo es cuando tomas un elemento a con un Rango tomas un elemento B con otro Rango y tienes que hacer que el elemento a cuadre con elemento B Bueno pues La respuesta es que en este caso guardar los elementos va a ser sencillo Porque básicamente si aquí tengo un nombre unos apellidos y una edad Pues aquí básicamente tengo un apellido un nombre y una edad y eso quiere decir que aquí me hago una nueva base de datos me hao una nueva tabla llamada personas y digo identificador vale Por qué no Aunque teóricamente aquí no tengo nada de esto pero vale o sea no tengo aquí en el objeto un identificador Pero bueno da igual nombre apellidos y e edado yo creo que estáis viendo que el mapeo va a ser muy directo me vengo aquí a guardar Ok me vengo a personas y ahora a continuación 002 conecto con base de datos y almaceno Vale entonces vengo por aquí y digo import mysql connector voy a abrir por aquí vamos a ver qué tengo por aquí Esto me lo voy a cerrar y aquí dam segundo acceso a datos ficheros eh clases serializar no es que estos ficheros conectores Y esto es php conexiones php Ok vale nada pues gpt python my sql Connect and insert vale Y mys python que ya lo tengo instalado vale el error no lo quiero soy un poco cic vale y le digo eh No me lo pongas en una función no hace falta y digo conexión es igual a mysql connector donde en este caso lo que voy a hacer local Host acceso a datos Vale y eh cursor es igual a conexión punto cursor esto aquí igual que siempre insert query aquí viene la cuestión no lo voy a hacer tan bonito como esto insert into personas valius y voy directamente a saco nul coma TACA vale Y entonces rec coordenada cursor execute y connection comit vale esto es conexión esto es petición los parámetros no me hacen falta en este caso vale Sería bueno utilizar parámetros pero no lo estoy haciendo y ya está así que aquí voy a utilizar voy a decir F y voy a decir que quiero persona 1 nombre ya sabéis que estoy accediendo directamente a la propiedad del objeto ya sabéis que sería más limpio Hacerlo con un getter Pero bueno ahora por sencillez y por Claridad voy a hacerlo directamente de esta forma vale con acceso directo público y ahora apellidos y ahora edad esto técnicamente es un entero con lo cual pues no lleva comillas Vale y eh punto y coma si todo va bien si todo va bien Ahora le doy f5 y me voy a la base de datos me voy a personas y me ha insertado José Vicente carratala sanchis con edad 46 acabamos de hacer un mapeo objeto relacional es decir acabamos de insertar un elemento que está en un objeto que está en un objeto y Lo acabamos de insertar en una base de datos de tipo relacional con lo cual obviamente pues eh Este es el ejemplo más sencillo y este caso no supone ningún tipo de problema ahora vamos a crear problemas Vale Voy a decirle 003 ahora inserto a todos los clientes personas todas las personas vale porque yo puedo venir por aquí y decir personas es igual a ñaca entonces digo personas. apen es decir creo una lista de personas creo una lista de personas y ahora digo Aquí y ahora digo for persona in personas y ejecuto bueno ejecuto estos dos Entonces es persona nombre apellidos persona edad vale ejecuto f5 Hola f5 le he dao pues parece que sí pero parece que no Okay bien me voy aquí a personas claro se ve que le ha dado dos veces vale Y me inserta José Vicente y me inserta a Juan García es decir lo que estoy haciendo es persistir en una base de datos relacional un modelo basado en objetos problema los objetos por suerte para nosotros tienen cosas que no tienen las bases de datos relacionales o a priori 004 ahora complico la cosa y no es que la quiera complicar porque me guste complicar las cosas al contrario Pero simplemente os voy a decir que hay veces en las que hacer un mapeo no va a ser tan sencillo Cómo Pues mira self emails y ahora voy a suponer que los emails no son un campo escalar sino que son un vectorial o una lista para entendernos vale Send emails self emails es igual a nuevos emails Y entonces qué es nuevos emails pues nuevos emails es info @ jocar.com.mx Juan @garciaposti pues ahí empieza a llegar el problema del mapeo objeto relacional vale Y es que un objeto me soporta esto perfectamente un objeto me soporta que una propiedad sea una lista que una propiedad sea una lista que sea un diccionario que sea una tupla que sea una lista que contiene un objeto que contiene una tupla o sea el nivel de profundidad de la información en python es prácticamente infinita en python insisto en cualquier otro lenguaje de programación que soporte programación te objetos pero claro cuando nos vamos al modelo relacional una tabla es una tabla Y eso es sagrado y yo aquí dentro de una tabla no puedo meter una sub tabla así de repente en un campo vale lo que voy a hacer a continuación 005 vamos a intentar guardar los datos Vale entonces Yo vengo por aquí y digo me personas me estructura voy Air un campo después de edad que se llama emails que es marchar 255 guardar vale Y ahora lo que hago es que insert into personas valius voy a empezar a bajar esto null persona nombre persona apellidos persona edad y Pro Vale entonces vengo por aquí y digo persona. emails vale emails y vamos a probarlo a ver qué pasa voy a vaciar la tabla de personas vaciar Ok bien está vacía vale le doy a f5 igual explota y explota vale explota en este caso porque me dice a ver es que no puedo guardar esto O sea my sql espera que yo le meta un String y tú has intentado meter algo que no es un String puedo hacer Bueno a partir de aquí hay múltiples posibilidades una muy sencilla es convierto a cadena entonces Yo vengo por aquí me voy a eh python list to String Vale y join perfecto pues Hala Okay y digo eh correos es igual a coma de persona emails y aquí meto correos directamente así que ejecuto Hola eh un momentín Por qué no ha entrado porque aquí hace falta una comilla Ok f5 y ahora ha entrado y ahora me voy a personas y ahora veo que me ha puesto info @jaru esto info @j viicente carat.com bueno es una solución que desde el punto de vista de la normalización de bases de datos pues no es muy Guay en el sentido de que me acabo de cargar la atomicidad de los datos es decir en myq se supone que cada celda guarda un dato atómico y esto que estamos aquí pues no es un dato atómico es un dato compuesto vale es un dato compuesto de dos subd datos diferentes que son dos unidades de información diferentes Pero bueno Vale Nos lo comemos No pasa nada vale no hay ningún problema pero claro yo aquí lo que hecho es una lista y convertirla a una secuencia de elementos separados por comas ojo en el mapeo objeto relacional luego hay que hacer el mapeo inverso vale Y es que luego desde una base de datos tenemos que ser posibles o sea tiene que ser posible Eh regenerar vale el registro dentro de un programa orientado a objetos pero hoy vamos a trabajar Únicamente con la primera de las vías un momento Bueno pues a continuación eh complico todavía más la cosa porque yo ahora vengo y digo Mira es que técnicamente eh correos José Vicente no va a ser simplemente una lista va a ser una lista pero que esta lista va a contener objetos entonces digo objeto eh tipo eh personal coma HM valor es info @josé viicente carratala comom coma vale si queréis lo voy a poner así para que lo veáis claro y esto es una coma y Esto va aquí vale Y ahora cojo esto y digo tipo trabajo y valor info @jcarreraandrade 2@gmail.com Claro si yo ahora a continuación os pregunto cómo mapeamos esto dentro de un campo de may sql pues obviamente os va a explotar la cabeza porque vais a decir ahora ya me he perdido completamente porque ya no sé cómo podemos guardar esto dentro de un campo de may sql y que esto siga teniendo algún tipo de sentido vale la dificultad De esta unidad didáctica trata de esto trata de cómo hacer vale Cómo gestionar que por una parte un objeto una clase que pueda tener la complejidad que sea necesaria porque para la lógica de nuestro programa sea necesario que un objeto tenga esta complejidad pero luego cómo persistir toda esta información vale Cómo persistir en un sistema relacional vale porque acordaos no olvidemos todos lo del tema de Blanca el año pasado con el lenguaje de programación c que dentro de python podemos utilizar podemos hacer con la librería pikel vale os acordáis del año pasado de lo de guardar eh leches lo de guardar elementos en archivos binarios vale oos suena os acordáis alguien parece que no Hola estáis ahí no estáis os habéis ido Okay Vale y os acordáis de lo que estoy comentando creo que no vale os acordáis de que el año pasado en un momento dado hacia final de curso teníamos un problema un reto más que un problema vale con la serialización de objetos o de propiedades Okay vale me imagino eh con respecto a guardar archivos Quiero recordar que era desde c vale desde el lenguaje de programación c a archivos de texto vale Y en un momento dado pues Blanca aportó la solución de en lugar de guardar a serializado a una archivo de texto pues guardar directamente a un archivo binario Vale pues esa solución que ahora voy a recordar con una librería de python que se llama pikel vale sigue siendo una solución es decir vamos a ver eso vale pues creo recordar que lo vimos con c vamos ahora a verlo con python esto no soluciona el problema que se plantea en esta unidad pero es un poco para refrescar formas de guardar información así 008 p escribo bien entonces Yo vengo por aquí yo me voy a quitar un momento la parte de may sql esto de aquí es personas vale esto de aquí es esto es correos José Vicente vale Ok f5 vale todo correcto porque simplemente lo que hecho es declarar una clase y ahora con la librería pickel bueno quito import my sql connector import pickel vale eh dentro de piel un momentín solución un python piel pickel right binary vamos a ver si wr binary vale eso okay esto zoom eso es lo que no recordaba Vale y ahora vengo por aquí el with Es que no me gusta vale voy a decir archivo es igual a Open my Data pickel Vale Voy a guardarlo como binario punto Bin el nombre es el que queráis la extensión es la que queráis y ahora digo archivo pun dump y Eh bueno personas sabes directamente Ok en archivo e no perdona pickel doom y en archivo Vale y debería haber un pel punto cl Pero vale venga muy bien entonces yo ahora ejecuto por aquí y le doy a f5 y en esa carpeta que ahora aparecerá me voy a dam En qué escritorio estoy aquí me voy a segundo me voy a acceso a datos me voy a mapeo relacional me voy a concepto y veo que tengo un archivo binario Bin que ocupa Uh cer bytes vale Yo creo que esto es porque me falta eh archivo. Close Okay ahora sí 248 byt bien ahora a continuación Mirad 009 pikel Leo python me cargo correos José Vicente vale me cargo personas. appen y ahora a continuación le digo archivo Open esto es read binary rb y digo pickel pun load a ver Now pickel load piel pel vale rb s eso está claro vale pel pun load Ok y digo personas es igual a pel pun load y del archivo y ahora vengo por aquí y digo print personas Qué es personas le doy a f5 y me dice que Eh Esto de aquí es decir esto es una lista esta lista tiene un único elemento y el elemento es de tipo persona el tipo de dato es persona qué es lo que acabo de hacer aquí pues lo que acabo de hacer aquí es guardar toda esa información a Palo Seco independientemente de la complejidad que ha tenido esa información guardarla en un archivo binario y luego leer el archivo binario y recuperar toda esa información tal cual la guardé vosotros diréis pues ya está o se solución perfecta en el sentido de que ya lo tenemos todo pues no porque pickel al final no deja de ser un archivo binario con lo cual no lo estoy mapeando en una base de datos relacional y diréis Pero qué pesado con la base de datos relacional para qué quieres la base de datos relacional pues para luego poder realizar operaciones de búsqueda de selección o de filtrado o de lo que sea que eso obviamente no lo puedo hacer con un archivo binario recordamos también que existe vale voy a poner aquí esto de aquí wr to J son Pretty print instead of pickel vale recordamos 00 escribo J que en un momento dado si tengo una estructura de datos muy compleja Esto me lo quito me quito piel meto J son vale Ok y quiero quiero Esto vale Y digo diccionario es igual a persona to dict Ah esto persona to dict for persona in personas vale Y ahora aquí esto y ahora digo archivo es igual a Open personas J en modo Wi y archivo aquí esto es diccionario esto es archivo y indent es igual a 4 y archivo punto Close Ok si yo hago esto le doy f5 Hola persona hasb Ah un mom m moment momn porque aquí en el método había que meter un toct esto es vale Ok venga hago así y lo que ha ocurrido es que me acabo de guardar un archivo llamado J son pero sobre todo lo más importante de ese archivo es que si y ahora le doy botón derecho y le doy a abrir con Y le doy a editor pues ocurre esto ocurre que me acabo de guardar el objeto la instancia del objeto con toda la complejidad que sea necesario es decir una lista que o sea un parámetro que contiene una lista que contiene objetos y este objeto su valor a su vez es una lista de strings o sea un ejemplo ya complejo pero una vez más O sea recordemos estas soluciones que están ahí y son fantásticas pero recordemos una vez más que el objetivo de esta unidad didáctica No porque yo lo diga sino porque viene marcado por los objetivos oficiales es como veis por aquí pues trabajar aquí trabajar con el mapeo objeto relacional vale es decir ser capaces de alguna forma si es posible automatizada eh persistir en una base de datos Pues digamos objetos que sean relacionales vale Vamos allá y voy a empezar ahora de nuevo con un ejemplo sencillo eh ejemplo sencillo automático punto python vale vengo a persona quito los emails quito el to Dick vamos a volver a la base esto fuera esto más adelante volverá esto fuera esto fuera Vale ahora recupero el my sql connector okay personas. apen es persona y esto es Juan García con Pues yo que sé 40 bueno 46 36 años 26 años lo que sea vale una forma de mapeo automático consiste en generar nosotros todo aquello que necesitamos dentro de la base de datos eso qué quiere decir Pues que yo ahora vengo por aquí y digo eh 012 listo propiedades en la base de datos en la base de datos no perdón listo propiedades en la clase y me vengo por aquí me vengo por aquí me vengo por aquí python list Class properties y properties attributes bueno vale Ok dir Venga pues a continuación yo digo print personas de Cero y dir f5 nuevos emails espérate nuevos emails no esto no existe ahora no existe Ok Dick dir doc apellidos clases attributes vale only attributes Uy madre mía vale venga atributos es igual atributo vale in my instance que es personas de cero If not callable personas de Cero y que no empiece con esto de aquí vale print atributos y me dice apellidos edad nombre de tal forma que yo aquí puedo meter nuevos atributos de forma dinámica y este print me los va a cazar automáticamente vale Eso quiere decir que yo ahora le puedo decir 013 crear tabla en mysql en petición Y entonces digo Ok pues petición es igual a create Table persona vale create Table persona la voy a poner con mayúscula Más que nada porque corresponde a un mapeo de objetos vale create Table persona y aquí voy a hacer una chuleta persona y voy a poner nombre apellidos edad voy a poner todo rachar ya está 255 prev visualizo sql y me sale esto Vale entonces aquí el engine.in db me lo voy a cargar bien y voy a hacer esto ahora persona y ahora for atributo in atributos momentín esto de aquí loo aquí Lo pongo aquí vale print atributos y Lio petición más igual a esto Esto vale no Pues aquí voy a poner atributo barar 255 nul fantástico al final le pongo petición más igual a esto y en python remove Last from String Ok esto petición es igual a petición de le equito el último carácter print petición f5 aquí me falta un signo más ok vale Y me dice create Table persona eh apellidos barchart not nul edad nombre y not nul O sea si os fijáis está fenomenal vale si os fijáis acabo de formatear una petición a base de datos de hecho y ahora a continuación 014 Me conecto a base de datos me voy a ir por aquí a eh dónde estás pikel complico vale me voy a mysql connector OK Me conecto a mysql cursor Ok realizo una petición y ejecuto la petición y commit petición es esto con lo cual atención esta conexión realmente iría arriba ahora comentamos código f5 y si no he cometido ningún error Ahora me voy a mysql Ahora me voy a mysql donde sea que esté mysql aquí recargo Y si todo ha ido bien en acceso a datos me ha aparecido una tabla llamada persona y la tabla persona tiene apellidos edad y nombre pero si yo ahora me elimino la tabla persona y aquí de repente digo self email es igual a Nuevo email y aquí arriba digo info @josé viicente carratalá com y aquí pongo Juan @garciaposti me voy a refrescar persona y veo que persona también tiene email esto qué quiere decir pues esto quiere decir que ya esto ya empieza a tener buena pinta en el sentido de que eh estamos haciendo que mysql se adapte automáticamente a las condiciones que nosotros pongamos vale aquí si esto lo vuelvo a ejecutar me dará error porque me dirá Table persona already exists por tanto puedo decir create Table If not exists persona vale Y eso ya no da error porque intenta crear la tabla y si no existe pues no pasa nada vale bien con esto ya tenemos la primera parte de la parte contratante claro ahora tenemos que meter datos Así que ahora a continuación vengo por aquí y digo 015 y meto datos Y entonces ahora vamos a ver Ok Ok un momento no conex execute petición vale por aquí voy a bajar esto por aquí y ahora digo vamos a ver petición es igual a insert into persona Val vale otra vez empiezo a formatear una petición y ahora para cada uno de los atributos for atributo in atributos y le digo aquí y le digo comilla comilla coma me cargo la el último carácter de la petición le y cursor execute vale Yo creo que ya entonces f5 eh canonic cate Sí perdón str me aseguro que todo sea str no tuple Ah no tuple ostras a ver línea 44 peticiones iguales atributo es atributo Ah no no no que no es atributo tú madre mía esto es eh uh Ah sí esto es Ah no for atributo en atributo espérate okay for persona in personas Vale ahora for atributo in atributos Entonces esto es punto y coma y esto es persona punto atributo vale creo que sí persona has no attribute vale atributo persona de atributo is not subscriptable vale venga un momento porque eco o print atributo Okay create Table vale apellidos un momento esto vale correcto el get attribute un momento esto es correcto vale esto es lo que me falla esto de aquí o Okay Vale f5 eh canonic con cenate esto HM Ah okay Esto va Aquí y Esto va aquí okay muy bien una vez que hemos hecho esto si todo ha ido bien vale si todo ha ido bien quiere decir que me voy a mysql y no solo ha creado automáticamente la tabla sino que además ha poblado de forma automática la tabla Eso quiere decir que yo ahora no solo puedo crear la tabla que yo quiera sino puedo insertar los datos que yo quiera vamos a poner comentarios porque este código ha crecido y para que quede todo claro vamos a ver creo una clase que es el modelo de datos vale preparo una conexión con el servidor vale creo una lista de personas y ahora aquí creación dinámica de la tabla en la base de datos Y esto de aquí es crea inserción dinámica en la base de datos inserción dinámica de registros Okay bien pues una vez que tengo esto Ahora voy a empezar a comentar las cosas preparo una con en la base de datos no tiene mucho misterio creo una clase no tiene mucho misterio está claro lo que hace pero preparo el principio de la petición listo los atributos de la clase y ahora para cada uno de los atributos los encadenó a la petición me como la última coma porque si no da error y cierro el paréntesis de la petición y el PR petición Es simplemente para verlo Vale ahora inserción dinámica lo mismo e espérate Ah no esto no va Aquí Esto va Aquí Vale ahora creo un cursor ejecuto la petición y ahora para cada una de las personas hago un insert empiezo a preparar la inserción Y entonces para cada uno de los atributos PR atributo ya sabéis que ya no hace falta y encadenó ese atributo a la petición de insert bien le quito la última coma Le encadenar étes final y ejecuto la petición y al final lo lanzo todo contra el servidor eso es lo que hace el código que hemos desarrollado hoy vale que es un código Que de momento hace un mapeo objeto relacional sencillo vale pero nosotros digamos no nos o sea simplemente definimos un modelo de datos y no nos tenemos que preocupar De nada más qué ocurriría si yo ahora digo self punto dirección es igual aeva voy a hacer eh 017 nuevo modelo de datos Ah ahora vengo por aquí y digo nuevo email nueva dirección vale Yo aquí digo eh la calle de José Vicente Pero hay un problema y la calle de Juan f5 me da un error porque el número de columnas no coincide entonces hay una cosa que podemos hacer un momentín que esto lo voy a mover arriba hay una cosa que podemos hacer Y es que aquí vale Antes que nada borramos la tabla anterior por si acaso hay eh datos anteriores o una estructura anterior que no me valga ent una posibilidad No digo que siempre que haya que hacerlo vale digo que una posibilidad es esta eh dónde estás aquí petición es Drop Table personas persona así que f5 Y si ahora a continuación recargo donde Antes había apellidos edad email nombre ahora recargo y hay apellidos dirección edad email nombre es decir lo que he hecho es elimina la base la tabla anterior Crea una nueva tabla con el nuevo modelo de datos y vuelca el modelo de datos correcto vale bien como os digo este eh es un caso relativamente sencillo y aún así nos ha llevado un poquito de esfuerzo pero aquí tenéis un bloque de código que más adelante podéis reutilizar para lo que queráis en el momento en el que queráis mapear en el sentido desde el objeto hasta la base de datos ahora bien qué ocurre cuando a continuación quiero lo contrario Perdón lo contrario no lo contrario hoy todavía no qué ocurre cuando lo que quiero a continuación es ahora 018 eh complico un poco el modelo vale Y entonces digo eh self punto teléfonos voy a dejar Claro que eso es una lista eh nuevos teléfonos coma nuevos teléfonos vale Y aquí pongo en la web de José Vicente pongo 1 2 3 4 coma 4 5 6 7 yo que sé y aquí pongo coma pues 3 4 5 6 com 678 lo que sea bien ahí tengo un nuevo modelo de datos y de hecho si ahora intento persistir esto f5 Hola dice que lo ha hecho no sé qué habrá hecho vamos a comprobarlo eh le doy a persona vale Bueno me ha hecho prácticamente lo mismo de antes vale me lo ha insertado como en este caso una lista completa lo cual insisto o sea funcionado ha funcionado Pero no es lo óptimo Ahora yo pregunto Qué es lo óptimo qué es lo que debería ocurrir qué es lo que debería hacer el programa Bueno pues en un mapeo relacional y aquí viene la complejidad De esta unidad didáctica lo que debería ocurrir es que si yo aquí tengo teléfonos y teléfonos es plural y tengo una relación de un a n Pues debería hacer una tabla externa llamada teléfonos y debería guardar en esa tabla externa cada uno de estos teléfonos vale es decir debería hacer una relación porque para eso porque aquí existe Es decir aquí tenemos una Ray tenemos un list y pero este list está enlazado a esa persona pero eso es posible en objetos Pero qué ocurre en un mapeo relacional Pues en un mapeo relacional es otra tabla Pero qué ocurre si hago otra tabla que esa tabla tendrá que tener un foreign key vale tendrá que tener una clave relacional para la tabla anterior esto qué quiere decir pues que ahora este modelo que tengo en la pantalla técnicamente no me vale del todo porque si teléfonos va a estar en una tabla externa Necesito un número una clave Primaria para identificar con la tabla primaria pero no lo tengo vale con loig ya empiezo teniendo un problema pero no pasa nada porque yo a continuación voy a decir clientes voy a simular identificador 255 clave primaria autoincremental simulo sql Hola a veces se queda pillado y no sé por qué A ver 019 creo clave primaria Okay vale Ya te digo no sé por qué ahora se ha quedado pillado un momentín recargo vale usuarios o cosa identificador entero eh índice primario autoincremental vale Y ya OK bien previsualiza vale Y digo identificador entero not nul autoincrement esto por aquí Okay vale esto lo pongo aquí identificador not nul int not nul autoincrement coma Vale y primary key identificador y primary key identificador vale Yo creo que ya yo creo que ya pero no ya porque insert into personas vales nul coma lo que sea el nul es para poner un valor nulo al identificador al autoincremental ejecuto Ok Ay qué ha pasado vamos a ver meq server not nul vale he tenido un problema ahí entonces create Table If not exist voy a decir cursor este fuera vale voy a decir print petición Y probablemente he tenido un problema al formatear la petición Eh no Uy qué cosas por me das error ah Table acceso a datos persona ostias qué por qué me dices esto vamos a ver vale me dice que no existe me dice que no existe porque no existe vale por Ah vale Drop Table If exist persona Ok bien Ahora qué me dice creable not persona identific nul Vale me da un error de sql vamos a ver si pongo aquí el sql Lo pongo aquí en sql y a ver si aquí me dice mejor el error vale int not nul autoincrement identificador in not nul auto increment Ah cuidado esta comilla que hací ahí es un poco rara vamos a verla aquí ese es el problema vale f5 otro error muy bien No pasa nada y primary Ke identificador estas comillas abiertas vale f5 muy bien sigue dando error vamos a verlo me dice cerca de identificador en la línea uno claro como todo es uno voy a bajarlo apellidos dirección edad email nombre teléfonos not nul primary key ahora Ahí está el problema vale Ya no hace falta esto ya no hace falta esto f5 okay Vale ahora sí si ahora me voy a la tabla Ahora me voy a persona y si me voy a persona veo que no solo eh tengo como podemos ver el identificador vale o sea Perdón los datos sino que Además tengo un identificador que es clave primaria entero autoincremental eso qué quiere decir pues que de Cara a hacer un mapeo relacional ahora ya tengo esto más preparad dito para un campo externo como son teléfonos y en el caso de que un campo sea teléfonos pues lo que voy a hacer es que me lo voy a separar a otro a otra tabla tened en cuenta que estoy programando directamente en abstracto Eso quiere decir que la programación se está complicando pero a cambio lo que estoy haciendo No solo funciona para la tabla personas vale funciona para cualquier tipo de tabla que nosotros queramos vamos a hacerlo sobre personas y en cuanto lo tengamos que probablemente no lo vamos a acabar hoy sino que lo acabaremos el próximo día pero en cuanto lo tengamos Pues veréis que la solución que estamos desarrollando más adelante os servirá para mapear y para persistir cualquier tipo de objeto bien para esto a continuación yo lo que voy a hacer es detectar qué Campos son una lista así que me vengo por aquí 020 y detecto si el campo es una lista y entonces digo vamos a ver primero la tabla Ok atributo Vale y digo If e atributo If not list atributo creo que es así un momento vamos a ver check If Element is not a list in python creo que es not list Pero bueno Ah instance interesante Vale pues esto If not is instance Element the list Element es atributo en ese caso petición por aquí si es una lista Pues ahora veremos lo que hacemos Vale ahora trabajaremos el els aquí a continuación vamos a ver digo list Espérate momentín porque claro atributo no list vale bien pero get att ahí If is instance get att de persona de atributo vale list es igual a esto muy bien y ahora otra vez si not is instance de esto vamos a probarlo f5 Okay person is not define un momentín En qué línea en la 48 o sea no lo sé 48 If not is instance de persona de personas de cero Okay vale hago así me voy a la base de datos me voy a persona y veo que no está teléfono es decir si un atributo es una lista lo excluye de aquí lo excluye de esa tabla por qué Porque va a crear una nueva tabla obviamente Así que ahora 021 creo una nueva tabla para el atributo que sea lista vale els petición 2 es igual a create Table If not exist vale vamos a verlo momentín que te lo voy a decir esta petición que voy a hacer no va a ser correcta vale pero un poco para ir abriendo boca not ex atributo identificador entero not nul increment coma atributo bar charar coma primary key identificador vale Y ya está e cursor execute petición 2s y vamos a ver vale vamos a probarlo f5 Ok me voy a la base de datos y veo que está persona y si todo va bien refresco y veo que ha creado teléfonos Es decir me ha creado persona Y como teléfono es un campo que es una lista me está preparando una tabla llamado teléfonos y en teléfonos tengo Ah atributo cuidado esto lo ha guardado mal vale tengo identificador y tengo atributo qué es esto atributo no perdona eh atributo los teléfonos Estos teléfonos Bueno pues sí pues teléfonos pues ya está vale Así que voy a llamar a esto vale Y voy a hacer también petición dos es igual a Drop Table If not If exists atributo cursor punto execute vamos a verlo Ok me voy aquí refresco vale Y me dice identificador teléfonos podríamos pensar que es fantástico pero todavía no vale ahora vamos a ver por qué ahora insertamos dentro de esta segunda tabla 022 insertamos los datos Y entonces digo si es una tabla sea si es una lista en ese caso lo que voy a hacer es petición do insert into e atributo valius nul coma y esto debe ser esto get att persona de atributo de hecho lo pongo como String de hecho lo pongo como String completo ahí y gu bajo o sea y barra de esta y ahora cursor execute de petición 2s vale si todo va bien ya casi lo tenemos falta poco f5 con lo cual me vengo aquí y veo que tengo persona y dentro de persona luego me voy a teléfonos y ay mu no no quieto Vale ahora vamos a ver Esto vale para cada uno de los elementos de la lista ok vale Perfecto no pasa nada vamos a ver eh 023 cada elemento de lista es independiente y entonces vengo y digo for elemento in esto y en esto Ok esto aquí y str de elemento vale si todo ha ido bien Ahora me voy a la base de datos y tengo persona y tengo teléfonos está casi bien vale ahora ya estamos haciendo un mapeo de objeto a una base de datos relacional de bastante más calidad de lo que teníamos hasta el momento nos falta una cosa nos falta el primary key vale perdón el foreign key es decir tengo persona tengo a José Vicente y a Juan tengo teléfonos Tengo este y este teléfono pero cómo sé a quién pertenecen Pues no lo sé ese es el problema vale No lo sé y claro aquí debería haber un campo más que debería ser la clave for la clave foránea es A quién pertenece ese elemento sacar una clave foránea va a ser difícil y el motivo por el cual va a ser difícil es porque en un momento dado no sabemos Cuál es el índice de la persona vale lo vamos a intuir de casualidad porque como sabemos o pensamos que el índice numérico de sql va a coincidir con el índice numérico de personas pues vamos a suponer que coinciden aquí me estoy tirando un triple muy grande quiero decir que va a coincidir va a funcionar en este caso concreto igual en Casos concretos o sea igual en casos más complejos no funciona pero vamos a probarlo hoy va a funcionar y así por lo menos entendéis el concepto Así que 024 clave foránea vale Y entonces un momentín Au Ay Ay vale Y entonces yo vengo aquí y digo insert into vale insert into personas no create Table If not exists atributo identificador atributo bar charar y aquí voy a poner fk int de 255 ya está vale creo un campo llamado fk Por qué Porque es un fore key Ya está no tiene mucho más misterio bien ya le pondremos otro nombre más clarito que fk tampoco es que no sea claro y ahora a continuación vengo aquí y digo for persona in personas un momentín un mín chat gpt python for in How to Index Okay Ok Ok Ah bueno vale Ok no está mal esta solución Vale entonces digo for persona no por personas y esto es persona índice ok Ya me puedo cargar esto y entonces le digo insert into atributo valius nul coma índice coma s elemento es decir en este caso insisto una vez más estoy asumiendo que el índice de mysql va a coincidir con el índice de la Ray de personas Insisto que en este caso va a funcionar en otros casos No lo sé bien Así que ahora vengo y ejecuto f5 el concatenate un momentín str vale Y yo ahora a continuación me voy a mysql veo que tengo las personas veo que tengo los tel pero los teléfonos Au 00 y 1 y un no perdona má un OK ahora sí y veo que tengo los teléfonos y veo que el teléfono un y un con corresponde al usuario con identificador 1 y el teléfono 2 y 2 corresponde a la persona con identificador 2 luego acabo de implementar un mapeo objeto relacional con un poquito más de con un poquito más de gracia de lo que lo tenía hasta ahora Vale Voy a hacer lo siguiente 025 especificar tabla con lo cual yo ahora vengo por aquí y digo eh Por ejemplo aquí creo una clase y digo clase es igual a persona entonces Yo vengo por aquí y aquí donde pone clase Drop Table If exists persona o sea clase create Table If exist clase Drop Table If exist create Table If exists Ok insert into classe vale f5 sigue funcionando igual pero qué ocurre Pues que ahora a continuación Mirad yo me voy a reutilizar y al reutilizar digo mira ahora sabes qué voy a crear una clase producto la clase producto tiene un nuevo nombre tiene una nueva descripción tiene un nuevo precio y tiene unas nuevas categorías nombre descripción precio y categorías Es decir me he creado un modelo diferente Ahora nuevo nombre nueva descripción nuevo precio y nuevas categorías la clase Ahora se llama producto y yo ahora digo productos voy a dejarlo como personas vale para no marear productos camiseta y camiseta fenomenal para el día a día precio pues 34,56 esto Qué es eh categorías Vale pues categorías es eh ropa y Caballero vale Y ahora a continuación me creo otro elemento que se llama pantalón para vestir de noche Vale pues 56 con 43 ropa y señora qué ocurre que tengo un modelo de datos tengo una clase diferente tengo una entidad diferente tengo categorías la clase se llama producto creo nuevas instancias y si todo ha ido bien f5 persona is not defined Dónde está Perdona aquí Ah no dónde estás es más En qué línea me lo dice línea 30 Ah persona claro no es persona Perdón es producto y producto vale f5 si yo me voy a la base de datos yo ahora refresco y veo que tengo producto y tengo camiseta fenomenal para el día a día camiseta pantalón el precio pero las categorías no están en esta tabla porque como son varias categorías están en otra tabla así que me voy a categorías y en categorías veo que el fk número un es ropa y caballero y el fk número dos es ropa y señora Vale hasta aquí la clase de hoy con lo cual para no marear porque ahora tenemos que hacer el camino inverso pero el camino inverso lo haremos en la próxima clase de hecho este camino técnicamente no está acabado porque no hemos creado foreign Keys de verdad sino que hemos creado foreing kys filosóficas vale Pero el próximo día Tendremos que hacer que sean de verdad pero de momento hoy lo que quiero es que el concepto que os haya quedado claro aunque sea a nivel muy global es que existe la forma existen formas de mapear un objeto con toda la complejidad que admite un objeto porque un objeto es muy sufrido le puedes meter ahí de todo con una tabla con una base de datos relacional que no está tan sufrida y no le puedes meter tanto de todo pero sin embargo aunque no le puedes meter de todo pues hay mecanismos Mediante los cuales puedes convertir ese modelo de objeto a un modelo de base de datos relacional Y a partir de ahí seguir funcionando y asegurarte que toda la complejidad que tiene tu base de datos la vas a poder guardar en perdona tus objetos la vas a poder guardar en una base de datos para más adelante pues hacer búsquedas recuperar Ahora quiero devolver al programa pero solo una porción de los objetos no quiero todos vale lo que sea y lo que haga falta la idea Está en que pues en el mercado en el sector Por una parte tenemos lenguajes de programación que tienden que favorecen a trabajar con programación orientada a objetos Por otra parte tenemos que la base de datos má más utilizada son bases de datos de tipo relacional pero el modelo de uno y el modelo de otro no cuadra es decir el modelo de programación orientado de objetos es un modelo de éxito el modelo de base de datos relacional es un modelo de éxito Pero los dos modelos no cuadran en absoluto vale por tanto en un momento dado se requiere pues utilizar algún tipo de estrategia luego veremos que en python hay herramientas ya prediseñadas y preh hechas y preconstruidas como librerías para hacer Este mapeo vale Pero antes de utilizar herramientas que ya existen quería hacer un ejercicio más manual para que entendáis de cero Cuál es el concepto y cuál es la problemática de mapear objetos a una base de datos relacional vale bien pues poco más por hoy nos vemos la semana que viene y nada y a darle caña y nada y nos vemos el lunes Vale y cualquier cosa pues ya lo vamos comentando por el grupo vale venga hasta luego a vosotros