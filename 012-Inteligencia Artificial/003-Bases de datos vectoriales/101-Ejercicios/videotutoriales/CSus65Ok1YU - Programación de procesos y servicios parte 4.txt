bien ahora a continuación vamos a empezar a introducir bueno ciertos parámetros dentro de cada uno de los workers tales como por ejemplo voy a meter la energía para digamos energía ok voy a decirles que al principio es igual a 100 y bar vamos a decir hambre es igual a cero de momento para empezar a continuación voy a hacer lo siguiente voy a decir bar duerme perdón función duerme y al dormir voy a decir que energía + + y ahora a continuación voy a hacer lo siguiente y vamos a ver voy a decir que bajar muerto es igual a folks no está muerto está vivo y voy a decir que la energía es menor que 20 en ese caso duerme y en caso contrario un vuélvete pero hay un pequeño problema y es que a medida que uno se mueve la energía decrece esa va a ser un poco la cuestión y ahora el tamaño voy a hacer que sea vamos a ver energía partido por 10 porque si intento hacerlo de 100 realmente va a ser una barbaridad así que recargo vale ahí tenemos los personajes y cuando tienen poca energía lo que hacen es que paran alegría estoy siguiendo a uno estoy siguiendo a uno de ellos nunca deja de moverse ah muy bien vale claro perfecto fantástico y si energía y energía es mayor que 80 en ese caso ya se puede mover vamos a verlo es cuando están durmiendo y ahora se quedan deberían quedarse quietos esperando a que decrezcan a ver claro lo vamos a ver qué energía más vale lo que quiero es que se quede en un momento quietos porque lo que están haciendo es un poco de trampa es decir están moviéndose independientemente vale vamos a hacer una cosa vamos a ver bar dormido es igual a falls y entonces digo vamos a ver si energía es menor que 20 dormido ok es igual a true duerme en ese caso si dormido es igual a true en ese caso duerme y cuando la energía sea 80 en ese caso dormido es igual a falls eso quiere decir que despierta así que recargamos por aquí vemos que algunos personajes se quedan por ahí quietos voy a seguir a uno al principio deberían perder de energía al moverse vamos a poner menos porque no estoy viendo nada recargamos este por ejemplo entiendo qué debe estar durmiendo no porque se mueve rápido o sea se mueve lento y yo diría que no están durmiendo nunca caen dormidos entonces algo debe estar fallando en la lógica vamos a verlo vamos a ver dormido es igual a fox si energía es menor que 20 en ese caso 2002 igual a trigo si dormidos igual a true duerme si energía es mayor que 80 dormidos agua falls y muévete entonces no entiendo por qué por ejemplo estos de aquí no se hacen pequeños vamos a eliminar unas cuantas cosas ok así que para esto recargo me he cargado a la bolsa ver 5 errores al experto efe wood no sé muy bien que me he cargado pero sí que parece que me ha cargado algo si he cargado esto recargamos y en principio deberían estar cayendo de tamaño pero no están cayendo cuando se mueven energía - igual a 10 una barbaridad y evitarse hay algo que me extraña porque al moverse no están perdiendo energía voy a decir con sole punto log energía y así vamos a ver qué es lo que ocurre recargamos y siempre es fiel ese es el problema entonces cuando el personaje se mueve de hecho cómo se están moviendo si nadie está haciendo que se muevan cambia dirección son 100 ahí hay un problema vale bien y digo si la energía es mayor que 80 se mueve vamos a verlo ahora se mueven porque sí ok y cuidado porque no se pueden hacer lo que hay tan pequeños vale sí energía es mayor que 80 en ese caso un dormido es igual también es el balafón eso y si dormidos igual a folk en ese caso muévete vamos a verlo vamos a ver ahora el personaje se hace pequeño duerme y se vuelve a mover ahora sí está funcionando correctamente está perdiendo mucha energía lo sé pero ahora lo corregimos pasar lo que hacemos que el personaje se mueve pierde energía cuando se pierde energía duerme al dormir recupera y una vez recuperada pues se despierta y sigue trabajando muy bien ahora puedo quitarle menos puedo decirle que cuando se mueve pierde 0.1 de energía cuando duerme suma 0.1 de energía y así los ciclos digamos de sueño no serán tan rápidos puedo quitar ya el control de puntos porque ya lo estoy viendo se van haciendo pequeños y cuando se hacen pequeños aparte de que esos acaban de echados pues duermen y una vez que duermen pues luego gran energía al dormir y se despierta ese día y creo que ya dentro de poco salir a dormir ahora está durmiendo está aumentando su energía y en cuanto a su energía haya aumentado suficientemente pues se despertará y seguirá trabajando bien vamos ya tenemos la energía producida por el cansancio por la necesidad de reposar vamos a continuación a por el hambre y es que si hay hambre digamos el sistema tendrá que comer vamos a poner unos cuantos puntos para comer por aquí por el proyecto vale para que el personaje pues pueda comer vale entonces en este caso voy a hacer lo siguiente me voy a ir a index y voy a decirle al sistema que vamos a ver el número bar número comida cuidado bar bueno sabes qué comida es igual a mí y barral bar número comida es igual por ejemplo a 20 y ahora voy a decir y ahora voy a decir aquí al principio foro bar y es igual a 0 y es menor qué número comida y más y voy a decir que en este caso pues número no esto que es comida jim es vamos a poner por aquí directamente pues x es igual a más punto random por 512 coma y es mas punto random 512 y yo creo que más o menos ya está así que la vengo por aquí y luego formar y es igual al número comida con texto beijing paz contexto punto arq d comida y punto x comida de punto y coma 20 0 x 2 como true y entonces contexto punto field y ya está y pues contexto punto voy a poner que la comida sea roja de color rojo así que si todo va bien vengo por aquí y habré creado pues unos círculos por aquí de comida muy grandes estos círculos representan digamos puntos donde los personajes pueden comer la idea es la siguiente a continuación voy a introducir aquí que pasa algún error no es que han desaparecido los elementos vale que estaban por allí voy a hacer una cosa la comida la voy a pintar correcto ahí y ahora voy a introducir la comida digamos en la matriz que voy a pasar a los personajes así que post message y le digo comida es comida ya le estoy pasando la matriz de la comida para que cuando un personaje se quede sin comida pues sepa dónde puede ir a buscarla me vengo por aquí y digo hambre es igual a cero cada vez que me muevo pues hambre más igual 0.1 entonces function busco comida función como y entonces ahora como y entonces ahora en busco comida lo que voy a hacer es que cuando sí en el hambre el hambre así mi hambre es mayor que 80 en ese caso pues voy a buscar comida entonces lo que voy a hacer es foro voy a buscar la más cercana y es igual a 0 y es menor que datos no otros no esto es barco mira comida es igual a datos punto data punto comida y entonces voy a decir comida leg y más y entonces en este caso lo que voy a hacer es averiguar pues cada uno de ellos es decir para empezar vamos a ver si está cerca bar barber comida bueno y comida a distancia es igual a esto y digo si la distancia es menor que 30 vamos a avanzar por ahí pues en ese caso lo que voy a hacer es que mi orientación digamos debe ir hacia la comida en este caso lo que voy a hacer es buscar dónde estás javascript angle between two points vamos a verlo y aquí está entonces ángel rubiáns vamos a verlo aunque el barrio antes igual los agregados ósea comida px para perdonar comida de y comida de griega post y comida de x posee x y entonces digo que ángulo dirección es igual a angle radiance si esto funciona bien vamos a verlo si esto funciona bien cuando tengo hambre y estoy a menos de 30 unidades de un punto de comida pues voy a ir hacia la comida vamos a ver si es cierto o no recargo vale vamos a esperar a qué tenga alambre y cuando tengan hambre vamos a verlo no sé si están cogiendo y se ha quedado a dormir vamos a ver si hambre con solé punto log tengo hambre vamos a verlo vamos a esperar un momento y ahora en cuanto se hagan pequeños ahora en cuanto se hagan pequeños pues empezaron a decir tengo hambre o se han puesto a dormir qué curioso se paran a dormir pero nunca dicen que tienen hambre qué es voy a poner hambre igual a 1 vamos a esforzar que tengan hambre y esto ya me extraña mucho esto ya me extraña mucho porque nadie está diciendo que tenga hambre bar hambre es igual a cero hombre más igual a uno vamos a ver con sol punto log hambre porque ya me está extrañando muchísimo que nadie diga tengo hambre pero 10 20 50 80 90 100 y qué pasa no estoy ejecutando busco comida muy bien eso es lo que pasó con sol vamos allá y ahora en un momento en principio deberían empezar a buscar comida pero no están buscando vamos a recuperar el tengo hambre y creo que había ido uno a por ello tengo hambre pero que yo vea ai ai sí que parece que efectivamente están encontrando vamos a decir que distancia es menor que 50 aunque 60 o que 100 o que lo que sea para que no encuentren mejor tengo hambre y ahí van a comer sí que está funcionando correctamente vale entonces ahí lo que vamos a hacer es lo siguiente si hambre es mayor que 80 vale y ahora digo bar hambriento es igual a fox y entonces digo si hambriento es igual a falls ok y ahora digo lo mismo aquí sí hambre es mayor que 80 en ese caso hambriento es si hambriento extra en ese caso de esa por comida ahora si comida sí hambre es menor que 20 en ese caso hambriento es igual a fox vale entonces ahora lo que voy a hacer es que como a distancia es menor que bien en ese caso hambre menos hombre menos igual cuánto le puesto antes menos igual a uno vamos a verlo cuidado hambriento y es notifight mar hambriento spotify y entonces ahí tengo hambre va y comer y cuando ya ha comido teóricamente debería irse a hacer su marcha cuando ya ha comido debería irse a hacer su marcha vamos a ver por qué no está ocurriendo eso mientras tanto tenemos aquí los que están durmiendo mueven duerme vamos a hacer que todo ocurra muy rápido vale duermen después de llegar a por la comida una vez que han comido se quedan ahí entonces hambriento es igual a falls si hambre es menor que 20 hambriento es igual a falls con lo cual teóricamente deberían dirección es igual a más random por p es decir una vez que han comido deberían irse pero no pero se están quedando vale creo que ya lo único es que lo único es que tienen que volver vale pero creo que ya está funcionando entonces vamos a ver hambre menos 0.1 0.1 vamos a dejar que todo ocurra más lentamente 0.1 y si todo va bien y si todo va bien ahora sí tenemos ya los personajes vamos a darle una vez para que corran un poquito más rápido en la velocidad más punto random por 2 + 0.3 que corren todos un poquito más y ahí los tenemos teóricamente cuando tengan hambre pusieran al comer ayer tenemos tengo hambre claro tengo hambre y tengo sueño también de momento están durmiendo ahora se despertarán y ahí lo tenemos y ahora van a comer porque tienen hambre perfecto vale vamos a hacer lo siguiente cuando comen vamos a decirle qué se comen rápido y luego por otra parte la energía esmas.com por 100 por 50 más 100 950 y esto es lo mismo pero bien esto vale un poco para que cada uno tenga un valor diferente de hambre y de sueño y de todo esto están comiendo y cuando acaban de comer deberían irse ya se han ido perfecto vamos a poner más personajes pero parece que esto marcha vamos a poner 50 importante que veamos que toda la lógica de cada uno de los personajes está en el worker bien ahora ahí está ahora vemos como algunos comen algunos duermen vemos como tienen que descansar de vez en cuando y cuando han descansado pues se recuperan vamos a hacer que duerman un poquito más rápido que recuperen el energía va un poquito más rápido estamos acabando vamos a verlo bien allí parece que los últimos cambios que hemos hecho pues como podemos observar en el procesador están haciendo que el sistema le cueste así que bueno que se va a hacer es lo que tiene el hecho de que cuantos más cálculos hagamos pues más va a pensar el procesador ahí los tenemos comiendo algunos durmiendo y ahora lo que voy a hacer lo que voy a hacer es poner alguna condición digamos como de muerte y es que si en un momento dado uno un personaje se queda sin comida o jesse o sea el hambre digámosle se le pone a cero pues el personaje digamos se mueve o sea tiene que o sea si descansa vale pero tiene que encontrar comida porque si no morirá entonces vamos a por ello vamos a por ello vamos a intentarlo ya a ver si tenemos suerte y no se nos muere ninguno lo que voy a hacer ahora por tanto es decirle al sistema que funcione muerte y voy a decirle que sí hambre es menor que 0 en ese caso muerto es igual a true y por tanto todo esto lo que hace es bueno aparte de que le voy a decir que dónde está ferré es igual a cero ya es de color negro es igual a 0 se ve es igual a 0 y por tanto voy a decirle al sistema que si todo esto depende de muerto es igual a false porque si el personaje está muerto pues ya no hace falta que hagamos todo esto y ok vamos a por ello voy a poner reto de 30 personajes y vamos a por ello recargamos vamos a verlo no se ha recargado te diría que no vamos a verlo ahora entonces la idea es que ninguno se quede sin energía pero cuando duermen técnicamente no pierde energía pero bueno cuando duerme técnicamente pues creo que ahí no voy a hacer una cosa cuando duerme hambre más igual a 0.1 voy a poner voy a ser muy cruel en el sentido de que cuando el personaje duerme pierde un poco de energía pero que gana un poco de hambre y quiero decir pero tampoco tanto como cuando está caminando así que hay los personajes están comiendo vale ahí se van pero vuelven yo creo que cuando se están comiendo la energía les puede subir al infinito con lo cual pues alguno estará acumulando energía infinita prácticamente y por tanto o hambre me negativo y por tanto no podrán morir por suerte para ellos pero como podemos ver pues bueno e intentan estar cerca de la comida lo cual es por su cuanto menos curioso una cosa que puedo hacer es decir qué sí hambre cuidado hambre menor que cero hambre mayor qué es a ver creo que estoy bien hombre raro bien si hambre es menor que cero en ese caso hambre es igual a cero y energía es igual a 100 en ese caso energía es igual a 100 esto es mayor que a 100 lo que estoy haciendo es que los personajes pues no puedan hacer ciertas trampas digamos que no puedan tener la energía infinita que no pueden traer hambres negativa todo esto los tenemos uno se ha quedado dormido justo antes de llegar la comida es curioso y bueno como vemos pues están cumpliendo que cuando tienen hambre pues van a los huecos de comida y cuando han comido cuando han descansado pues se van muy bien bueno y siempre se puede realizar algún ajuste por ejemplo en este caso observó que al rato de haber dejado esto un poco funcionando pues de alguna forma es como que se juntan todos en los comederos pero yo creo que no es por un tema de avaricia por comer sino que es por un tema de que se quedan atrapados porque antes cuando he dicho que choquen lo que he dicho realmente es que se den la vuelta a 180 grados pero creo que ese dar la vuelta a veces los deja un poco atrapados vamos a venir aquí vamos a venir a cambiar dirección entonces voy a hacer lo siguiente no cambia dirección no perdona colisión cuando colecciona por de esto dónde estás evitarse ahí está entonces voy a buscar la función de buscar comida y lo que voy a hacer con esto es el ángulo en radiales vamos a ver voy a decirle que angle rubiáns voy a darle la vuelta a las cosas que es post y no esto y porsche x menos esto porque es porque no quiero que vayan el uno hacia el otro con la comida quiero que huyan el uno del otro así que vengo por aquí direcciones iguala el radiance y vamos a probarlo entonces ahora lo que va a ocurrir es que pues cuando alguien va a colisionar pues intenta huir digamos en la dirección contraria vamos a ver al intentar huir vamos a verlo ahí eso es no sé si es que están durmiendo o es que se han quedado atrapados ok y sé que están durmiendo bueno interesante curioso porque por una parte quieren comer pero por otra parte están atrapados y ahora se quedan más atrapados todavía que antes lo cual no deja de ser curioso puede ser una cosa voy a hacer que orbiten así que más punto y partido 2 con hacer es orbitar 90 grados esto va a hacer un efecto bastante curioso y vamos a verlo y lo que ocurre y lo que ocurre vales que quedan un poco atrapados entre sí se evitan pero al final pues no pueden evitar digamos lo que puedo hacer es digamos eximirlos o hacer el tamaño más grande o más pequeño quería decir a ver si distancia es menor que 5 y distancia es mayor que 3 voy a hacer incluso y hambriento es igual a falls digamos que no se busquen cuando están hambrientos no lo sé vamos a verlo la idea es ir probando así que cuando no están hambrientos pues la idea es que entonces puedan tener más libertad allí ahora se supone que están comiendo pero yo creo que unos cuantos se han quedado atrapados así que la idea es eso la idea es que como vemos en un momento dado buena parte de que hay uno que se queda durmiendo pero de alguna forma lo que puedo hacer es que se eviten entre sí por ejemplo claro es que ese nunca llega a comer y vamos a decirles qué dirección ángel rubiáns y voy a ver si puedo decirles y que caminen un poquito o sea que se eviten y que pegaron golpe digamos y la idea es que cuando colisionan entre sí pues se pegan un empujón digamos pero bueno algo tendría que retocar el código porque como podemos ver pues yo creo que se quedan muy enganchados entre ellos yo creo que si quedar enganchados vamos a ver sí con que estén lejos que ya coman busco comida si distancia es menor que vamos a poner 50 pues ya comen y así un poco la idea es que mira como en todos a comer la idea es que puedan comer y no se queden atrapados porque haya otros que no les dejen comer y ahí salen ahí se han quedado enganchados y bueno como vemos la idea es ir retocando el código hasta que finalmente tengamos un poco el comportamiento que esperamos y esa es un poco la idea bueno por último voy a aprovechar para hacer un repaso de lo que hemos hecho en el ejercicio sobre todo voy a comentar el archivo tarea 8 que es el archivo que más tengo sin comentar así que vamos a por ello vamos a crear una serie de comentarios originalmente le asignó un identificador a este objeto a continuación le asigno una variable que recibirá la colección de datos que corresponden a los otros objetos le asigno una variable que corresponderá a la colección de datos que corresponde a la comida bien y entonces digo esta función se ejecuta cuando recibo un mensaje identificador es el que le pasa a la función principal recojo esto aquí recojo los datos de los otros objetos y los pongo dentro de la variable y recojo los datos de la comida y los pongo en la variable bien esta es una línea que realmente al final no hace nada recordemos ahora vamos a ver como en un momento dado voy a tener un bucle como arrancó una variable temporizador llamo a la función de inicio que se ejecuta una vez cuando el personaje nace como le aplicó una posición x aleatoria de la misma forma le aplicó una posición y aleatoria le pongo un color rojo aleatorio le pongo un color verde aleatorio le pongo un color azul aleatorio y ahora en las propiedades del objeto le pongo un tamaño inicial de 2 que luego ya cambiaremos le doy una dirección inicial aleatoria entre 0 y 360 grados le doy una velocidad inicial aleatoria le proporcionó una energía inicial aleatoria le doy una cantidad inicial de hambre aleatoria y por defecto cuando el personaje arranca por defecto no está muerto cuando el personaje arranca como por defecto no está dormido cuando el personaje arranca por defecto no está hambriento y ahora cuando el personaje arranca como por defecto no estaba hambriento ahora ejecutó la función de inicio aquí estaría bien que pusiera un espacio la función de inicio de momento lo único que hace es llamar al bucle el bucle que está aquí abajo del todo ahora llegaremos a él entonces esta función busca los bordes y conecta las colisiones entonces sí es cierto que el personaje está fuera de los rangos de la imagen entonces en ese caso el personaje pega la vuelta esta función se encarga de gestionar el movimiento del personaje actualizamos la posición x en base al coseno trigonométrico de la dirección por la velocidad el coche no coseno actualizamos la posición y en base al seno trigonométrico cuando el personaje se está moviendo inevitablemente pierde un poco de energía y cuando el personaje se está moviendo gana un poquito de hambre ahora vamos a abrir esta función controla que el personaje vaya cambiando poco a poco de dirección y por tanto le añadimos una pequeña componente aleatoria al ángulo de dirección del personaje esta función se encarga de la búsqueda de comida solo se ejecuta en el caso de que el personaje esté hambriento miramos donde están todos los comederos para cada uno de los comederos sacamos la distancia en horizontal sacamos a continuación la distancia en vertical y mediante esta fórmula calculamos el módulo de la distancia entonces en el caso de que la distancia sea menor que 60 como es decir como que esté cerca me dirijo hacia ese comedero esto quiere decir actualizo mi ángulo y en el caso de que la distancia sea poca rebajó mi cantidad de hambre como lo que quiere decir que estoy comiendo la función como al final no la he llamado esta función gestiona que los personajes se eviten entre sí sacamos la distancia en horizontal sacamos la distancia en vertical miro dónde están todos y cada uno del resto de los personajes para cada uno de los personajes miro mi distancia con respecto a ellos y en el caso de que el personaje esté cerca busco el ángulo de escape y lo aplico a mi angulo actualizo mi posición x con respecto a ese nuevo ángulo actualizo mi posición y con respecto a ese nuevo ángulo y temporalmente cambio mi tamaño simplemente para que se sepa que es colisionado y ahora la función duerme esto es lo que ocurre cuando el personaje duerme su energía se recupera pero cuidado porque su hambre también sube y esto es lo que ocurre cuando el personaje muere por defecto la variable muerte se pone en verdadero su color se vuelve negro creo que no he puesto aquí la función muerte en ninguna parte si hambre es menor que 0 hombre es igual a 0 sin muerto fall sí creo que no he visto por ninguna parte donde realmente se muere el personaje cuando pasa nada esta es la función de bucle que se ejecuta constantemente no es posible tener hambre negativa tiene región cuidado esto allí no es posible tener más de 100 puntos de energía y entonces si el personaje está vivo en ese caso su tamaño está en función de su energía activamos la función de colisión de bordes activamos la función de cambio de dirección activamos la función de búsqueda de comida si el personaje tiene poca energía se queda dormido si el personaje está dormido se ejecuta la función de dormir si la energía del personaje estaba por encima de 80 deja de dormir si el personaje ya no está dormido se puede mover si el hambre del personaje está por encima de 80 quiere decir que está hambriento si el hambre está por debajo de 20 deja de estar hambriento activamos la función de evitarse y pasamos a la función principal los datos del personaje limpiamos el temporizador anterior y creamos un temporizador recursivo que se llama a sí mismo para hacer otra vuelta del bucle y con esto por tanto como vemos tenemos ya el código comentado para que en un momento dado pues podamos tener en la documentación de qué es lo que hace cada línea de este archivo