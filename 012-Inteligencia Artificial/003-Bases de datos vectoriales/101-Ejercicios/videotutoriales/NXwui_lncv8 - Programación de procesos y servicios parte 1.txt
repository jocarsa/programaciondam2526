una de las primeras cosas que vamos a ver dentro de esta acción formativa que tiene que ver con dispositivos de cálculo y de computación dentro de cualquier tipo de máquina es la cantidad de sub dispositivos de computación que queremos realmente dentro de nuestro hardware yo por ejemplo en este caso dentro de este ordenador dentro de este equipo con el que estoy trabajando ahora mismo pues dispongo de cuatro núcleos de procesamiento esta gráfica puede encontrarse en prácticamente cualquier sistema operativo reciente cualquier sistema operativo moderno y básicamente esta gráfica nos dice cuántos procesadores tenemos y además nos dice que carga tenemos ahora mismo en cada uno de ellos bien en este caso antes de empezar a grabar este vídeo pues tenía vamos a darle por aquí tenía una cierta carga del sistema operativo pero a partir de que he empezado a grabar el vídeo pues evidentemente estoy usando un programa que distribuye la carga entre diferentes procesadores y por tanto veo como la carga pues asumió bien en este caso por tanto nos dejamos este procesador aquí y esta gráfica aquí y vamos a demostrar primero cuál es el problema y luego cuál es una de las soluciones es decir el problema es que cuando creamos un programa ese programa por regla general a menos que nosotros lo digamos no es capaz de distribuirse entre diferentes procesadores pero a continuación veremos la solución para este problema así que voy a sacar un editor de texto no importa cual vamos a verlo voy a sacar un editor de texto con el que pueda escribir código en este caso voy a trabajar con javascript y lo que voy a hacer en este caso es que aquí por ejemplo voy a crear una carpeta llamada procesos y dentro de esta carpeta voy a guardar un archivo dentro de escritorio procesos llamado index 1.7 ml así que lo que voy a hacer ahora dentro de este documento vamos a hacerlo un poco más grande para que lo podamos ver mejor vamos a poner 16 píxeles de tamaño taita html voy a crear la estructura básica para un documento vale ya continuación voy a abrir un pequeño javascript y ese javascript en esta ocasión quiero que haga una operación realmente bueno más que compleja realmente que sea una operación costosa así que voy a hacer lo siguiente bar número es igual a cero punto cero 000 euros- cuántos números vamos a ver qué pasa vamos a poner un punto y coma al final y ahora a continuación voy a hacer un bucle for largo voy a hacer var iteraciones es igual a muchísimas iteraciones y digo por bar y es igual a 0 y es menor que iteraciones y más y por ejemplo quiero multiplicar número es igual al número x 1.000 00 y unos cuantos números más la idea es que quiero realizar una serie de operaciones básicas una serie de operaciones pues bueno digamos básicas pero complejas que sean muchas operaciones así que con solé punto log voy a poner aquí techo y vamos a abrir este vamos abrir este javascript vamos a abrirlo con el navegador y vamos a verlo vemos como el navegador está calculando y vemos como también la carga en las cpu en los cuatro núcleos de la cpu ha subido pero sin embargo aunque ha subido vamos a esperar aunque ha subido y finalmente no ocupa los cuatro núcleos no ocupa a los cuatro cores de procesamiento y por tanto digamos estoy infrautilizando el procesador lo que está ocurriendo es que vamos a esperar vamos a poner un poquito menos de operaciones quizás me he pasado un poco vamos a verlo paramos al parar recuperaremos el procesador y ahora voy a ejecutarlo de nuevo que queda un poquito vamos allá consola hecho bueno vale parece que podemos ponerle unos pocos ceros más vamos a verlo ahí he hecho 10 más y ahora si vemos como tarda un momento y al final nos da el resultado bueno nos dice hecho y de hecho si queremos pues también podemos decirle que queremos ver el resultado podríamos sacar por la consola el número vamos a verlo y he hecho número vamos a ver cuál es el número que ha salido entonces a continuación voy a querer saber cuánto tiempo ha tardado el programa en sacar la información bueno este es el número que tengo al final bien su número perfectamente válido bueno ahora quiero no ya calcular a ojo el tiempo que ha pasado desde el principio hasta el final sino que lo que quiero es calcular con precisión cuánto tiempo ha tardado el programa para eso vamos a utilizar la librería de fechas que tienen javascript y para eso lo que haré es comparar en un momento dado pues como digo el tiempo que ha pasado por ejemplo con los mini segundos de la época y unix bien así que ahora lo que voy a hacer en este caso es que voy a introducir voy a sacar primero cuál es la fecha en este momento y a continuación voy a sacar cuál es la fecha al final en cuanto a la fecha la voy a sacar en un formato un poco especial que es el número de milisegundos que han pasado desde el día 1 de enero de 1970 es una referencia es lo que se llama la época iunics la era y unix en la cual pues digamos que el tiempo se mide a partir de ese momento así que a continuación voy a hacer lo siguiente voy a decir creo una constante que se llama tiempo inicio y le voy a decir que es de punto así que tengo por aquí el tiempo de inicio y quiero sacar con solé punto el ojo el tiempo inicio guarde recargo el procesador como vemos empieza a funcionar el procesador como vemos intenta repartir la carga entre los diferentes núcleos esto lo hace directamente cada uno de los cada uno de los navegadores y en este caso nos dice que el tiempo al inicio era este de aquí este es el tiempo y unix en este caso en milisegundos como digo es el número de medir segundos que han pasado desde el día 1 de enero de 1970 hasta ahora mismo bien ahora lo que voy a hacer es decirle al sistema que quiero el tiempo final y por tanto al final voy a decir el tiempo requerido para usar o para digamos trabajar o para calcular este programa ha sido de más y ahora evidentemente tiempo final menos tiempo de inicio así que si todo va bien vamos allá guardamos recargamos y vamos a ver cuánto tiempo los dice vamos a verlo bien y nos dice que el tiempo requerido para calcular este programa ha sido de 16 mil 807 milisegundos o lo que es lo mismo 16 segundos pero con los milisegundos calculados bueno en este caso podemos observar cómo estamos infra utilizando los recursos de cálculo que tenemos en este ordenador ahora mismo tengo cuatro núcleos de cálculo pero de igual aunque tuviera ocho núcleos de cálculo aunque tuviera 16 núcleos de cálculo finalmente seguiría utilizando uno de estos núcleos de cálculo lo que quiero decir en definitiva es que cuanto más potente sea mi ordenador más lo voy a ir para utilizar si no aprendo a trabajar programando aprovechando los diferentes núcleos ahora vamos a hacer otra cosa vamos a indicarle al sistema que esto es el cálculo 1 para continuación en este programa quiero hacer un cálculo 2 un cálculo 3 y un cálculo 4 calculo 3 y calculo 4 vamos a poner un con solo punto logo para saber qué es lo que está ocurriendo vamos con el cálculo 1 me habló sin acentos calculo 2 cálculo 3 calculo 4 aquí es cuando llegamos a otro cuello de botella importante porque vamos con el cálculo 1 y el programa se queda detenido en el cálculo 1 hasta que el programa no acaba el cálculo 1 no va a empezar el cálculo 2 lo estamos viendo aquí en el monitor en el vamos a ver lo más grande lo estamos viendo aquí ahora vemos que ha pasado con el cálculo 2 vemos que ha pasado al cálculo 2 una vez que acabe el cálculo 2 empezará el cálculo 3 y luego el cálculo 4 y el problema es que mientras tanto podemos observar fácilmente la gráfica de rendimiento como pues prácticamente tenemos la mitad de nuestro ordenador tenemos el 50% de nuestra capacidad de proceso sin utilizar así que en este caso como nos podemos imaginar a continuación nuestro objetivo va a ser utilizar aprender a utilizar esa potencia de cálculo vamos a comprobar cuál es el tiempo final para anotar lo más que nada vamos a por ello y nos dice que el tiempo requerido para calcular este programa ha sido de 64 mil 171 milisegundos o lo que es lo mismo 64 segundos a continuación quedémonos con este número quedémonos con este valor quedémonos con este dato y lo que voy a hacer a continuación es empezar a trabajar distribuyendo la potencia entre varios procesadores para comprobar cuál es nuestra ganancia de rendimiento para ello lo que voy a hacer es que voy a guardar este index como siguiente versión index 2 y a continuación aquí me voy a ir a otro archivo así que vengo por aquí abro index 2 no quiero cambiar index 1 más que nada porque no quiero perder el trato de aquí porque luego lo quiero comparar evidentemente así que ahora vengo por aquí y lo que voy a hacer es decir bar número de núcleos quiero saber cuántos núcleos de procesador tengo ahora mismo en este ordenador entonces digo navigator junto a hardware concurrencia así que vengo por aquí y digo con soles puntos el ordenador en el que estás ahora mismo tiene + número de núcleos para que no me aparezca el error de javascript para que no me aparezca error de javascript voy a poner la etiqueta meta charles set es igual a efe 8 para que los acentos se interpreten correctamente y vemos como para empezar este 4 proviene de esta variable número de núcleos y vemos cómo efectivamente si aquí hay 4 gráficas es decir si realmente el procesador tiene cuatro núcleos pues vemos como allí indica que tiene realmente cuatro núcleos vemos como tiene cuatro núcleos para procesar bien pues ahora a continuación lo que quiero hacer es utilizar esos cuatro núcleos quiero decirle al programa que realmente quiero hacer uso de esos cuatro núcleos diferentes para trabajar y esto lo voy a hacer evidentemente cada programa digamos cada el lenguaje de programación tiene sus propias estrategias para trabajar con múltiples núcleos en mi caso voy a utilizar una estrategia que se llaman workers los workers digamos los trabajadores son elementos que nos van a permitir trabajar con múltiples núcleos vamos a verlos bien a continuación vamos a hacer lo siguiente voy a crear vamos a verlo por aquí vamos a verlo voy a crear un archivo nuevo voy a copiar el anterior voy a copiar la anterior lo voy a guardar como index 3 y ahora voy a demostrar el uso de un worker así que para ello voy a hacer lo siguiente puede decir bar trabajador es igual a new worker ya sabemos que sea algo lo pongo en español es porque lo podemos cambiar es porque podemos poner lo que queramos pero si algo lo pongo en inglés es porque tiene que estar así que worker es una un objeto una clase que existe en el navegador web en cualquier navegador web moderno y digo tarea punto js es una tarea que va a llevar a cabo el worker entonces a continuación lo que voy a hacer es un poco estar pendiente de qué es lo que me dice este worker y voy a decir trabajador punto el mes 6 cuando el trabajador me envíe un mensaje de vuelta voy a decir función y con solé punto log el trabajador ha dicho algo de momento no va a decir nada no creo que diga nada vamos a verlo digo 3 y me dice en este caso me dice que yo he prometido que va a existir un archivo llamado tarea js pero no existe ese archivo tarea punto j s así que no pasa nada voy a crear un archivo llamado tarea punto js y ahora a continuación vamos a ver ok vamos a recargar y luego sale vamos a ver bien en este caso dice que el origin es nulo es decir que lo estoy intentando cargar directamente desde bueno desde el sistema de archivos y lo que voy a hacer es decirle que lo voy a cargar desde un servidor web local entonces voy a pasarlo aquí y voy a pasarlo ht docs valero pasó a procesos lo abro desde ahí y ahora lo único es que he tenido que cerrar el navegador no pasa nada acordémonos de que antes teníamos una marca de 64 segundos vale por tanto en localhost procesos invex 3 punto html bien vamos a expresión ar ok vale vamos a consola y ya está esto es lo que nos dice ahora ya no tenemos el error del servidor esto es lo que nos dice el worker y es que de momento no nos dice nada pero no pasa nada porque a continuación lo que vamos a hacer es que el worker realmente diga algo entonces vamos a por ello vamos a cargar mi tarea punto j s y voy a hacer lo siguiente vamos a ver por una parte lo que voy a hacer es decirle pues simplemente digamos a la tarea que diga algo pues message y te digo hola desde la tarea ok así que recargo y te digo el trabajador ha dicho algo el trabajador ha dicho algo que ha dicho bueno fijémonos en un mes y lo que hace es escuchar qué es lo que dice el trabajador y el post message lo que hace es elevar un mensaje desde el trabajador hasta la tarea principal tenemos un medio de comunicación unidireccional mediante el cual el trabajador es capaz de enviarle mensajes la tarea principal o sea el trabajador dice cosa está tarea principal escucha vamos a ver qué dice datos entonces quiero saber lo que ha dicho el trabajador ha dicho algo datos recargo me dice en este caso que ha dicho algo vamos a ver con sol punto rojo datos y así lo vemos en crudo y así el sistema nos saca en crudo y nos dice cómo podemos ver en la pantalla e nos dice datos punto data nos dice el trabajador ha dicho algo te digo hola desde la tarea ya tenemos este medio de comunicación unidireccional pero ahora quiero comunicarme también en la otra dirección quiero decirle al trabajador algo entonces vamos a hacer lo siguiente vamos a hacer lo siguiente voy a decirle trabajador punto post message con esto le digo algo hola y entonces a la tarea le puedo decir qué con meses en este caso va en minúsculas curiosamente es igual a function y te digo hola desde la tarea qué es lo que ocurre aquí pues lo que ocurre aquí es que solo se envía un post message cuando se recibe un mes hecho es decir la tarea está quieta esperando a que le tiene un mensaje y cuando le dan un mensaje entonces es cuando dice hola desde la tarea recargamos en este caso dice exactamente lo mismo voy a hacer una cosa voy a quitar el post message y comprobaremos que no ocurre nada es decir el post message desde la tarea principal lo que hace es enviarle un mensaje al trabajador el trabajador lo que hace es escuchar si alguien le envía un mensaje y si alguien le envía un mensaje de vuelta y por tanto la tarea principal escucha un mensaje de vuelta puede parecer un poco complejo realmente tiene mucha lógica pero lo importante es que ya tenemos por aquí un medio de comunicación multidireccional que tenemos por aquí un medio de comunicación bidireccional para comunicar las tareas con la tarea principal y ahora lo importante es que dentro de lo que es digamos la tarea principal pues podemos calcular nuevas tareas podemos crear tantas tareas como necesitemos vamos a por ello ahora lo que voy a hacer dentro de esta tarea es decirle al sistema que quiero traer quiero importar el index 1 html quiero realizar este cálculo lo voy a copiar voy a pegar dentro de tarea y lo que voy a hacer en post message es que voy a lanzar el número voy a devolver el número así que vamos allá recargamos vamos a verlo recargamos aquí vemos que el programa ahora se pondrá a funcionar haber un segundo index 3 no se va a poner a funcionar porque no le estoy enviando mensaje ahora es la prueba funcional vamos con el cálculo 1 y dice el trabajador ha dicho algo el trabajador en este caso nos devuelve un número concreto pero lo importante es que la ejecución no se ha parado la ejecución no se ha detenido mientras que el programa estaba calculando bien qué es lo que voy a hacer ahora bueno pues lo que voy a hacer ahora es crear una serie de workers donde cada uno de los workers como ahora veremos se va a colocar en un núcleo diferente de procesamiento vamos a verlo a continuación para ello voy a guardar este archivo como index 4 html vamos a copiar algo de lo que teníamos en index tenemos número de núcleos y ahora digo bar núcleo es igual a trabajador es igual a new worker y voy a cargar el archivo tarea 2 js es new array perdón ahora sí es una nueva colección de algo entonces digo for bar y es igual a 0 y es menor que número de núcleos y más y ahora si le voy a decir trabajador y es igual ahora sí a mi worker tarea 2 punto js esto es muy importante porque lo que he hecho por tanto ya no es un solo worker sino que he hecho un conjunto de workers he hecho un conjunto de diferentes workers en este caso evidentemente tantos workers como núcleos de procesamiento tengo en el sistema y ahora una vez que he creado diferentes workers lo que voy a hacer es enviarles un mensaje voy a decir trabajador de y punto post message y voy a decir comienza simplemente un mensaje de bienvenida ahora en la tarea voy a guardar esta tarea como tarea 2 y realmente la tarea 2 va a tener prácticamente lo mismo que la tarea 1 vamos a verlo vamos con un cálculo ok dos meses número vale y yo creo que ya está simplemente le voy a decir al sistema que voy a hacer al sistema que trabajador rey punto 6 voy a decir función datos y con solé punto log datos punto data bien si todo va bien si todo va bien ahora lo que voy a hacer es recargar el index 3 vamos a verlo ahí el trabajador ha dicho algo a verlo en principio lo ha hecho muy rápido a ver estoy viendo si lo ha hecho o no lo ha hecho en definitiva debería tener 4 vamos a verlo por aquí hasta el index 4 claro ese es el problema muy bien vale trabajador y un mes x notas function vale new worker trabajador un mes 6 así perdón es igual a function ahora sí vale recargo dice vamos con el cálculo y ahora me devuelve cuatro números diferentes que de hecho son los mismos pero fijémonos que lo que ha hecho el sistema en este caso es decirle qué bueno que quiero calcular hay una cosa que me extraña y es que he hecho el mismo exacto cálculo y ha tardado una barbaridad menos que trabajando en la tarea principal vamos a poner ese mismo cálculo recargamos y el programa devuelve el calcula es decir no sólo vemos que lo está calculando mucho más rápido sino que además vemos en ese pico de ahí que ahora realmente está utilizando los múltiples sistemas de cálculo que necesite además yo la puedo venir por aquí y decir muro no quiero solo tener estas iteraciones quiero tener más interacciones así que como podemos ver pues estamos trabajando ahora con cuatro núcleos de procesamiento y sobre todo lo importante es que si nos fijamos ahora en el procesador veremos que cada uno de esos núcleos de procesamiento cada uno de esos workers está trabajando de forma independiente y eso quiere decir que estamos utilizando ahora si el procesador en su plena expresión también evidentemente vamos a tener que enfrentar nuevos retos porque trabajar con un workers evidentemente equivale a trabajar con tareas paralelas tareas que en principio son independientes entre sí tareas que se tienen que pasar información entre sí y en definitiva esto nos va a suponer nuevos retos pero a la vez una vez que hacemos esto también como podemos comprobar pues podemos desbloquear la potencia del ordenador y podemos realmente aprovechar todos los procesadores que tenga un ordenador concreto que además pues cada día son mayores a continuación en los siguientes ejercicios lo que vamos es analizar cómo podemos sacarle partido cómo podemos sacarle rendimiento a esta técnica de programación mediante la cual vamos a poder usar los núcleos de programación de forma independiente hay una cosa interesante de todas formas es la siguiente y es que voy a bajar un poco los números de cálculo y es que yo puedo lanzar más tareas que hilos de procesamiento tengo esto quiere decir que yo por ejemplo en este caso voy a esperar a que acabe este hilo si no lo puedo matar pero bueno no pasa nada por cierto que si vengo por aquí al monitor vamos a ver cpu vale bueno nos muestra los procesos una pena vale pero quería que nos mostraran los subprocesos para que viéramos pues que estaba usando realmente bien vamos a verlo vale entonces como decía no tenemos porque no tenemos por qué quedarnos con tantos núcleos como tengamos evidentemente es recomendable vale pero voy a poner por ejemplo que quiero 100 procesos quiero 100 workers que es lo que va a hacer el programa si yo le pido 100 tareas y tengo 4 procesadores bueno no va a pasar nada no va a pasar nada porque sobre todo lo que quiero ahora momento es matar esta tarea para que finalice así que voy a matarla ok perfecto y ahora es un proceso más pequeño he hecho 100 procesos más grandes y vamos allá y vemos como lo que va a hacer el programa como vemos ahí es que tenemos 100 procesos ahora en cuanto el historial de la cpu se refresque pues veremos como pues bueno se pone al cien por cien de hecho yo diría que está bloqueado el día que está parado está muy bloqueado vamos a verlo cp1 al 100% ahí lo tenemos de vuelta ventana historial de la cpu y por tanto lo que hace el programa ahora se refrescará más que nada porque parece que crear 100 procesos que de golpe ha sido un poco fuerte pero lo que hace el programa básicamente es repartir los 100 procesos entre los núcleos de procesamiento que tenga entonces pues hay evidentemente cuantos más núcleos de procesamiento tenga pues mejor como digo creo que me he pasado a mira yo creo que ya lo tengo por aquí ya lo tengo por aquí de vuelta ahí lo vemos tengo ya los 100 resultados tengo ya hay los núcleos corriendo vale ahora volverá el sistema pero bueno lo que comentaba hay diferentes estrategias una estrategia es un programa y si tengo cuatro núcleos de procesamiento es partirlo por cuatro bloques y enviar cada bloque a su núcleo y hay otra estrategia ya iremos viendo largo de los vídeos que consiste en hacer muchos cachitos diferentes y pequeños e irlos enviando dinámicamente a tantos núcleos como haya para procesar